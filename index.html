<!DOCTYPE html>
<html >
    <head>
        <meta charset="utf-8">
        <title>Spring</title>

        <link rel="stylesheet" href="/dist/css/main.css" charset="utf-8">
    </head>
    <body>
        <nav><div class="title">21. Web Mvc framework</div>
        </nav>

        <div class="documentation-main chapter"><section><h1 id="21-1-spring-web-mvc-">21.1 Spring Web MVCæ¡†æ¶ç®€ä»‹</h1>
<p>Springçš„æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰æ¡†æ¶æ˜¯å›´ç»•ä¸€ä¸ª<code>DispatcherServlet</code>æ¥è®¾è®¡çš„ï¼Œè¿™ä¸ªServletä¼šæŠŠè¯·æ±‚åˆ†å‘ç»™å„ä¸ªå¤„ç†å™¨ï¼Œå¹¶æ”¯æŒå¯é…ç½®çš„å¤„ç†å™¨æ˜ å°„ã€è§†å›¾æ¸²æŸ“ã€æœ¬åœ°åŒ–ã€æ—¶åŒºä¸ä¸»é¢˜æ¸²æŸ“ç­‰ï¼Œç”šè‡³è¿˜èƒ½æ”¯æŒæ–‡ä»¶ä¸Šä¼ ã€‚å¤„ç†å™¨æ˜¯ä½ çš„åº”ç”¨ä¸­æ³¨è§£äº†<code>@Controller</code>å’Œ<code>@RequestMapping</code>çš„ç±»å’Œæ–¹æ³•ï¼ŒSpringä¸ºå¤„ç†å™¨æ–¹æ³•æä¾›äº†æå…¶å¤šæ ·çµæ´»çš„é…ç½®ã€‚Spring 3.0ä»¥åæä¾›äº†<code>@Controller</code>æ³¨è§£æœºåˆ¶ã€<code>@PathVariable</code>æ³¨è§£ä»¥åŠä¸€äº›å…¶ä»–çš„ç‰¹æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥è¿›è¡ŒRESTful webç«™ç‚¹å’Œåº”ç”¨çš„å¼€å‘ã€‚</p>
<blockquote>
<p>â€œå¯¹æ‰©å±•å¼€æ”¾â€æ˜¯Spring Web MVCæ¡†æ¶ä¸€ä¸ªé‡è¦çš„è®¾è®¡åŸåˆ™ï¼Œè€Œå¯¹äºSpringçš„æ•´ä¸ªå®Œæ•´æ¡†æ¶æ¥è¯´ï¼Œå…¶è®¾è®¡åŸåˆ™åˆ™æ˜¯â€œå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹é—­åˆâ€ã€‚</p>
<p>Spring Web MVCæ ¸å¿ƒç±»åº“ä¸­çš„ä¸€äº›æ–¹æ³•è¢«å®šä¹‰ä¸º<code>final</code>æ–¹æ³•ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œä½ ä¸èƒ½è¦†å†™è¿™äº›æ–¹æ³•ä»¥å®šåˆ¶å…¶è¡Œä¸ºã€‚å½“ç„¶ï¼Œä¸æ˜¯è¯´ç»å¯¹ä¸è¡Œï¼Œä½†è¯·è®°ä½è¿™æ¡åŸåˆ™ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ä¸æ˜¯å¥½çš„å®è·µã€‚</p>
<p>å…³äºè¯¥åŸåˆ™çš„è¯¦ç»†è§£é‡Šï¼Œä½ å¯ä»¥å‚è€ƒSeth Laddç­‰äººæ‰€è‘—çš„â€œæ·±å…¥è§£æSpring Web MVCä¸Web Flowâ€ä¸€ä¹¦ã€‚ç›¸å…³ä¿¡æ¯åœ¨ç¬¬117é¡µï¼Œâ€œè®¾è®¡åˆæ¢ï¼ˆA Look At Designï¼‰â€ä¸€èŠ‚ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥å‚è€ƒï¼š</p>
<ul>
<li><a href="http://www.objectmentor.com/resources/articles/ocp.pdf">Bob Martinæ‰€å†™çš„â€œå¼€é—­åŸåˆ™ï¼ˆThe Open-Closed Principleï¼‰â€ï¼ˆPDFï¼‰</a></li>
</ul>
<p>ä½ æ— æ³•å¢å¼ºSpring MVCä¸­çš„<code>final</code>æ–¹æ³•ï¼Œæ¯”å¦‚<code>AbstractController.setSynchronizeOnSession()</code>æ–¹æ³•ç­‰ã€‚è¯·å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/aop.html#aop-understanding-aop-proxies">10.6.1 ç†è§£AOPä»£ç†</a>ä¸€èŠ‚ï¼Œå…¶ä¸­è§£é‡Šäº†AOPä»£ç†çš„ç›¸å…³çŸ¥è¯†ï¼Œè®ºè¿°äº†ä¸ºä»€ä¹ˆä½ ä¸èƒ½å¯¹<code>final</code>æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚</p>
</blockquote>
<p>åœ¨Spring Web MVCä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•å¯¹è±¡æ¥ä½œä¸ºå‘½ä»¤å¯¹è±¡æˆ–è¡¨å•è¿”å›å¯¹è±¡ï¼Œè€Œæ— é¡»å®ç°ä¸€ä¸ªæ¡†æ¶ç›¸å…³çš„æ¥å£æˆ–åŸºç±»ã€‚Springçš„æ•°æ®ç»‘å®šéå¸¸çµæ´»ï¼šæ¯”å¦‚ï¼Œå®ƒä¼šæŠŠæ•°æ®ç±»å‹ä¸åŒ¹é…å½“æˆå¯ç”±åº”ç”¨è‡ªè¡Œå¤„ç†çš„è¿è¡Œæ—¶éªŒè¯é”™è¯¯ï¼Œè€Œéç³»ç»Ÿé”™è¯¯ã€‚ä½ å¯èƒ½ä¼šä¸ºäº†é¿å…éæ³•çš„ç±»å‹è½¬æ¢åœ¨è¡¨å•å¯¹è±¡ä¸­ä½¿ç”¨å­—ç¬¦ä¸²æ¥å­˜å‚¨æ•°æ®ï¼Œä½†æ— ç±»å‹çš„å­—ç¬¦ä¸²æ— æ³•æè¿°ä¸šåŠ¡æ•°æ®çš„çœŸæ­£å«ä¹‰ï¼Œå¹¶ä¸”ä½ è¿˜éœ€è¦æŠŠå®ƒä»¬è½¬æ¢æˆå¯¹åº”çš„ä¸šåŠ¡å¯¹è±¡ç±»å‹ã€‚æœ‰äº†Springçš„éªŒè¯æœºåˆ¶ï¼Œæ„å‘³ç€ä½ å†ä¹Ÿä¸éœ€è¿™ä¹ˆåšäº†ï¼Œå¹¶ä¸”ç›´æ¥å°†ä¸šåŠ¡å¯¹è±¡ç»‘å®šåˆ°è¡¨å•å¯¹è±¡ä¸Šé€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<p>Springçš„è§†å›¾è§£æä¹Ÿæ˜¯è®¾è®¡å¾—å¼‚å¸¸çµæ´»ã€‚æ§åˆ¶å™¨ä¸€èˆ¬è´Ÿè´£å‡†å¤‡ä¸€ä¸ª<code>Map</code>æ¨¡å‹ã€å¡«å……æ•°æ®ã€è¿”å›ä¸€ä¸ªåˆé€‚çš„è§†å›¾åç­‰ï¼ŒåŒæ—¶å®ƒä¹Ÿå¯ä»¥ç›´æ¥å°†æ•°æ®å†™åˆ°å“åº”æµä¸­ã€‚è§†å›¾åçš„è§£æé«˜åº¦çµæ´»ï¼Œæ”¯æŒå¤šç§é…ç½®ï¼ŒåŒ…æ‹¬é€šè¿‡æ–‡ä»¶æ‰©å±•åã€<code>Accept</code>å†…å®¹å¤´ã€beanã€é…ç½®æ–‡ä»¶ç­‰çš„é…ç½®ï¼Œç”šè‡³ä½ è¿˜å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªè§†å›¾è§£æå™¨<code>ViewResolver</code>ã€‚æ¨¡å‹ï¼ˆMVCä¸­çš„Mï¼Œmodelï¼‰å…¶å®æ˜¯ä¸€ä¸ª<code>Map</code>ç±»å‹çš„æ¥å£ï¼Œå½»åº•åœ°æŠŠæ•°æ®ä»è§†å›¾æŠ€æœ¯ä¸­æŠ½è±¡åˆ†ç¦»äº†å‡ºæ¥ã€‚ä½ å¯ä»¥ä¸åŸºäºæ¨¡æ¿çš„æ¸²æŸ“æŠ€æœ¯ç›´æ¥æ•´åˆï¼Œå¦‚JSPã€Velocityå’ŒFreemarkerç­‰ï¼Œæˆ–è€…ä½ è¿˜å¯ä»¥ç›´æ¥ç”ŸæˆXMLã€JSONã€Atomä»¥åŠå…¶ä»–å¤šç§ç±»å‹çš„å†…å®¹ã€‚<code>Map</code>æ¨¡å‹ä¼šç®€å•åœ°è¢«è½¬æ¢æˆåˆé€‚çš„æ ¼å¼ï¼Œæ¯”å¦‚JSPçš„è¯·æ±‚å±æ€§ï¼ˆattributeï¼‰ï¼Œä¸€ä¸ªVelocityæ¨¡æ¿çš„æ¨¡å‹ç­‰ã€‚</p>
</section<section><h1 id="21-1-1-spring-web-mvc-">21.1.1 Spring Web MVCçš„æ–°ç‰¹æ€§</h1>
<blockquote>
<p>Spring Web Flow</p>
<p>Spring Web Flow (SWF) æ„åœ¨æˆä¸ºwebåº”ç”¨ä¸­çš„é¡µé¢æµ(page flow)ç®¡ç†ä¸­æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>SWFåœ¨Servletç¯å¢ƒå’ŒPortletç¯å¢ƒä¸‹é›†æˆäº†ç°æœ‰çš„æ¡†æ¶ï¼Œå¦‚Spring MVCå’ŒJSFç­‰ã€‚å¦‚æœä½ çš„ä¸šåŠ¡æµç¨‹æœ‰ä¸€ä¸ªè´¯ç©¿å§‹ç»ˆçš„æ¨¡å‹ï¼Œè€Œéå•çº¯åˆ†ç«‹çš„è¯·æ±‚ï¼Œé‚£ä¹ˆSWFå¯èƒ½æ˜¯é€‚åˆä½ çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>SWFå…è®¸ä½ å°†é€»è¾‘ä¸Šçš„é¡µé¢æµæŠ½å–æˆç‹¬ç«‹å¯å¤ç”¨çš„æ¨¡å—ï¼Œè¿™å¯¹äºæ„å»ºä¸€ä¸ªwebåº”ç”¨çš„å¤šä¸ªæ¨¡å—æ˜¯æœ‰ç›Šçš„ã€‚that guide the user through controlled navigations that drive business processes.</p>
<p>å…³äºSWFçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®<a href="http://projects.spring.io/spring-webflow/">Spring Web Flowçš„å®˜ç½‘</a>ã€‚</p>
</blockquote>
<p>Springçš„webæ¨¡å—æ”¯æŒè®¸å¤šwebç›¸å…³çš„ç‰¹æ€§ï¼š</p>
<ul>
<li>æ¸…æ™°çš„èŒè´£åˆ†ç¦»ã€‚æ¯ä¸ªè§’è‰²â€”â€”æ§åˆ¶å™¨ï¼ŒéªŒè¯å™¨ï¼Œå‘½ä»¤å¯¹è±¡ï¼Œè¡¨å•å¯¹è±¡ï¼Œæ¨¡å‹å¯¹è±¡ï¼Œ<code>DispatcherServlet</code>ï¼Œå¤„ç†å™¨æ˜ å°„ï¼Œè§†å›¾è§£æå™¨ï¼Œç­‰ç­‰è®¸å¤šâ€”â€”çš„å·¥ä½œï¼Œéƒ½å¯ä»¥ç”±ç›¸åº”çš„å¯¹è±¡æ¥å®Œæˆã€‚</li>
<li>å¼ºå¤§ã€ç›´è§‚çš„æ¡†æ¶å’Œåº”ç”¨beançš„é…ç½®ã€‚è¿™ç§é…ç½®èƒ½åŠ›åŒ…æ‹¬èƒ½å¤Ÿä»ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œç®€å•çš„å¼•ç”¨ï¼Œæ¯”å¦‚åœ¨webæ§åˆ¶å™¨ä¸­å¼•ç”¨ä¸šåŠ¡å¯¹è±¡ã€éªŒè¯å™¨ç­‰ã€‚</li>
<li>å¼ºå¤§çš„é€‚é…èƒ½åŠ›ã€éä¾µå…¥æ€§å’Œçµæ´»æ€§ã€‚Spring MVCæ”¯æŒä½ å®šä¹‰ä»»æ„çš„æ§åˆ¶å™¨æ–¹æ³•ç­¾åï¼Œåœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹ä½ è¿˜å¯ä»¥æ·»åŠ é€‚åˆçš„æ³¨è§£ï¼ˆæ¯”å¦‚<code>@RequestParam</code>ã€<code>@RequestHeader</code>ã€<code>@PathVariable</code>ç­‰ï¼‰</li>
<li>å¯å¤ç”¨çš„ä¸šåŠ¡ä»£ç ï¼Œä½¿ä½ è¿œç¦»é‡å¤ä»£ç ã€‚ä½ å¯ä»¥ä½¿ç”¨å·²æœ‰çš„ä¸šåŠ¡å¯¹è±¡ä½œä¸ºå‘½ä»¤å¯¹è±¡æˆ–è¡¨å•å¯¹è±¡ï¼Œè€Œä¸éœ€è®©å®ƒä»¬å»ç»§æ‰¿ä¸€ä¸ªæ¡†æ¶æä¾›çš„ä»€ä¹ˆåŸºç±»ã€‚</li>
<li>å¯å®šåˆ¶çš„æ•°æ®ç»‘å®šå’ŒéªŒè¯ã€‚ç±»å‹ä¸åŒ¹é…ä»…è¢«è®¤ä¸ºæ˜¯åº”ç”¨çº§åˆ«çš„éªŒè¯é”™è¯¯ï¼Œé”™è¯¯å€¼ã€æœ¬åœ°åŒ–æ—¥æœŸã€æ•°å­—ç»‘å®šç­‰ä¼šè¢«ä¿å­˜ã€‚ä½ ä¸éœ€è¦å†åœ¨è¡¨å•å¯¹è±¡ä½¿ç”¨å…¨Stringå­—æ®µï¼Œç„¶åå†æ‰‹åŠ¨å°†å®ƒä»¬è½¬æ¢æˆä¸šåŠ¡å¯¹è±¡ã€‚</li>
<li>å¯å®šåˆ¶çš„å¤„ç†å™¨æ˜ å°„å’Œè§†å›¾è§£æã€‚å¤„ç†å™¨æ˜ å°„å’Œè§†å›¾è§£æç­–ç•¥ä»ç®€å•çš„åŸºäºURLé…ç½®ï¼Œåˆ°ç²¾ç»†ä¸“ç”¨çš„è§£æç­–ç•¥ï¼ŒSpringå…¨éƒ½æ”¯æŒã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼ŒSpringæ¯”ä¸€äº›ä¾èµ–äºç‰¹å®šæŠ€æœ¯çš„webæ¡†æ¶è¦æ›´åŠ çµæ´»ã€‚</li>
<li>çµæ´»çš„æ¨¡å‹ä¼ é€’ã€‚Springä½¿ç”¨ä¸€ä¸ªåç§°/å€¼å¯¹çš„Mapæ¥åšæ¨¡å‹ï¼Œè¿™ä½¿å¾—æ¨¡å‹å¾ˆå®¹æ˜“é›†æˆã€ä¼ é€’ç»™ä»»ä½•ç±»å‹çš„è§†å›¾æŠ€æœ¯ã€‚</li>
<li>å¯å®šåˆ¶çš„æœ¬åœ°åŒ–ä¿¡æ¯ã€æ—¶åŒºå’Œä¸»é¢˜è§£æã€‚æ”¯æŒç”¨/ä¸ç”¨Springæ ‡ç­¾åº“çš„JSPæŠ€æœ¯ï¼Œæ”¯æŒJSTLï¼Œæ”¯æŒæ— éœ€é¢å¤–é…ç½®çš„Velocityæ¨¡æ¿ï¼Œç­‰ç­‰ã€‚;</li>
<li>ä¸€ä¸ªç®€å•ä½†åŠŸèƒ½å¼ºå¤§çš„JSPæ ‡ç­¾åº“ï¼Œé€šå¸¸ç§°ä¸ºSpringæ ‡ç­¾åº“ï¼Œå®ƒæä¾›äº†è¯¸å¦‚æ•°æ®ç»‘å®šã€ä¸»é¢˜æ”¯æŒç­‰ä¸€äº›ç‰¹æ€§çš„æ”¯æŒã€‚è¿™äº›å®šåˆ¶çš„æ ‡ç­¾ä¸ºæ ‡è®°ï¼ˆmarkupï¼‰ä½ çš„ä»£ç æä¾›äº†æœ€å¤§ç¨‹åº¦çš„çµæ´»æ€§ã€‚å…³äºæ ‡ç­¾åº“æè¿°ç¬¦ï¼ˆdescriptorï¼‰çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒé™„å½•<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/spring-tld.html">ç¬¬42ç«  Spring JSPæ ‡ç­¾åº“</a></li>
<li>ä¸€ä¸ªSpring 2.0å¼€å§‹å¼•å…¥çš„JSPè¡¨å•æ ‡ç­¾åº“ã€‚å®ƒè®©ä½ åœ¨JSPé¡µé¢ä¸­ç¼–å†™è¡¨å•ç®€å•è®¸å¤šã€‚å…³äºæ ‡ç­¾åº“æè¿°ç¬¦ï¼ˆdescriptorï¼‰çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒé™„å½• <a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/spring-form-tld.html">ç¬¬43ç«  Springè¡¨å•çš„JSPæ ‡ç­¾åº“</a></li>
<li>æ–°å¢ç”Ÿå‘½å‘¨æœŸä»…ç»‘å®šåˆ°å½“å‰HTTPè¯·æ±‚æˆ–HTTPä¼šè¯çš„Beanç±»å‹ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸æ˜¯Spring MVCè‡ªèº«çš„ç‰¹æ€§ï¼Œè€Œæ˜¯Spring MVCä½¿ç”¨çš„ä¸Šä¸‹æ–‡å®¹å™¨<code>WebApplicationContext</code>æ‰€æä¾›çš„ç‰¹æ€§ã€‚è¿™äº›beançš„scopeåœ¨<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/beans.html#beans-factory-scopes-other">6.5.4 è¯·æ±‚ã€ä¼šè¯åŠå…¨å±€ä¼šè¯scope</a>ä¸€èŠ‚æœ‰è¯¦ç»†æè¿°ã€‚</li>
</ul>
</section<section><h1 id="21-1-2-mvc-">21.1.2 å…è®¸å…¶ä»–MVCå®ç°</h1>
<p>æœ‰äº›é¡¹ç›®å¯èƒ½æ›´å€¾å‘äºä½¿ç”¨éSpringçš„MVCæ¡†æ¶ã€‚ è®¸å¤šå›¢é˜Ÿå¸Œæœ›ä»ç„¶ä½¿ç”¨ç°æœ‰çš„æŠ€æœ¯æ ˆï¼Œæ¯”å¦‚JSFç­‰ï¼Œè¿™æ ·ä»–ä»¬æŒæ¡çš„æŠ€èƒ½å’Œå·¥å…·ä¾ç„¶èƒ½å‘æŒ¥ä½œç”¨ã€‚</p>
<p>å¦‚æœä½ ç¡®å®ä¸æƒ³ä½¿ç”¨Springçš„Web MVCï¼Œä½†åˆå¸Œæœ›èƒ½ä»Springæä¾›çš„ä¸€äº›è§£å†³æ–¹æ¡ˆä¸­å—ç›Šï¼Œé‚£ä¹ˆå°†ä½ æ‰€ä½¿ç”¨çš„æ¡†æ¶å’ŒSpringè¿›è¡Œé›†æˆä¹Ÿå¾ˆå®¹æ˜“ã€‚åªéœ€è¦åœ¨<code>ContextLoaderListener</code>ä¸­å¯åŠ¨ä¸€ä¸ªSpringçš„æ ¹åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆroot application contextï¼‰ï¼Œç„¶åä½ å°±å¯ä»¥åœ¨ä»»ä½•actionå¯¹è±¡ä¸­é€šè¿‡å…¶<code>ServletContext</code>å±æ€§ï¼ˆæˆ–é€šè¿‡Springå¯¹åº”çš„helperæ–¹æ³•ï¼‰å–å¾—ã€‚ä¸éœ€è¦ä»»ä½•ä¾µå…¥æ€§çš„æ’ä»¶ï¼Œå› æ­¤ä¸éœ€è¦å¤æ‚çš„é›†æˆã€‚ä»åº”ç”¨å±‚çš„è§†è§’æ¥çœ‹ï¼Œä½ åªæ˜¯å°†Springå½“æˆä¾èµ–åº“ä½¿ç”¨ï¼Œå¹¶ä¸”å°†å®ƒçš„æ ¹åº”ç”¨ä¸Šä¸‹æ–‡å®ä¾‹ä½œä¸ºåº”ç”¨è¿›å…¥ç‚¹ã€‚</p>
<p>å³ä½¿ä¸ç”¨Springçš„Web MVCæ¡†æ¶ï¼Œä½ é…ç½®çš„å…¶ä»–Springçš„beanå’ŒæœåŠ¡ä¹Ÿéƒ½èƒ½å¾ˆæ–¹ä¾¿åœ°å–å¾—ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼ŒSpringä¸å…¶ä»–webæ¡†æ¶çš„ä½¿ç”¨ä¸å†²çªã€‚Springåªæ˜¯åœ¨è®¸å¤šé—®é¢˜ä¸Šæå‡ºäº†å…¶ä»–çº¯web MVCæ¡†æ¶æœªæ›¾æå‡ºè¿‡çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚beançš„é…ç½®ã€æ•°æ®å­˜å–ã€äº‹åŠ¡å¤„ç†ç­‰ï¼Œä»…æ­¤è€Œå·²ã€‚å› æ­¤ï¼Œå¦‚æœä½ åªæ˜¯æƒ³ä½¿ç”¨Springçš„ä¸€éƒ¨åˆ†ç‰¹æ€§æ¥å¢å¼ºä½ çš„åº”ç”¨ï¼Œæ¯”å¦‚Springæä¾›çš„JDBC/Hibernateäº‹åŠ¡æŠ½è±¡ç­‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†Springä½œä¸ºä¸€ä¸ªä¸­é—´å±‚å’Œ/æˆ–æ•°æ®å­˜å–å±‚æ¥ä½¿ç”¨ã€‚</p>
</section<section><h1 id="21-2-dispatcherservlet">21.2 DispatcherServlet</h1>
<p>Spring MVCæ¡†æ¶ï¼Œä¸å…¶ä»–å¾ˆå¤šwebçš„MVCæ¡†æ¶ä¸€æ ·ï¼šè¯·æ±‚é©±åŠ¨ï¼›æ‰€æœ‰è®¾è®¡éƒ½å›´ç»•ç€ä¸€ä¸ªä¸­å¤®Servletæ¥å±•å¼€ï¼Œå®ƒè´Ÿè´£æŠŠæ‰€æœ‰è¯·æ±‚åˆ†å‘åˆ°æ§åˆ¶å™¨ï¼›åŒæ—¶æä¾›å…¶ä»–webåº”ç”¨å¼€å‘æ‰€éœ€è¦çš„åŠŸèƒ½ã€‚ä¸è¿‡Springçš„ä¸­å¤®å¤„ç†å™¨ï¼Œ<code>DispatcherServlet</code>ï¼Œèƒ½åšçš„æ¯”è¿™æ›´å¤šã€‚å®ƒä¸Spring IoCå®¹å™¨åšåˆ°äº†æ— ç¼é›†æˆï¼Œè¿™æ„å‘³ç€ï¼ŒSpringæä¾›çš„ä»»ä½•ç‰¹æ€§ï¼Œåœ¨Spring MVCä¸­ä½ éƒ½å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº†Spring Web MVCçš„<code>DispatcherServlet</code>å¤„ç†è¯·æ±‚çš„å·¥ä½œæµã€‚ç†Ÿæ‚‰è®¾è®¡æ¨¡å¼çš„æœ‹å‹ä¼šå‘ç°ï¼Œ<code>DispatcherServlet</code>åº”ç”¨çš„å…¶å®å°±æ˜¯ä¸€ä¸ªâ€œå‰ç«¯æ§åˆ¶å™¨â€çš„è®¾è®¡æ¨¡å¼ï¼ˆå…¶ä»–å¾ˆå¤šä¼˜ç§€çš„webæ¡†æ¶ä¹Ÿéƒ½ä½¿ç”¨äº†è¿™ä¸ªè®¾è®¡æ¨¡å¼ï¼‰ã€‚</p>
<p><img src="./figures/figure-21-1-the-request-processing-workflow-in-spring-web-mvc.png" alt="å›¾21.1 Spring Web MVCå¤„ç†è¯·æ±‚çš„ï¼ˆé«˜å±‚æŠ½è±¡ï¼‰å·¥ä½œæµ"></p>
<p><code>DispatcherServlet</code>å…¶å®å°±æ˜¯ä¸ª<code>Servlet</code>ï¼ˆå®ƒç»§æ‰¿è‡ª<code>HttpServlet</code>åŸºç±»ï¼‰ï¼ŒåŒæ ·ä¹Ÿéœ€è¦åœ¨ä½ webåº”ç”¨çš„<code>web.xml</code>é…ç½®æ–‡ä»¶ä¸‹å£°æ˜ã€‚ä½ éœ€è¦åœ¨<code>web.xml</code>æ–‡ä»¶ä¸­æŠŠä½ å¸Œæœ›<code>DispatcherServlet</code>å¤„ç†çš„è¯·æ±‚æ˜ å°„åˆ°å¯¹åº”çš„URLä¸Šå»ã€‚è¿™å°±æ˜¯æ ‡å‡†çš„Java EE Servleté…ç½®ï¼›ä¸‹é¢çš„ä»£ç å°±å±•ç¤ºäº†å¯¹<code>DispatcherServlet</code>å’Œè·¯å¾„æ˜ å°„çš„å£°æ˜ï¼š</p>
<pre><code class="lang-xml">&lt;web-app&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;example&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;example&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/example/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</code></pre>
<blockquote>
<p>In the preceding example, all requests starting with <code>/example</code> will be handled by the <code>DispatcherServlet</code> instance named example. In a Servlet 3.0+ environment, you also have the option of configuring the Servlet container programmatically. Below is the code based equivalent of the above web.xml example:</p>
</blockquote>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ‰€æœ‰è·¯å¾„ä»¥<code>/example</code>å¼€å¤´çš„è¯·æ±‚éƒ½ä¼šè¢«åå­—ä¸º<code>example</code>çš„<code>DispatcherServlet</code>å¤„ç†ã€‚åœ¨Servlet 3.0+çš„ç¯å¢ƒä¸‹ï¼Œä½ è¿˜å¯ä»¥ç”¨ç¼–ç¨‹çš„æ–¹å¼é…ç½®Servletå®¹å™¨ã€‚ä¸‹é¢æ˜¯ä¸€æ®µè¿™ç§åŸºäºä»£ç é…ç½®çš„ä¾‹å­ï¼Œå®ƒä¸ä¸Šé¢å®šä¹‰çš„<code>web.xml</code>é…ç½®æ–‡ä»¶æ˜¯ç­‰æ•ˆçš„ã€‚</p>
<pre><code class="lang-java">public class MyWebApplicationInitializer implements WebApplicationInitializer {

    @Override
    public void onStartup(ServletContext container) {
        ServletRegistration.Dynamic registration = container.addServlet(&quot;dispatcher&quot;, new DispatcherServlet());
        registration.setLoadOnStartup(1);
        registration.addMapping(&quot;/example/*&quot;);
    }

}
</code></pre>
<p><code>WebApplicationInitializer</code>æ˜¯Spring MVCæä¾›çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒä¼šæŸ¥æ‰¾ä½ æ‰€æœ‰åŸºäºä»£ç çš„é…ç½®ï¼Œå¹¶åº”ç”¨å®ƒä»¬æ¥åˆå§‹åŒ–Servlet 3ç‰ˆæœ¬ä»¥ä¸Šçš„webå®¹å™¨ã€‚å®ƒæœ‰ä¸€ä¸ªæŠ½è±¡çš„å®ç°<code>AbstractDispatcherServletInitializer</code>ï¼Œç”¨ä»¥ç®€åŒ–<code>DispatcherServlet</code>çš„æ³¨å†Œå·¥ä½œï¼šä½ åªéœ€è¦æŒ‡å®šå…¶servletæ˜ å°„ï¼ˆmappingï¼‰å³å¯ã€‚è‹¥æƒ³äº†è§£æ›´å¤šç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒ<a href="../21-15/code-based-servlet-container-initialization.md">åŸºäºä»£ç çš„Servletå®¹å™¨åˆå§‹åŒ–</a>ä¸€èŠ‚ã€‚</p>
<p>ä¸Šé¢åªæ˜¯é…ç½®Spring Web MVCçš„ç¬¬ä¸€æ­¥ï¼Œæ¥ä¸‹æ¥ä½ éœ€è¦é…ç½®å…¶ä»–çš„ä¸€äº›beanï¼ˆé™¤äº†<code>DispatcherServlet</code>ä»¥å¤–çš„å…¶ä»–beanï¼‰ï¼Œå®ƒä»¬ä¹Ÿä¼šè¢«Spring Web MVCæ¡†æ¶ä½¿ç”¨åˆ°ã€‚</p>
<p>åœ¨<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/beans.html#context-introduction">6.15 åº”ç”¨ä¸Šä¸‹æ–‡ApplicationContextçš„å…¶ä»–ä½œç”¨)</a>ä¸€èŠ‚ä¸­æˆ‘ä»¬èŠåˆ°ï¼ŒSpringä¸­çš„<code>ApplicationContext</code>å®ä¾‹æ˜¯å¯ä»¥æœ‰èŒƒå›´ï¼ˆscopeï¼‰çš„ã€‚åœ¨Spring MVCä¸­ï¼Œæ¯ä¸ª<code>DispatcherServlet</code>éƒ½æŒæœ‰ä¸€ä¸ªè‡ªå·±çš„ä¸Šä¸‹æ–‡å¯¹è±¡<code>WebApplicationContext</code>ï¼Œå®ƒåˆç»§æ‰¿äº†æ ¹ï¼ˆrootï¼‰<code>WebApplicationContext</code>å¯¹è±¡ä¸­å·²ç»å®šä¹‰çš„æ‰€æœ‰beanã€‚è¿™äº›ç»§æ‰¿çš„beanå¯ä»¥åœ¨å…·ä½“çš„Servletå®ä¾‹ä¸­è¢«é‡è½½ï¼Œåœ¨æ¯ä¸ªServletå®ä¾‹ä¸­ä½ ä¹Ÿå¯ä»¥å®šä¹‰å…¶scopeä¸‹çš„æ–°beanã€‚</p>
<p><img src="./figures/figure-21-2-typical-context-hierarchy-in-spring-web-mvc.png" alt="å›¾21.2 Spring Web MVCä¸­å¸¸è§çš„contextå±‚çº§ç»“æ„"></p>
<p><code>DispatcherServlet</code>çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼ŒSpring MVCä¼šåœ¨ä½ webåº”ç”¨çš„<code>WEB-INF</code>ç›®å½•ä¸‹æŸ¥æ‰¾ä¸€ä¸ªåä¸º[servlet-name]-servlet.xmlçš„é…ç½®æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºå…¶ä¸­æ‰€å®šä¹‰çš„beanã€‚å¦‚æœåœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨ç›¸åŒåå­—çš„beanï¼Œåˆ™å®ƒä»¬å°†è¢«æ–°å®šä¹‰çš„åŒåbeanè¦†ç›–ã€‚</p>
<p>çœ‹çœ‹ä¸‹é¢è¿™ä¸ª<code>DispatcherServlet</code>çš„Servleté…ç½®ï¼ˆå®šä¹‰äºweb.xmlæ–‡ä»¶ä¸­ï¼‰ï¼š</p>
<pre><code class="lang-xml">&lt;web-app&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;golfing&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;golfing&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/golfing/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</code></pre>
<p>æœ‰äº†ä»¥ä¸Šçš„Servleté…ç½®æ–‡ä»¶ï¼Œä½ è¿˜éœ€è¦åœ¨åº”ç”¨ä¸­çš„<code>/WEB-INF/</code>è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ª<code>golfing-servlet.xml</code>æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­å®šä¹‰æ‰€æœ‰Spring MVCç›¸å…³çš„ç»„ä»¶ï¼ˆæ¯”å¦‚beanç­‰ï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡servletåˆå§‹åŒ–å‚æ•°ä¸ºè¿™ä¸ªé…ç½®æ–‡ä»¶æŒ‡å®šå…¶ä»–çš„è·¯å¾„ï¼ˆè§ä¸‹é¢çš„ä¾‹å­ï¼‰ï¼š</p>
<p>å½“ä½ çš„åº”ç”¨ä¸­åªéœ€è¦ä¸€ä¸ª<code>DispatcherServlet</code>æ—¶ï¼Œåªé…ç½®ä¸€ä¸ªæ ¹contextå¯¹è±¡ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚</p>
<p><img src="./figures/figure-21-3-single-root-context-in-spring-web-mvc.png" alt="å›¾21.3 Spring Web MVCä¸­çš„æ ¹context"></p>
<p>è¦é…ç½®ä¸€ä¸ªå”¯ä¸€çš„æ ¹contextå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡åœ¨servletåˆå§‹åŒ–å‚æ•°ä¸­é…ç½®ä¸€ä¸ªç©ºçš„contextConfigLocationæ¥åšåˆ°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="lang-xml">&lt;web-app&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;/WEB-INF/root-context.xml&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
            &lt;param-value&gt;&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
    &lt;listener&gt;
        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
    &lt;/listener&gt;
&lt;/web-app&gt;
</code></pre>
<p><code>WebApplicationContext</code>ç»§æ‰¿è‡ª<code>ApplicationContext</code>ï¼Œå®ƒæä¾›äº†ä¸€äº›webåº”ç”¨ç»å¸¸éœ€è¦ç”¨åˆ°çš„ç‰¹æ€§ã€‚å®ƒä¸æ™®é€šçš„<code>ApplicationContext</code>ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå®ƒæ”¯æŒä¸»é¢˜çš„è§£æï¼ˆè¯¦è§<a href="../21-9/using-themes.md">21.9 ä¸»é¢˜Themes</a>ä¸€å°èŠ‚ï¼‰ï¼Œå¹¶ä¸”çŸ¥é“å®ƒå…³è”åˆ°çš„æ˜¯å“ªä¸ªservletï¼ˆå®ƒæŒæœ‰ä¸€ä¸ªè¯¥<code>ServletContext</code>çš„å¼•ç”¨ï¼‰ã€‚<code>WebApplicationContext</code>è¢«ç»‘å®šåœ¨<code>ServletContext</code>ä¸­ã€‚å¦‚æœéœ€è¦è·å–å®ƒï¼Œä½ å¯ä»¥é€šè¿‡<code>RequestContextUtils</code>å·¥å…·ç±»ä¸­çš„é™æ€æ–¹æ³•æ¥æ‹¿åˆ°è¿™ä¸ªwebåº”ç”¨çš„ä¸Šä¸‹æ–‡<code>WebApplicationContext</code>ã€‚</p>
</section<section><h1 id="21-2-1-webapplicationcontext-bean-">21.2.1 WebApplicationContextä¸­ç‰¹æ®Šçš„beanç±»å‹</h1>
<p>Springçš„<code>DispatcherServlet</code>ä½¿ç”¨äº†ç‰¹æ®Šçš„beanæ¥å¤„ç†è¯·æ±‚ã€æ¸²æŸ“è§†å›¾ç­‰ï¼Œè¿™äº›ç‰¹å®šçš„beanæ˜¯Spring MVCæ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœä½ æƒ³æŒ‡å®šä½¿ç”¨å“ªä¸ªç‰¹å®šçš„beanï¼Œä½ å¯ä»¥åœ¨webåº”ç”¨ä¸Šä¸‹æ–‡<code>WebApplicationContext</code>ä¸­ç®€å•åœ°é…ç½®å®ƒä»¬ã€‚å½“ç„¶è¿™åªæ˜¯å¯é€‰çš„ï¼ŒSpring MVCç»´æŠ¤äº†ä¸€ä¸ªé»˜è®¤çš„beanåˆ—è¡¨ï¼Œå¦‚æœä½ æ²¡æœ‰è¿›è¡Œç‰¹åˆ«çš„é…ç½®ï¼Œæ¡†æ¶å°†ä¼šä½¿ç”¨é»˜è®¤çš„beanã€‚ä¸‹ä¸€å°èŠ‚ä¼šä»‹ç»æ›´å¤šçš„ç»†èŠ‚ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å°†å…ˆå¿«é€Ÿåœ°çœ‹ä¸€ä¸‹ï¼Œ<code>DispatcherServlet</code>éƒ½ä¾èµ–äºå“ªäº›ç‰¹æ®Šçš„beanæ¥è¿›è¡Œå®ƒçš„åˆå§‹åŒ–ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">beançš„ç±»å‹</th>
<th style="text-align:left">ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a href="../21-4/handler-mappings.md"><code>HandlerMapping</code></a></td>
<td style="text-align:left">å¤„ç†å™¨æ˜ å°„ã€‚å®ƒä¼šæ ¹æ®æŸäº›è§„åˆ™å°†è¿›å…¥å®¹å™¨çš„è¯·æ±‚æ˜ å°„åˆ°å…·ä½“çš„å¤„ç†å™¨ä»¥åŠä¸€ç³»åˆ—å‰å¤„ç†å™¨å’Œåå¤„ç†å™¨ï¼ˆå³å¤„ç†å™¨æ‹¦æˆªå™¨ï¼‰ä¸Šã€‚å…·ä½“çš„è§„åˆ™è§†<code>HandlerMapping</code>ç±»çš„å®ç°ä¸åŒè€Œæœ‰æ‰€ä¸åŒã€‚å…¶æœ€å¸¸ç”¨çš„ä¸€ä¸ªå®ç°æ”¯æŒä½ åœ¨æ§åˆ¶å™¨ä¸Šæ·»åŠ æ³¨è§£ï¼Œé…ç½®è¯·æ±‚è·¯å¾„ã€‚å½“ç„¶ï¼Œä¹Ÿå­˜åœ¨å…¶ä»–çš„å®ç°ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>HandlerAdapter</code></td>
<td style="text-align:left">å¤„ç†å™¨é€‚é…å™¨ã€‚æ‹¿åˆ°è¯·æ±‚æ‰€å¯¹åº”çš„å¤„ç†å™¨åï¼Œé€‚é…å™¨å°†è´Ÿè´£å»è°ƒç”¨è¯¥å¤„ç†å™¨ï¼Œè¿™ä½¿å¾—<code>DispatcherServlet</code>æ— éœ€å…³å¿ƒå…·ä½“çš„è°ƒç”¨ç»†èŠ‚ã€‚æ¯”æ–¹è¯´ï¼Œè¦è°ƒç”¨çš„æ˜¯ä¸€ä¸ªåŸºäºæ³¨è§£é…ç½®çš„æ§åˆ¶å™¨ï¼Œé‚£ä¹ˆè°ƒç”¨å‰è¿˜éœ€è¦ä»è®¸å¤šæ³¨è§£ä¸­è§£æå‡ºä¸€äº›ç›¸åº”çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œ<code>HandlerAdapter</code>çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯å¯¹<code>DispatcherServlet</code>å±è”½è¿™äº›å…·ä½“çš„ç»†èŠ‚ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="../21-11/1-handler-exception-handler.md"><code>HandlerExceptionResolver</code></a></td>
<td style="text-align:left">å¤„ç†å™¨å¼‚å¸¸è§£æå™¨ã€‚å®ƒè´Ÿè´£å°†æ•è·çš„å¼‚å¸¸æ˜ å°„åˆ°ä¸åŒçš„è§†å›¾ä¸Šå»ï¼Œæ­¤å¤–è¿˜æ”¯æŒæ›´å¤æ‚çš„å¼‚å¸¸å¤„ç†ä»£ç ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="../21-5/resolving-views.md"><code>ViewResolver</code></a></td>
<td style="text-align:left">è§†å›¾è§£æå™¨ã€‚å®ƒè´Ÿè´£å°†ä¸€ä¸ªä»£è¡¨é€»è¾‘è§†å›¾åçš„å­—ç¬¦ä¸²ï¼ˆStringï¼‰æ˜ å°„åˆ°å®é™…çš„è§†å›¾ç±»å‹<code>View</code>ä¸Šã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="../21-8/using-locales.md"><code>LocaleResolver</code></a> &amp; <a href="../21-8/1-obtaining-time-zone-information.md"><code>LocaleContextResolver</code></a></td>
<td style="text-align:left">åœ°åŒºè§£æå™¨ å’Œ åœ°åŒºä¸Šä¸‹æ–‡è§£æå™¨ã€‚å®ƒä»¬è´Ÿè´£è§£æå®¢æˆ·ç«¯æ‰€åœ¨çš„åœ°åŒºä¿¡æ¯ç”šè‡³æ—¶åŒºä¿¡æ¯ï¼Œä¸ºå›½é™…åŒ–çš„è§†å›¾å®šåˆ¶æä¾›äº†æ”¯æŒã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="../21-9/1-overview-of-themes.md"><code>ThemeResolver</code></a></td>
<td style="text-align:left">ä¸»é¢˜è§£æå™¨ã€‚å®ƒè´Ÿè´£è§£æä½ webåº”ç”¨ä¸­å¯ç”¨çš„ä¸»é¢˜ï¼Œæ¯”å¦‚ï¼Œæä¾›ä¸€äº›ä¸ªæ€§åŒ–å®šåˆ¶çš„å¸ƒå±€ç­‰ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="../21-10/springs-multipart-file-upload-support.md"><code>MultipartResolver</code></a></td>
<td style="text-align:left">è§£æmulti-partçš„ä¼ è¾“è¯·æ±‚ï¼Œæ¯”å¦‚æ”¯æŒé€šè¿‡HTMLè¡¨å•è¿›è¡Œçš„æ–‡ä»¶ä¸Šä¼ ç­‰ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="../21-6/using-flash-attributes.md"><code>FlashMapManager</code></a></td>
<td style="text-align:left">FlashMapç®¡ç†å™¨ã€‚å®ƒèƒ½å¤Ÿå­˜å‚¨å¹¶å–å›ä¸¤æ¬¡è¯·æ±‚ä¹‹é—´çš„<code>FlashMap</code>å¯¹è±¡ã€‚åè€…å¯ç”¨äºåœ¨è¯·æ±‚ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œé€šå¸¸æ˜¯åœ¨è¯·æ±‚é‡å®šå‘çš„æƒ…å¢ƒä¸‹ä½¿ç”¨ã€‚</td>
</tr>
</tbody>
</table>
</section<section><h1 id="21-2-2-dispatcherservlet-">21.2.2 é»˜è®¤çš„DispatcherServleté…ç½®</h1>
<p>ä¸Šä¸€å°èŠ‚è®²åˆ°ï¼Œ<code>DispatcherServlet</code>ç»´æŠ¤äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­ä¿å­˜äº†å…¶æ‰€ä¾èµ–çš„æ‰€æœ‰beançš„é»˜è®¤å®ç°ã€‚è¿™ä¸ªåˆ—è¡¨ä¿å­˜åœ¨åŒ…<code>org.springframework.web.servlet</code>ä¸‹çš„<code>DispatcherServlet.properties</code>æ–‡ä»¶ä¸­ã€‚</p>
<p>è¿™äº›ç‰¹æ®Šçš„beanéƒ½æœ‰ä¸€äº›åŸºæœ¬çš„é»˜è®¤è¡Œä¸ºã€‚æˆ–æ—©æˆ–æ™šï¼Œä½ å¯èƒ½éœ€è¦å¯¹å®ƒä»¬æä¾›çš„ä¸€äº›é»˜è®¤é…ç½®è¿›è¡Œå®šåˆ¶ã€‚æ¯”å¦‚è¯´ï¼Œé€šå¸¸ä½ éœ€è¦é…ç½®<code>InternalResourceViewResolver</code>ç±»æä¾›çš„<code>prefix</code>å±æ€§ï¼Œä½¿å…¶æŒ‡å‘è§†å›¾æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚

è¿™é‡Œéœ€è¦ç†è§£çš„ä¸€ä¸ªäº‹æƒ…æ˜¯ï¼Œä¸€æ—¦ä½ åœ¨webåº”ç”¨ä¸Šä¸‹æ–‡<code>WebApplicationContext</code>ä¸­é…ç½®äº†æŸä¸ªç‰¹æ®Šbeanä»¥åï¼ˆæ¯”å¦‚<code>InternalResourceViewResolver</code>ï¼‰ï¼Œå®é™…ä¸Šä½ ä¹Ÿè¦†å†™äº†è¯¥beançš„é»˜è®¤å®ç°ã€‚æ¯”æ–¹è¯´ï¼Œå¦‚æœä½ é…ç½®äº†<code>InternalResourceViewResolver</code>ï¼Œé‚£ä¹ˆæ¡†æ¶å°±ä¸ä¼šå†ä½¿ç”¨bean<code>ViewResolver</code>çš„é»˜è®¤å®ç°ã€‚</p>
<p>åœ¨<a href="../21-16/configuring-spring-mvc.md">21.16èŠ‚ Spring MVCçš„é…ç½®</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å…¶ä»–é…ç½®Spring MVCçš„æ–¹å¼ï¼Œæ¯”å¦‚é€šè¿‡Javaç¼–ç¨‹é…ç½®æˆ–è€…é€šè¿‡MVC XMLå‘½åç©ºé—´è¿›è¡Œé…ç½®ã€‚å®ƒä»¬ä¸ºé…ç½®ä¸€ä¸ªSpring MVCåº”ç”¨æä¾›äº†ç®€æ˜“çš„å¼€å§‹æ–¹å¼ï¼Œä¹Ÿä¸éœ€è¦ä½ å¯¹æ¡†æ¶å®ç°ç»†èŠ‚æœ‰å¤ªå¤šäº†è§£ã€‚å½“ç„¶ï¼Œæ— è®ºä½ é€‰ç”¨ä½•ç§æ–¹å¼å¼€å§‹é…ç½®ï¼Œæœ¬èŠ‚æ‰€ä»‹ç»çš„ä¸€äº›æ¦‚å¿µéƒ½æ˜¯åŸºç¡€ä¸”æ™®é€‚çš„ï¼Œå®ƒä»¬å¯¹ä½ åç»­çš„å­¦ä¹ éƒ½åº”æœ‰æ‰€åŠ©ç›Šã€‚</p>
</section<section><h1 id="21-2-3-dispatcherservlet-">21.2.3 DispatcherServletçš„å¤„ç†æµç¨‹</h1>
<p>é…ç½®å¥½<code>DispatcherServlet</code>ä»¥åï¼Œå¼€å§‹æœ‰è¯·æ±‚ä¼šç»è¿‡è¿™ä¸ª<code>DispatcherServlet</code>ã€‚æ­¤æ—¶ï¼Œ<code>DispatcherServlet</code>ä¼šä¾ç…§ä»¥ä¸‹çš„æ¬¡åºå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œæœç´¢åº”ç”¨çš„ä¸Šä¸‹æ–‡å¯¹è±¡<code>WebApplicationContext</code>å¹¶æŠŠå®ƒä½œä¸ºä¸€ä¸ªå±æ€§ï¼ˆattributeï¼‰ç»‘å®šåˆ°è¯¥è¯·æ±‚ä¸Šï¼Œä»¥ä¾¿æ§åˆ¶å™¨å’Œå…¶ä»–ç»„ä»¶èƒ½å¤Ÿä½¿ç”¨å®ƒã€‚å±æ€§çš„é”®åé»˜è®¤ä¸º<code>DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE</code></li>
<li>å°†åœ°åŒºï¼ˆlocaleï¼‰è§£æå™¨ç»‘å®šåˆ°è¯·æ±‚ä¸Šï¼Œä»¥ä¾¿å…¶ä»–ç»„ä»¶åœ¨å¤„ç†è¯·æ±‚ï¼ˆæ¸²æŸ“è§†å›¾ã€å‡†å¤‡æ•°æ®ç­‰ï¼‰æ—¶å¯ä»¥è·å–åŒºåŸŸç›¸å…³çš„ä¿¡æ¯ã€‚å¦‚æœä½ çš„åº”ç”¨ä¸éœ€è¦è§£æåŒºåŸŸç›¸å…³çš„ä¿¡æ¯ï¼Œå¿½ç•¥å®ƒå³å¯</li>
<li>å°†ä¸»é¢˜ï¼ˆthemeï¼‰è§£æå™¨ç»‘å®šåˆ°è¯·æ±‚ä¸Šï¼Œä»¥ä¾¿å…¶ä»–ç»„ä»¶ï¼ˆæ¯”å¦‚è§†å›¾ç­‰ï¼‰èƒ½å¤Ÿäº†è§£è¦æ¸²æŸ“å“ªä¸ªä¸»é¢˜æ–‡ä»¶ã€‚åŒæ ·ï¼Œå¦‚æœä½ ä¸éœ€è¦ä½¿ç”¨ä¸»é¢˜ç›¸å…³çš„ç‰¹æ€§ï¼Œå¿½ç•¥å®ƒå³å¯</li>
<li>å¦‚æœä½ é…ç½®äº†multipartæ–‡ä»¶å¤„ç†å™¨ï¼Œé‚£ä¹ˆæ¡†æ¶å°†æŸ¥æ‰¾è¯¥æ–‡ä»¶æ˜¯ä¸æ˜¯multipartï¼ˆåˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†è¿ç»­ä¸Šä¼ ï¼‰çš„ã€‚è‹¥æ˜¯ï¼Œåˆ™å°†è¯¥è¯·æ±‚åŒ…è£…æˆä¸€ä¸ª<code>MultipartHttpServletRequest</code>å¯¹è±¡ï¼Œä»¥ä¾¿å¤„ç†é“¾ä¸­çš„å…¶ä»–ç»„ä»¶å¯¹å®ƒåšè¿›ä¸€æ­¥çš„å¤„ç†ã€‚å…³äºSpringå¯¹multipartæ–‡ä»¶ä¼ è¾“å¤„ç†çš„æ”¯æŒï¼Œè¯»è€…å¯ä»¥å‚è€ƒ<a href="../21-10/springs-multipart-file-upload-support.md">21.10 Springçš„multipartï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰æ”¯æŒ</a>ä¸€å°èŠ‚</li>
<li>ä¸ºè¯¥è¯·æ±‚æŸ¥æ‰¾ä¸€ä¸ªåˆé€‚çš„å¤„ç†å™¨ã€‚å¦‚æœå¯ä»¥æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨ï¼Œåˆ™ä¸è¯¥å¤„ç†å™¨å…³è”çš„æ•´æ¡æ‰§è¡Œé“¾ï¼ˆå‰å¤„ç†å™¨ã€åå¤„ç†å™¨ã€æ§åˆ¶å™¨ç­‰ï¼‰éƒ½ä¼šè¢«æ‰§è¡Œï¼Œä»¥å®Œæˆç›¸åº”æ¨¡å‹çš„å‡†å¤‡æˆ–è§†å›¾çš„æ¸²æŸ“</li>
<li>å¦‚æœå¤„ç†å™¨è¿”å›çš„æ˜¯ä¸€ä¸ªæ¨¡å‹ï¼ˆmodelï¼‰ï¼Œé‚£ä¹ˆæ¡†æ¶å°†æ¸²æŸ“ç›¸åº”çš„è§†å›¾ã€‚è‹¥æ²¡æœ‰è¿”å›ä»»ä½•æ¨¡å‹ï¼ˆå¯èƒ½æ˜¯å› ä¸ºå‰åçš„å¤„ç†å™¨å‡ºäºæŸäº›åŸå› æ‹¦æˆªäº†è¯·æ±‚ç­‰ï¼Œæ¯”å¦‚ï¼Œå®‰å…¨é—®é¢˜ï¼‰ï¼Œåˆ™æ¡†æ¶ä¸ä¼šæ¸²æŸ“ä»»ä½•è§†å›¾ï¼Œæ­¤æ—¶è®¤ä¸ºå¯¹è¯·æ±‚çš„å¤„ç†å¯èƒ½å·²ç»ç”±å¤„ç†é“¾å®Œæˆäº†</li>
</ul>
<p>å¦‚æœåœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆä¸Šä¸‹æ–‡<code>WebApplicationContext</code>å¯¹è±¡ä¸­æ‰€å®šä¹‰çš„å¼‚å¸¸å¤„ç†å™¨å°†ä¼šè´Ÿè´£æ•è·è¿™äº›å¼‚å¸¸ã€‚é€šè¿‡é…ç½®ä½ è‡ªå·±çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œä½ å¯ä»¥å®šåˆ¶è‡ªå·±å¤„ç†å¼‚å¸¸çš„æ–¹å¼ã€‚</p>
<p>Springçš„<code>DispatcherServlet</code>ä¹Ÿå…è®¸å¤„ç†å™¨è¿”å›ä¸€ä¸ªServlet APIè§„èŒƒä¸­å®šä¹‰çš„ <em>æœ€åä¿®æ”¹æ—¶é—´æˆ³ï¼ˆlast-modification-dateï¼‰</em> å€¼ã€‚å†³å®šè¯·æ±‚æœ€åä¿®æ”¹æ—¶é—´çš„æ–¹å¼å¾ˆç›´æ¥ï¼š<code>DispatcherServlet</code>ä¼šå…ˆæŸ¥æ‰¾åˆé€‚çš„å¤„ç†å™¨æ˜ å°„æ¥æ‰¾åˆ°è¯·æ±‚å¯¹åº”çš„å¤„ç†å™¨ï¼Œç„¶åæ£€æµ‹å®ƒæ˜¯å¦å®ç°äº† <em>LastModified</em> æ¥å£ã€‚è‹¥æ˜¯ï¼Œåˆ™è°ƒç”¨æ¥å£çš„<code>long getLastModified(request)</code>æ–¹æ³•ï¼Œå¹¶å°†è¯¥è¿”å›å€¼è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>ä½ å¯ä»¥å®šåˆ¶<code>DispatcherServlet</code>çš„é…ç½®ï¼Œå…·ä½“çš„åšæ³•ï¼Œæ˜¯åœ¨<code>web.xml</code>æ–‡ä»¶ä¸­ï¼ŒServletçš„å£°æ˜å…ƒç´ ä¸Šæ·»åŠ ä¸€äº›Servletçš„åˆå§‹åŒ–å‚æ•°ï¼ˆé€šè¿‡<code>init-param</code>å…ƒç´ ï¼‰ã€‚è¯¥å…ƒç´ å¯é€‰çš„å‚æ•°åˆ—è¡¨å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">å¯é€‰å‚æ•°</th>
<th style="text-align:left">è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>contextClass</code></td>
<td style="text-align:left">ä»»æ„å®ç°äº†<code>WebApplicationContext</code>æ¥å£çš„ç±»ã€‚è¿™ä¸ªç±»ä¼šåˆå§‹åŒ–è¯¥servletæ‰€éœ€è¦ç”¨åˆ°çš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¡†æ¶ä¼šä½¿ç”¨ä¸€ä¸ª<code>XmlWebApplicationContext</code>å¯¹è±¡ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>contextConfigLocation</code></td>
<td style="text-align:left">ä¸€ä¸ªæŒ‡å®šäº†ä¸Šä¸‹æ–‡é…ç½®æ–‡ä»¶è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œè¯¥å€¼ä¼šè¢«ä¼ å…¥ç»™<code>contextClass</code>æ‰€æŒ‡å®šçš„ä¸Šä¸‹æ–‡å®ä¾‹å¯¹è±¡ã€‚è¯¥å­—ç¬¦ä¸²å†…å¯ä»¥åŒ…å«å¤šä¸ªå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¹‹é—´ä»¥é€—å·åˆ†éš”ï¼Œä»¥æ­¤æ”¯æŒä½ è¿›è¡Œå¤šä¸ªä¸Šä¸‹æ–‡çš„é…ç½®ã€‚åœ¨å¤šä¸ªä¸Šä¸‹æ–‡ä¸­é‡å¤å®šä¹‰çš„beanï¼Œä»¥æœ€ååŠ è½½çš„beanå®šä¹‰ä¸ºå‡†</td>
</tr>
<tr>
<td style="text-align:left"><code>namespace</code></td>
<td style="text-align:left"><code>WebApplicationContext</code>çš„å‘½åç©ºé—´ã€‚é»˜è®¤æ˜¯<code>[servlet-name]-servlet</code></td>
</tr>
</tbody>
</table>
</section<section><h1 id="21-3-controller-">21.3 æ§åˆ¶å™¨(Controller)çš„å®ç°</h1>
<blockquote>
<p>...Spring implements a controller in a very abstract way, which enables you to create a wide variety of controllers.</p>
</blockquote>
<p>æ§åˆ¶å™¨ä½œä¸ºåº”ç”¨ç¨‹åºé€»è¾‘çš„å¤„ç†å…¥å£ï¼Œå®ƒä¼šè´Ÿè´£å»è°ƒç”¨ä½ å·²ç»å®ç°çš„ä¸€äº›æœåŠ¡ã€‚é€šå¸¸ï¼Œä¸€ä¸ªæ§åˆ¶å™¨ä¼šæ¥æ”¶å¹¶è§£æç”¨æˆ·çš„è¯·æ±‚ï¼Œç„¶åæŠŠå®ƒè½¬æ¢æˆä¸€ä¸ªæ¨¡å‹äº¤ç»™è§†å›¾ï¼Œç”±è§†å›¾æ¸²æŸ“å‡ºé¡µé¢æœ€ç»ˆå‘ˆç°ç»™ç”¨æˆ·ã€‚Springå¯¹æ§åˆ¶å™¨çš„å®šä¹‰éå¸¸å®½æ¾ï¼Œè¿™æ„å‘³ç€ä½ åœ¨å®ç°æ§åˆ¶å™¨æ—¶éå¸¸è‡ªç”±ã€‚</p>
<p>Spring 2.5ä»¥åå¼•å…¥äº†åŸºäºæ³¨è§£çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä½ å¯ä»¥åœ¨ä½ çš„æ§åˆ¶å™¨å®ç°ä¸Šæ·»åŠ <code>@RequestMapping</code>ã€<code>@RequestParam</code>ã€<code>@ModelAttribute</code>ç­‰æ³¨è§£ã€‚æ³¨è§£ç‰¹æ€§æ—¢æ”¯æŒåŸºäºServletçš„MVCï¼Œä¹Ÿå¯æ”¯æŒåŸºäºPortletçš„MVCã€‚é€šè¿‡æ­¤ç§æ–¹å¼å®ç°çš„æ§åˆ¶å™¨æ—¢æ— éœ€ç»§æ‰¿æŸä¸ªç‰¹å®šçš„åŸºç±»ï¼Œä¹Ÿæ— éœ€å®ç°æŸäº›ç‰¹å®šçš„æ¥å£ã€‚è€Œä¸”ï¼Œå®ƒé€šå¸¸ä¹Ÿä¸ä¼šç›´æ¥ä¾èµ–äºServletæˆ–Portletçš„APIæ¥è¿›è¡Œç¼–ç¨‹ï¼Œä¸è¿‡ä½ ä»ç„¶å¯ä»¥å¾ˆå®¹æ˜“åœ°è·å–Servletæˆ–Portletç›¸å…³çš„å˜é‡ã€ç‰¹æ€§å’Œè®¾æ–½ç­‰ã€‚</p>
<blockquote>
<p>åœ¨<a href="https://github.com/spring-projects">Springé¡¹ç›®çš„å®˜æ–¹Github</a>ä¸Šä½ å¯ä»¥æ‰¾åˆ°è®¸å¤šé¡¹ç›®ï¼Œå®ƒä»¬å¯¹æœ¬èŠ‚æ‰€è¿°ä»¥åçš„æ³¨è§£æ”¯æŒæä¾›äº†è¿›ä¸€æ­¥å¢å¼ºï¼Œæ¯”å¦‚è¯´MvcShowcaseï¼ŒMvcAjaxï¼ŒMvcBasicï¼ŒPetClinicï¼ŒPetCareç­‰ã€‚</p>
</blockquote>
<pre><code class="lang-java">@Controller
public class HelloWorldController {

    @RequestMapping(&quot;/helloWorld&quot;)
    public String helloWorld(Model model) {
        model.addAttribute(&quot;message&quot;, &quot;Hello World!&quot;);
        return &quot;helloWorld&quot;;
    }
}
</code></pre>
<p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œ<code>@Controller</code>æ³¨è§£å’Œ<code>@RequestMapping</code>æ³¨è§£æ”¯æŒå¤šæ ·çš„æ–¹æ³•åå’Œæ–¹æ³•ç­¾åã€‚åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ–¹æ³•æ¥å—ä¸€ä¸ª<code>Model</code>ç±»å‹çš„å‚æ•°å¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²<code>String</code>ç±»å‹çš„è§†å›¾åã€‚ä½†äº‹å®ä¸Šï¼Œæ–¹æ³•æ‰€æ”¯æŒçš„å‚æ•°å’Œè¿”å›å€¼æœ‰éå¸¸å¤šçš„é€‰æ‹©ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨æœ¬å°èŠ‚çš„åé¢éƒ¨åˆ†ä¼šæåŠã€‚<code>@Controller</code>å’Œ<code>@RequestMapping</code>åŠå…¶ä»–çš„ä¸€äº›æ³¨è§£ï¼Œå…±åŒæ„æˆäº†Spring MVCæ¡†æ¶çš„åŸºæœ¬å®ç°ã€‚æœ¬èŠ‚å°†è¯¦ç»†åœ°ä»‹ç»è¿™äº›æ³¨è§£ï¼Œä»¥åŠå®ƒä»¬åœ¨ä¸€ä¸ªServletç¯å¢ƒä¸‹æœ€å¸¸è¢«ä½¿ç”¨åˆ°çš„ä¸€äº›åœºæ™¯ã€‚</p>
</section<section><h1 id="21-3-1-controller-">21.3.1 ä½¿ç”¨@Controlleræ³¨è§£å®šä¹‰ä¸€ä¸ªæ§åˆ¶å™¨</h1>
<blockquote>
<p>[Original] The <code>@Controller</code> annotation indicates that a particular class serves the role of a controller. Spring does not require you to extend any controller base class or reference the Servlet API. However, you can still reference Servlet-specific features if you need to.</p>
</blockquote>
<p><code>@Controller</code>æ³¨è§£è¡¨æ˜äº†ä¸€ä¸ªç±»æ˜¯ä½œä¸ºæ§åˆ¶å™¨çš„è§’è‰²è€Œå­˜åœ¨çš„ã€‚Springä¸è¦æ±‚ä½ å»ç»§æ‰¿ä»»ä½•æ§åˆ¶å™¨åŸºç±»ï¼Œä¹Ÿä¸è¦æ±‚ä½ å»å®ç°Servletçš„é‚£å¥—APIã€‚å½“ç„¶ï¼Œå¦‚æœä½ éœ€è¦çš„è¯ä¹Ÿå¯ä»¥å»ä½¿ç”¨ä»»ä½•ä¸Servletç›¸å…³çš„ç‰¹æ€§å’Œè®¾æ–½ã€‚</p>
<blockquote>
<p>[Original] The <code>@Controller</code> annotation acts as a stereotype for the annotated class, indicating its role. The dispatcher scans such annotated classes for mapped methods and detects <code>@RequestMapping</code> annotations (see the next section).</p>
</blockquote>
<p><code>@Controller</code>æ³¨è§£å¯ä»¥è®¤ä¸ºæ˜¯è¢«æ ‡æ³¨ç±»çš„åŸå‹ï¼ˆstereotypeï¼‰ï¼Œè¡¨æ˜äº†è¿™ä¸ªç±»æ‰€æ‰¿æ‹…çš„è§’è‰²ã€‚åˆ†æ´¾å™¨ï¼ˆ<code>DispatcherServlet</code>ï¼‰ä¼šæ‰«ææ‰€æœ‰æ³¨è§£äº†<code>@Controller</code>çš„ç±»ï¼Œæ£€æµ‹å…¶ä¸­é€šè¿‡<code>@RequestMapping</code>æ³¨è§£é…ç½®çš„æ–¹æ³•ï¼ˆè¯¦è§ä¸‹ä¸€å°èŠ‚ï¼‰ã€‚</p>
<blockquote>
<p>[Original] You can define annotated controller beans explicitly, using a standard Spring bean definition in the dispatcherâ€™s context. However, the <code>@Controller</code> stereotype also allows for autodetection, aligned with Spring general support for detecting component classes in the classpath and auto-registering bean definitions for them.</p>
</blockquote>
<p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨<code>@Controller</code>æ³¨è§£è€Œæ˜¾å¼åœ°å»å®šä¹‰è¢«æ³¨è§£çš„beanï¼Œè¿™ç‚¹é€šè¿‡æ ‡å‡†çš„Spring beançš„å®šä¹‰æ–¹å¼ï¼Œåœ¨dispatherçš„ä¸Šä¸‹æ–‡å±æ€§ä¸‹é…ç½®å³å¯åšåˆ°ã€‚ä½†æ˜¯<code>@Controller</code>åŸå‹æ˜¯å¯ä»¥è¢«æ¡†æ¶è‡ªåŠ¨æ£€æµ‹çš„ï¼ŒSpringæ”¯æŒclasspathè·¯å¾„ä¸‹ç»„ä»¶ç±»çš„è‡ªåŠ¨æ£€æµ‹ï¼Œä»¥åŠå¯¹å·²å®šä¹‰beançš„è‡ªåŠ¨æ³¨å†Œã€‚</p>
<blockquote>
<p>[Original] To enable autodetection of such annotated controllers, you add component scanning to your configuration. Use the spring-context schema as shown in the following XML snippet:</p>
</blockquote>
<p>ä½ éœ€è¦åœ¨é…ç½®ä¸­åŠ å…¥ç»„ä»¶æ‰«æçš„é…ç½®ä»£ç æ¥å¼€å¯æ¡†æ¶å¯¹æ³¨è§£æ§åˆ¶å™¨çš„è‡ªåŠ¨æ£€æµ‹ã€‚è¯·ä½¿ç”¨ä¸‹é¢XMLä»£ç æ‰€ç¤ºçš„spring-context schemaï¼š</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;
    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
    xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;context:component-scan base-package=&quot;org.springframework.samples.petclinic.web&quot;/&gt;

    &lt;!-- ... --&gt;

&lt;/beans&gt;
</code></pre>
</section<section><h1 id="21-3-2-requestmapping-">21.3.2 ä½¿ç”¨@RequestMappingæ³¨è§£æ˜ å°„è¯·æ±‚è·¯å¾„</h1>
<p>ä½ å¯ä»¥ä½¿ç”¨<code>@RequestMapping</code>æ³¨è§£æ¥å°†è¯·æ±‚URLï¼Œå¦‚<code>/appointments</code>ç­‰ï¼Œæ˜ å°„åˆ°æ•´ä¸ªç±»ä¸Šæˆ–æŸä¸ªç‰¹å®šçš„å¤„ç†å™¨æ–¹æ³•ä¸Šã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç±»çº§åˆ«çš„æ³¨è§£è´Ÿè´£å°†ä¸€ä¸ªç‰¹å®šï¼ˆæˆ–ç¬¦åˆæŸç§æ¨¡å¼ï¼‰çš„è¯·æ±‚è·¯å¾„æ˜ å°„åˆ°ä¸€ä¸ªæ§åˆ¶å™¨ä¸Šï¼ŒåŒæ—¶é€šè¿‡æ–¹æ³•çº§åˆ«çš„æ³¨è§£æ¥ç»†åŒ–æ˜ å°„ï¼Œå³æ ¹æ®ç‰¹å®šçš„HTTPè¯·æ±‚æ–¹æ³•ï¼ˆâ€œGETâ€â€œPOSTâ€æ–¹æ³•ç­‰ï¼‰ã€HTTPè¯·æ±‚ä¸­æ˜¯å¦æºå¸¦ç‰¹å®šå‚æ•°ç­‰æ¡ä»¶ï¼Œå°†è¯·æ±‚æ˜ å°„åˆ°åŒ¹é…çš„æ–¹æ³•ä¸Šã€‚</p>
<p>ä¸‹é¢è¿™æ®µä»£ç ç¤ºä¾‹æ¥è‡ªPetcareï¼Œå®ƒå±•ç¤ºäº†åœ¨Spring MVCä¸­å¦‚ä½•åœ¨æ§åˆ¶å™¨ä¸Šä½¿ç”¨<code>@RequestMapping</code>æ³¨è§£ï¼š</p>
<pre><code class="lang-java">@Controller
@RequestMapping(&quot;/appointments&quot;)
public class AppointmentsController {

    private final AppointmentBook appointmentBook;

    @Autowired
    public AppointmentsController(AppointmentBook appointmentBook) {
        this.appointmentBook = appointmentBook;
    }

    @RequestMapping(method = RequestMethod.GET)
    public Map&lt;String, Appointment&gt; get() {
        return appointmentBook.getAppointmentsForToday();
    }

    @RequestMapping(path = &quot;/{day}&quot;, method = RequestMethod.GET)
    public Map&lt;String, Appointment&gt; getForDay(@PathVariable @DateTimeFormat(iso=ISO.DATE) Date day, Model model) {
        return appointmentBook.getAppointmentsForDay(day);
    }

    @RequestMapping(path = &quot;/new&quot;, method = RequestMethod.GET)
    public AppointmentForm getNewForm() {
        return new AppointmentForm();
    }

    @RequestMapping(method = RequestMethod.POST)
    public String add(@Valid AppointmentForm appointment, BindingResult result) {
        if (result.hasErrors()) {
            return &quot;appointments/new&quot;;
        }
        appointmentBook.addAppointment(appointment);
        return &quot;redirect:/appointments&quot;;
    }
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè®¸å¤šåœ°æ–¹éƒ½ä½¿ç”¨åˆ°äº†<code>@RequestMapping</code>æ³¨è§£ã€‚ç¬¬ä¸€æ¬¡ä½¿ç”¨ç‚¹æ˜¯ä½œç”¨äºç±»çº§åˆ«çš„ï¼Œå®ƒæŒ‡ç¤ºäº†æ‰€æœ‰<code>/appointments</code>å¼€å¤´çš„è·¯å¾„éƒ½ä¼šè¢«æ˜ å°„åˆ°æ§åˆ¶å™¨ä¸‹ã€‚<code>get()</code>æ–¹æ³•ä¸Šçš„<code>@RequestMapping</code>æ³¨è§£å¯¹è¯·æ±‚è·¯å¾„è¿›è¡Œäº†è¿›ä¸€æ­¥ç»†åŒ–ï¼šå®ƒä»…æ¥å—GETæ–¹æ³•çš„è¯·æ±‚ã€‚è¿™æ ·ï¼Œä¸€ä¸ªè¯·æ±‚è·¯å¾„ä¸º<code>/appointments</code>ã€HTTPæ–¹æ³•ä¸ºGETçš„è¯·æ±‚ï¼Œå°†ä¼šæœ€ç»ˆè¿›å…¥åˆ°è¿™ä¸ªæ–¹æ³•è¢«å¤„ç†ã€‚<code>add()</code>æ–¹æ³•ä¹Ÿåšäº†ç±»ä¼¼çš„ç»†åŒ–ï¼Œè€Œ<code>getNewForm()</code>æ–¹æ³•åˆ™åŒæ—¶æ³¨è§£äº†èƒ½å¤Ÿæ¥å—çš„è¯·æ±‚çš„HTTPæ–¹æ³•å’Œè·¯å¾„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè·¯å¾„ä¸º<code>appointments/new</code>ã€HTTPæ–¹æ³•ä¸ºGETçš„è¯·æ±‚å°†ä¼šè¢«è¿™ä¸ªæ–¹æ³•æ‰€å¤„ç†ã€‚</p>
<p><code>getForDay()</code>æ–¹æ³•åˆ™å±•ç¤ºäº†ä½¿ç”¨<code>@RequestMapping</code>æ³¨è§£çš„å¦ä¸€ä¸ªæŠ€å·§ï¼šURIæ¨¡æ¿ã€‚ï¼ˆå…³äºURIæ¨¡æ¿ï¼Œè¯·<a href="">è§ä¸‹å°èŠ‚</a>ï¼‰</p>
<p>ç±»çº§åˆ«çš„<code>@RequestMapping</code>æ³¨è§£å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚ä¸é…ç½®çš„è¯åˆ™æ‰€æœ‰çš„è·¯å¾„éƒ½æ˜¯ç»å¯¹è·¯å¾„ï¼Œè€Œéç›¸å¯¹è·¯å¾„ã€‚ä»¥ä¸‹çš„ä»£ç ç¤ºä¾‹æ¥è‡ªPetClinicï¼Œå®ƒå±•ç¤ºäº†ä¸€ä¸ªå…·æœ‰å¤šä¸ªå¤„ç†å™¨æ–¹æ³•çš„æ§åˆ¶å™¨ï¼š</p>
<pre><code class="lang-java">@Controller
public class ClinicController {

    private final Clinic clinic;

    @Autowired
    public ClinicController(Clinic clinic) {
        this.clinic = clinic;
    }

    @RequestMapping(&quot;/&quot;)
    public void welcomeHandler() {
    }

    @RequestMapping(&quot;/vets&quot;)
    public ModelMap vetsHandler() {
        return new ModelMap(this.clinic.getVets());
    }
}
</code></pre>
<p>ä»¥ä¸Šä»£ç æ²¡æœ‰æŒ‡å®šè¯·æ±‚å¿…é¡»æ˜¯GETæ–¹æ³•è¿˜æ˜¯PUT/POSTæˆ–å…¶ä»–æ–¹æ³•ï¼Œ<code>@RequestMapping</code>æ³¨è§£é»˜è®¤ä¼šæ˜ å°„æ‰€æœ‰çš„HTTPè¯·æ±‚æ–¹æ³•ã€‚å¦‚æœä»…æƒ³æ¥æ”¶æŸç§è¯·æ±‚æ–¹æ³•ï¼Œè¯·åœ¨æ³¨è§£ä¸­æŒ‡å®šä¹‹<code>@RequestMapping(method=GET)</code>ä»¥ç¼©å°èŒƒå›´ã€‚</p>
<h2 id="-controller-aop-">@Controllerå’Œé¢å‘åˆ‡é¢ï¼ˆAOPï¼‰ä»£ç†</h2>
<p>æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨è¿è¡Œæ—¶ä½¿ç”¨AOPä»£ç†æ¥è£…é¥°æ§åˆ¶å™¨ï¼Œæ¯”å¦‚å½“ä½ ç›´æ¥åœ¨æ§åˆ¶å™¨ä¸Šä½¿ç”¨<code>@Transactional</code>æ³¨è§£æ—¶ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ç±»çº§åˆ«ï¼ˆåœ¨æ§åˆ¶å™¨ä¸Šä½¿ç”¨ï¼‰çš„ä»£ç†æ–¹å¼ã€‚è¿™ä¸€èˆ¬æ˜¯ä»£ç†æ§åˆ¶å™¨çš„é»˜è®¤åšæ³•ã€‚å¦‚æœæ§åˆ¶å™¨å¿…é¡»å®ç°ä¸€äº›æ¥å£ï¼Œè€Œè¯¥æ¥å£åˆä¸æ”¯æŒSpring Contextçš„å›è°ƒï¼ˆæ¯”å¦‚<code>InitializingBean</code>, <code>*Aware</code>ç­‰æ¥å£ï¼‰ï¼Œé‚£è¦é…ç½®ç±»çº§åˆ«çš„ä»£ç†å°±å¿…é¡»æ‰‹åŠ¨é…ç½®äº†ã€‚æ¯”å¦‚ï¼ŒåŸæ¥çš„é…ç½®æ–‡ä»¶<code>&lt;tx:annotation-driven/&gt;</code>éœ€è¦æ˜¾å¼é…ç½®ä¸º<code>&lt;tx:annotation-driven proxy-target-class=&quot;true&quot;/&gt;</code>ã€‚</p>
<h2 id="spring-mvc-3-1-requestmapping-">Spring MVC 3.1ä¸­æ–°å¢æ”¯æŒ@RequestMappingçš„ä¸€äº›ç±»</h2>
<blockquote>
<p>They are recommended for use and even required to take advantage of new features in Spring MVC 3.1 and going forward.</p>
</blockquote>
<p>Spring 3.1ä¸­æ–°å¢äº†ä¸€ç»„ç±»ç”¨ä»¥å¢å¼º<code>@RequestMapping</code>ï¼Œåˆ†åˆ«æ˜¯<code>RequestMappingHandlerMapping</code>å’Œ<code>RequestMappingHandlerAdapter</code>ã€‚æˆ‘ä»¬æ¨èä½ ç”¨ä¸€ç”¨ã€‚æœ‰éƒ¨åˆ†Spring MVC 3.1ä¹‹åæ–°å¢çš„ç‰¹æ€§ï¼Œè¿™ä¸¤ä¸ªæ³¨è§£ç”šè‡³æ˜¯å¿…é¡»çš„ã€‚åœ¨MVCå‘½åç©ºé—´å’ŒMVC Javaç¼–ç¨‹é…ç½®æ–¹å¼ä¸‹ï¼Œè¿™ç»„ç±»åŠå…¶æ–°ç‰¹æ€§é»˜è®¤æ˜¯å¼€å¯çš„ã€‚ä½†è‹¥ä½ ä½¿ç”¨å…¶ä»–é…ç½®æ–¹å¼ï¼Œåˆ™è¯¥ç‰¹æ€§å¿…é¡»æ‰‹åŠ¨é…ç½®æ‰èƒ½ä½¿ç”¨ã€‚æœ¬å°èŠ‚å°†ç®€è¦ä»‹ç»ä¸€ä¸‹ï¼Œæ–°ç±»ç›¸æ¯”ä¹‹å‰çš„ä¸€äº›é‡è¦å˜åŒ–ã€‚</p>
<p>åœ¨Spring 3.1ä¹‹å‰ï¼Œæ¡†æ¶ä¼šåœ¨ä¸¤ä¸ªä¸åŒçš„é˜¶æ®µåˆ†åˆ«æ£€æŸ¥ç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«çš„è¯·æ±‚æ˜ å°„â€”â€”é¦–å…ˆï¼Œ<code>DefaultAnnotationHanlderMapping</code>ä¼šå…ˆåœ¨ç±»çº§åˆ«ä¸Šé€‰ä¸­ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œç„¶åå†é€šè¿‡<code>AnnotationMethodHandlerAdapter</code>å®šä½åˆ°å…·ä½“è¦è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<blockquote>
<p>[Original] With the new support classes in Spring 3.1, the <code>RequestMappingHandlerMapping</code> is the only place where a decision is made about which method should process the request. Think of controller methods as a collection of unique endpoints with mappings for each method derived from type and method-level <code>@RequestMapping</code> information.</p>
</blockquote>
<p>ç°åœ¨æœ‰äº†Spring 3.1åå¼•å…¥çš„è¿™ç»„æ–°ç±»ï¼Œ<code>RequestMappingHandlerMapping</code>æˆä¸ºäº†è¿™ä¸¤ä¸ªå†³ç­–å®é™…å‘ç”Ÿçš„å”¯ä¸€ä¸€ä¸ªåœ°æ–¹ã€‚ä½ å¯ä»¥æŠŠæ§åˆ¶å™¨ä¸­çš„ä¸€ç³»åˆ—å¤„ç†æ–¹æ³•å½“æˆæ˜¯ä¸€ç³»åˆ—ç‹¬ç«‹çš„æœåŠ¡èŠ‚ç‚¹ï¼Œæ¯ä¸ªä»ç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«çš„<code>@RequestMapping</code>æ³¨è§£ä¸­è·å–åˆ°è¶³å¤Ÿè¯·æ±‚1è·¯å¾„æ˜ å°„ä¿¡æ¯ã€‚</p>
<blockquote>
<p>[Original] This enables some new possibilities. For once a <code>HandlerInterceptor</code> or a <code>HandlerExceptionResolver</code> can now expect the Object-based handler to be a <code>HandlerMethod</code>, which allows them to examine the exact method, its parameters and associated annotations. The processing for a URL no longer needs to be split across different controllers.</p>
</blockquote>
<p>è¿™ç§æ–°çš„å¤„ç†æ–¹å¼å¸¦æ¥äº†æ–°çš„å¯èƒ½æ€§ã€‚ä¹‹å‰çš„<code>HandlerInterceptor</code>æˆ–<code>HandlerExceptionResolver</code>ç°åœ¨å¯ä»¥ç¡®å®šæ‹¿åˆ°çš„è¿™ä¸ªå¤„ç†å™¨è‚¯å®šæ˜¯ä¸€ä¸ª<code>HandlerMethod</code>ç±»å‹ï¼Œå› æ­¤å®ƒèƒ½å¤Ÿç²¾ç¡®åœ°äº†è§£è¿™ä¸ªæ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ƒçš„å‚æ•°ã€åº”ç”¨äºå…¶ä¸Šçš„æ³¨è§£ç­‰ã€‚è¿™æ ·ï¼Œå†…éƒ¨å¯¹äºä¸€ä¸ªURLçš„å¤„ç†æµç¨‹å†ä¹Ÿä¸éœ€è¦åˆ†éš”åˆ°ä¸åŒçš„æ§åˆ¶å™¨é‡Œé¢å»æ‰§è¡Œäº†ã€‚</p>
<blockquote>
<p>[Original] There are also several things no longer possible:
[Original] <em> Select a controller first with a <code>SimpleUrlHandlerMapping</code> or <code>BeanNameUrlHandlerMapping</code> and then narrow the method based on <code>@RequestMapping</code> annotations.
[Original] </em> Rely on method names as a fall-back mechanism to disambiguate between two <code>@RequestMapping</code> methods that donâ€™t have an explicit path mapping URL path but otherwise match equally, e.g. by HTTP method. In the new support classes <code>@RequestMapping</code> methods have to be mapped uniquely.
[Original] * Have a single default method (without an explicit path mapping) with which requests are processed if no other controller method matches more concretely. In the new support classes if a matching method is not found a 404 error is raised.</p>
</blockquote>
<p>åŒæ—¶ï¼Œä¹Ÿæœ‰å…¶ä»–çš„ä¸€äº›å˜åŒ–ï¼Œæ¯”å¦‚æœ‰äº›äº‹æƒ…å°±æ²¡æ³•è¿™ä¹ˆç©å„¿äº†ï¼š</p>
<ul>
<li>å…ˆé€šè¿‡<code>SimpleUrlHandlerMapping</code>æˆ–<code>BeanNameUrlHandlerMapping</code>æ¥æ‹¿åˆ°è´Ÿè´£å¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨ï¼Œç„¶åé€šè¿‡<code>@RequestMapping</code>æ³¨è§£é…ç½®çš„ä¿¡æ¯æ¥å®šä½åˆ°å…·ä½“çš„å¤„ç†æ–¹æ³•ï¼›</li>
<li>ä¾é æ–¹æ³•åç§°æ¥ä½œä¸ºé€‰æ‹©å¤„ç†æ–¹æ³•çš„æ ‡å‡†ã€‚æ¯”å¦‚è¯´ï¼Œä¸¤ä¸ªæ³¨è§£äº†<code>@RequestMapping</code>çš„æ–¹æ³•é™¤äº†æ–¹æ³•åç§°æ‹¥æœ‰å®Œå…¨ç›¸åŒçš„URLæ˜ å°„å’ŒHTTPè¯·æ±‚æ–¹æ³•ã€‚åœ¨æ–°ç‰ˆæœ¬ä¸‹ï¼Œ<code>@RequestMapping</code>æ³¨è§£çš„æ–¹æ³•å¿…é¡»å…·æœ‰å”¯ä¸€çš„è¯·æ±‚æ˜ å°„ï¼›</li>
<li>å®šä¹‰ä¸€ä¸ªé»˜è®¤æ–¹æ³•ï¼ˆå³æ²¡æœ‰å£°æ˜è·¯å¾„æ˜ å°„ï¼‰ï¼Œåœ¨è¯·æ±‚è·¯å¾„æ— æ³•è¢«æ˜ å°„åˆ°æ§åˆ¶å™¨ä¸‹æ›´ç²¾ç¡®çš„æ–¹æ³•ä¸Šå»æ—¶ï¼Œä¸ºè¯¥è¯·æ±‚æä¾›é»˜è®¤å¤„ç†ã€‚åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæ— æ³•ä¸ºä¸€ä¸ªè¯·æ±‚æ‰¾åˆ°åˆé€‚çš„å¤„ç†æ–¹æ³•ï¼Œé‚£ä¹ˆä¸€ä¸ª404é”™è¯¯å°†è¢«æŠ›å‡ºï¼›</li>
</ul>
<blockquote>
<p>[Original] The above features are still supported with the existing support classes. However to take advantage of new Spring MVC 3.1 features youâ€™ll need to use the new support classes.</p>
</blockquote>
<p>å¦‚æœä½¿ç”¨åŸæ¥çš„ç±»ï¼Œä»¥ä¸Šçš„åŠŸèƒ½è¿˜æ˜¯å¯ä»¥åšåˆ°ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦äº«å—Spring MVC 3.1ç‰ˆæœ¬å¸¦æ¥çš„æ–¹ä¾¿ç‰¹æ€§ï¼Œä½ å°±éœ€è¦å»ä½¿ç”¨æ–°çš„ç±»ã€‚</p>
<blockquote>
<p>[Original] ## URI Template Patterns</p>
</blockquote>
<h2 id="uri-">URIæ¨¡æ¿</h2>
<blockquote>
<p>[Original] URI templates can be used for convenient access to selected parts of a URL in a <code>@RequestMapping</code> method.</p>
</blockquote>
<p>URIæ¨¡æ¿å¯ä»¥ä¸ºå¿«é€Ÿè®¿é—®<code>@RequestMapping</code>ä¸­æŒ‡å®šçš„URLçš„ä¸€ä¸ªç‰¹å®šçš„éƒ¨åˆ†æä¾›å¾ˆå¤§çš„ä¾¿åˆ©ã€‚</p>
<blockquote>
<p>[Original] A URI Template is a URI-like string, containing one or more variable names. When you substitute values for these variables, the template becomes a URI. The proposed RFC for URI Templates defines how a URI is parameterized. For example, the URI Template <code>http://www.example.com/users/{userId}</code> contains the variable userId. Assigning the value fred to the variable yields <code>http://www.example.com/users/fred</code>.</p>
</blockquote>
<p>URIæ¨¡æ¿æ˜¯ä¸€ä¸ªç±»ä¼¼äºURIçš„å­—ç¬¦ä¸²ï¼Œåªä¸è¿‡å…¶ä¸­åŒ…å«äº†ä¸€ä¸ªæˆ–å¤šä¸ªçš„å˜é‡åã€‚å½“ä½ ä½¿ç”¨å®é™…çš„å€¼å»å¡«å……è¿™äº›å˜é‡åçš„æ—¶å€™ï¼Œæ¨¡æ¿å°±é€€åŒ–æˆäº†ä¸€ä¸ªURIã€‚åœ¨URIæ¨¡æ¿çš„RFCæè®®ä¸­å®šä¹‰äº†ä¸€ä¸ªURIæ˜¯å¦‚ä½•è¿›è¡Œå‚æ•°åŒ–çš„ã€‚æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªè¿™ä¸ªURIæ¨¡æ¿<code>http://www.example.com/users/{userId}</code>å°±åŒ…å«äº†ä¸€ä¸ªå˜é‡å<em>userId</em>ã€‚å°†å€¼<em>fred</em>èµ‹ç»™è¿™ä¸ªå˜é‡ååï¼Œå®ƒå°±å˜æˆäº†ä¸€ä¸ªURIï¼š<code>http://www.example.com/users/fred</code>ã€‚</p>
<blockquote>
<p>[Original] In Spring MVC you can use the <code>@PathVariable</code> annotation on a method argument to bind it to the value of a URI template variable:</p>
</blockquote>
<p>åœ¨Spring MVCä¸­ä½ å¯ä»¥åœ¨æ–¹æ³•å‚æ•°ä¸Šä½¿ç”¨<code>@PathVariable</code>æ³¨è§£ï¼Œå°†å…¶ä¸URIæ¨¡æ¿ä¸­çš„å‚æ•°ç»‘å®šèµ·æ¥ï¼š</p>
<pre><code class="lang-java">@RequestMapping(path=&quot;/owners/{ownerId}&quot;, method=RequestMethod.GET)
public String findOwner(@PathVariable String ownerId, Model model) {
    Owner owner = ownerService.findOwner(ownerId);
    model.addAttribute(&quot;owner&quot;, owner);
    return &quot;displayOwner&quot;;
}
</code></pre>
<blockquote>
<p>[Original] The URI Template &quot;<code>/owners/{ownerId}</code>&quot; specifies the variable name <code>ownerId</code>. When the controller handles this request, the value of <code>ownerId</code> is set to the value found in the appropriate part of the URI. For example, when a request comes in for <code>/owners/fred</code>, the value of <code>ownerId</code> is <code>fred</code>.</p>
</blockquote>
<p>URIæ¨¡æ¿&quot;<code>/owners/{ownerId}</code>&quot;æŒ‡å®šäº†ä¸€ä¸ªå˜é‡ï¼Œåä¸º<code>ownerId</code>ã€‚å½“æ§åˆ¶å™¨å¤„ç†è¿™ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œ<code>ownerId</code>çš„å€¼å°±ä¼šè¢«URIæ¨¡æ¿ä¸­å¯¹åº”éƒ¨åˆ†çš„å€¼æ‰€å¡«å……ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœè¯·æ±‚çš„URIæ˜¯<code>/owners/fred</code>ï¼Œæ­¤æ—¶å˜é‡<code>ownerId</code>çš„å€¼å°±æ˜¯<code>fred</code>.
`</p>
<blockquote>
<p>ä¸ºäº†å¤„ç†<code>@PathVariables</code>æ³¨è§£ï¼ŒSpring MVCå¿…é¡»é€šè¿‡å˜é‡åæ¥æ‰¾åˆ°URIæ¨¡æ¿ä¸­ç›¸å¯¹åº”çš„å˜é‡ã€‚ä½ å¯ä»¥åœ¨æ³¨è§£ä¸­ç›´æ¥å£°æ˜ï¼š</p>
<pre><code class="lang-java">@RequestMapping(path=&quot;/owners/{ownerId}}&quot;, method=RequestMethod.GET)
public String findOwner(@PathVariable(&quot;ownerId&quot;) String theOwner, Model model) {
    // å…·ä½“çš„æ–¹æ³•ä»£ç â€¦
}
</code></pre>
<p>æˆ–è€…ï¼Œå¦‚æœURIæ¨¡æ¿ä¸­çš„å˜é‡åä¸æ–¹æ³•çš„å‚æ•°åæ˜¯ç›¸åŒçš„ï¼Œåˆ™ä½ å¯ä»¥ä¸å¿…å†æŒ‡å®šä¸€æ¬¡ã€‚åªè¦ä½ åœ¨ç¼–è¯‘çš„æ—¶å€™ç•™ä¸‹debugä¿¡æ¯ï¼ŒSpring MVCå°±å¯ä»¥è‡ªåŠ¨åŒ¹é…URLæ¨¡æ¿ä¸­ä¸æ–¹æ³•å‚æ•°åç›¸åŒçš„å˜é‡åã€‚</p>
<pre><code class="lang-java">@RequestMapping(path=&quot;/owners/{ownerId}&quot;, method=RequestMethod.GET)
public String findOwner(@PathVariable String ownerId, Model model) {
    // å…·ä½“çš„æ–¹æ³•ä»£ç â€¦
}
</code></pre>
<p>[Original] A method can have any number of <code>@PathVariable</code> annotations:</p>
</blockquote>
<p>ä¸€ä¸ªæ–¹æ³•å¯ä»¥æ‹¥æœ‰ä»»æ„æ•°é‡çš„<code>@PathVariable</code>æ³¨è§£ï¼š</p>
<pre><code class="lang-java">@RequestMapping(path=&quot;/owners/{ownerId}/pets/{petId}&quot;, method=RequestMethod.GET)
public String findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) {
    Owner owner = ownerService.findOwner(ownerId);
    Pet pet = owner.getPet(petId);
    model.addAttribute(&quot;pet&quot;, pet);
    return &quot;displayPet&quot;;
}
</code></pre>
<blockquote>
<p>[Original] When a <code>@PathVariable</code> annotation is used on a <code>Map&lt;String, String&gt;</code> argument, the map is populated with all URI template variables.</p>
</blockquote>
<p>å½“<code>@PathVariable</code>æ³¨è§£è¢«åº”ç”¨äº<code>Map&lt;String, String&gt;</code>ç±»å‹çš„å‚æ•°ä¸Šæ—¶ï¼Œæ¡†æ¶ä¼šä½¿ç”¨æ‰€æœ‰URIæ¨¡æ¿å˜é‡æ¥å¡«å……è¿™ä¸ªmapã€‚</p>
<blockquote>
<p>[Original] A URI template can be assembled from type and path level <em>@RequestMapping</em> annotations. As a result the <code>findPet()</code> method can be invoked with a URL such as <code>/owners/42/pets/21</code>.</p>
</blockquote>
<p>URIæ¨¡æ¿å¯ä»¥ä»ç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«çš„ <em>@RequestMapping</em> æ³¨è§£è·å–æ•°æ®ã€‚å› æ­¤ï¼Œåƒè¿™æ ·çš„<code>findPet()</code>æ–¹æ³•å¯ä»¥è¢«ç±»ä¼¼äº<code>/owners/42/pets/21</code>è¿™æ ·çš„URLè·¯ç”±å¹¶è°ƒç”¨åˆ°ï¼š</p>
<pre><code class="lang-java">_@Controller_
@RequestMapping(&quot;/owners/{ownerId}&quot;)
public class RelativePathUriTemplateController {

    @RequestMapping(&quot;/pets/{petId}&quot;)
    public void findPet(_@PathVariable_ String ownerId, _@PathVariable_ String petId, Model model) {
        // æ–¹æ³•å®ç°ä½“è¿™é‡Œå¿½ç•¥
    }

}
</code></pre>
<blockquote>
<p>[Original] A <code>@PathVariable</code> argument can be of <em>any simple type</em> such as int, long, Date, etc. Spring automatically converts to the appropriate type or throws a
<code>TypeMismatchException</code> if it fails to do so. You can also register support
for parsing additional data types. See <a href="mvc.html#mvc-ann-typeconversion" title="Method Parameters And
Type Conversion">the section called &quot;Method Parameters
And Type Conversion&quot;</a> and <a href="mvc.html#mvc-ann-webdatabinder" title="Customizing WebDataBinder
initialization">the section called &quot;Customizing WebDataBinder
initialization&quot;</a>.</p>
</blockquote>
<p><code>@PathVariable</code>å¯ä»¥è¢«åº”ç”¨äºæ‰€æœ‰ <em>ç®€å•ç±»å‹</em> çš„å‚æ•°ä¸Šï¼Œæ¯”å¦‚intã€longã€Dateç­‰ç±»å‹ã€‚Springä¼šè‡ªåŠ¨åœ°å¸®ä½ æŠŠå‚æ•°è½¬åŒ–æˆåˆé€‚çš„ç±»å‹ï¼Œå¦‚æœè½¬æ¢å¤±è´¥ï¼Œå°±æŠ›å‡ºä¸€ä¸ª<code>TypeMismatchException</code>ã€‚å¦‚æœä½ éœ€è¦å¤„ç†å…¶ä»–æ•°æ®ç±»å‹çš„è½¬æ¢ï¼Œä¹Ÿå¯ä»¥æ³¨å†Œè‡ªå·±çš„ç±»ã€‚è‹¥éœ€è¦æ›´è¯¦ç»†çš„ä¿¡æ¯å¯ä»¥å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-typeconversion" title="Method Parameters And Type Conversion">â€œæ–¹æ³•å‚æ•°ä¸ç±»å‹è½¬æ¢â€ä¸€èŠ‚</a>å’Œ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-webdatabinder" title="Customizing WebDataBinder initialization">â€œå®šåˆ¶WebDataBinderåˆå§‹åŒ–è¿‡ç¨‹â€ä¸€èŠ‚</a></p>
<h2 id="-uri-">å¸¦æ­£åˆ™è¡¨è¾¾å¼çš„URIæ¨¡æ¿</h2>
<blockquote>
<p>[Original] Sometimes you need more precision in defining URI template variables. Consider the URL <code>&quot;/spring-web/spring-web-3.0.5.jar&quot;</code>. How do you break it down into
multiple parts?</p>
</blockquote>
<p>æœ‰æ—¶å€™ä½ å¯èƒ½éœ€è¦æ›´å‡†ç¡®åœ°æè¿°ä¸€ä¸ªURIæ¨¡æ¿çš„å˜é‡ï¼Œæ¯”å¦‚è¯´è¿™ä¸ªURLï¼š<code>&quot;/spring-web/spring-web-3.0.5.jar</code>ã€‚ä½ è¦æ€ä¹ˆæŠŠå®ƒåˆ†è§£æˆå‡ ä¸ªæœ‰æ„ä¹‰çš„éƒ¨åˆ†å‘¢ï¼Ÿ</p>
<blockquote>
<p>[Original] The <code>@RequestMapping</code> annotation supports the use of regular expressions in URI template variables. The syntax is <code>{varName:regex}</code> where the first part defines the variable name and the second - the regular expression.For example:</p>
</blockquote>
<p><code>@RequestMapping</code>æ³¨è§£æ”¯æŒä½ åœ¨URIæ¨¡æ¿å˜é‡ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚è¯­æ³•æ˜¯<code>{varName:regex}</code>ï¼Œå…¶ä¸­ç¬¬ä¸€éƒ¨åˆ†å®šä¹‰äº†å˜é‡åï¼Œç¬¬äºŒéƒ¨åˆ†å°±æ˜¯ä½ æ‰€è¦åº”ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç æ ·ä¾‹ï¼š</p>
<pre><code class="lang-java">@RequestMapping(&quot;/spring-web/{symbolicName:[a-z-]+}-{version:\\d\\.\\d\\.\\d}{extension:\\.[a-z]+}&quot;)
    public void handle(@PathVariable String version, @PathVariable String extension) {
        // ä»£ç éƒ¨åˆ†çœç•¥...
    }
}
</code></pre>
<h2 id="path-patterns-">Path Patternsï¼ˆä¸å¥½ç¿»ï¼Œå®¹æ˜“æ‰éŸµå‘³ï¼‰</h2>
<blockquote>
<p>[Original] In addition to URI templates, the <code>@RequestMapping</code> annotation also supports Ant-style path patterns (for example, <code>/myPath/*.do</code>). A combination of URI
template variables and Ant-style globs is also supported (e.g. <code>/owners/*/pets/{petId}</code>).</p>
</blockquote>
<p>é™¤äº†URIæ¨¡æ¿å¤–ï¼Œ<code>@RequestMapping</code>æ³¨è§£è¿˜æ”¯æŒAnté£æ ¼çš„è·¯å¾„æ¨¡å¼ï¼ˆå¦‚<code>/myPath/*.do</code>ç­‰ï¼‰ã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å¯ä»¥æŠŠURIæ¨¡æ¿å˜é‡å’ŒAnté£æ ¼çš„globç»„åˆèµ·æ¥ä½¿ç”¨ï¼ˆæ¯”å¦‚<code>/owners/*/pets/{petId}</code>è¿™æ ·çš„ç”¨æ³•ç­‰ï¼‰ã€‚</p>
<h2 id="-path-pattern-comparison-">è·¯å¾„æ ·å¼çš„åŒ¹é…(Path Pattern Comparison)</h2>
<blockquote>
<p>[Original] When a URL matches multiple patterns, a sort is used to find the most specific match.</p>
</blockquote>
<p>å½“ä¸€ä¸ªURLåŒæ—¶åŒ¹é…å¤šä¸ªæ¨¡æ¿ï¼ˆpatternï¼‰æ—¶ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸€ä¸ªç®—æ³•æ¥å†³å®šå…¶ä¸­æœ€åŒ¹é…çš„ä¸€ä¸ªã€‚</p>
<blockquote>
<p>[Original] A pattern with a lower count of URI variables and wild cards is considered more specific. For example <code>/hotels/{hotel}/*</code> has 1 URI variable and 1 wild card and is considered more specific than <code>/hotels/{hotel}/**</code> which as 1 URI
variable and 2 wild cards.</p>
</blockquote>
<p>URIæ¨¡æ¿å˜é‡çš„æ•°ç›®å’Œé€šé…ç¬¦æ•°é‡çš„æ€»å’Œæœ€å°‘çš„é‚£ä¸ªè·¯å¾„æ¨¡æ¿æ›´å‡†ç¡®ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ<code>/hotels/{hotel}/*</code>è¿™ä¸ªè·¯å¾„æ‹¥æœ‰ä¸€ä¸ªURIå˜é‡å’Œä¸€ä¸ªé€šé…ç¬¦ï¼Œè€Œ<code>/hotels/{hotel}/**</code>è¿™ä¸ªè·¯å¾„åˆ™æ‹¥æœ‰ä¸€ä¸ªURIå˜é‡å’Œä¸¤ä¸ªé€šé…ç¬¦ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºå‰è€…æ˜¯æ›´å‡†ç¡®çš„è·¯å¾„æ¨¡æ¿ã€‚</p>
<blockquote>
<p>[Original] If two patterns have the same count, the one that is longer is considered more specific. For example <code>/foo/bar*</code> is longer and considered more specific than <code>/foo/*</code>.</p>
</blockquote>
<p>å¦‚æœä¸¤ä¸ªæ¨¡æ¿çš„URIæ¨¡æ¿æ•°é‡å’Œé€šé…ç¬¦æ•°é‡æ€»å’Œä¸€è‡´ï¼Œåˆ™è·¯å¾„æ›´é•¿çš„é‚£ä¸ªæ¨¡æ¿æ›´å‡†ç¡®ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ<code>/foo/bar*</code>å°±è¢«è®¤ä¸ºæ¯”<code>/foo/*</code>æ›´å‡†ç¡®ï¼Œå› ä¸ºå‰è€…çš„è·¯å¾„æ›´é•¿ã€‚</p>
<blockquote>
<p>[Original] When two patterns have the same count and length, the pattern with fewer wild cards is considered more specific. For example <code>/hotels/{hotel}</code> is more
specific than <code>/hotels/*</code>.</p>
</blockquote>
<p>å¦‚æœä¸¤ä¸ªæ¨¡æ¿çš„æ•°é‡å’Œé•¿åº¦å‡ä¸€è‡´ï¼Œåˆ™é‚£ä¸ªå…·æœ‰æ›´å°‘é€šé…ç¬¦çš„æ¨¡æ¿æ˜¯æ›´åŠ å‡†ç¡®çš„ã€‚æ¯”å¦‚ï¼Œ<code>/hotels/{hotel}</code>å°±æ¯”<code>/hotels/*</code>æ›´ç²¾ç¡®ã€‚</p>
<blockquote>
<p>[Original] There are also some additional special rules:</p>
</blockquote>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„è§„åˆ™ï¼š</p>
<blockquote>
<p>[Original] <em> The <strong>default mapping pattern</strong> `/*</em><code>is less specific than any other pattern. For example</code>/api/{a}/{b}/{c}` is more specific.</p>
<p>[Original] <em> A <strong>prefix pattern</strong> such as `/public/*</em><code>is less specific than any other pattern that doesn&#39;t contain double wildcards. For example</code>/public/path3/{a}/{b}/{c}` is more specific.</p>
</blockquote>
<ul>
<li><strong>é»˜è®¤çš„é€šé…æ¨¡å¼</strong><code>/**</code>æ¯”å…¶ä»–æ‰€æœ‰çš„æ¨¡å¼éƒ½æ›´â€œä¸å‡†ç¡®â€ã€‚æ¯”æ–¹è¯´ï¼Œ<code>/api/{a}/{b}/{c}</code>å°±æ¯”é»˜è®¤çš„é€šé…æ¨¡å¼<code>/**</code>è¦æ›´å‡†ç¡®</li>
<li><strong>å‰ç¼€é€šé…</strong>ï¼ˆæ¯”å¦‚<code>/public/**</code>)è¢«è®¤ä¸ºæ¯”å…¶ä»–ä»»ä½•ä¸åŒ…æ‹¬åŒé€šé…ç¬¦çš„æ¨¡å¼æ›´ä¸å‡†ç¡®ã€‚æ¯”å¦‚è¯´ï¼Œ<code>/public/path3/{a}/{b}/{c}</code>å°±æ¯”<code>/public/**</code>æ›´å‡†ç¡®</li>
</ul>
<blockquote>
<p>[Original] For the full details see <code>AntPatternComparator</code> in <code>AntPathMatcher</code>. Note that the PathMatcher can be customized (see <a href="mvc.html#mvc-config-path-matching" title="21.16.11 Path Matching">Section 21.16.11, &quot;Path
Matching&quot;</a> in the
section on configuring Spring MVC).</p>
</blockquote>
<p>æ›´å¤šçš„ç»†èŠ‚è¯·å‚è€ƒè¿™ä¸¤ä¸ªç±»ï¼š<code>AntPatternComparator</code>å’Œ<code>AntPathMatcher</code>ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒPathMatcherç±»æ˜¯å¯ä»¥é…ç½®çš„ï¼ˆè§â€œé…ç½®Spring MVCâ€ä¸€èŠ‚ä¸­çš„<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/html#mvc-config-path-matching" title="21.16.11 Path Matching">21.16.11 è·¯å¾„çš„åŒ¹é…</a>ä¸€èŠ‚)ã€‚</p>
<h2 id="-path-patterns-">å¸¦å ä½ç¬¦çš„è·¯å¾„æ¨¡å¼ï¼ˆpath patternsï¼‰</h2>
<blockquote>
<p>[Original] Patterns in <code>@RequestMapping</code> annotations support ${â€¦} placeholders against local properties and/or system properties and environment variables. This may be useful in cases where the path a controller is mapped to may need to be
customized through configuration. For more information on placeholders, see
the javadocs of the <code>PropertyPlaceholderConfigurer</code> class.</p>
</blockquote>
<p><code>@RequestMapping</code>æ³¨è§£æ”¯æŒåœ¨è·¯å¾„ä¸­ä½¿ç”¨å ä½ç¬¦ï¼Œä»¥å–å¾—ä¸€äº›æœ¬åœ°é…ç½®ã€ç³»ç»Ÿé…ç½®ã€ç¯å¢ƒå˜é‡ç­‰ã€‚è¿™ä¸ªç‰¹æ€§æœ‰æ—¶å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚è¯´æ§åˆ¶å™¨çš„æ˜ å°„è·¯å¾„éœ€è¦é€šè¿‡é…ç½®æ¥å®šåˆ¶çš„åœºæ™¯ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šå…³äºå ä½ç¬¦çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ<code>PropertyPlaceholderConfigurer</code>è¿™ä¸ªç±»çš„æ–‡æ¡£ã€‚</p>
<h4 id="suffix-pattern-matching">Suffix Pattern Matching</h4>
<h2 id="-">åç¼€æ¨¡å¼åŒ¹é…</h2>
<blockquote>
<p>[Original] By default Spring MVC performs <code>&quot;.*&quot;</code> suffix pattern matching so that a
controller mapped to <code>/person</code> is also implicitly mapped to <code>/person.*</code>. This
makes it easy to request different representations of a resource through the
URL path (e.g. <code>/person.pdf</code>, <code>/person.xml</code>).</p>
</blockquote>
<p>Spring MVCé»˜è®¤é‡‡ç”¨<code>&quot;.*&quot;</code>çš„åç¼€æ¨¡å¼åŒ¹é…æ¥è¿›è¡Œè·¯å¾„åŒ¹é…ï¼Œå› æ­¤ï¼Œä¸€ä¸ªæ˜ å°„åˆ°<code>/person</code>è·¯å¾„çš„æ§åˆ¶å™¨ä¹Ÿä¼šéšå¼åœ°è¢«æ˜ å°„åˆ°<code>/person.*</code>ã€‚è¿™ä½¿å¾—é€šè¿‡URLæ¥è¯·æ±‚åŒä¸€èµ„æºæ–‡ä»¶çš„ä¸åŒæ ¼å¼å˜å¾—æ›´ç®€å•ï¼ˆæ¯”å¦‚<code>/person.pdf</code>ï¼Œ<code>/person.xml</code>ï¼‰ã€‚</p>
<blockquote>
<p>[Original] Suffix pattern matching can be turned off or restricted to a set of path extensions explicitly registered for content negotiation purposes. This is
generally recommended to minimize ambiguity with common request mappings such
as <code>/person/{id}</code> where a dot might not represent a file extension, e.g.
<code>/person/joe@email.com</code> vs <code>/person/joe@email.com.json)</code>. Furthermore as explained in the note below suffix pattern matching as well as content negotiation may be used
in some circumstances to attempt malicious attacks and there are good reasons
to restrict them meaningfully.</p>
</blockquote>
<p>ä½ å¯ä»¥å…³é—­é»˜è®¤çš„åç¼€æ¨¡å¼åŒ¹é…ï¼Œæˆ–è€…æ˜¾å¼åœ°å°†è·¯å¾„åç¼€é™å®šåˆ°ä¸€äº›ç‰¹å®šæ ¼å¼ä¸Šfor content negotiation purposeã€‚æˆ‘ä»¬æ¨èè¿™æ ·åšï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ˜ å°„è¯·æ±‚æ—¶å¯ä»¥å¸¦æ¥çš„ä¸€äº›äºŒä¹‰æ€§ï¼Œæ¯”å¦‚è¯·æ±‚ä»¥ä¸‹è·¯å¾„<code>/person/{id}</code>æ—¶ï¼Œè·¯å¾„ä¸­çš„ç‚¹å·åé¢å¸¦çš„å¯èƒ½ä¸æ˜¯æè¿°å†…å®¹æ ¼å¼ï¼Œæ¯”å¦‚<code>/person/joe@email.com</code> vs <code>/person/joe@email.com.json</code>ã€‚è€Œä¸”æ­£å¦‚ä¸‹é¢é©¬ä¸Šè¦æåˆ°çš„ï¼Œåç¼€æ¨¡å¼é€šé…ä»¥åŠå†…å®¹åå•†æœ‰æ—¶å¯èƒ½ä¼šè¢«é»‘å®¢ç”¨æ¥è¿›è¡Œæ”»å‡»ï¼Œå› æ­¤ï¼Œå¯¹åç¼€é€šé…è¿›è¡Œæœ‰æ„ä¹‰çš„é™å®šæ˜¯æœ‰å¥½å¤„çš„ã€‚</p>
<blockquote>
<p>[Original] See <a href="mvc.html#mvc-config-path-matching" title="21.16.11 Path Matching">Section 21.16.11, &quot;Path Matching&quot;</a> for suffix pattern matching configuration and also <a href="mvc.html#mvc-config-content-negotiation" title="21.16.6 Content Negotiation">Section 21.16.6, &quot;Content Negotiation&quot;</a> for content negotiation configuration.</p>
</blockquote>
<p>å…³äºåç¼€æ¨¡å¼åŒ¹é…çš„é…ç½®é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-config-path-matching" title="21.16.11 Path Matching">ç¬¬21.16.11å°èŠ‚ &quot;è·¯å¾„åŒ¹é…&quot;</a>ï¼›å…³äºå†…å®¹åå•†çš„é…ç½®é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-config-content-negotiation" title="21.16.6 Content Negotiation">ç¬¬21.16.6å°èŠ‚ &quot;å†…å®¹åå•†&quot;</a>çš„å†…å®¹ã€‚</p>
<h2 id="-rfd">åç¼€æ¨¡å¼åŒ¹é…ä¸RFD</h2>
<blockquote>
<p>[Original] Reflected file download (RFD) attack was first described in a <a href="https://www.trustwave.com/Resources/SpiderLabs-Blog/Reflected-File-Download---A-New-Web-Attack-Vector/">paper by
Trustwave</a> in 2014. The attack is similar to XSS in that it relies on input (e.g. query parameter, URI variable) being reflected in the response. However instead of inserting JavaScript into HTML, an RFD attack relies on the browser switching to perform a download and treating the response as an executable script if double-clicked based on the file extension (e.g. .bat, .cmd).</p>
</blockquote>
<p>RFD(Reflected file download)æ”»å‡»æœ€å…ˆæ˜¯2014å¹´åœ¨<a href="https://www.trustwave.com/Resources/SpiderLabs-Blog/Reflected-File-Download---A-New-Web-Attack-Vector/">Trustwaveçš„ä¸€ç¯‡è®ºæ–‡</a>ä¸­è¢«æå‡ºçš„ã€‚å®ƒä¸XSSæ”»å‡»æœ‰äº›ç›¸ä¼¼ï¼Œå› ä¸ºè¿™ç§æ”»å‡»æ–¹å¼ä¹Ÿä¾èµ–äºæŸäº›ç‰¹å¾ï¼Œå³éœ€è¦ä½ çš„è¾“å…¥ï¼ˆæ¯”å¦‚æŸ¥è¯¢å‚æ•°ï¼ŒURIå˜é‡ç­‰ï¼‰ç­‰ä¹Ÿåœ¨è¾“å‡ºï¼ˆresponseï¼‰ä¸­ä»¥æŸç§å½¢å¼å‡ºç°ã€‚ä¸åŒçš„æ˜¯ï¼ŒRFDæ”»å‡»å¹¶ä¸æ˜¯é€šè¿‡åœ¨HTMLä¸­å†™å…¥JavaScriptä»£ç è¿›è¡Œï¼Œè€Œæ˜¯ä¾èµ–äºæµè§ˆå™¨æ¥è·³è½¬åˆ°ä¸‹è½½é¡µé¢ï¼Œå¹¶æŠŠç‰¹å®šæ ¼å¼ï¼ˆæ¯”å¦‚.batï¼Œ.cmdç­‰ï¼‰çš„responseå½“æˆæ˜¯å¯æ‰§è¡Œè„šæœ¬ï¼ŒåŒå‡»å®ƒå°±ä¼šæ‰§è¡Œã€‚</p>
<blockquote>
<p>[Original] In Spring MVC <code>@ResponseBody</code> and <code>ResponseEntity</code> methods are at risk because they can render different content types which clients can request including via URL path extensions. Note however that neither disabling suffix pattern matching nor disabling the use of path extensions for content negotiation purposes alone are effective at preventing RFD attacks.</p>
</blockquote>
<p>Spring MVCçš„<code>@ResponseBody</code>å’Œ<code>ResponseEntity</code>æ–¹æ³•æ˜¯æœ‰é£é™©çš„ï¼Œå› ä¸ºå®ƒä»¬ä¼šæ ¹æ®å®¢æˆ·çš„è¯·æ±‚â€”â€”åŒ…æ‹¬URLçš„è·¯å¾„åç¼€ï¼Œæ¥æ¸²æŸ“ä¸åŒçš„å†…å®¹ç±»å‹ã€‚å› æ­¤ï¼Œç¦ç”¨åç¼€æ¨¡å¼åŒ¹é…æˆ–è€…ç¦ç”¨ä»…ä¸ºå†…å®¹åå•†å¼€å¯çš„è·¯å¾„æ–‡ä»¶åç¼€åæºå¸¦ï¼Œéƒ½æ˜¯é˜²èŒƒRFDæ”»å‡»çš„æœ‰æ•ˆæ–¹å¼ã€‚</p>
<blockquote>
<p>[Original] For comprehensive protection against RFD, prior to rendering the response body Spring MVC adds a <code>Content-Disposition:inline;filename=f.txt</code> header to suggest a fixed and safe download file filename. This is done only if the URL path contains a file extension that is neither whitelisted nor explicitly registered for content negotiation purposes. However it may potentially have side effects when URLs are typed directly into a browser.</p>
</blockquote>
<p>è‹¥è¦å¼€å¯å¯¹RFDæ›´é«˜çº§çš„ä¿æŠ¤æ¨¡å¼ï¼Œå¯ä»¥åœ¨Spring MVCæ¸²æŸ“å¼€å§‹è¯·æ±‚æ­£æ–‡ä¹‹å‰ï¼Œåœ¨è¯·æ±‚å¤´ä¸­å¢åŠ ä¸€è¡Œé…ç½®<code>Content-Disposition:inline;filename=f.txt</code>ï¼ŒæŒ‡å®šå›ºå®šçš„ä¸‹è½½æ–‡ä»¶çš„æ–‡ä»¶åã€‚è¿™ä»…åœ¨URLè·¯å¾„ä¸­åŒ…å«äº†ä¸€ä¸ªæ–‡ä»¶ç¬¦åˆä»¥ä¸‹ç‰¹å¾çš„æ‹“å±•åæ—¶é€‚ç”¨ï¼šè¯¥æ‰©å±•åæ—¢ä¸åœ¨ä¿¡ä»»åˆ—è¡¨ï¼ˆç™½åå•ï¼‰ä¸­ï¼Œä¹Ÿæ²¡æœ‰è¢«æ˜¾å¼åœ°è¢«æ³¨å†Œäºå†…å®¹åå•†æ—¶ä½¿ç”¨ã€‚å¹¶ä¸”è¿™ç§åšæ³•è¿˜å¯ä»¥æœ‰ä¸€äº›å‰¯ä½œç”¨ï¼Œæ¯”å¦‚ï¼Œå½“URLæ˜¯é€šè¿‡æµè§ˆå™¨æ‰‹åŠ¨è¾“å…¥çš„æ—¶å€™ã€‚</p>
<blockquote>
<p>[Original] Many common path extensions are whitelisted by default. Furthermore REST API calls are typically not meant to be used as URLs directly in browsers. Nevertheless applications that use custom <code>HttpMessageConverter</code> implementations can explicitly register file extensions for content negotiation and the Content-Disposition header will not be added for such extensions. See <a href="mvc.html#mvc-config-content-negotiation" title="21.16.6 Content Negotiation">Section 21.16.6, &quot;Content Negotiation&quot;</a>.</p>
</blockquote>
<p>å¾ˆå¤šå¸¸ç”¨çš„è·¯å¾„æ–‡ä»¶åç¼€é»˜è®¤æ˜¯è¢«ä¿¡ä»»çš„ã€‚å¦å¤–ï¼ŒRESTçš„APIä¸€èˆ¬æ˜¯ä¸åº”è¯¥ç›´æ¥ç”¨åšURLçš„ã€‚ä¸è¿‡ï¼Œä½ å¯ä»¥è‡ªå·±å®šåˆ¶<code>HttpMessageConverter</code>çš„å®ç°ï¼Œç„¶åæ˜¾å¼åœ°æ³¨å†Œç”¨äºå†…å®¹åå•†çš„æ–‡ä»¶ç±»å‹ï¼Œè¿™ç§æƒ…å½¢ä¸‹Content-Dispositionå¤´å°†ä¸ä¼šè¢«åŠ å…¥åˆ°è¯·æ±‚å¤´ä¸­ã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-config-content-negotiation" title="21.16.6 Content Negotiation">ç¬¬21.16.6èŠ‚ä¸­â€œå†…å®¹åå•†â€çš„å†…å®¹</a>ã€‚</p>
<blockquote>
<p>[Original] This was originally introduced as part of work for <a href="http://pivotal.io/security/cve-2015-5211">CVE-2015-5211</a>. Below are additional recommendations from the report:</p>
<ul>
<li>Encode rather than escape JSON responses. This is also an OWASP XSS recommendation. For an example of how to do that with Spring see <a href="https://github.com/rwinch/spring-jackson-owasp">spring-jackson-owasp</a>.</li>
<li>Configure suffix pattern matching to be turned off or restricted to explicitly registered suffixes only.</li>
<li>Configure content negotiation with the properties &quot;useJaf&quot; and &quot;ignoreUnknownPathExtensions&quot; set to false which would result in a 406 response for URLs with unknown extensions. Note however that this may not be an option if URLs are naturally expected to have a dot towards the end.</li>
<li>Add <code>X-Content-Type-Options: nosniff</code> header to responses. Spring Security 4 does this by default.</li>
</ul>
</blockquote>
<p>æ„Ÿè§‰è¿™èŠ‚çš„ç¿»è¯‘è´¨é‡è¿˜æœ‰é™ï¼Œéœ€è¦ç»§ç»­äº†è§£XSSæ”»å‡»å’ŒRFDæ”»å‡»çš„ç»†èŠ‚å†ç¿»ã€‚</p>
<h2 id="-">çŸ©é˜µå˜é‡</h2>
<blockquote>
<p>[Original] The URI specification <a href="http://tools.ietf.org/html/rfc3986#section-3.3">RFC 3986</a> defines the possibility of including name-value pairs within path segments. There is no specific term used in the spec. The general &quot;URI path parameters&quot; could be applied although the more unique <a href="http://www.w3.org/DesignIssues/MatrixURIs.html">&quot;Matrix URIs&quot;</a>, originating from an old post by Tim Berners-Lee, is also frequently used and fairly well known. Within Spring MVC these are referred to as matrix variables.</p>
</blockquote>
<p>åŸæ¥çš„URIè§„èŒƒ<a href="http://tools.ietf.org/html/rfc3986#section-3.3">RFC 3986</a>ä¸­å…è®¸åœ¨è·¯å¾„æ®µè½ä¸­æºå¸¦é”®å€¼å¯¹ï¼Œä½†è§„èŒƒæ²¡æœ‰æ˜ç¡®ç»™è¿™æ ·çš„é”®å€¼å¯¹å®šä¹‰æœ¯è¯­ã€‚æœ‰äººå«â€œURIè·¯å¾„å‚æ•°â€ï¼Œä¹Ÿæœ‰å«<a href="http://www.w3.org/DesignIssues/MatrixURIs.html">â€œçŸ©é˜µURIâ€</a>çš„ã€‚åè€…æ˜¯Tim Berners-Leeé¦–å…ˆåœ¨å…¶åšå®¢ä¸­æåˆ°çš„æœ¯è¯­ï¼Œè¢«ä½¿ç”¨å¾—è¦æ›´åŠ é¢‘ç¹ä¸€äº›ï¼ŒçŸ¥ååº¦ä¹Ÿæ›´é«˜äº›ã€‚è€Œåœ¨Spring MVCä¸­ï¼Œæˆ‘ä»¬ç§°è¿™æ ·çš„é”®å€¼å¯¹ä¸ºçŸ©é˜µå˜é‡ã€‚</p>
<blockquote>
<p>[Original] Matrix variables can appear in any path segment, each matrix variable separated with a &quot;;&quot; (semicolon). For example: <code>&quot;/cars;color=red;year=2012&quot;</code>. Multiple values may be either &quot;,&quot; (comma) separated <code>&quot;color=red,green,blue&quot;</code> or the variable name may be repeated <code>&quot;color=red;color=green;color=blue&quot;</code>.</p>
</blockquote>
<p>çŸ©é˜µå˜é‡å¯ä»¥åœ¨ä»»ä½•è·¯å¾„æ®µè½ä¸­å‡ºç°ï¼Œæ¯å¯¹çŸ©é˜µå˜é‡ä¹‹é—´ä½¿ç”¨ä¸€ä¸ªåˆ†å·â€œ;â€éš”å¼€ã€‚æ¯”å¦‚è¿™æ ·çš„URIï¼š<code>&quot;/cars;color=red;year=2012&quot;</code>ã€‚å¤šä¸ªå€¼å¯ä»¥ç”¨é€—å·éš”å¼€<code>&quot;color=red,green,blue&quot;</code>ï¼Œæˆ–è€…é‡å¤å˜é‡åå¤šæ¬¡<code>&quot;color=red;color=green;color=blue&quot;</code>ã€‚</p>
<blockquote>
<p>[Original] If a URL is expected to contain matrix variables, the request mapping pattern must represent them with a URI template. This ensures the request can be matched correctly regardless of whether matrix variables are present or not and in what order they are provided.</p>
</blockquote>
<p>å¦‚æœä¸€ä¸ªURLæœ‰å¯èƒ½éœ€è¦åŒ…å«çŸ©é˜µå˜é‡ï¼Œé‚£ä¹ˆåœ¨è¯·æ±‚è·¯å¾„çš„æ˜ å°„é…ç½®ä¸Šå°±éœ€è¦ä½¿ç”¨URIæ¨¡æ¿æ¥ä½“ç°è¿™ä¸€ç‚¹ã€‚è¿™æ ·æ‰èƒ½ç¡®ä¿è¯·æ±‚å¯ä»¥è¢«æ­£ç¡®åœ°æ˜ å°„ï¼Œè€Œä¸ç®¡çŸ©é˜µå˜é‡åœ¨URIä¸­æ˜¯å¦å‡ºç°ã€å‡ºç°çš„æ¬¡åºæ˜¯æ€æ ·ç­‰ã€‚</p>
<blockquote>
<p>[Original] Below is an example of extracting the matrix variable &quot;q&quot;:</p>
</blockquote>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•ä»çŸ©é˜µå˜é‡ä¸­è·å–åˆ°å˜é‡â€œqâ€çš„å€¼ï¼š</p>
<pre><code class="lang-java">// GET /pets/42;q=11;r=22

@RequestMapping(path = &quot;/pets/{petId}&quot;, method = RequestMethod.GET)
public void findPet(@PathVariable String petId, @MatrixVariable int q) {

    // petId == 42
    // q == 11

}
</code></pre>
<blockquote>
<p>[Original] Since all path segments may contain matrix variables, in some cases you need to be more specific to identify where the variable is expected to be:</p>
</blockquote>
<p>ç”±äºä»»æ„è·¯å¾„æ®µè½ä¸­éƒ½å¯ä»¥å«æœ‰çŸ©é˜µå˜é‡ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä½ éœ€è¦ç”¨æ›´ç²¾ç¡®çš„ä¿¡æ¯æ¥æŒ‡å®šä¸€ä¸ªçŸ©é˜µå˜é‡çš„ä½ç½®ï¼š</p>
<pre><code class="lang-java">// GET /owners/42;q=11/pets/21;q=22

@RequestMapping(path = &quot;/owners/{ownerId}/pets/{petId}&quot;, method = RequestMethod.GET)
public void findPet(
    @MatrixVariable(name=&quot;q&quot;, pathVar=&quot;ownerId&quot;) int q1,
    @MatrixVariable(name=&quot;q&quot;, pathVar=&quot;petId&quot;) int q2) {

    // q1 == 11
    // q2 == 22

}
</code></pre>
<blockquote>
<p>[Original] A matrix variable may be defined as optional and a default value specified:</p>
</blockquote>
<p>ä½ ä¹Ÿå¯ä»¥å£°æ˜ä¸€ä¸ªçŸ©é˜µå˜é‡ä¸æ˜¯å¿…é¡»å‡ºç°çš„ï¼Œå¹¶ç»™å®ƒèµ‹ä¸€ä¸ªé»˜è®¤å€¼ï¼š</p>
<pre><code class="lang-java">// GET /pets/42

@RequestMapping(path = &quot;/pets/{petId}&quot;, method = RequestMethod.GET)
public void findPet(@MatrixVariable(required=false, defaultValue=&quot;1&quot;) int q) {

    // q == 1

}
</code></pre>
<blockquote>
<p>[Original] All matrix variables may be obtained in a Map:</p>
</blockquote>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªMapæ¥å­˜å‚¨æ‰€æœ‰çš„çŸ©é˜µå˜é‡ï¼š</p>
<pre><code class="lang-java">// GET /owners/42;q=11;r=12/pets/21;q=22;s=23

@RequestMapping(path = &quot;/owners/{ownerId}/pets/{petId}&quot;, method = RequestMethod.GET)
public void findPet(
    @MatrixVariable Map&lt;String, String&gt; matrixVars,
    @MatrixVariable(pathVar=&quot;petId&quot;) Map&lt;String, String&gt; petMatrixVars) {

    // matrixVars: [&quot;q&quot; : [11,22], &quot;r&quot; : 12, &quot;s&quot; : 23]
    // petMatrixVars: [&quot;q&quot; : 11, &quot;s&quot; : 23]

}
</code></pre>
<blockquote>
<p>[Original] Note that to enable the use of matrix variables, you must set the <code>removeSemicolonContent</code> property of <code>RequestMappingHandlerMapping</code> to <code>false</code>. By default it is set to <code>true</code>.</p>
</blockquote>
<p>å¦‚æœè¦å…è®¸çŸ©é˜µå˜é‡çš„ä½¿ç”¨ï¼Œä½ å¿…é¡»æŠŠ<code>RequestMappingHandlerMapping</code>ç±»çš„<code>removeSemicolonContent</code>å±æ€§è®¾ç½®ä¸º<code>false</code>ã€‚è¯¥å€¼é»˜è®¤æ˜¯<code>true</code>çš„ã€‚</p>
<blockquote>
<p>[Original] The MVC Java config and the MVC namespace both provide options for enabling the use of matrix variables.</p>
<p>MVCçš„Javaç¼–ç¨‹é…ç½®å’Œå‘½åç©ºé—´é…ç½®éƒ½æä¾›äº†å¯ç”¨çŸ©é˜µå˜é‡çš„æ–¹å¼ã€‚</p>
<p>[Original] If you are using Java config, The <a href="mvc.html#mvc-config-advanced-java" title="21.16.13 Advanced Customizations with MVC Java Config">Advanced Customizations with MVC Java Config</a> section describes how the <code>RequestMappingHandlerMapping</code> can be customized.</p>
<p>å¦‚æœä½ æ˜¯ä½¿ç”¨Javaç¼–ç¨‹çš„æ–¹å¼ï¼Œ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-config-advanced-java" title="21.16.13 Advanced Customizations with MVC Java Config">â€œMVC Javaé«˜çº§å®šåˆ¶åŒ–é…ç½®â€ä¸€èŠ‚</a>æè¿°äº†å¦‚ä½•å¯¹<code>RequestMappingHandlerMapping</code>è¿›è¡Œå®šåˆ¶ã€‚</p>
<p>[Original] In the MVC namespace, the <code>&lt;mvc:annotation-driven&gt;</code> element has an <code>enable-matrix-variables</code> attribute that should be set to <code>true</code>. By default it is set to <code>false</code>.</p>
<p>è€Œä½¿ç”¨MVCçš„å‘½åç©ºé—´é…ç½®æ—¶ï¼Œä½ å¯ä»¥æŠŠ<code>&lt;mvc:annotation-driven&gt;</code>å…ƒç´ ä¸‹çš„<code>enable-matrix-variables</code>å±æ€§è®¾ç½®ä¸º<code>true</code>ã€‚è¯¥å€¼é»˜è®¤æƒ…å†µä¸‹æ˜¯é…ç½®ä¸º<code>false</code>çš„ã€‚</p>
</blockquote>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;

    &lt;mvc:annotation-driven enable-matrix-variables=&quot;true&quot;/&gt;

&lt;/beans&gt;
</code></pre>
<h2 id="-">å¯æ¶ˆè´¹çš„åª’ä½“ç±»å‹</h2>
<blockquote>
<p>[Original] You can narrow the primary mapping by specifying a list of consumable media types. The request will be matched only if the <em>Content-Type</em> request header matches the specified media type. For example:</p>
</blockquote>
<p>ä½ å¯ä»¥æŒ‡å®šä¸€ç»„å¯æ¶ˆè´¹çš„åª’ä½“ç±»å‹ï¼Œç¼©å°æ˜ å°„çš„èŒƒå›´ã€‚è¿™æ ·åªæœ‰å½“è¯·æ±‚å¤´ä¸­ <em>Content-Type</em> çš„å€¼ä¸æŒ‡å®šå¯æ¶ˆè´¹çš„åª’ä½“ç±»å‹ä¸­æœ‰ç›¸åŒçš„æ—¶å€™ï¼Œè¯·æ±‚æ‰ä¼šè¢«åŒ¹é…ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<pre><code class="lang-java">@Controller
@RequestMapping(path = &quot;/pets&quot;, method = RequestMethod.POST, consumes=&quot;application/json&quot;)
public void addPet(@RequestBody Pet pet, Model model) {
    // æ–¹æ³•å®ç°çœç•¥
}
</code></pre>
<blockquote>
<p>[Original] Consumable media type expressions can also be negated as in <em>!text/plain</em> to match to all requests other than those with <em>Content-Type</em> of <em>text/plain</em>. Also consider using constants provided in <code>MediaType</code> such as <code>APPLICATION_JSON_VALUE</code> and <code>APPLICATION_JSON_UTF8_VALUE</code>.</p>
</blockquote>
<p>æŒ‡å®šå¯æ¶ˆè´¹åª’ä½“ç±»å‹çš„è¡¨è¾¾å¼ä¸­è¿˜å¯ä»¥ä½¿ç”¨å¦å®šï¼Œæ¯”å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ <em>!text/plain</em> æ¥åŒ¹é…æ‰€æœ‰è¯·æ±‚å¤´ <em>Content-Type</em> ä¸­ä¸å« <em>text/plain</em> çš„è¯·æ±‚ã€‚åŒæ—¶ï¼Œåœ¨<code>MediaType</code>ç±»ä¸­è¿˜å®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚<code>APPLICATION_JSON_VALUE</code>ã€<code>APPLICATION_JSON_UTF8_VALUE</code>ç­‰ï¼Œæ¨èæ›´å¤šåœ°ä½¿ç”¨å®ƒä»¬ã€‚</p>
<blockquote>
<p>[Original] The <em>consumes</em> condition is supported on the type and on the method level. Unlike most other conditions, when used at the type level, method-level consumable types override rather than extend type-level consumable types.</p>
<p><em>consumes</em>å±æ€§æä¾›çš„æ˜¯æ–¹æ³•çº§çš„ç±»å‹æ”¯æŒã€‚ä¸å…¶ä»–å±æ€§ä¸åŒï¼Œå½“åœ¨ç±»å‹çº§ä½¿ç”¨æ—¶ï¼Œæ–¹æ³•çº§çš„æ¶ˆè´¹ç±»å‹å°†è¦†ç›–ç±»å‹çº§çš„é…ç½®ï¼Œè€Œéç»§æ‰¿å…³ç³»ã€‚</p>
</blockquote>
<h2 id="-">å¯ç”Ÿäº§çš„åª’ä½“ç±»å‹</h2>
<blockquote>
<p>[Original] You can narrow the primary mapping by specifying a list of producible media types. The request will be matched only if the <em>Accept</em> request header matches one of these values. Furthermore, use of the <em>produces</em> condition ensures the actual content type used to generate the response respects the media types specified in the <em>produces</em> condition. For example:</p>
</blockquote>
<p>ä½ å¯ä»¥æŒ‡å®šä¸€ç»„å¯ç”Ÿäº§çš„åª’ä½“ç±»å‹ï¼Œç¼©å°æ˜ å°„çš„èŒƒå›´ã€‚è¿™æ ·åªæœ‰å½“è¯·æ±‚å¤´ä¸­ <em>Accept</em> çš„å€¼ä¸æŒ‡å®šå¯ç”Ÿäº§çš„åª’ä½“ç±»å‹ä¸­æœ‰ç›¸åŒçš„æ—¶å€™ï¼Œè¯·æ±‚æ‰ä¼šè¢«åŒ¹é…ã€‚è€Œä¸”ï¼Œä½¿ç”¨ <em>produces</em> æ¡ä»¶å¯ä»¥ç¡®ä¿ç”¨äºç”Ÿæˆå“åº”ï¼ˆresponseï¼‰çš„å†…å®¹ä¸æŒ‡å®šçš„å¯ç”Ÿäº§çš„åª’ä½“ç±»å‹æ˜¯ç›¸åŒçš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="lang-java">@Controller
@RequestMapping(path = &quot;/pets/{petId}&quot;, method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_UTF8_VALUE)
@ResponseBody
public Pet getPet(@PathVariable String petId, Model model) {
    // æ–¹æ³•å®ç°çœç•¥
}
</code></pre>
<blockquote>
<p>[Original] Be aware that the media type specified in the <em>produces</em> condition can also optionally specify a character set. For example, in the code snippet above we
specify the same media type than the default one configured in <code>MappingJackson2HttpMessageConverter</code>, including the <code>UTF-8</code> charset.</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡ <em>condition</em> æ¡ä»¶æŒ‡å®šçš„åª’ä½“ç±»å‹ä¹Ÿå¯ä»¥æŒ‡å®šå­—ç¬¦é›†ã€‚æ¯”å¦‚åœ¨ä¸Šé¢çš„å°æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦†å†™äº†<code>MappingJackson2HttpMessageConverter</code>ç±»ä¸­é»˜è®¤é…ç½®çš„åª’ä½“ç±»å‹ï¼ŒåŒæ—¶ï¼Œè¿˜æŒ‡å®šäº†ä½¿ç”¨<code>UTF-8</code>çš„å­—ç¬¦é›†ã€‚</p>
<p>[Original] Just like with <em>consumes</em>, producible media type expressions can be negated as in <em>!text/plain</em> to match to all requests other than those with an <em>Accept</em> header value of <em>text/plain</em>. Also consider using constants provided in <code>MediaType</code> such as <code>APPLICATION_JSON_VALUE</code> and <code>APPLICATION_JSON_UTF8_VALUE</code>.</p>
</blockquote>
<p>ä¸ <em>consumes</em> æ¡ä»¶ç±»ä¼¼ï¼Œå¯ç”Ÿäº§çš„åª’ä½“ç±»å‹è¡¨è¾¾å¼ä¹Ÿå¯ä»¥ä½¿ç”¨å¦å®šã€‚æ¯”å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ <em>!text/plain</em> æ¥åŒ¹é…æ‰€æœ‰è¯·æ±‚å¤´ <em>Accept</em> ä¸­ä¸å« <em>text/plain</em> çš„è¯·æ±‚ã€‚åŒæ—¶ï¼Œåœ¨<code>MediaType</code>ç±»ä¸­è¿˜å®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚<code>APPLICATION_JSON_VALUE</code>ã€<code>APPLICATION_JSON_UTF8_VALUE</code>ç­‰ï¼Œæ¨èæ›´å¤šåœ°ä½¿ç”¨å®ƒä»¬ã€‚</p>
<blockquote>
<p>[Original] The <em>produces</em> condition is supported on the type and on the method level. Unlike most other conditions, when used at the type level, method-level
producible types override rather than extend type-level producible types.</p>
<p><em>produces</em>å±æ€§æä¾›çš„æ˜¯æ–¹æ³•çº§çš„ç±»å‹æ”¯æŒã€‚ä¸å…¶ä»–å±æ€§ä¸åŒï¼Œå½“åœ¨ç±»å‹çº§ä½¿ç”¨æ—¶ï¼Œæ–¹æ³•çº§çš„æ¶ˆè´¹ç±»å‹å°†è¦†ç›–ç±»å‹çº§çš„é…ç½®ï¼Œè€Œéç»§æ‰¿å…³ç³»ã€‚</p>
</blockquote>
<h2 id="-">è¯·æ±‚å‚æ•°ä¸è¯·æ±‚å¤´çš„å€¼</h2>
<blockquote>
<p>[Original] You can narrow request matching through request parameter conditions such as <code>&quot;myParam&quot;</code>, <code>&quot;!myParam&quot;</code>, or <code>&quot;myParam=myValue&quot;</code>. The first two test for request parameter presence/absence and the third for a specific parameter value. Here is an example with a request parameter value condition:</p>
</blockquote>
<p>ä½ å¯ä»¥ç­›é€‰è¯·æ±‚å‚æ•°çš„æ¡ä»¶æ¥ç¼©å°è¯·æ±‚åŒ¹é…èŒƒå›´ï¼Œæ¯”å¦‚<code>&quot;myParam&quot;</code>ã€<code>&quot;!myParam&quot;</code>åŠ<code>&quot;myParam=myValue&quot;</code>ç­‰ã€‚å‰ä¸¤ä¸ªæ¡ä»¶ç”¨äºç­›é€‰å­˜åœ¨/ä¸å­˜åœ¨æŸäº›è¯·æ±‚å‚æ•°çš„è¯·æ±‚ï¼Œç¬¬ä¸‰ä¸ªæ¡ä»¶ç­›é€‰å…·æœ‰ç‰¹å®šå‚æ•°å€¼çš„è¯·æ±‚ã€‚ä¸‹é¢æœ‰ä¸ªä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¯·æ±‚å‚æ•°å€¼çš„ç­›é€‰æ¡ä»¶ï¼š</p>
<pre><code class="lang-java">@Controller
@RequestMapping(&quot;/owners/{ownerId}&quot;)
public class RelativePathUriTemplateController {

    @RequestMapping(path = &quot;/pets/{petId}&quot;, method = RequestMethod.GET, params=&quot;myParam=myValue&quot;)
    public void findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) {
        // å®é™…å®ç°çœç•¥
    }

}
</code></pre>
<blockquote>
<p>[Original] The same can be done to test for request header presence/absence or to match based on a specific request header value:</p>
</blockquote>
<p>åŒæ ·ï¼Œä½ å¯ä»¥ç”¨ç›¸åŒçš„æ¡ä»¶æ¥ç­›é€‰è¯·æ±‚å¤´çš„å‡ºç°ä¸å¦ï¼Œæˆ–è€…ç­›é€‰å‡ºä¸€ä¸ªå…·æœ‰ç‰¹å®šå€¼çš„è¯·æ±‚å¤´ï¼š</p>
<pre><code class="lang-java">@Controller
@RequestMapping(&quot;/owners/{ownerId}&quot;)
public class RelativePathUriTemplateController {

    @RequestMapping(path = &quot;/pets&quot;, method = RequestMethod.GET, headers=&quot;myHeader=myValue&quot;)
    public void findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) {
        // æ–¹æ³•ä½“å®ç°çœç•¥
    }

}
</code></pre>
<blockquote>
<p>[Original] Although you can match to <em>Content-Type</em> and <em>Accept</em> header values using media type wild cards (for example <em>&quot;content-type=text/*&quot;</em> will match to <em>&quot;text/plain&quot;</em> and <em>&quot;text/html&quot;</em>), it is recommended to use the <em>consumes</em> and <em>produces</em> conditions respectively instead. They are intended specifically for that purpose.</p>
<p>å°½ç®¡ï¼Œä½ å¯ä»¥ä½¿ç”¨åª’ä½“ç±»å‹çš„é€šé…ç¬¦ï¼ˆæ¯”å¦‚ <em>&quot;content-type=text/*&quot;</em>ï¼‰æ¥åŒ¹é…è¯·æ±‚å¤´ <em>Content-Type</em>å’Œ <em>Accept</em>çš„å€¼ï¼Œä½†æˆ‘ä»¬æ›´æ¨èç‹¬ç«‹ä½¿ç”¨ <em>consumes</em>å’Œ <em>produces</em>æ¡ä»¶æ¥ç­›é€‰å„è‡ªçš„è¯·æ±‚ã€‚å› ä¸ºå®ƒä»¬å°±æ˜¯ä¸“é—¨ä¸ºåŒºåˆ†è¿™ä¸¤ç§ä¸åŒçš„åœºæ™¯è€Œç”Ÿçš„ã€‚</p>
</blockquote>
</section<section><h1 id="21-3-3-requestmapping-handler-method-">21.3.3 å®šä¹‰@RequestMappingæ³¨è§£çš„å¤„ç†æ–¹æ³•(handler method)</h1>
<p>ä½¿ç”¨<code>@RequestMapping</code>æ³¨è§£çš„å¤„ç†æ–¹æ³•å¯ä»¥æ‹¥æœ‰éå¸¸çµæ´»çš„æ–¹æ³•ç­¾åï¼Œå®ƒæ”¯æŒçš„æ–¹æ³•å‚æ•°åŠè¿”å›å€¼ç±»å‹å°†åœ¨æ¥ä¸‹æ¥çš„å°èŠ‚è®²è¿°ã€‚å¤§å¤šæ•°å‚æ•°éƒ½å¯ä»¥ä»»æ„çš„æ¬¡åºå‡ºç°ï¼Œé™¤äº†å”¯ä¸€çš„ä¸€ä¸ªä¾‹å¤–ï¼š<code>BindingResult</code>å‚æ•°ã€‚è¿™åœ¨ä¸‹èŠ‚ä¹Ÿä¼šè¯¦ç»†æè¿°ã€‚</p>
<blockquote>
<p>Spring 3.1ä¸­æ–°å¢äº†ä¸€äº›ç±»ï¼Œç”¨ä»¥å¢å¼ºæ³¨è§£äº†<code>@RequestMapping</code>çš„å¤„ç†æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯<code>RequestMappingHandlerMapping</code>ç±»å’Œ<code>RequestMappingHandlerAdapter</code>ç±»ã€‚æˆ‘ä»¬é¼“åŠ±ä½¿ç”¨è¿™ç»„æ–°çš„ç±»ï¼Œå¦‚æœè¦ä½¿ç”¨Spring 3.1åŠä»¥åç‰ˆæœ¬çš„æ–°ç‰¹æ€§ï¼Œè¿™ç»„ç±»ç”šè‡³æ˜¯å¿…é¡»ä½¿ç”¨çš„ã€‚è¿™äº›å¢å¼ºç±»åœ¨MVCçš„å‘½åç©ºé—´é…ç½®å’ŒMVCçš„Javaç¼–ç¨‹æ–¹å¼é…ç½®ä¸­éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¦‚æœä¸æ˜¯ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•ï¼Œé‚£ä¹ˆå°±éœ€è¦æ˜¾å¼åœ°é…ç½®ã€‚</p>
</blockquote>
<h2 id="-">æ”¯æŒçš„æ–¹æ³•å‚æ•°ç±»å‹</h2>
<p>ä¸‹é¢åˆ—å‡ºæ‰€æœ‰æ”¯æŒçš„æ–¹æ³•å‚æ•°ç±»å‹ï¼š</p>
<ul>
<li>è¯·æ±‚æˆ–å“åº”å¯¹è±¡ï¼ˆServlet APIï¼‰ã€‚å¯ä»¥æ˜¯ä»»ä½•å…·ä½“çš„è¯·æ±‚æˆ–å“åº”ç±»å‹çš„å¯¹è±¡ï¼Œæ¯”å¦‚ï¼Œ<code>ServletRequest</code>æˆ–<code>HttpServletRequest</code>å¯¹è±¡ç­‰ã€‚</li>
<li><code>HttpSession</code>ç±»å‹çš„ä¼šè¯å¯¹è±¡ï¼ˆServlet APIï¼‰ã€‚ä½¿ç”¨è¯¥ç±»å‹çš„å‚æ•°å°†è¦æ±‚è¿™æ ·ä¸€ä¸ªsessionçš„å­˜åœ¨ï¼Œå› æ­¤è¿™æ ·çš„å‚æ•°æ°¸ä¸ä¸º<code>null</code>ã€‚</li>
</ul>
<blockquote>
<p>å­˜å–sessionå¯èƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸€ä¸ªServletçš„è¿è¡Œç¯å¢ƒä¸­ã€‚å¦‚æœåº”ç”¨å¯èƒ½æœ‰å¤šä¸ªè¯·æ±‚åŒæ—¶å¹¶å‘å­˜å–ä¸€ä¸ªsessionåœºæ™¯ï¼Œè¯·è€ƒè™‘å°†RequestMappingHandlerAdapterç±»ä¸­çš„&quot;synchronizeOnSession&quot;æ ‡å¿—è®¾ç½®ä¸º&quot;true&quot;ã€‚</p>
</blockquote>
<ul>
<li><code>org.springframework.web.context.request.WebRequest</code>æˆ–<code>org.springframework.web.context.request.NativeWebRequest</code>ã€‚å…è®¸å­˜å–ä¸€èˆ¬çš„è¯·æ±‚å‚æ•°å’Œè¯·æ±‚/ä¼šè¯èŒƒå›´çš„å±æ€§ï¼ˆattributeï¼‰ï¼ŒåŒæ—¶æ— éœ€ç»‘å®šä½¿ç”¨Servlet/Portletçš„API</li>
<li>å½“å‰è¯·æ±‚çš„åœ°åŒºä¿¡æ¯<code>java.util.Locale</code>ï¼Œç”±å·²é…ç½®çš„æœ€ç›¸å…³çš„åœ°åŒºè§£æå™¨è§£æå¾—åˆ°ã€‚åœ¨MVCçš„ç¯å¢ƒä¸‹ï¼Œå°±æ˜¯åº”ç”¨ä¸­é…ç½®çš„<code>LocaleResolver</code>æˆ–<code>LocaleContextResolver</code></li>
<li>ä¸å½“å‰è¯·æ±‚ç»‘å®šçš„æ—¶åŒºä¿¡æ¯<code>java.util.TimeZone</code>ï¼ˆjava 6ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼‰/<code>java.time.ZoneId</code>ï¼ˆjava 8ï¼‰ï¼Œç”±<code>LocaleContextResolver</code>è§£æå¾—åˆ°</li>
<li>ç”¨äºå­˜å–è¯·æ±‚æ­£æ–‡çš„<code>java.io.InputStream</code>æˆ–<code>java.io.Reader</code>ã€‚è¯¥å¯¹è±¡ä¸é€šè¿‡Servlet APIæ‹¿åˆ°çš„è¾“å…¥æµ/Readeræ˜¯ä¸€æ ·çš„</li>
<li>ç”¨äºç”Ÿæˆå“åº”æ­£æ–‡çš„<code>java.io.OutputStream</code>æˆ–<code>java.io.Writer</code>ã€‚è¯¥å¯¹è±¡ä¸é€šè¿‡Servlet APIæ‹¿åˆ°çš„è¾“å‡ºæµ/Writeræ˜¯ä¸€æ ·çš„</li>
<li><code>org.springframework.http.HttpMethod</code>ã€‚å¯ä»¥æ‹¿åˆ°HTTPè¯·æ±‚æ–¹æ³•</li>
<li>åŒ…è£…äº†å½“å‰è¢«è®¤è¯ç”¨æˆ·ä¿¡æ¯çš„<code>java.security.Principal</code></li>
<li>å¸¦<code>@PathVariable</code>æ³¨è§£çš„æ–¹æ³•å‚æ•°ï¼Œå…¶å­˜æ”¾äº†URIæ¨¡æ¿å˜é‡ä¸­çš„å€¼ã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-requestmapping-uri-templates" title="URI Template Patterns">â€œURIæ¨¡æ¿å˜é‡â€ä¸€èŠ‚</a></li>
<li>å¸¦<code>@MatrixVariable</code>æ³¨è§£çš„æ–¹æ³•å‚æ•°ï¼Œå…¶å­˜æ”¾äº†URIè·¯å¾„æ®µä¸­çš„é”®å€¼å¯¹ã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-matrix-variables" title="Matrix Variables">â€œçŸ©é˜µå˜é‡â€ä¸€èŠ‚</a></li>
<li>å¸¦<code>@RequestParam</code>æ³¨è§£çš„æ–¹æ³•å‚æ•°ï¼Œå…¶å­˜æ”¾äº†Servletè¯·æ±‚ä¸­æ‰€æŒ‡å®šçš„å‚æ•°ã€‚å‚æ•°çš„å€¼ä¼šè¢«è½¬æ¢æˆæ–¹æ³•å‚æ•°æ‰€å£°æ˜çš„ç±»å‹ã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-requestparam" title="Binding request parameters to method parameters with @RequestParam">â€œä½¿ç”¨@RequestParamæ³¨è§£ç»‘å®šè¯·æ±‚å‚æ•°è‡³æ–¹æ³•å‚æ•°â€ä¸€èŠ‚</a></li>
<li>å¸¦<code>@RequestHeader</code>æ³¨è§£çš„æ–¹æ³•å‚æ•°ï¼Œå…¶å­˜æ”¾äº†Servletè¯·æ±‚ä¸­æ‰€æŒ‡å®šçš„HTTPè¯·æ±‚å¤´çš„å€¼ã€‚å‚æ•°çš„å€¼ä¼šè¢«è½¬æ¢æˆæ–¹æ³•å‚æ•°æ‰€å£°æ˜çš„ç±»å‹ã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-requestheader" title="Mapping request header attributes with the @RequestHeader annotation">â€œä½¿ç”¨@RequestHeaderæ³¨è§£æ˜ å°„è¯·æ±‚å¤´å±æ€§â€ä¸€èŠ‚</a>.</li>
<li>å¸¦<code>@RequestBody</code>æ³¨è§£çš„å‚æ•°ï¼Œæä¾›äº†å¯¹HTTPè¯·æ±‚ä½“çš„å­˜å–ã€‚å‚æ•°çš„å€¼é€šè¿‡<code>HttpMessageConverter</code>è¢«è½¬æ¢æˆæ–¹æ³•å‚æ•°æ‰€å£°æ˜çš„ç±»å‹ã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-requestbody" title="Mapping the request body with the @RequestBody annotation">â€œä½¿ç”¨@RequestBodyæ³¨è§£æ˜ å°„è¯·æ±‚ä½“â€ä¸€èŠ‚&quot;</a></li>
<li>å¸¦<code>@RequestPart</code>æ³¨è§£çš„å‚æ•°ï¼Œæä¾›äº†å¯¹ä¸€ä¸ª&quot;multipart/form-dataè¯·æ±‚å—ï¼ˆrequest partï¼‰å†…å®¹çš„å­˜å–ã€‚æ›´å¤šçš„ä¿¡æ¯è¯·å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-multipart-forms-non-browsers" title="21.10.5 Handling a file upload request from programmatic clients">21.10.5 â€œå¤„ç†å®¢æˆ·ç«¯æ–‡ä»¶ä¸Šä¼ çš„è¯·æ±‚â€ä¸€èŠ‚</a>å’Œ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-multipart" title="21.10 Spring&#39;s multipart \(file upload\) support">21.10 â€œSpringå¯¹å¤šéƒ¨åˆ†æ–‡ä»¶ä¸Šä¼ çš„æ”¯æŒâ€ä¸€èŠ‚</a></li>
<li><code>HttpEntity&lt;?&gt;</code>ç±»å‹çš„å‚æ•°ï¼Œå…¶æä¾›äº†å¯¹HTTPè¯·æ±‚å¤´å’Œè¯·æ±‚å†…å®¹çš„å­˜å–ã€‚è¯·æ±‚æµæ˜¯é€šè¿‡<code>HttpMessageConverter</code>è¢«è½¬æ¢æˆentityå¯¹è±¡çš„ã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-httpentity" title="Using HttpEntity">â€œHttpEntityâ€ä¸€èŠ‚</a></li>
<li><code>java.util.Map</code>/<code>org.springframework.io.Model</code>/<code>org.springframework.ui.ModelMap</code>ç±»å‹çš„å‚æ•°ï¼Œç”¨ä»¥å¢å¼ºé»˜è®¤æš´éœ²ç»™è§†å›¾å±‚çš„æ¨¡å‹(model)çš„åŠŸèƒ½</li>
<li><code>org.springframework.web.servlet.mvc.support.RedirectAttributes</code>ç±»å‹çš„å‚æ•°ï¼Œç”¨ä»¥æŒ‡å®šé‡å®šå‘ä¸‹è¦ä½¿ç”¨åˆ°çš„å±æ€§é›†ä»¥åŠæ·»åŠ flashå±æ€§ï¼ˆæš‚å­˜åœ¨æœåŠ¡ç«¯çš„å±æ€§ï¼Œå®ƒä»¬ä¼šåœ¨ä¸‹æ¬¡é‡å®šå‘è¯·æ±‚çš„èŒƒå›´ä¸­æœ‰æ•ˆï¼‰ã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-flash-attributes" title="21.6 Using flash attributes">â€œå‘é‡å®šå‘è¯·æ±‚ä¼ é€’å‚æ•°â€ä¸€èŠ‚</a></li>
<li>å‘½ä»¤æˆ–è¡¨å•å¯¹è±¡ï¼Œå®ƒä»¬ç”¨äºå°†è¯·æ±‚å‚æ•°ç›´æ¥ç»‘å®šåˆ°beanå­—æ®µï¼ˆå¯èƒ½æ˜¯é€šè¿‡setteræ–¹æ³•ï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡<code>@InitBinder</code>æ³¨è§£å’Œ/æˆ–<code>HanderAdapter</code>çš„é…ç½®æ¥å®šåˆ¶è¿™ä¸ªè¿‡ç¨‹çš„ç±»å‹è½¬æ¢ã€‚å…·ä½“è¯·å‚è€ƒ<code>RequestMappingHandlerAdapter</code>ç±»<code>webBindingInitializer</code>å±æ€§çš„æ–‡æ¡£ã€‚è¿™æ ·çš„å‘½ä»¤å¯¹è±¡ï¼Œä»¥åŠå…¶ä¸Šçš„éªŒè¯ç»“æœï¼Œé»˜è®¤ä¼šè¢«æ·»åŠ åˆ°æ¨¡å‹modelä¸­ï¼Œé”®åé»˜è®¤æ˜¯è¯¥å‘½ä»¤å¯¹è±¡ç±»çš„ç±»åâ€”â€”æ¯”å¦‚ï¼Œ<code>some.package.OrderAddress</code>ç±»å‹çš„å‘½ä»¤å¯¹è±¡å°±ä½¿ç”¨å±æ€§å<code>orderAddress</code>ç±»è·å–ã€‚<code>ModelAttribute</code>æ³¨è§£å¯ä»¥åº”ç”¨åœ¨æ–¹æ³•å‚æ•°ä¸Šï¼Œç”¨ä»¥æŒ‡å®šè¯¥æ¨¡å‹æ‰€ç”¨çš„å±æ€§å</li>
<li><code>org.springframework.validation.Errors</code> / <code>org.springframework.validation.BindingResult</code>éªŒè¯ç»“æœå¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å‰é¢çš„å‘½ä»¤æˆ–è¡¨å•å¯¹è±¡çš„éªŒè¯ç»“æœï¼ˆç´§æ¥å…¶å‰çš„ç¬¬ä¸€ä¸ªæ–¹æ³•å‚æ•°ï¼‰ã€‚</li>
<li><code>org.springframework.web.bind.support.SessionStatus</code>å¯¹è±¡ï¼Œç”¨ä»¥æ ‡è®°å½“å‰çš„è¡¨å•å¤„ç†å·²ç»“æŸã€‚è¿™å°†è§¦å‘ä¸€äº›æ¸…ç†æ“ä½œï¼š<code>@SessionAttributes</code>åœ¨ç±»çº§åˆ«æ³¨è§£çš„å±æ€§å°†è¢«ç§»é™¤</li>
<li><code>org.springframework.web.util.UriComponentsBuilder</code>æ„é€ å™¨å¯¹è±¡ï¼Œç”¨äºæ„é€ å½“å‰è¯·æ±‚URLç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸»æœºåã€ç«¯å£å·ã€èµ„æºç±»å‹ï¼ˆschemeï¼‰ã€ä¸Šä¸‹æ–‡è·¯å¾„ã€servletæ˜ å°„ä¸­çš„ç›¸å¯¹éƒ¨åˆ†ï¼ˆliteral partï¼‰ç­‰</li>
</ul>
<p>åœ¨å‚æ•°åˆ—è¡¨ä¸­ï¼Œ<code>Errors</code>æˆ–<code>BindingResult</code>å‚æ•°å¿…é¡»ç´§è·Ÿåœ¨å…¶æ‰€ç»‘å®šçš„éªŒè¯å¯¹è±¡åé¢ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨å‚æ•°åˆ—è¡¨ä¸­å…è®¸æœ‰å¤šäºä¸€ä¸ªçš„æ¨¡å‹å¯¹è±¡ï¼ŒSpringä¼šä¸ºå®ƒä»¬åˆ›å»ºä¸åŒçš„<code>BindingResult</code>å®ä¾‹ã€‚å› æ­¤ï¼Œä¸‹é¢è¿™æ ·çš„ä»£ç æ˜¯ä¸èƒ½å·¥ä½œçš„ï¼š</p>
<p><strong>BindingResultä¸@ModelAttributeé”™è¯¯çš„å‚æ•°æ¬¡åº</strong></p>
<pre><code class="lang-java">@RequestMapping(method = RequestMethod.POST)
public String processSubmit(@ModelAttribute(&quot;pet&quot;) Pet pet, Model model, BindingResult result) { ... }
</code></pre>
<p>ä¸Šä¾‹ä¸­ï¼Œå› ä¸ºåœ¨æ¨¡å‹å¯¹è±¡<code>Pet</code>å’ŒéªŒè¯ç»“æœå¯¹è±¡<code>BindingResult</code>ä¸­é—´è¿˜æ’äº†ä¸€ä¸ª<code>Model</code>å‚æ•°ï¼Œè¿™æ˜¯ä¸è¡Œçš„ã€‚è¦è¾¾åˆ°é¢„æœŸçš„æ•ˆæœï¼Œå¿…é¡»è°ƒæ•´ä¸€ä¸‹å‚æ•°çš„æ¬¡åºï¼š</p>
<pre><code class="lang-java">@RequestMapping(method = RequestMethod.POST)
public String processSubmit(@ModelAttribute(&quot;pet&quot;) Pet pet, BindingResult result, Model model) { ... }
</code></pre>
<blockquote>
<p>å¯¹äºä¸€äº›å¸¦æœ‰<code>required</code>å±æ€§çš„æ³¨è§£ï¼ˆæ¯”å¦‚<code>@RequestParam</code>ã€<code>@RequestHeader</code>ç­‰ï¼‰ï¼ŒJDK 1.8çš„<code>java.util.Optional</code>å¯ä»¥ä½œä¸ºè¢«å®ƒä»¬æ³¨è§£çš„æ–¹æ³•å‚æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>java.util.Optional</code>ä¸<code>required=false</code>çš„ä½œç”¨æ˜¯ç›¸åŒçš„ã€‚</p>
</blockquote>
<h2 id="-">æ”¯æŒçš„æ–¹æ³•è¿”å›ç±»å‹</h2>
<p>ä»¥ä¸‹æ˜¯handleræ–¹æ³•å…è®¸çš„æ‰€æœ‰è¿”å›ç±»å‹ï¼š</p>
<ul>
<li><code>ModelAndView</code>å¯¹è±¡ï¼Œå…¶ä¸­modeléšå«å¡«å……äº†å‘½ä»¤å¯¹è±¡ï¼Œä»¥åŠæ³¨è§£äº†<code>@ModelAttribute</code>å­—æ®µçš„å­˜å–å™¨è¢«è°ƒç”¨æ‰€è¿”å›çš„å€¼ã€‚</li>
<li><code>Model</code>å¯¹è±¡ï¼Œå…¶ä¸­è§†å›¾åç§°é»˜è®¤ç”±<code>RequestToViewNameTranslator</code>å†³å®šï¼Œmodeléšå«å¡«å……äº†å‘½ä»¤å¯¹è±¡ä»¥åŠæ³¨è§£äº†<code>@ModelAttribute</code>å­—æ®µçš„å­˜å–å™¨è¢«è°ƒç”¨æ‰€è¿”å›çš„å€¼</li>
<li><code>Map</code>å¯¹è±¡ï¼Œç”¨äºæš´éœ²modelï¼Œå…¶ä¸­è§†å›¾åç§°é»˜è®¤ç”±<code>RequestToViewNameTranslator</code>å†³å®šï¼Œmodeléšå«å¡«å……äº†å‘½ä»¤å¯¹è±¡ä»¥åŠæ³¨è§£äº†<code>@ModelAttribute</code>å­—æ®µçš„å­˜å–å™¨è¢«è°ƒç”¨æ‰€è¿”å›çš„å€¼</li>
<li><code>View</code>å¯¹è±¡ã€‚å…¶ä¸­modeléšå«å¡«å……äº†å‘½ä»¤å¯¹è±¡ï¼Œä»¥åŠæ³¨è§£äº†<code>@ModelAttribute</code>å­—æ®µçš„å­˜å–å™¨è¢«è°ƒç”¨æ‰€è¿”å›çš„å€¼ã€‚handleræ–¹æ³•ä¹Ÿå¯ä»¥å¢åŠ ä¸€ä¸ª<code>Model</code>ç±»å‹çš„æ–¹æ³•å‚æ•°æ¥å¢å¼ºmodel</li>
<li><code>String</code>å¯¹è±¡ï¼Œå…¶å€¼ä¼šè¢«è§£ææˆä¸€ä¸ªé€»è¾‘è§†å›¾åã€‚å…¶ä¸­ï¼Œmodelå°†é»˜è®¤å¡«å……äº†å‘½ä»¤å¯¹è±¡ä»¥åŠæ³¨è§£äº†<code>@ModelAttribute</code>å­—æ®µçš„å­˜å–å™¨è¢«è°ƒç”¨æ‰€è¿”å›çš„å€¼ã€‚handleræ–¹æ³•ä¹Ÿå¯ä»¥å¢åŠ ä¸€ä¸ª<code>Model</code>ç±»å‹çš„æ–¹æ³•å‚æ•°æ¥å¢å¼ºmodel</li>
<li><code>void</code>ã€‚å¦‚æœå¤„ç†å™¨æ–¹æ³•ä¸­å·²ç»å¯¹responseå“åº”æ•°æ®è¿›è¡Œäº†å¤„ç†ï¼ˆæ¯”å¦‚åœ¨æ–¹æ³•å‚æ•°ä¸­å®šä¹‰ä¸€ä¸ª<code>ServletResponse</code>æˆ–<code>HttpServletResponse</code>ç±»å‹çš„å‚æ•°å¹¶ç›´æ¥å‘å…¶å“åº”ä½“ä¸­å†™ä¸œè¥¿ï¼‰ï¼Œé‚£ä¹ˆæ–¹æ³•å¯ä»¥è¿”å›voidã€‚handleræ–¹æ³•ä¹Ÿå¯ä»¥å¢åŠ ä¸€ä¸ª<code>Model</code>ç±»å‹çš„æ–¹æ³•å‚æ•°æ¥å¢å¼ºmodel</li>
<li>å¦‚æœå¤„ç†å™¨æ–¹æ³•æ³¨è§£äº†<code>ResponseBody</code>ï¼Œé‚£ä¹ˆè¿”å›ç±»å‹å°†è¢«å†™åˆ°HTTPçš„å“åº”ä½“ä¸­ï¼Œè€Œè¿”å›å€¼ä¼šè¢«<code>HttpMessageConverters</code>è½¬æ¢æˆæ‰€æ–¹æ³•å£°æ˜çš„å‚æ•°ç±»å‹ã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-responsebody &quot;Mapping the response body with the @ResponseBody annotation">ä½¿ç”¨&quot;@ResponseBodyæ³¨è§£æ˜ å°„å“åº”ä½“&quot;ä¸€èŠ‚</a></li>
<li><code>HttpEntity&lt;?&gt;</code>æˆ–<code>ResponseEntity&lt;?&gt;</code>å¯¹è±¡ï¼Œç”¨äºæä¾›å¯¹Servlet HTTPå“åº”å¤´å’Œå“åº”å†…å®¹çš„å­˜å–ã€‚å¯¹è±¡ä½“ä¼šè¢«<code>HttpMessageConverters</code>è½¬æ¢æˆå“åº”æµã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvn-ann-httpentity" title="Using Entity">ä½¿ç”¨HttpEntityä¸€èŠ‚</a></li>
<li><code>HttpHeaders</code>å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªä¸å«å“åº”ä½“çš„response</li>
<li><code>Callable&lt;?&gt;</code>å¯¹è±¡ã€‚å½“åº”ç”¨å¸Œæœ›å¼‚æ­¥åœ°è¿”å›æ–¹æ³•å€¼æ—¶ä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ç”±Spring MVCè‡ªèº«çš„çº¿ç¨‹æ¥ç®¡ç†</li>
<li><code>DeferredResult&lt;?&gt;</code>å¯¹è±¡ã€‚å½“åº”ç”¨å¸Œæœ›æ–¹æ³•çš„è¿”å›å€¼äº¤ç”±çº¿ç¨‹è‡ªèº«å†³å®šæ—¶ä½¿ç”¨</li>
<li><code>ListenableFuture&lt;?&gt;</code>å¯¹è±¡ã€‚å½“åº”ç”¨å¸Œæœ›æ–¹æ³•çš„è¿”å›å€¼äº¤ç”±çº¿ç¨‹è‡ªèº«å†³å®šæ—¶ä½¿ç”¨</li>
<li><code>ResponseBodyEmitter</code>å¯¹è±¡ï¼Œå¯ç”¨å®ƒå¼‚æ­¥åœ°å‘å“åº”ä½“ä¸­åŒæ—¶å†™å¤šä¸ªå¯¹è±¡ï¼Œalso supported as the body within a <code>ResponseEntity</code></li>
<li><code>SseEmitter</code>å¯¹è±¡ï¼Œå¯ç”¨å®ƒå¼‚æ­¥åœ°å‘å“åº”ä½“ä¸­å†™æœåŠ¡å™¨ç«¯äº‹ä»¶ï¼ˆServer-Sent Eventsï¼‰,also supported as the body within a <code>ResponseEntity</code></li>
<li><code>StreamingResponseBody</code>å¯¹è±¡ï¼Œå¯ç”¨å®ƒå¼‚æ­¥åœ°å‘å“åº”å¯¹è±¡çš„è¾“å‡ºæµä¸­å†™ä¸œè¥¿ã€‚also supported as the body within a <code>ResponseEntity</code></li>
<li>å…¶ä»–ä»»ä½•è¿”å›ç±»å‹ï¼Œéƒ½ä¼šè¢«å¤„ç†æˆmodelçš„ä¸€ä¸ªå±æ€§å¹¶è¿”å›ç»™è§†å›¾ï¼Œè¯¥å±æ€§çš„åç§°ä¸ºæ–¹æ³•çº§çš„<code>@ModelAttribute</code>æ‰€æ³¨è§£çš„å­—æ®µåï¼ˆæˆ–è€…ä»¥è¿”å›ç±»å‹çš„ç±»åä½œä¸ºé»˜è®¤çš„å±æ€§åï¼‰ã€‚modeléšå«å¡«å……äº†å‘½ä»¤å¯¹è±¡ä»¥åŠæ³¨è§£äº†<code>@ModelAttribute</code>å­—æ®µçš„å­˜å–å™¨è¢«è°ƒç”¨æ‰€è¿”å›çš„å€¼</li>
</ul>
<h2 id="-requestparam-">ä½¿ç”¨@RequestParamå°†è¯·æ±‚å‚æ•°ç»‘å®šè‡³æ–¹æ³•å‚æ•°</h2>
<p>ä½ å¯ä»¥ä½¿ç”¨<code>@RequestParam</code>æ³¨è§£å°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°ä½ æ§åˆ¶å™¨çš„æ–¹æ³•å‚æ•°ä¸Šã€‚</p>
<p>ä¸‹é¢è¿™æ®µä»£ç å±•ç¤ºäº†å®ƒçš„ç”¨æ³•ï¼š</p>
<pre><code class="lang-java">@Controller
@RequestMapping(&quot;/pets&quot;)
@SessionAttributes(&quot;pet&quot;)
public class EditPetForm {
    // ...
    @RequestMapping(method = RequestMapping.GET)
    public String setupForm(@RequestParam(&quot;petId&quot;) int petId, ModelMap model) {
        Pet pet = this.clinic.loadPet(petId);
        model.addAttribute(&quot;pet&quot;, pet);
        return &quot;petForm&quot;;
    }

    // ,..
}
</code></pre>
<p>è‹¥å‚æ•°ä½¿ç”¨äº†è¯¥æ³¨è§£ï¼Œåˆ™è¯¥å‚æ•°é»˜è®¤æ˜¯å¿…é¡»æä¾›çš„ï¼Œä½†ä½ ä¹Ÿå¯ä»¥æŠŠè¯¥å‚æ•°æ ‡æ³¨ä¸ºéå¿…é¡»çš„ï¼šåªéœ€è¦å°†<code>@RequestParam</code>æ³¨è§£çš„<code>required</code>å±æ€§è®¾ç½®ä¸º<code>false</code>å³å¯ï¼ˆæ¯”å¦‚ï¼Œ<code>@RequestParam(path=&quot;id&quot;, required=false)</code>ï¼‰ã€‚</p>
<p>è‹¥æ‰€æ³¨è§£çš„æ–¹æ³•å‚æ•°ç±»å‹ä¸æ˜¯<code>String</code>ï¼Œåˆ™ç±»å‹è½¬æ¢ä¼šè‡ªåŠ¨åœ°å‘ç”Ÿã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-typeconversion" title="Method Parameters And Type
Conversion">&quot;æ–¹æ³•å‚æ•°ä¸ç±»å‹è½¬æ¢&quot;ä¸€èŠ‚</a></p>
<p>è‹¥<code>@RequestParam</code>æ³¨è§£çš„å‚æ•°ç±»å‹æ˜¯<code>Map&lt;String, String&gt;</code>æˆ–è€…<code>MultiValueMap&lt;String, String&gt;</code>ï¼Œåˆ™è¯¥Mapä¸­ä¼šè‡ªåŠ¨å¡«å……æ‰€æœ‰çš„è¯·æ±‚å‚æ•°ã€‚</p>
<h2 id="-requestbody-">ä½¿ç”¨@RequestBodyæ³¨è§£æ˜ å°„è¯·æ±‚ä½“</h2>
<p>æ–¹æ³•å‚æ•°ä¸­çš„<code>@RequestBody</code>æ³¨è§£æš—ç¤ºäº†æ–¹æ³•å‚æ•°åº”è¯¥è¢«ç»‘å®šäº†HTTPè¯·æ±‚ä½“çš„å€¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="lang-java">@RequestMapping(path = &quot;/something&quot;, method = RequestMethod.PUT)
public void handle(@RequestBody String body, Writer writer) throws IOException {
    writer.write(body);
}
</code></pre>
<p>è¯·æ±‚ä½“åˆ°æ–¹æ³•å‚æ•°çš„è½¬æ¢æ˜¯ç”±<code>HttpMessageConverter</code>å®Œæˆçš„ã€‚<code>HttpMessageConverter</code>è´Ÿè´£å°†HTTPè¯·æ±‚ä¿¡æ¯è½¬æ¢æˆå¯¹è±¡ï¼Œä»¥åŠå°†å¯¹è±¡è½¬æ¢å›ä¸€ä¸ªHTTPå“åº”ä½“ã€‚å¯¹äº<code>@RequestBody</code>æ³¨è§£ï¼Œ<code>RequestMappingHandlerAdapter</code>æä¾›äº†ä»¥ä¸‹å‡ ç§é»˜è®¤çš„<code>HttpMessageConverter</code>æ”¯æŒï¼š</p>
<ul>
<li><code>ByteArrayHttpMessageConverter</code>ç”¨ä»¥è½¬æ¢å­—èŠ‚æ•°ç»„</li>
<li><code>StringHttpMessageConverter</code>ç”¨ä»¥è½¬æ¢å­—ç¬¦ä¸²</li>
<li><code>FormHttpMessageConverter</code>ç”¨ä»¥å°†è¡¨æ ¼æ•°æ®è½¬æ¢æˆ<code>MultiValueMap&lt;String, String&gt;</code>æˆ–ä»<code>MultiValueMap&lt;String, String&gt;</code>ä¸­è½¬æ¢å‡ºè¡¨æ ¼æ•°æ®</li>
<li><code>SourceHttpMessageConverter</code>ç”¨äº<code>javax.xml.transform.Source</code>ç±»çš„äº’ç›¸è½¬æ¢</li>
</ul>
<p>å…³äºè¿™äº›è½¬æ¢å™¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/remoting.html#rest-message-conversion" title="27.10.2 HTTP Message Conversion">&quot;HTTPä¿¡æ¯è½¬æ¢å™¨&quot;ä¸€èŠ‚</a>ã€‚å¦å¤–ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯MVCå‘½åç©ºé—´æˆ–Javaç¼–ç¨‹çš„é…ç½®æ–¹å¼ï¼Œä¼šæœ‰æ›´å¤šé»˜è®¤æ³¨å†Œçš„æ¶ˆæ¯è½¬æ¢å™¨ã€‚æ›´å¤šä¿¡æ¯ï¼Œè«‹åƒè€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-config-enable" title="21.16.1 Enabling the MVC Java Config or the MVC XML Namespace">&quot;å¯ç”¨MVC Javaç¼–ç¨‹é…ç½®æˆ–MVC XMLå‘½ä»¤ç©ºé—´é…ç½®&quot;ä¸€èŠ‚</a>ã€‚</p>
<p>è‹¥ä½ æ›´å€¾å‘äºé˜…è¯»å’Œç¼–å†™XMLæ–‡ä»¶ï¼Œé‚£ä¹ˆä½ éœ€è¦é…ç½®ä¸€ä¸ª<code>MarshallingHttpMessageConverter</code>å¹¶ä¸ºå…¶æä¾›<code>org.springframework.oxm</code>åŒ…ä¸‹çš„ä¸€ä¸ª<code>Marshaller</code>å’Œ<code>Unmarshaller</code>å®ç°ã€‚ä¸‹é¢çš„ç¤ºä¾‹å°±ä¸ºä½ å±•ç¤ºå¦‚ä½•ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å®ƒã€‚ä½†å¦‚æœä½ çš„åº”ç”¨æ˜¯ä½¿ç”¨MVCå‘½ä»¤ç©ºé—´æˆ–MVC Javaç¼–ç¨‹çš„æ–¹å¼è¿›è¡Œé…ç½®çš„ï¼Œåˆ™è¯·å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-config-enable" title="21.16.1 Enabling the MVC Java Config or the MVC XML Namespace">&quot;å¯ç”¨MVC Javaç¼–ç¨‹é…ç½®æˆ–MVC XMLå‘½ä»¤ç©ºé—´é…ç½®&quot;è¿™ä¸€èŠ‚</a>ã€‚</p>
<pre><code class="lang-xml">&lt;bean class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;&gt;
    &lt;property name=&quot;messageConverters&quot;&gt;
        &lt;util:list id=&quot;beanList&quot;&gt;
            &lt;ref bean=&quot;stringHttpMessageConverter&quot;/&gt;
            &lt;ref bean=&quot;marshallingHttpMessageConverter&quot;/&gt;
        &lt;/util:list&gt;
    &lt;/property
&lt;/bean&gt;

&lt;bean id=&quot;stringHttpMessageConverter&quot; class=&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;/&gt;

&lt;bean id=&quot;marshallingHttpMessageConverter&quot;
        class=&quot;org.springframework.http.converter.xml.MarshallingHttpMessageConverter&quot;&gt;
    &lt;property name=&quot;marshaller&quot; ref=&quot;castorMarshaller&quot;/&gt;
    &lt;property name=&quot;unmarshaller&quot; ref=&quot;castorMarshaller&quot;/&gt;
&lt;/bean&gt;

&lt;bean id=&quot;castorMarshaller&quot; class=&quot;org.springframework.oxm.castor.CastorMarshaller&quot;/&gt;
</code></pre>
<p>æ³¨è§£äº†<code>@RequestBody</code>çš„æ–¹æ³•å‚æ•°è¿˜å¯ä»¥è¢«<code>@Valid</code>æ³¨è§£ï¼Œè¿™æ ·æ¡†æ¶ä¼šä½¿ç”¨å·²é…ç½®çš„<code>Validator</code>å®ä¾‹æ¥å¯¹è¯¥å‚æ•°è¿›è¡ŒéªŒè¯ã€‚è‹¥ä½ çš„åº”ç”¨æ˜¯ä½¿ç”¨MVCå‘½ä»¤ç©ºé—´æˆ–MVC Javaç¼–ç¨‹çš„æ–¹å¼é…ç½®çš„ï¼Œæ¡†æ¶ä¼šå‡è®¾åœ¨classpathè·¯å¾„ä¸‹å­˜åœ¨ä¸€ä¸ªç¬¦åˆJSR-303è§„èŒƒçš„éªŒè¯å™¨ï¼Œå¹¶è‡ªåŠ¨å°†å…¶ä½œä¸ºé»˜è®¤é…ç½®ã€‚</p>
<p>ä¸<code>@ModelAttribute</code>æ³¨è§£çš„å‚æ•°ä¸€æ ·ï¼Œ<code>Errors</code>ä¹Ÿå¯ä»¥è¢«ä¼ å…¥ä¸ºæ–¹æ³•å‚æ•°ï¼Œç”¨äºæ£€æŸ¥é”™è¯¯ã€‚å¦‚æœæ²¡æœ‰å£°æ˜è¿™æ ·ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆç¨‹åºä¼šæŠ›å‡ºä¸€ä¸ª<code>MethodArgumentNotValidException</code>å¼‚å¸¸ã€‚è¯¥å¼‚å¸¸é»˜è®¤ç”±<code>DefaultHandlerExceptionResolver</code>å¤„ç†ï¼Œå¤„ç†ç¨‹åºä¼šè¿”å›ä¸€ä¸ª<code>400</code>é”™è¯¯ç»™å®¢æˆ·ç«¯ã€‚</p>
<blockquote>
<p>å…³äºå¦‚ä½•é€šè¿‡MVCå‘½ä»¤ç©ºé—´æˆ–MVC Javaç¼–ç¨‹çš„æ–¹å¼é…ç½®æ¶ˆæ¯è½¬æ¢å™¨å’ŒéªŒè¯å™¨ï¼Œä¹Ÿè¯·å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-config-enable" title="21.16.1 Enabling the MVC Java Config or the MVC XML Namespace">&quot;å¯ç”¨MVC Javaç¼–ç¨‹é…ç½®æˆ–MVC XMLå‘½ä»¤ç©ºé—´é…ç½®&quot;ä¸€èŠ‚</a>ã€‚</p>
</blockquote>
<h2 id="-responsebody-">ä½¿ç”¨@ResponseBodyæ³¨è§£æ˜ å°„å“åº”ä½“</h2>
<p><code>@ResponseBody</code>æ³¨è§£ä¸<code>@RequestBody</code>æ³¨è§£ç±»ä¼¼ã€‚<code>@ResponseBody</code>æ³¨è§£å¯è¢«åº”ç”¨äºæ–¹æ³•ä¸Šï¼Œæ ‡å¿—è¯¥æ–¹æ³•çš„è¿”å›å€¼ï¼ˆæ›´æ­£ï¼ŒåŸæ–‡æ˜¯return typeï¼Œçœ‹èµ·æ¥åº”è¯¥æ˜¯è¿”å›å€¼ï¼‰åº”è¯¥è¢«ç›´æ¥å†™å›åˆ°HTTPå“åº”ä½“ä¸­å»ï¼ˆè€Œä¸ä¼šè¢«è¢«æ”¾ç½®åˆ°Modelä¸­æˆ–è¢«è§£é‡Šä¸ºä¸€ä¸ªè§†å›¾åï¼‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="lang-java">@RequestMapping(path = &quot;/something&quot;, method = RequestMethod.PUT)
@ResponseBody
public String helloWorld() {
    return &quot;Hello World&quot;
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ç»“æœæ˜¯æ–‡æœ¬<code>Hello World</code>å°†è¢«å†™å…¥HTTPçš„å“åº”æµä¸­ã€‚</p>
<p>ä¸<code>@RequestBody</code>æ³¨è§£ç±»ä¼¼ï¼ŒSpringä½¿ç”¨äº†ä¸€ä¸ª<code>HttpMessageConverter</code>æ¥å°†è¿”å›å¯¹è±¡è½¬æ¢åˆ°å“åº”ä½“ä¸­ã€‚å…³äºè¿™äº›è½¬æ¢å™¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/remoting.html#rest-message-conversion" title="27.10.2 HTTP Message Conversion">&quot;HTTPä¿¡æ¯è½¬æ¢å™¨&quot;ä¸€èŠ‚</a>ã€‚</p>
<h2 id="-restcontroller-rest-">ä½¿ç”¨@RestControlleræ³¨è§£åˆ›å»ºRESTæ§åˆ¶å™¨</h2>
<p>å½“ä»Šè®©æ§åˆ¶å™¨å®ç°ä¸€ä¸ªREST APIæ˜¯éå¸¸å¸¸è§çš„ï¼Œè¿™ç§åœºæ™¯ä¸‹æ§åˆ¶å™¨åªéœ€è¦æä¾›JSONã€XMLæˆ–å…¶ä»–è‡ªå®šä¹‰çš„åª’ä½“ç±»å‹å†…å®¹å³å¯ã€‚ä½ ä¸éœ€è¦åœ¨æ¯ä¸ª<code>@RequestMapping</code>æ–¹æ³•ä¸Šéƒ½å¢åŠ ä¸€ä¸ª<code>@ResponseBody</code>æ³¨è§£ï¼Œæ›´ç®€æ˜çš„åšæ³•æ˜¯ï¼Œç»™ä½ çš„æ§åˆ¶å™¨åŠ ä¸Šä¸€ä¸ª<code>@RestController</code>çš„æ³¨è§£ã€‚</p>
<p><a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE
/javadoc-api/org/springframework/web/bind/annotation/RestController.html"><code>@RestController</code></a>æ˜¯ä¸€ä¸ªåŸç”Ÿå†…ç½®çš„æ³¨è§£ï¼Œå®ƒç»“åˆäº†<code>@ResponseBody</code>ä¸<code>@Controller</code>æ³¨è§£çš„åŠŸèƒ½ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå®ƒä¹Ÿè®©ä½ çš„æ§åˆ¶å™¨æ›´è¡¨ä¹‰ï¼Œè€Œä¸”åœ¨æ¡†æ¶æœªæ¥çš„å‘å¸ƒç‰ˆæœ¬ä¸­ï¼Œå®ƒä¹Ÿå¯èƒ½æ‰¿è½½æ›´å¤šçš„æ„ä¹‰ã€‚</p>
<p>ä¸æ™®é€šçš„<code>@Controller</code>æ— å¼‚ï¼Œ<code>@RestController</code>ä¹Ÿå¯ä»¥ä¸<code>@ControllerAdvice</code>beané…åˆä½¿ç”¨ã€‚æ›´å¤šç»†èŠ‚ï¼Œè¯·è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-controller-advice" title="Advising controllers with @ControllerAdvice">ä½¿ç”¨@ControllerAdviceè¾…åŠ©æ§åˆ¶å™¨</a>ã€‚</p>
<h2 id="-http-httpentity">ä½¿ç”¨HTTPå®ä½“HttpEntity</h2>
<p><code>HttpEntity</code>ä¸<code>@RequestBody</code>å’Œ<code>@ResponseBody</code>å¾ˆç›¸ä¼¼ã€‚é™¤äº†èƒ½è·å¾—è¯·æ±‚ä½“å’Œå“åº”ä½“ä¸­çš„å†…å®¹ä¹‹å¤–ï¼Œ<code>HttpEntity</code>ï¼ˆä»¥åŠä¸“é—¨è´Ÿè´£å¤„ç†å“åº”çš„<code>ResponseEntity</code>å­ç±»ï¼‰è¿˜å¯ä»¥å­˜å–è¯·æ±‚å¤´å’Œå“åº”å¤´ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="lang-java">@RequestMapping(&quot;/something&quot;)
public ResponseEntity&lt;String&gt; handle(HttpEntity&lt;byte[]&gt; requestEntity) throws UnsupportedEncodingException {
    String requestHeader = requestEntity.getHeaders().getFirst(&quot;MyRequestHeader&quot;);
    byte[] requestBody = requestEntity.getBody();

    // do something with request header and body

    HttpHeaders responseHeaders = new HttpHeaders();
    responseHeaders.set(&quot;MyResponseHeader&quot;, &quot;MyValue&quot;);
    return new ResponseEntity&lt;String&gt;(&quot;Hello World&quot;, responseHeaders, HttpStatus.CREATED);
}
</code></pre>
<p>ä¸Šé¢è¿™æ®µç¤ºä¾‹ä»£ç å…ˆæ˜¯è·å–äº†<code>MyRequestHeader</code>è¯·æ±‚å¤´çš„å€¼ï¼Œç„¶åè¯»å–è¯·æ±‚ä½“çš„ä¸»ä½“å†…å®¹ã€‚è¯»å®Œä»¥åå¾€å½±å“å¤´ä¸­æ·»åŠ äº†ä¸€ä¸ªè‡ªå·±çš„å“åº”å¤´<code>MyResponseHeader</code>ï¼Œç„¶åå‘å“åº”æµä¸­å†™äº†å­—ç¬¦ä¸²<code>Hello World</code>ï¼Œæœ€åæŠŠå“åº”çŠ¶æ€ç è®¾ç½®ä¸º201ï¼ˆåˆ›å»ºæˆåŠŸï¼‰ã€‚</p>
<p>ä¸<code>@RequestBody</code>ä¸<code>@ResponseBody</code>æ³¨è§£ä¸€æ ·ï¼ŒSpringä½¿ç”¨äº†<code>HttpMessageConverter</code>æ¥å¯¹è¯·æ±‚æµå’Œå“åº”æµè¿›è¡Œè½¬æ¢ã€‚å…³äºè¿™äº›è½¬æ¢å™¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»ä¸Šä¸€å°èŠ‚ä»¥åŠ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/remoting.html#rest-message-conversion" title="27.10.2 HTTP Message Conversion">&quot;HTTPä¿¡æ¯è½¬æ¢å™¨&quot;è¿™ä¸€èŠ‚</a>ã€‚</p>
<h2 id="-modelattribute-">å¯¹æ–¹æ³•ä½¿ç”¨@ModelAttributeæ³¨è§£</h2>
<p><code>@ModelAttribute</code>æ³¨è§£å¯è¢«åº”ç”¨åœ¨æ–¹æ³•æˆ–æ–¹æ³•å‚æ•°ä¸Šã€‚æœ¬èŠ‚å°†ä»‹ç»å…¶è¢«æ³¨è§£äºæ–¹æ³•ä¸Šæ—¶çš„ç”¨æ³•ï¼Œä¸‹èŠ‚ä¼šä»‹ç»å…¶è¢«ç”¨äºæ³¨è§£æ–¹æ³•å‚æ•°çš„ç”¨æ³•ã€‚</p>
<p>æ³¨è§£åœ¨æ–¹æ³•ä¸Šçš„<code>@ModelAttribute</code>è¯´æ˜äº†æ–¹æ³•çš„ä½œç”¨æ˜¯ç”¨äºæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§åˆ°modelä¸Šã€‚è¿™æ ·çš„æ–¹æ³•èƒ½æ¥å—ä¸<code>@RequestMapping</code>æ³¨è§£ç›¸åŒçš„å‚æ•°ç±»å‹ï¼Œåªä¸è¿‡ä¸èƒ½ç›´æ¥è¢«æ˜ å°„åˆ°å…·ä½“çš„è¯·æ±‚ä¸Šã€‚åœ¨åŒä¸€ä¸ªæ§åˆ¶å™¨ä¸­ï¼Œæ³¨è§£äº†<code>@ModelAttribute</code>çš„æ–¹æ³•å®é™…ä¸Šä¼šåœ¨<code>@RequestMapping</code>æ–¹æ³•ä¹‹å‰è¢«è°ƒç”¨ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªä¾‹å­ï¼š</p>
<pre><code class="lang-java">// Add one attribute
// The return value of the method is added to the model under the name &quot;account&quot;
// You can customize the name via @ModelAttribute(&quot;myAccount&quot;)

@ModelAttribute
public Account addAccount(@RequestParam String number) {
    return accountManager.findAccount(number);
}

// Add multiple attributes

@ModelAttribute
public void populateModel(@RequestParam String number, Model model) {
    model.addAttribute(accountManager.findAccount(number));
    // add more ...
}
</code></pre>
<p><code>@ModelAttribute</code>æ–¹æ³•é€šå¸¸è¢«ç”¨æ¥å¡«å……ä¸€äº›å…¬å…±éœ€è¦çš„å±æ€§æˆ–æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªä¸‹æ‹‰åˆ—è¡¨æ‰€é¢„è®¾çš„å‡ ç§çŠ¶æ€ï¼Œæˆ–è€…å® ç‰©çš„å‡ ç§ç±»å‹ï¼Œæˆ–è€…å»å–å¾—ä¸€ä¸ªHTMLè¡¨å•æ¸²æŸ“æ‰€éœ€è¦çš„å‘½ä»¤å¯¹è±¡ï¼Œæ¯”å¦‚<code>Account</code>ç­‰ã€‚</p>
<p>ç•™æ„<code>@ModelAttribute</code>æ–¹æ³•çš„ä¸¤ç§é£æ ¼ã€‚åœ¨ç¬¬ä¸€ç§å†™æ³•ä¸­ï¼Œæ–¹æ³•é€šè¿‡è¿”å›å€¼çš„æ–¹å¼é»˜è®¤åœ°å°†æ·»åŠ ä¸€ä¸ªå±æ€§ï¼›åœ¨ç¬¬äºŒç§å†™æ³•ä¸­ï¼Œæ–¹æ³•æ¥æ”¶ä¸€ä¸ª<code>Model</code>å¯¹è±¡ï¼Œç„¶åå¯ä»¥å‘å…¶ä¸­æ·»åŠ ä»»æ„æ•°é‡çš„å±æ€§ã€‚ä½ å¯ä»¥åœ¨æ ¹æ®éœ€è¦ï¼Œåœ¨ä¸¤ç§é£æ ¼ä¸­é€‰æ‹©åˆé€‚çš„ä¸€ç§ã€‚</p>
<p>ä¸€ä¸ªæ§åˆ¶å™¨å¯ä»¥æ‹¥æœ‰æ•°é‡ä¸é™çš„<code>@ModelAttribute</code>æ–¹æ³•ã€‚åŒä¸ªæ§åˆ¶å™¨å†…çš„æ‰€æœ‰è¿™äº›æ–¹æ³•ï¼Œéƒ½ä¼šåœ¨<code>@RequestMapping</code>æ–¹æ³•ä¹‹å‰è¢«è°ƒç”¨ã€‚</p>
<p><code>@ModelAttribute</code>æ–¹æ³•ä¹Ÿå¯ä»¥å®šä¹‰åœ¨<code>@ControllerAdvice</code>æ³¨è§£çš„ç±»ä¸­ï¼Œå¹¶ä¸”è¿™äº›<code>@ModelAttribute</code>å¯ä»¥åŒæ—¶å¯¹è®¸å¤šæ§åˆ¶å™¨ç”Ÿæ•ˆã€‚å…·ä½“çš„ä¿¡æ¯å¯ä»¥å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-controller-advice" title="Advising controllers with @ControllerAdvice">ä½¿ç”¨@ControllerAdviceè¾…åŠ©æ§åˆ¶å™¨</a>ã€‚</p>
<blockquote>
<p>å±æ€§åæ²¡æœ‰è¢«æ˜¾å¼æŒ‡å®šçš„æ—¶å€™åˆå½“å¦‚ä½•å‘¢ï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¡†æ¶å°†æ ¹æ®å±æ€§çš„ç±»å‹ç»™äºˆä¸€ä¸ªé»˜è®¤åç§°ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè‹¥æ–¹æ³•è¿”å›ä¸€ä¸ª<code>Account</code>ç±»å‹çš„å¯¹è±¡ï¼Œåˆ™é»˜è®¤çš„å±æ€§åä¸º&quot;account&quot;ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½®<code>@ModelAttribute</code>æ³¨è§£çš„å€¼æ¥æ”¹å˜é»˜è®¤å€¼ã€‚å½“å‘<code>Model</code>ä¸­ç›´æ¥æ·»åŠ å±æ€§æ—¶ï¼Œè¯·ä½¿ç”¨åˆé€‚çš„é‡è½½æ–¹æ³•<code>addAttribute(..)</code>-å³ï¼Œå¸¦æˆ–ä¸å¸¦å±æ€§åçš„æ–¹æ³•ã€‚</p>
</blockquote>
<p><code>@ModelAttribute</code>æ³¨è§£ä¹Ÿå¯ä»¥è¢«ç”¨åœ¨<code>@RequestMapping</code>æ–¹æ³•ä¸Šã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>@RequestMapping</code>æ–¹æ³•çš„è¿”å›å€¼å°†ä¼šè¢«è§£é‡Šä¸ºmodelçš„ä¸€ä¸ªå±æ€§ï¼Œè€Œéä¸€ä¸ªè§†å›¾åã€‚æ­¤æ—¶è§†å›¾åå°†ä»¥è§†å›¾å‘½åçº¦å®šæ¥æ–¹å¼æ¥å†³è®®ï¼Œä¸è¿”å›å€¼ä¸ºvoidçš„æ–¹æ³•æ‰€é‡‡ç”¨çš„å¤„ç†æ–¹æ³•ç±»ä¼¼â€”â€”è¯·è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-coc-r2vnt" title="21.13.3 The View - RequestToViewNameTranslator">è§†å›¾ï¼šè¯·æ±‚ä¸è§†å›¾åçš„å¯¹åº”</a>ã€‚</p>
<h2 id="-modelattribute-">åœ¨æ–¹æ³•å‚æ•°ä¸Šä½¿ç”¨@ModelAttributeæ³¨è§£</h2>
<p>å¦‚ä¸Šä¸€å°èŠ‚æ‰€è§£é‡Šï¼Œ<code>@ModelAttribute</code>æ³¨è§£æ—¢å¯ä»¥è¢«ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œä¹Ÿå¯ä»¥è¢«ç”¨åœ¨æ–¹æ³•å‚æ•°ä¸Šã€‚è¿™ä¸€å°èŠ‚å°†ä»‹ç»å®ƒæ³¨è§£åœ¨æ–¹æ³•å‚æ•°ä¸Šæ—¶çš„ç”¨æ³•ã€‚</p>
<p>æ³¨è§£åœ¨æ–¹æ³•å‚æ•°ä¸Šçš„<code>@ModelAttribute</code>è¯´æ˜äº†è¯¥æ–¹æ³•å‚æ•°çš„å€¼å°†ç”±modelä¸­å–å¾—ã€‚å¦‚æœmodelä¸­æ‰¾ä¸åˆ°ï¼Œé‚£ä¹ˆè¯¥å‚æ•°ä¼šå…ˆè¢«å®ä¾‹åŒ–ï¼Œç„¶åè¢«æ·»åŠ åˆ°modelä¸­ã€‚åœ¨modelä¸­å­˜åœ¨ä»¥åï¼Œè¯·æ±‚ä¸­æ‰€æœ‰åç§°åŒ¹é…çš„å‚æ•°éƒ½ä¼šå¡«å……åˆ°è¯¥å‚æ•°ä¸­ã€‚è¿™åœ¨Spring MVCä¸­è¢«ç§°ä¸ºæ•°æ®ç»‘å®šï¼Œä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç‰¹æ€§ï¼ŒèŠ‚çº¦äº†ä½ æ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨ä»è¡¨æ ¼æ•°æ®ä¸­è½¬æ¢è¿™äº›å­—æ®µæ•°æ®çš„æ—¶é—´ã€‚</p>
<pre><code class="lang-java">@RequestMapping(path = &quot;/owners/{ownerId}/pets/{petId}/edit&quot;, method = RequestMethod.POST)
public String processSubmit(@ModelAttribute Pet pet) { }
</code></pre>
<p>ä»¥ä¸Šé¢çš„ä»£ç ä¸ºä¾‹ï¼Œè¿™ä¸ªPetç±»å‹çš„å®ä¾‹å¯èƒ½æ¥è‡ªå“ªé‡Œå‘¢ï¼Ÿæœ‰å‡ ç§å¯èƒ½:</p>
<ul>
<li>å®ƒå¯èƒ½å› ä¸º<code>@SessionAttributes</code>æ³¨è§£çš„ä½¿ç”¨å·²ç»å­˜åœ¨äºmodelä¸­â€”â€”è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-sessionattrib" title="Using @SessionAttributes to store model attributes in the HTTP Session between requests">&quot;åœ¨è¯·æ±‚ä¹‹é—´ä½¿ç”¨@SessionAttributesæ³¨è§£ï¼Œä½¿ç”¨HTTPä¼šè¯ä¿å­˜æ¨¡å‹æ•°æ®&quot;ä¸€èŠ‚</a></li>
<li>å®ƒå¯èƒ½å› ä¸ºåœ¨åŒä¸ªæ§åˆ¶å™¨ä¸­ä½¿ç”¨äº†<code>@ModelAttribute</code>æ–¹æ³•å·²ç»å­˜åœ¨äºmodelä¸­â€”â€”æ­£å¦‚ä¸Šä¸€å°èŠ‚æ‰€å™è¿°çš„</li>
<li>å®ƒå¯èƒ½æ˜¯ç”±URIæ¨¡æ¿å˜é‡å’Œç±»å‹è½¬æ¢ä¸­å–å¾—çš„ï¼ˆä¸‹é¢ä¼šè¯¦ç»†è®²è§£ï¼‰</li>
<li>å®ƒå¯èƒ½æ˜¯è°ƒç”¨äº†è‡ªèº«çš„é»˜è®¤æ„é€ å™¨è¢«å®ä¾‹åŒ–å‡ºæ¥çš„</li>
</ul>
<p><code>@ModelAttribute</code>æ–¹æ³•å¸¸ç”¨äºä»æ•°æ®åº“ä¸­å–ä¸€ä¸ªå±æ€§å€¼ï¼Œè¯¥å€¼å¯èƒ½é€šè¿‡<code>@SessionAttributes</code>æ³¨è§£åœ¨è¯·æ±‚ä¸­é—´ä¼ é€’ã€‚åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨URIæ¨¡æ¿å˜é‡å’Œç±»å‹è½¬æ¢çš„æ–¹å¼æ¥å–å¾—ä¸€ä¸ªå±æ€§æ˜¯æ›´æ–¹ä¾¿çš„æ–¹å¼ã€‚è¿™é‡Œæœ‰ä¸ªä¾‹å­ï¼š</p>
<pre><code class="lang-java">@RequestMapping(path = &quot;/accounts/{account}&quot;, method = RequestMethod.PUT)
public String save(@ModelAttribute(&quot;account&quot;) Account account) {

}
</code></pre>
<p>ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œmodelå±æ€§çš„åç§°ï¼ˆ&quot;account&quot;ï¼‰ä¸URIæ¨¡æ¿å˜é‡çš„åç§°ç›¸åŒ¹é…ã€‚å¦‚æœä½ é…ç½®äº†ä¸€ä¸ªå¯ä»¥å°†<code>String</code>ç±»å‹çš„è´¦æˆ·å€¼è½¬æ¢æˆ<code>Account</code>ç±»å‹å®ä¾‹çš„è½¬æ¢å™¨<code>Converter&lt;String, Account&gt;</code>ï¼Œé‚£ä¹ˆä¸Šé¢è¿™æ®µä»£ç å°±å¯ä»¥å·¥ä½œçš„å¾ˆå¥½ï¼Œè€Œä¸éœ€è¦å†é¢å¤–å†™ä¸€ä¸ª<code>@ModelAttribute</code>æ–¹æ³•ã€‚</p>
<p>ä¸‹ä¸€æ­¥å°±æ˜¯æ•°æ®çš„ç»‘å®šã€‚<code>WebDataBinder</code>ç±»èƒ½å°†è¯·æ±‚å‚æ•°â€”â€”åŒ…æ‹¬å­—ç¬¦ä¸²çš„æŸ¥è¯¢å‚æ•°å’Œè¡¨å•å­—æ®µç­‰â€”â€”é€šè¿‡åç§°åŒ¹é…åˆ°modelçš„å±æ€§ä¸Šã€‚æˆåŠŸåŒ¹é…çš„å­—æ®µåœ¨éœ€è¦çš„æ—¶å€™ä¼šè¿›è¡Œä¸€æ¬¡ç±»å‹è½¬æ¢ï¼ˆä»Stringç±»å‹åˆ°ç›®æ ‡å­—æ®µçš„ç±»å‹ï¼‰ï¼Œç„¶åè¢«å¡«å……åˆ°modelå¯¹åº”çš„å±æ€§ä¸­ã€‚æ•°æ®ç»‘å®šå’Œæ•°æ®éªŒè¯çš„é—®é¢˜åœ¨<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/validation.html" title="8. Validation, Data Binding, and Type Conversion">ç¬¬8ç«  <em>éªŒè¯ï¼Œæ•°æ®ç»‘å®šå’Œç±»å‹è½¬æ¢</em></a>ä¸­æåˆ°ã€‚å¦‚ä½•åœ¨æ§åˆ¶å™¨å±‚æ¥å®šåˆ¶æ•°æ®ç»‘å®šçš„è¿‡ç¨‹ï¼Œåœ¨<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-webdatabinder" title="Customizing WebDataBinder initialization">è¿™ä¸€èŠ‚ &quot;å®šåˆ¶WebDataBinderçš„åˆå§‹åŒ–&quot;</a>ä¸­æåŠã€‚</p>
<p>è¿›è¡Œäº†æ•°æ®ç»‘å®šåï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼Œæ¯”å¦‚æ²¡æœ‰æä¾›å¿…é¡»çš„å­—æ®µã€ç±»å‹è½¬æ¢è¿‡ç¨‹çš„é”™è¯¯ç­‰ã€‚è‹¥æƒ³æ£€æŸ¥è¿™äº›é”™è¯¯ï¼Œå¯ä»¥åœ¨æ³¨è§£äº†<code>@ModelAttribute</code>çš„å‚æ•°ç´§è·Ÿç€å£°æ˜ä¸€ä¸ª<code>BindingResult</code>å‚æ•°ï¼š</p>
<pre><code class="lang-java">@RequestMapping(path = &quot;/owners/{ownerId}/pets/{petId}/edit&quot;, method = RequestMethod.POST)
public String processSubmit(@ModelAttribute(&quot;pet&quot;) Pet pet, BindingResult result) {
    if (result.hasErrors()) {
        return &quot;petForm&quot;;
    }

    // ...

}
</code></pre>
<p>æ‹¿åˆ°<code>BindingResult</code>å‚æ•°åï¼Œä½ å¯ä»¥æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ã€‚æœ‰æ—¶ä½ å¯ä»¥é€šè¿‡Springçš„<code>&lt;errors&gt;</code>è¡¨å•æ ‡ç­¾æ¥åœ¨åŒä¸€ä¸ªè¡¨å•ä¸Šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚</p>
<p><code>BindingResult</code>è¢«ç”¨äºè®°å½•æ•°æ®ç»‘å®šè¿‡ç¨‹çš„é”™è¯¯ï¼Œå› æ­¤é™¤äº†æ•°æ®ç»‘å®šå¤–ï¼Œä½ è¿˜å¯ä»¥æŠŠè¯¥å¯¹è±¡ä¼ ç»™è‡ªå·±å®šåˆ¶çš„éªŒè¯å™¨æ¥è°ƒç”¨éªŒè¯ã€‚è¿™ä½¿å¾—æ•°æ®ç»‘å®šè¿‡ç¨‹å’ŒéªŒè¯è¿‡ç¨‹å‡ºç°çš„é”™è¯¯å¯ä»¥è¢«æœé›†åˆ°ä¸€å¤„ï¼Œç„¶åä¸€å¹¶è¿”å›ç»™ç”¨æˆ·ï¼š</p>
<pre><code class="lang-java">@RequestMapping(path = &quot;/owners/{ownerId}/pets/{petId}/edit&quot;, method = RequestMethod.POST)
public String processSubmit(@ModelAttribute(&quot;pet&quot;) Pet pet, BindingResult result) {

    new PetValidator().validate(pet, result);
    if (result.hasErrors()) {
        return &quot;petForm&quot;;
    }

    // ...

}
</code></pre>
<p>åˆæˆ–è€…ï¼Œä½ å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªJSR-303è§„èŒƒçš„<code>@Valid</code>æ³¨è§£ï¼Œè¿™æ ·éªŒè¯å™¨ä¼šè‡ªåŠ¨è¢«è°ƒç”¨ã€‚</p>
<pre><code class="lang-java">@RequestMapping(path = &quot;/owners/{ownerId}/pets/{petId}/edit&quot;, method = RequestMethod.POST)
public String processSubmit(@Valid @ModelAttribute(&quot;pet&quot;) Pet pet, BindingResult result) {

    if (result.hasErrors()) {
        return &quot;petForm&quot;;
    }

    // ...

}
</code></pre>
<p>å…³äºå¦‚ä½•é…ç½®å¹¶ä½¿ç”¨éªŒè¯ï¼Œå¯ä»¥å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/validation.html#validation-beanvalidation" title="8.8 Spring Validation">ç¬¬8.8å°èŠ‚ &quot;SpringéªŒè¯&quot;</a>å’Œ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/validation.html" title="8. Validation, Data Binding, and Type Conversion">ç¬¬8ç«  <em>éªŒè¯ï¼Œæ•°æ®ç»‘å®šå’Œç±»å‹è½¬æ¢</em></a>ã€‚</p>
<h2 id="-sessionattributes-http-">åœ¨è¯·æ±‚ä¹‹é—´ä½¿ç”¨@SessionAttributesæ³¨è§£ï¼Œä½¿ç”¨HTTPä¼šè¯ä¿å­˜æ¨¡å‹æ•°æ®</h2>
<p>ç±»å‹çº§åˆ«çš„<code>@SessionAttributes</code>æ³¨è§£å£°æ˜äº†æŸä¸ªç‰¹å®šå¤„ç†å™¨æ‰€ä½¿ç”¨çš„ä¼šè¯å±æ€§ã€‚é€šå¸¸å®ƒä¼šåˆ—å‡ºè¯¥ç±»å‹å¸Œæœ›å­˜å‚¨åˆ°sessionæˆ–converstaionä¸­çš„modelå±æ€§åæˆ–modelçš„ç±»å‹åï¼Œä¸€èˆ¬æ˜¯ç”¨äºåœ¨è¯·æ±‚ä¹‹é—´ä¿å­˜ä¸€äº›è¡¨å•æ•°æ®çš„beanã€‚</p>
<p>ä»¥ä¸‹çš„ä»£ç æ®µæ¼”ç¤ºäº†è¯¥æ³¨è§£çš„ç”¨æ³•ï¼Œå®ƒæŒ‡å®šäº†æ¨¡å‹å±æ€§çš„åç§°</p>
<pre><code class="lang-java">@Controller
@RequestMapping(&quot;/editPet.do&quot;)
@SessionAttributes(&quot;pet&quot;)
public class EditPetForm {
    // ...
}
</code></pre>
<h2 id="-application-x-www-form-urlencoded-">ä½¿ç”¨&quot;application/x-www-form-urlencoded&quot;æ•°æ®</h2>
<p>ä¸Šä¸€å°èŠ‚è®²è¿°äº†å¦‚ä½•ä½¿ç”¨<code>@ModelAttribute</code>æ”¯æŒå®¢æˆ·ç«¯æµè§ˆå™¨çš„å¤šæ¬¡è¡¨å•æäº¤è¯·æ±‚ã€‚å¯¹äºä¸æ˜¯ä½¿ç”¨çš„æµè§ˆå™¨çš„å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ä¹Ÿæ¨èä½¿ç”¨è¿™ä¸ªæ³¨è§£æ¥å¤„ç†è¯·æ±‚ã€‚ä½†å½“è¯·æ±‚æ˜¯ä¸€ä¸ªHTTP PUTæ–¹æ³•çš„è¯·æ±‚æ—¶ï¼Œæœ‰ä¸€ä¸ªäº‹æƒ…éœ€è¦æ³¨æ„ã€‚æµè§ˆå™¨å¯ä»¥é€šè¿‡HTTPçš„GETæ–¹æ³•æˆ–POSTæ–¹æ³•æ¥æäº¤è¡¨å•æ•°æ®ï¼Œéæµè§ˆå™¨çš„å®¢æˆ·ç«¯è¿˜å¯ä»¥é€šè¿‡HTTPçš„PUTæ–¹æ³•æ¥æäº¤è¡¨å•ã€‚è¿™å°±è®¾è®¡æ˜¯ä¸ªæŒ‘æˆ˜ï¼Œå› ä¸ºåœ¨Servletè§„èŒƒä¸­æ˜ç¡®è§„å®šï¼Œ<code>ServletRequest.getParameter*()</code>ç³»åˆ—çš„æ–¹æ³•åªèƒ½æ”¯æŒé€šè¿‡HTTP POSTæ–¹æ³•çš„æ–¹å¼æäº¤è¡¨å•ï¼Œè€Œä¸æ”¯æŒHTTP PUTçš„æ–¹å¼ã€‚</p>
<p>ä¸ºäº†æ”¯æŒHTTPçš„PUTç±»å‹å’ŒPATCHç±»å‹çš„è¯·æ±‚ï¼ŒSpringçš„<code>spring-web</code>æ¨¡å—æä¾›äº†ä¸€ä¸ªè¿‡æ»¤å™¨<code>HttpPutFormContentFilter</code>ã€‚ä½ å¯ä»¥åœ¨<code>web.xml</code>æ–‡ä»¶ä¸­é…ç½®å®ƒï¼š</p>
<pre><code class="lang-xml">    &lt;filter&gt;
        &lt;filter-name&gt;httpPutFormFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;org.springframework.web.filter.HttpPutFormContentFilter&lt;/filter-class&gt;
    &lt;/filter&gt;

    &lt;filter-mapping&gt;
        &lt;filter-name&gt;httpPutFormFilter&lt;/filter-name&gt;
        &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;/filter-mapping&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
</code></pre>
<p>ä¸Šé¢çš„è¿‡æ»¤å™¨å°†ä¼šæ‹¦æˆªå†…å®¹ç±»å‹(content type)ä¸º<code>application/x-www-form-urlencoded</code>ã€HTTPæ–¹æ³•ä¸ºPUTæˆ–PATCHç±»å‹çš„è¯·æ±‚ï¼Œç„¶åä»è¯·æ±‚ä½“ä¸­è¯»å–è¡¨å•æ•°æ®ï¼ŒæŠŠå®ƒä»¬åŒ…è£…åœ¨<code>ServletRequest</code>ä¸­ã€‚è¿™æ˜¯ä¸ºäº†ä½¿è¡¨å•æ•°æ®èƒ½å¤Ÿé€šè¿‡<code>ServletRequest.getParameter*()</code>ç³»åˆ—çš„æ–¹æ³•æ¥æ‹¿åˆ°ã€‚</p>
<blockquote>
<p>å› ä¸º<code>HttpPutFormContentFilter</code>ä¼šæ¶ˆè´¹è¯·æ±‚ä½“çš„å†…å®¹ï¼Œå› æ­¤ï¼Œå®ƒä¸åº”è¯¥ç”¨äºå¤„ç†é‚£äº›ä¾èµ–äºå…¶ä»–<code>application/x-www-form-urlencoded</code>è½¬æ¢å™¨çš„PUTå’ŒPATCHè¯·æ±‚ï¼Œè¿™åŒ…æ‹¬äº†<code>@RequestBodyMultiValueMap&lt;String, String&gt;</code>å’Œ<code>HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt;</code>ã€‚</p>
</blockquote>
<h2 id="-cookievalue-cookie-">ä½¿ç”¨@CookieValueæ³¨è§£æ˜ å°„cookieå€¼</h2>
<p><code>@CookieValue</code>æ³¨è§£èƒ½å°†ä¸€ä¸ªæ–¹æ³•å‚æ•°ä¸ä¸€ä¸ªHTTP cookieçš„å€¼è¿›è¡Œç»‘å®šã€‚</p>
<p>çœ‹ä¸€ä¸ªè¿™æ ·çš„åœºæ™¯ï¼šä»¥ä¸‹çš„è¿™ä¸ªcookieå­˜å‚¨åœ¨ä¸€ä¸ªHTTPè¯·æ±‚ä¸­ï¼š</p>
<pre><code>JSESSIONID=415A4AC178C59DACE0B2C9CA727CDD84
</code></pre><p>ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†æ‹¿åˆ°<code>JSESSIONID</code>è¿™ä¸ªcookieå€¼çš„æ–¹æ³•ï¼š</p>
<pre><code class="lang-java">@RequestMapping(&quot;/displayHeaderInfo.do&quot;)
public void displayHeaderInfo(@CookieValue(&quot;JSESSIONID&quot;) String cookie) {
    //...
}
</code></pre>
<p>è‹¥æ³¨è§£çš„ç›®æ ‡æ–¹æ³•å‚æ•°ä¸æ˜¯<code>String</code>ç±»å‹ï¼Œåˆ™ç±»å‹è½¬æ¢ä¼šè‡ªåŠ¨è¿›è¡Œã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-typeconversion" title="Method Parameters And Type Conversion">&quot;æ–¹æ³•å‚æ•°ä¸ç±»å‹è½¬æ¢&quot;</a>ä¸€èŠ‚ã€‚</p>
<p>è¿™ä¸ªæ³¨è§£å¯ä»¥æ³¨è§£åˆ°å¤„ç†å™¨æ–¹æ³•ä¸Šï¼Œåœ¨Servletç¯å¢ƒå’ŒPortletç¯å¢ƒéƒ½èƒ½ä½¿ç”¨ã€‚</p>
<h2 id="-requestheader-">ä½¿ç”¨<code>@RequestHeader</code>æ³¨è§£æ˜ å°„è¯·æ±‚å¤´å±æ€§</h2>
<p><code>@RequestHeader</code>æ³¨è§£èƒ½å°†ä¸€ä¸ªæ–¹æ³•å‚æ•°ä¸ä¸€ä¸ªè¯·æ±‚å¤´å±æ€§è¿›è¡Œç»‘å®šã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¯·æ±‚å¤´çš„ä¾‹å­ï¼š</p>
<pre><code>    Host                    localhost:8080
    Accept                  text/html,application/xhtml+xml,application/xml;q=0.9
    Accept-Language         fr,en-gb;q=0.7,en;q=0.3
    Accept-Encoding         gzip,deflate
    Accept-Charset          ISO-8859-1,utf-8;q=0.7,*;q=0.7
    Keep-Alive              300
</code></pre><p>ä»¥ä¸‹çš„ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•å–å¾—<code>Accept-Encoding</code>è¯·æ±‚å¤´å’Œ<code>Keep-Alive</code>è¯·æ±‚å¤´çš„å€¼ï¼š</p>
<pre><code class="lang-java">@RequestMapping(&quot;/displayHeaderInfo.do&quot;)
public void displayHeaderInfo(@RequestHeader(&quot;Accept-Encoding&quot;) String encoding,
        @RequestHeader(&quot;Keep-Alive&quot;) long keepAlive) {
    //...
}
</code></pre>
<p>è‹¥æ³¨è§£çš„ç›®æ ‡æ–¹æ³•å‚æ•°ä¸æ˜¯<code>String</code>ç±»å‹ï¼Œåˆ™ç±»å‹è½¬æ¢ä¼šè‡ªåŠ¨è¿›è¡Œã€‚<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-typeconversion" title="Method Parameters And Type Conversion">&quot;æ–¹æ³•å‚æ•°ä¸ç±»å‹è½¬æ¢&quot;</a>ä¸€èŠ‚ã€‚</p>
<p>å¦‚æœ<code>@RequestHeader</code>æ³¨è§£åº”ç”¨åœ¨<code>Map&lt;String, String&gt;</code>ã€<code>MultiValueMap&lt;String, String&gt;</code>æˆ–<code>HttpHeaders</code>ç±»å‹çš„å‚æ•°ä¸Šï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¯·æ±‚å¤´å±æ€§å€¼éƒ½ä¼šè¢«å¡«å……åˆ°mapä¸­ã€‚</p>
<blockquote>
<p>Springå†…ç½®æ”¯æŒå°†ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ˆæˆ–å…¶ä»–ç±»å‹è½¬æ¢ç³»ç»Ÿæ‰€èƒ½è¯†åˆ«çš„ç±»å‹ï¼‰è½¬æ¢æˆä¸€ä¸ªStringç±»å‹çš„åˆ—è¡¨/é›†åˆã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæ³¨è§£äº†<code>@RequestHeader(&quot;Accept&quot;)</code>çš„æ–¹æ³•å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ª<code>String</code>ç±»å‹ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯<code>String[]</code>æˆ–<code>List&lt;String&gt;</code>ç±»å‹çš„ã€‚</p>
</blockquote>
<p>è¿™ä¸ªæ³¨è§£å¯ä»¥æ³¨è§£åˆ°å¤„ç†å™¨æ–¹æ³•ä¸Šï¼Œåœ¨Servletç¯å¢ƒå’ŒPortletç¯å¢ƒéƒ½èƒ½ä½¿ç”¨ã€‚</p>
<h2 id="-">æ–¹æ³•å‚æ•°ä¸ç±»å‹è½¬æ¢</h2>
<p>ä»è¯·æ±‚å‚æ•°ã€è·¯å¾„å˜é‡ã€è¯·æ±‚å¤´å±æ€§æˆ–è€…cookieä¸­æŠ½å–å‡ºæ¥çš„<code>String</code>ç±»å‹çš„å€¼ï¼Œå¯èƒ½éœ€è¦è¢«è½¬æ¢æˆå…¶æ‰€ç»‘å®šçš„ç›®æ ‡æ–¹æ³•å‚æ•°æˆ–å­—æ®µçš„ç±»å‹ï¼ˆæ¯”å¦‚ï¼Œé€šè¿‡<code>@ModelAttribute</code>å°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°æ–¹æ³•å‚æ•°ä¸Šï¼‰ã€‚å¦‚æœç›®æ ‡ç±»å‹ä¸æ˜¯<code>String</code>ï¼ŒSpringä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹è½¬æ¢ã€‚æ‰€æœ‰çš„ç®€å•ç±»å‹è¯¸å¦‚intã€longã€Dateéƒ½æœ‰å†…ç½®çš„æ”¯æŒã€‚å¦‚æœæƒ³è¿›ä¸€æ­¥å®šåˆ¶è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ï¼Œä½ å¯ä»¥é€šè¿‡<code>WebDataBinder</code>ï¼ˆè¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-webdatabinder" title="Customizing WebDataBinder initialization">&quot;å®šåˆ¶WebDataBinderçš„åˆå§‹åŒ–&quot;</a>ä¸€èŠ‚ï¼‰ï¼Œæˆ–è€…ä¸º<code>Formatters</code>é…ç½®ä¸€ä¸ª<code>FormattingConversionService</code>ï¼ˆè¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/validation.html#format" title="8.6 Spring Field Formatting">8.6èŠ‚ &quot;Springå­—æ®µæ ¼å¼åŒ–&quot;</a>ä¸€èŠ‚ï¼‰æ¥åšåˆ°ã€‚</p>
<h2 id="-webdatabinder-">å®šåˆ¶WebDataBinderçš„åˆå§‹åŒ–</h2>
<p>å¦‚æœæƒ³é€šè¿‡Springçš„<code>WebDataBinder</code>åœ¨å±æ€§ç¼–è¾‘å™¨ä¸­åšè¯·æ±‚å‚æ•°çš„ç»‘å®šï¼Œä½ å¯ä»¥ä½¿ç”¨åœ¨æ§åˆ¶å™¨å†…ä½¿ç”¨<code>@InitBinder</code>æ³¨è§£çš„æ–¹æ³•ã€åœ¨æ³¨è§£äº†<code>@ControllerAdvice</code>çš„ç±»ä¸­ä½¿ç”¨<code>@InitBinder</code>æ³¨è§£çš„æ–¹æ³•ï¼Œæˆ–è€…æä¾›ä¸€ä¸ªå®šåˆ¶çš„<code>WebBindingInitializer</code>ã€‚æ›´å¤šçš„ç»†èŠ‚ï¼Œè¯·å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-controller-advice" title="Advising controllers with @ControllerAdvice">ä½¿ç”¨@ControllerAdviceè¾…åŠ©æ§åˆ¶å™¨</a>ä¸€èŠ‚ã€‚</p>
<h3 id="-initbinder">æ•°æ®ç»‘å®šçš„å®šåˆ¶ï¼šä½¿ç”¨@InitBinder</h3>
<p>ä½¿ç”¨<code>@InitBinder</code>æ³¨è§£æ§åˆ¶å™¨çš„æ–¹æ³•ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ä½ çš„æ§åˆ¶å™¨ç±»ä¸­å®šåˆ¶åº”ç”¨çš„æ•°æ®ç»‘å®šã€‚<code>@InitBinder</code>ç”¨æ¥æ ‡è®°ä¸€äº›æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¼šåˆå§‹åŒ–ä¸€ä¸ª<code>WebDataBinder</code>å¹¶ç”¨ä»¥ä¸ºå¤„ç†å™¨æ–¹æ³•å¡«å……å‘½ä»¤å¯¹è±¡å’Œè¡¨å•å¯¹è±¡çš„å‚æ•°ã€‚</p>
<p>é™¤äº†å‘½ä»¤/è¡¨å•å¯¹è±¡ä»¥åŠç›¸åº”çš„éªŒè¯ç»“æœå¯¹è±¡ï¼Œè¿™æ ·çš„â€œç»‘å®šå™¨åˆå§‹åŒ–â€æ–¹æ³•èƒ½å¤Ÿæ¥æ”¶<code>@RequestMapping</code>æ‰€æ”¯æŒçš„æ‰€æœ‰å‚æ•°ç±»å‹ã€‚â€œç»‘å®šå™¨åˆå§‹åŒ–â€æ–¹æ³•ä¸èƒ½æœ‰è¿”å›å€¼ï¼Œå› æ­¤ï¼Œä¸€èˆ¬å°†å®ƒä»¬å£°æ˜ä¸º<code>void</code>è¿”å›ç±»å‹ã€‚ç‰¹åˆ«åœ°ï¼Œå½“<code>WebDataBinder</code>ä¸<code>WebRequest</code>æˆ–<code>java.util.Locale</code>ä¸€èµ·ä½œä¸ºæ–¹æ³•å‚æ•°æ—¶ï¼Œä½ å¯ä»¥åœ¨ä»£ç ä¸­æ³¨å†Œä¸Šä¸‹æ–‡ç›¸å…³çš„ç¼–è¾‘å™¨ã€‚</p>
<p>ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>@InitBinder</code>æ¥é…ç½®ä¸€ä¸ª<code>CustomerDateEditor</code>ï¼Œåè€…ä¼šå¯¹æ‰€æœ‰<code>java.util.Date</code>ç±»å‹çš„è¡¨å•å­—æ®µè¿›è¡Œæ“ä½œï¼š</p>
<pre><code class="lang-java">@Controller
public class MyFormController {

    @InitBinder
    public void initBinder(WebDataBinder binder) {
        SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);
        dateFormat.setLenient(false);
        binder.registerCustomEditor(Date.class, new CustomDateEditor(dateFormat, false));
    }

    // ...
}
</code></pre>
<p>æˆ–è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨Spring 4.2æä¾›çš„<code>addCustomFormatter</code>æ¥æŒ‡å®š<code>Formatter</code>çš„å®ç°ï¼Œè€Œéé€šè¿‡<code>PropertyEditor</code>å®ä¾‹ã€‚è¿™åœ¨ä½ æ‹¥æœ‰ä¸€ä¸ªéœ€è¦<code>Formatter</code>çš„setupæ–¹æ³•ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•ä½äºä¸€ä¸ªå…±äº«çš„<code>FormattingConversionService</code>ä¸­æ—¶éå¸¸æœ‰ç”¨ã€‚è¿™æ ·å¯¹äºæ§åˆ¶å™¨çº§åˆ«çš„ç»‘å®šè§„åˆ™çš„å®šåˆ¶ï¼Œä»£ç æ›´å®¹æ˜“è¢«å¤ç”¨ã€‚</p>
<pre><code class="lang-java">@Controller
public class MyFormController {

    @InitBinder
    public void initBinder(WebDataBinder binder) {
        binder.addCustomFormatter(new DateFormatter(&quot;yyyy-MM-dd&quot;));
    }

    // ...
}
</code></pre>
<h3 id="-webbindinginitializer">é…ç½®å®šåˆ¶çš„WebBindingInitializer</h3>
<p>ä¸ºäº†externalizeæ•°æ®ç»‘å®šçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œä½ å¯ä»¥ä¸º<code>WebBindingInitializer</code>æ¥å£æä¾›ä¸€ä¸ªè‡ªå·±çš„å®ç°ï¼Œåœ¨å…¶ä¸­ä½ å¯ä»¥ä¸º<code>AnnotationMethodHandlerAdapter</code>æä¾›ä¸€ä¸ªé»˜è®¤çš„é…ç½®beanï¼Œä»¥æ­¤æ¥è¦†å†™é»˜è®¤çš„é…ç½®ã€‚</p>
<p>ä»¥ä¸‹çš„ä»£ç æ¥è‡ªPetClinicçš„åº”ç”¨ï¼Œå®ƒå±•ç¤ºäº†ä¸º<code>WebBindingInitializer</code>æ¥å£æä¾›ä¸€ä¸ªè‡ªå®šä¹‰å®ç°ï¼š<code>org.springframework.samples.petclinic.web.ClinicBindingInitializer</code>å®Œæ•´çš„é…ç½®è¿‡ç¨‹ã€‚åè€…ä¸­é…ç½®äº†PetClinicåº”ç”¨ä¸­è®¸å¤šæ§åˆ¶å™¨æ‰€éœ€è¦çš„å±æ€§ç¼–è¾‘å™¨PropertyEditorsã€‚</p>
<pre><code class="lang-xml">&lt;bean class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;&gt;
    &lt;property name=&quot;cacheSeconds&quot; value=&quot;0&quot;/&gt;
    &lt;property name=&quot;webBindingInitializer&quot;&gt;
        &lt;bean class=&quot;org.springframework.samples.petclinic.web.ClinicBindingInitializer&quot;/&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<p><code>@InitBinder</code>æ–¹æ³•ä¹Ÿå¯ä»¥å®šä¹‰åœ¨<code>@ControllerAdvice</code>æ³¨è§£çš„ç±»ä¸Šï¼Œè¿™æ ·é…ç½®å¯ä»¥ä¸ºè®¸å¤šæ§åˆ¶å™¨æ‰€å…±äº«ã€‚è¿™æä¾›äº†é™¤ä½¿ç”¨<code>WebBindingInitializer</code>å¤–çš„å¦å¤–ä¸€ç§æ–¹æ³•ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-controller-advice" title="Advising controllers with @ControllerAdvice">ä½¿ç”¨@ControllerAdviceè¾…åŠ©æ§åˆ¶å™¨</a>ä¸€èŠ‚ã€‚</p>
<h2 id="-controlleradvice-">ä½¿ç”¨@ControllerAdviceè¾…åŠ©æ§åˆ¶å™¨</h2>
<p><code>@ControllerAdvice</code>æ˜¯ä¸€ä¸ªç»„ä»¶æ³¨è§£ï¼Œå®ƒä½¿å¾—å…¶å®ç°ç±»èƒ½å¤Ÿè¢«classpathæ‰«æè‡ªåŠ¨å‘ç°ã€‚è‹¥åº”ç”¨æ˜¯é€šè¿‡MVCå‘½ä»¤ç©ºé—´æˆ–MVC Javaç¼–ç¨‹æ–¹å¼é…ç½®ï¼Œé‚£ä¹ˆè¯¥ç‰¹æ€§é»˜è®¤æ˜¯è‡ªåŠ¨å¼€å¯çš„ã€‚</p>
<p>æ³¨è§£<code>@ControllerAdvice</code>çš„ç±»å¯ä»¥æ‹¥æœ‰<code>@ExceptionHandler</code>ã€<code>@InitBinder</code>æˆ–<code>@ModelAttribute</code>æ³¨è§£çš„æ–¹æ³•ï¼Œå¹¶ä¸”è¿™äº›æ–¹æ³•ä¼šè¢«åº”ç”¨è‡³æ§åˆ¶å™¨ç±»å±‚æ¬¡??çš„æ‰€æœ‰<code>@RequestMapping</code>æ–¹æ³•ä¸Šã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡<code>@ControllerAdvice</code>çš„å±æ€§æ¥æŒ‡å®šå…¶åªå¯¹ä¸€ä¸ªå­é›†çš„æ§åˆ¶å™¨ç”Ÿæ•ˆï¼š</p>
<pre><code class="lang-java">// Target all Controllers annotated with @RestController
@ControllerAdvice(annotations = RestController.class)
public class AnnotationAdvice {}

// Target all Controllers within specific packages
@ControllerAdvice(&quot;org.example.controllers&quot;)
public class BasePackageAdvice {}

// Target all Controllers assignable to specific classes
@ControllerAdvice(assignableTypes = {ControllerInterface.class, AbstractController.class})
public class AssignableTypesAdvice {}
</code></pre>
<p>æ›´å¤šçš„ç»†èŠ‚ï¼Œè¯·æŸ¥é˜…<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/javadoc-api/org/springframework/web/bind/annotation/ControllerAdvice.html"><code>@ControllerAdvice</code>çš„æ–‡æ¡£</a>ã€‚</p>
<p>ä¸‹é¢ä¸¤èŠ‚ï¼Œè¿˜çœ‹ä¸å¤ªæ‡‚ï¼Œå¾…è¯‘ã€‚</p>
<h4 id="jackson-serialization-view-support">Jackson Serialization View Support</h4>
<p>It can sometimes be useful to filter contextually the object that will be
serialized to the HTTP response body. In order to provide such capability,
Spring MVC has built-in support for rendering with <a href="http://wiki.fasterxml.com/JacksonJsonViews">Jackson&#39;s Serialization
Views</a>.</p>
<p>To use it with an <code>@ResponseBody</code> controller method or controller methods that
return <code>ResponseEntity</code>, simply add the <code>@JsonView</code> annotation with a class
argument specifying the view class or interface to be used:</p>
<pre><code>_@RestController_
public class UserController {

    _@RequestMapping(path = &quot;/user&quot;, method = RequestMethod.GET)_
    _@JsonView(User.WithoutPasswordView.class)_
    public User getUser() {
        return new User(&quot;eric&quot;, &quot;7!jd#h23&quot;);
    }
}

public class User {

    public interface WithoutPasswordView {};
    public interface WithPasswordView extends WithoutPasswordView {};

    private String username;
    private String password;

    public User() {
    }

    public User(String username, String password) {
        this.username = username;
        this.password = password;
    }

    _@JsonView(WithoutPasswordView.class)_
    public String getUsername() {
        return this.username;
    }

    _@JsonView(WithPasswordView.class)_
    public String getPassword() {
        return this.password;
    }
}
</code></pre><table>
<thead>
<tr>
<th><img src="images/note.png" alt="\[Note\]"></th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>Note that despite <code>@JsonView</code> allowing for more than one class to be
specified, the use on a controller method is only supported with exactly one
class argument. Consider the use of a composite interface if you need to
enable multiple views.</p>
<p>For controllers relying on view resolution, simply add the serialization view
class to the model:</p>
<pre><code>_@Controller_
public class UserController extends AbstractController {

    _@RequestMapping(path = &quot;/user&quot;, method = RequestMethod.GET)_
    public String getUser(Model model) {
        model.addAttribute(&quot;user&quot;, new User(&quot;eric&quot;, &quot;7!jd#h23&quot;));
        model.addAttribute(JsonView.class.getName(), User.WithoutPasswordView.class);
        return &quot;userView&quot;;
    }
}
</code></pre><h4 id="jackson-jsonp-support">Jackson JSONP Support</h4>
<p>In order to enable <a href="http://en.wikipedia.org/wiki/JSONP">JSONP</a> support for
<code>@ResponseBody</code> and <code>ResponseEntity</code> methods, declare an <code>@ControllerAdvice</code>
bean that extends <code>AbstractJsonpResponseBodyAdvice</code> as shown below where the
constructor argument indicates the JSONP query parameter name(s):</p>
<pre><code>_@ControllerAdvice_
public class JsonpAdvice extends AbstractJsonpResponseBodyAdvice {

    public JsonpAdvice() {
        super(&quot;callback&quot;);
    }
}
</code></pre><p>For controllers relying on view resolution, JSONP is automatically enabled
when the request has a query parameter named <code>jsonp</code> or <code>callback</code>. Those
names can be customized through <code>jsonpParameterNames</code> property.</p>
</section<section><h1 id="21-3-4-">21.3.4 å¼‚æ­¥è¯·æ±‚çš„å¤„ç†</h1>
<p>Spring MVC 3.2å¼€å§‹å¼•å…¥äº†åŸºäºServlet 3çš„å¼‚æ­¥è¯·æ±‚å¤„ç†ã€‚ç›¸æ¯”ä»¥å‰ï¼Œæ§åˆ¶å™¨æ–¹æ³•å·²ç»ä¸ä¸€å®šéœ€è¦è¿”å›ä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯å¯ä»¥è¿”å›ä¸€ä¸ª<code>java.util.concurrent.Callable</code>çš„å¯¹è±¡ï¼Œå¹¶é€šè¿‡Spring MVCæ‰€ç®¡ç†çš„çº¿ç¨‹æ¥äº§ç”Ÿè¿”å›å€¼ã€‚ä¸æ­¤åŒæ—¶ï¼ŒServletå®¹å™¨çš„ä¸»çº¿ç¨‹åˆ™å¯ä»¥é€€å‡ºå¹¶é‡Šæ”¾å…¶èµ„æºäº†ï¼ŒåŒæ—¶ä¹Ÿå…è®¸å®¹å™¨å»å¤„ç†å…¶ä»–çš„è¯·æ±‚ã€‚é€šè¿‡ä¸€ä¸ª<code>TaskExecutor</code>ï¼ŒSpring MVCå¯ä»¥åœ¨å¦å¤–çš„çº¿ç¨‹ä¸­è°ƒç”¨<code>Callable</code>ã€‚å½“<code>Callable</code>è¿”å›æ—¶ï¼Œè¯·æ±‚å†æºå¸¦<code>Callable</code>è¿”å›çš„å€¼ï¼Œå†æ¬¡è¢«åˆ†é…åˆ°Servletå®¹å™¨ä¸­æ¢å¤å¤„ç†æµç¨‹ã€‚ä»¥ä¸‹ä»£ç ç»™å‡ºäº†ä¸€ä¸ªè¿™æ ·çš„æ§åˆ¶å™¨æ–¹æ³•ä½œä¸ºä¾‹å­ï¼š</p>
<pre><code class="lang-java">@RequestMapping(method=RequestMethod.POST)
public Callable&lt;String&gt; processUpload(final MultipartFile file) {

    return new Callable&lt;String&gt;() {
        public String call() throws Exception {
            // ...
            return &quot;someView&quot;;
        }
    };

}
</code></pre>
<p>å¦ä¸€ä¸ªé€‰æ‹©ï¼Œæ˜¯è®©æ§åˆ¶å™¨æ–¹æ³•è¿”å›ä¸€ä¸ª<code>DeferredResult</code>çš„å®ä¾‹ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œè¿”å›å€¼å¯ä»¥ç”±ä»»ä½•ä¸€ä¸ªçº¿ç¨‹äº§ç”Ÿï¼Œä¹ŸåŒ…æ‹¬é‚£äº›ä¸æ˜¯ç”±Spring MVCç®¡ç†çš„çº¿ç¨‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè¿”å›å€¼å¯èƒ½æ˜¯ä¸ºäº†å“åº”æŸäº›å¤–éƒ¨äº‹ä»¶æ‰€äº§ç”Ÿçš„ï¼Œæ¯”å¦‚ä¸€æ¡JMSçš„æ¶ˆæ¯ï¼Œä¸€ä¸ªè®¡åˆ’ä»»åŠ¡ï¼Œç­‰ç­‰ã€‚ä»¥ä¸‹ä»£ç ç»™å‡ºäº†ä¸€ä¸ªè¿™æ ·çš„æ§åˆ¶å™¨ä½œä¸ºä¾‹å­ï¼š</p>
<pre><code class="lang-java">@RequestMapping(&quot;/quotes&quot;)
@ResponseBody
public DeferredResult&lt;String&gt; quotes() {
    DeferredResult&lt;String&gt; deferredResult = new DeferredResult&lt;String&gt;();
    // Save the deferredResult somewhere..
    return deferredResult;
}

// In some other thread...
deferredResult.setResult(data);
</code></pre>
<p>å¦‚æœå¯¹Servlet 3.0çš„å¼‚æ­¥è¯·æ±‚å¤„ç†ç‰¹æ€§æ²¡æœ‰äº†è§£ï¼Œç†è§£è¿™ä¸ªç‰¹æ€§å¯èƒ½ä¼šæœ‰ç‚¹å›°éš¾ã€‚å› æ­¤ï¼Œé˜…è¯»ä¸€ä¸‹å‰è€…çš„æ–‡æ¡£å°†ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ä»¥ä¸‹ç»™å‡ºäº†è¿™ä¸ªæœºåˆ¶è¿ä½œèƒŒåçš„ä¸€äº›åŸç†ï¼š</p>
<ul>
<li>ä¸€ä¸ªservletè¯·æ±‚<code>ServletRequest</code>å¯ä»¥é€šè¿‡è°ƒç”¨<code>request.startAsync()</code>æ–¹æ³•è€Œè¿›å…¥å¼‚æ­¥æ¨¡å¼ã€‚è¿™æ ·åšçš„ä¸»è¦ç»“æœå°±æ˜¯è¯¥servletä»¥åŠæ‰€æœ‰çš„è¿‡æ»¤å™¨éƒ½å¯ä»¥ç»“æŸï¼Œä½†å…¶å“åº”ï¼ˆresponseï¼‰ä¼šç•™å¾…å¼‚æ­¥å¤„ç†ç»“æŸåå†è¿”å›</li>
<li>è°ƒç”¨<code>request.startAsync()</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>AsyncContext</code>å¯¹è±¡ï¼Œå¯ç”¨å®ƒå¯¹å¼‚æ­¥å¤„ç†è¿›è¡Œè¿›ä¸€æ­¥çš„æ§åˆ¶å’Œæ“ä½œã€‚æ¯”å¦‚è¯´å®ƒä¹Ÿæä¾›äº†ä¸€ä¸ªä¸è½¬å‘ï¼ˆforwardï¼‰å¾ˆç›¸ä¼¼çš„<code>dispatch</code>æ–¹æ³•ï¼Œåªä¸è¿‡å®ƒå…è®¸åº”ç”¨æ¢å¤Servletå®¹å™¨çš„è¯·æ±‚å¤„ç†è¿›ç¨‹</li>
<li><code>ServletRequest</code>æä¾›äº†è·å–å½“å‰<code>DispatherType</code>çš„æ–¹å¼ï¼Œåè€…å¯ä»¥ç”¨æ¥åŒºåˆ«å½“å‰å¤„ç†çš„æ˜¯åŸå§‹è¯·æ±‚ã€å¼‚æ­¥åˆ†å‘è¯·æ±‚ã€è½¬å‘ï¼Œæˆ–æ˜¯å…¶ä»–ç±»å‹çš„è¯·æ±‚åˆ†å‘ç±»å‹ã€‚</li>
</ul>
<p>æœ‰äº†ä¸Šé¢çš„çŸ¥è¯†ï¼Œä¸‹é¢å¯ä»¥æ¥çœ‹ä¸€ä¸‹<code>Callable</code>çš„å¼‚æ­¥è¯·æ±‚è¢«å¤„ç†æ—¶æ‰€ä¾æ¬¡å‘ç”Ÿçš„äº‹ä»¶ï¼š</p>
<ul>
<li>æ§åˆ¶å™¨å…ˆè¿”å›ä¸€ä¸ª<code>Callable</code>å¯¹è±¡</li>
<li>Spring MVCå¼€å§‹è¿›è¡Œå¼‚æ­¥å¤„ç†ï¼Œå¹¶æŠŠè¯¥<code>Callable</code>å¯¹è±¡æäº¤ç»™å¦ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹çš„æ‰§è¡Œå™¨<code>TaskExecutor</code>å¤„ç†</li>
<li><code>DispatcherServlet</code>å’Œæ‰€æœ‰è¿‡æ»¤å™¨éƒ½é€€å‡ºServletå®¹å™¨çº¿ç¨‹ï¼Œä½†æ­¤æ—¶æ–¹æ³•çš„å“åº”å¯¹è±¡ä»æœªè¿”å›</li>
<li><code>Callable</code>å¯¹è±¡æœ€ç»ˆäº§ç”Ÿä¸€ä¸ªè¿”å›ç»“æœï¼Œæ­¤æ—¶Spring MVCä¼šé‡æ–°æŠŠè¯·æ±‚åˆ†æ´¾å›Servletå®¹å™¨ï¼Œæ¢å¤å¤„ç†</li>
<li><code>DispatcherServlet</code>å†æ¬¡è¢«è°ƒç”¨ï¼Œæ¢å¤å¯¹<code>Callable</code>å¼‚æ­¥å¤„ç†æ‰€è¿”å›ç»“æœçš„å¤„ç†</li>
</ul>
<p>å¯¹<code>DeferredResult</code>å¼‚æ­¥è¯·æ±‚çš„å¤„ç†é¡ºåºä¹Ÿéå¸¸ç±»ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºåº”ç”¨å¯ä»¥é€šè¿‡ä»»ä½•çº¿ç¨‹æ¥è®¡ç®—è¿”å›ä¸€ä¸ªç»“æœï¼š</p>
<ul>
<li>æ§åˆ¶å™¨å…ˆè¿”å›ä¸€ä¸ª<code>DeferredResult</code>å¯¹è±¡ï¼Œå¹¶æŠŠå®ƒå­˜å–åœ¨å†…å­˜ï¼ˆé˜Ÿåˆ—æˆ–åˆ—è¡¨ç­‰ï¼‰ä¸­ä»¥ä¾¿å­˜å–</li>
<li>Spring MVCå¼€å§‹è¿›è¡Œå¼‚æ­¥å¤„ç†</li>
<li><code>DispatcherServlet</code>å’Œæ‰€æœ‰è¿‡æ»¤å™¨éƒ½é€€å‡ºServletå®¹å™¨çº¿ç¨‹ï¼Œä½†æ­¤æ—¶æ–¹æ³•çš„å“åº”å¯¹è±¡ä»æœªè¿”å›</li>
<li>ç”±å¤„ç†è¯¥è¯·æ±‚çš„çº¿ç¨‹å¯¹ <code>DeferredResult</code>è¿›è¡Œè®¾å€¼ï¼Œç„¶åSpring MVCä¼šé‡æ–°æŠŠè¯·æ±‚åˆ†æ´¾å›Servletå®¹å™¨ï¼Œæ¢å¤å¤„ç†</li>
<li><code>DispatcherServlet</code>å†æ¬¡è¢«è°ƒç”¨ï¼Œæ¢å¤å¯¹è¯¥å¼‚æ­¥è¿”å›ç»“æœçš„å¤„ç†</li>
</ul>
<p>å…³äºå¼•å…¥å¼‚æ­¥è¯·æ±‚å¤„ç†çš„èƒŒæ™¯å’ŒåŸå› ï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®ƒã€ä¸ºä»€ä¹ˆä½¿ç”¨å¼‚æ­¥è¯·æ±‚å¤„ç†ç­‰é—®é¢˜ï¼Œä½ å¯ä»¥ä»<a href="https://spring.io/blog/2012/05/07/spring-mvc-3-2-preview-introducing-servlet-3-async-support">è¿™ä¸ªç³»åˆ—çš„åšå®¢</a>ä¸­äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p>
<h2 id="-">å¼‚æ­¥è¯·æ±‚çš„å¼‚å¸¸å¤„ç†</h2>
<p>è‹¥æ§åˆ¶å™¨è¿”å›çš„<code>Callable</code>åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿç®€å•æ¥è¯´ï¼Œè¿™ä¸ä¸€èˆ¬çš„æ§åˆ¶å™¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ˜¯ä¸€æ ·çš„ã€‚å®ƒä¼šè¢«æ­£å¸¸çš„å¼‚å¸¸å¤„ç†æµç¨‹æ•è·å¤„ç†ã€‚æ›´å…·ä½“åœ°è¯´å‘¢ï¼Œå½“<code>Callable</code>æŠ›å‡ºå¼‚å¸¸æ—¶ï¼ŒSpring MVCä¼šæŠŠä¸€ä¸ª<code>Exception</code>å¯¹è±¡åˆ†æ´¾ç»™Servletå®¹å™¨è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯æ­£å¸¸è¿”å›æ–¹æ³•çš„è¿”å›å€¼ï¼Œç„¶åå®¹å™¨æ¢å¤å¯¹æ­¤å¼‚æ­¥è¯·æ±‚å¼‚å¸¸çš„å¤„ç†ã€‚è‹¥æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª<code>DeferredResult</code>å¯¹è±¡ï¼Œä½ å¯ä»¥é€‰æ‹©è°ƒ<code>Exception</code>å®ä¾‹çš„<code>setResult</code>æ–¹æ³•è¿˜æ˜¯<code>setErrorResult</code>æ–¹æ³•ã€‚</p>
<h2 id="-">æ‹¦æˆªå¼‚æ­¥è¯·æ±‚</h2>
<p>å¤„ç†å™¨æ‹¦æˆªå™¨<code>HandlerInterceptor</code>å¯ä»¥å®ç°<code>AsyncHandlerInterceptor</code>æ¥å£æ‹¦æˆªå¼‚æ­¥è¯·æ±‚ï¼Œå› ä¸ºåœ¨å¼‚æ­¥è¯·æ±‚å¼€å§‹æ—¶ï¼Œè¢«è°ƒç”¨çš„å›è°ƒæ–¹æ³•æ˜¯è¯¥æ¥å£çš„<code>afterConcurrentHandlingStarted</code>æ–¹æ³•ï¼Œè€Œéä¸€èˆ¬çš„<code>postHandle</code>å’Œ<code>afterCompletion</code>æ–¹æ³•ã€‚</p>
<p>å¦‚æœéœ€è¦ä¸å¼‚æ­¥è¯·æ±‚å¤„ç†çš„ç”Ÿå‘½æµç¨‹æœ‰æ›´æ·±å…¥çš„é›†æˆï¼Œæ¯”å¦‚éœ€è¦å¤„ç†timeoutçš„äº‹ä»¶ç­‰ï¼Œåˆ™<code>HandlerInterceptor</code>éœ€è¦æ³¨å†Œä¸€ä¸ª<code>CallableProcessingInterceptor</code>æˆ–<code>DeferredResultProcessingInterceptor</code>æ‹¦æˆªå™¨ã€‚å…·ä½“çš„ç»†èŠ‚å¯ä»¥å‚è€ƒ<code>AsyncHandlerInterceptor</code>ç±»çš„Javaæ–‡æ¡£ã€‚</p>
<p><code>DeferredResult</code>ç±»è¿˜æä¾›äº†<code>onTimeout(Runnable)</code>å’Œ<code>onCompletion(Runnable)</code>ç­‰æ–¹æ³•ï¼Œå…·ä½“çš„ç»†èŠ‚å¯ä»¥å‚è€ƒ<code>DeferredResult</code>ç±»çš„Javaæ–‡æ¡£ã€‚</p>
<p><code>Callable</code>éœ€è¦è¯·æ±‚è¿‡æœŸ(timeout)å’Œå®Œæˆåçš„æ‹¦æˆªæ—¶ï¼Œå¯ä»¥æŠŠå®ƒåŒ…è£…åœ¨ä¸€ä¸ª<code>WebAsyncTask</code>å®ä¾‹ä¸­ï¼Œåè€…æä¾›äº†ç›¸å…³çš„æ”¯æŒã€‚</p>
<h2 id="http-streaming-">HTTP streaming(ä¸çŸ¥é“æ€ä¹ˆç¿»)</h2>
<p>å¦‚å‰æ‰€è¿°ï¼Œæ§åˆ¶å™¨å¯ä»¥ä½¿ç”¨<code>DeferredResult</code>æˆ–<code>Callable</code>å¯¹è±¡æ¥å¼‚æ­¥åœ°è®¡ç®—å…¶è¿”å›å€¼ï¼Œè¿™å¯ä»¥ç”¨äºå®ç°ä¸€äº›æœ‰ç”¨çš„æŠ€æœ¯ï¼Œæ¯”å¦‚ <a href="http://spring.io/blog/2012/05/08/spring-mvc-3-2-preview-techniques-for-real-time-updates/">long polling</a>æŠ€æœ¯ï¼Œè®©æœåŠ¡å™¨å¯ä»¥å°½å¯èƒ½å¿«åœ°å‘å®¢æˆ·ç«¯æ¨é€äº‹ä»¶ã€‚</p>
<p>å¦‚æœä½ æƒ³åœ¨ä¸€ä¸ªHTTPå“åº”ä¸­åŒæ—¶æ¨é€å¤šä¸ªäº‹ä»¶ï¼Œæ€ä¹ˆåŠï¼Ÿè¿™æ ·çš„æŠ€æœ¯å·²ç»å­˜åœ¨ï¼Œä¸&quot;Long Polling&quot;ç›¸å…³ï¼Œå«&quot;HTTP Streaming&quot;ã€‚Spring MVCæ”¯æŒè¿™é¡¹æŠ€æœ¯ï¼Œä½ å¯ä»¥é€šè¿‡è®©æ–¹æ³•è¿”å›ä¸€ä¸ª<code>ResponseBodyEmitter</code>ç±»å‹å¯¹è±¡æ¥å®ç°ï¼Œè¯¥å¯¹è±¡å¯è¢«ç”¨äºå‘é€å¤šä¸ªå¯¹è±¡ã€‚é€šå¸¸æˆ‘ä»¬æ‰€ä½¿ç”¨çš„<code>@ResponseBody</code>åªèƒ½è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæ˜¯é€šè¿‡<code>HttpMessageConverter</code>å†™åˆ°å“åº”ä½“ä¸­çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®ç°è¯¥æŠ€æœ¯çš„ä¾‹å­ï¼š</p>
<pre><code class="lang-java">@RequestMapping(&quot;/events&quot;)
public ResponseBodyEmitter handle() {
    ResponseBodyEmitter emitter = new ResponseBodyEmitter();
    // Save the emitter somewhere..
    return emitter;
}

// In some other thread
emitter.send(&quot;Hello once&quot;);

// and again later on
emitter.send(&quot;Hello again&quot;);

// and done at some point
emitter.complete();
</code></pre>
<p><code>ResponseBodyEmitter</code>ä¹Ÿå¯ä»¥è¢«æ”¾åˆ°<code>ResponseEntity</code>ä½“é‡Œé¢ä½¿ç”¨ï¼Œè¿™å¯ä»¥å¯¹å“åº”çŠ¶æ€å’Œå“åº”å¤´åšä¸€äº›å®šåˆ¶ã€‚</p>
<p>Note that <code>ResponseBodyEmitter</code> can also be used as the body in a
<code>ResponseEntity</code> in order to customize the status and headers of the response.</p>
<h2 id="-http-streaming">ä½¿ç”¨â€œæœåŠ¡å™¨ç«¯äº‹ä»¶æ¨é€â€çš„HTTP Streaming</h2>
<p><code>SseEmitter</code>æ˜¯<code>ResponseBodyEmitter</code>çš„ä¸€ä¸ªå­ç±»ï¼Œæä¾›äº†å¯¹<a href="http://www.w3.org/TR/eventsource/">æœåŠ¡å™¨ç«¯äº‹ä»¶æ¨é€</a>çš„æŠ€æœ¯çš„æ”¯æŒã€‚æœåŠ¡å™¨ç«¯äº‹ä»¶æ¨é€å…¶å®åªæ˜¯ä¸€ç§HTTP Streamingçš„ç±»ä¼¼å®ç°ï¼Œåªä¸è¿‡å®ƒæœåŠ¡å™¨ç«¯æ‰€æ¨é€çš„äº‹ä»¶éµå¾ªäº†W3C Server-Sent Eventsè§„èŒƒä¸­å®šä¹‰çš„äº‹ä»¶æ ¼å¼ã€‚</p>
<p>â€œæœåŠ¡å™¨ç«¯äº‹ä»¶æ¨é€â€æŠ€æœ¯æ­£å¦‚å…¶åï¼Œæ˜¯ç”¨äºç”±æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯è¿›è¡Œçš„äº‹ä»¶æ¨é€ã€‚è¿™åœ¨Spring MVCä¸­å¾ˆå®¹æ˜“åšåˆ°ï¼Œåªéœ€è¦æ–¹æ³•è¿”å›ä¸€ä¸ª<code>SseEmitter</code>ç±»å‹çš„å¯¹è±¡å³å¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒInternet Explorerå¹¶ä¸æ”¯æŒè¿™é¡¹æœåŠ¡å™¨ç«¯äº‹ä»¶æ¨é€çš„æŠ€æœ¯ã€‚å¦å¤–ï¼Œå¯¹äºæ›´å¤§å‹çš„webåº”ç”¨åŠæ›´ç²¾è‡´çš„æ¶ˆæ¯ä¼ è¾“åœºæ™¯â€”â€”æ¯”å¦‚åœ¨çº¿æ¸¸æˆã€åœ¨çº¿åä½œã€é‡‘èåº”ç”¨ç­‰â€”â€”æ¥è¯´ï¼Œä½¿ç”¨Springçš„WebSocketï¼ˆåŒ…å«SockJSé£æ ¼çš„å®æ—¶WebSocketï¼‰æ›´æˆç†Ÿä¸€äº›ï¼Œå› ä¸ºå®ƒæ”¯æŒçš„æµè§ˆå™¨èŒƒå›´éå¸¸å¹¿ï¼ˆåŒ…æ‹¬IEï¼‰ï¼Œå¹¶ä¸”ï¼Œå¯¹äºä¸€ä¸ªä»¥æ¶ˆæ¯ä¸ºä¸­å¿ƒçš„æ¶æ„ä¸­ï¼Œå®ƒä¸ºæœåŠ¡å™¨ç«¯-å®¢æˆ·ç«¯é—´çš„äº‹ä»¶å‘å¸ƒ-è®¢é˜…æ¨¡å‹çš„äº¤äº’æä¾›äº†æ›´é«˜å±‚çº§çš„æ¶ˆæ¯æ¨¡å¼ï¼ˆmessaging patternsï¼‰çš„æ”¯æŒã€‚</p>
<h2 id="-outputstream-http-streaming">ç›´æ¥å†™å›è¾“å‡ºæµOutputStreamçš„HTTP Streaming</h2>
<p><code>ResponseBodyEmitter</code>ä¹Ÿå…è®¸é€šè¿‡<code>HttpMessageConverter</code>å‘å“åº”ä½“ä¸­æ”¯æŒå†™äº‹ä»¶å¯¹è±¡ã€‚è¿™å¯èƒ½æ˜¯æœ€å¸¸è§çš„æƒ…å½¢ï¼Œæ¯”å¦‚å†™è¿”å›çš„JSONæ•°æ®çš„æ—¶å€™ã€‚ä½†æœ‰æ—¶ï¼Œè·³è¿‡æ¶ˆæ¯è½¬æ¢çš„é˜¶æ®µï¼Œç›´æ¥æŠŠæ•°æ®å†™å›å“åº”çš„è¾“å‡ºæµ<code>OutputStream</code>å¯èƒ½æ›´æœ‰æ•ˆï¼Œæ¯”å¦‚æ–‡ä»¶ä¸‹è½½è¿™æ ·çš„åœºæ™¯ã€‚è¿™å¯ä»¥é€šè¿‡è¿”å›ä¸€ä¸ª<code>StreamingResponseBody</code>ç±»å‹çš„å¯¹è±¡æ¥å®ç°ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®ç°çš„ä¾‹å­ï¼š</p>
<pre><code class="lang-java">@RequestMapping(&quot;/download&quot;)
public StreamingResponseBody handle() {
    return new StreamingResponseBody() {
        @Override
        public void writeTo(OutputStream outputStream) throws IOException {
            // write...
        }
    };
}
</code></pre>
<p><code>ResponseBodyEmitter</code>ä¹Ÿå¯ä»¥è¢«æ”¾åˆ°<code>ResponseEntity</code>ä½“é‡Œé¢ä½¿ç”¨ï¼Œè¿™å¯ä»¥å¯¹å“åº”çŠ¶æ€å’Œå“åº”å¤´åšä¸€äº›å®šåˆ¶ã€‚</p>
<h2 id="-">å¼‚æ­¥è¯·æ±‚å¤„ç†çš„ç›¸å…³é…ç½®</h2>
<h3 id="servlet-">Servletå®¹å™¨é…ç½®</h3>
<p>å¯¹äºé‚£äº›ä½¿ç”¨<code>web.xml</code>é…ç½®æ–‡ä»¶çš„åº”ç”¨ï¼Œè¯·ç¡®ä¿<code>web.xml</code>çš„ç‰ˆæœ¬æ›´æ–°åˆ°3.0ï¼š</p>
<pre><code class="lang-xml">&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance http://java.sun.com/xml/ns/javaee
                    http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;
         version=&quot;3.0&quot;&gt;

    ...

&lt;/web-app&gt;
</code></pre>
<p>å¼‚æ­¥è¯·æ±‚å¿…é¡»åœ¨<code>web.xml</code>å°†<code>DispatcherServlet</code>ä¸‹çš„å­å…ƒç´ <code>&lt;async-supported&gt;true&lt;/async-supported&gt;</code>è®¾ç½®ä¸ºtrueã€‚æ­¤å¤–ï¼Œæ‰€æœ‰å¯èƒ½å‚ä¸å¼‚æ­¥è¯·æ±‚å¤„ç†çš„è¿‡æ»¤å™¨<code>Filter</code>éƒ½å¿…é¡»é…ç½®ä¸ºæ”¯æŒASYNCç±»å‹çš„è¯·æ±‚åˆ†æ´¾ã€‚åœ¨Springæ¡†æ¶ä¸­ä¸ºè¿‡æ»¤å™¨å¯ç”¨æ”¯æŒASYNCç±»å‹çš„è¯·æ±‚åˆ†æ´¾åº”æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºè¿™äº›è¿‡æ»¤å™¨ä¸€èˆ¬éƒ½ç»§æ‰¿äº†åŸºç±»<code>OncePerRequestFilter</code>ï¼Œåè€…åœ¨è¿è¡Œæ—¶ä¼šæ£€æŸ¥è¯¥è¿‡æ»¤å™¨æ˜¯å¦éœ€è¦å‚ä¸åˆ°å¼‚æ­¥åˆ†æ´¾çš„è¯·æ±‚å¤„ç†ä¸­ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå±•ç¤ºäº†<code>web.xml</code>çš„é…ç½®ï¼š</p>
<pre><code class="lang-xml">    &lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xsi:schemaLocation=&quot;
                http://java.sun.com/xml/ns/javaee
                http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;
        version=&quot;3.0&quot;&gt;

        &lt;filter&gt;
            &lt;filter-name&gt;Spring OpenEntityManagerInViewFilter&lt;/filter-name&gt;
            &lt;filter-class&gt;org.springframework.~.OpenEntityManagerInViewFilter&lt;/filter-class&gt;
            &lt;async-supported&gt;true&lt;/async-supported&gt;
        &lt;/filter&gt;

        &lt;filter-mapping&gt;
            &lt;filter-name&gt;Spring OpenEntityManagerInViewFilter&lt;/filter-name&gt;
            &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
            &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
            &lt;dispatcher&gt;ASYNC&lt;/dispatcher&gt;
        &lt;/filter-mapping&gt;

    &lt;/web-app&gt;
</code></pre>
<p>å¦‚æœåº”ç”¨ä½¿ç”¨çš„æ˜¯Servlet 3è§„èŒƒåŸºäºJavaç¼–ç¨‹çš„é…ç½®æ–¹å¼ï¼Œæ¯”å¦‚é€šè¿‡<code>WebApplicationInitializer</code>ï¼Œé‚£ä¹ˆä½ ä¹Ÿéœ€è¦è®¾ç½®&quot;asyncSupported&quot;æ ‡å¿—å’ŒASYNCåˆ†æ´¾ç±»å‹çš„æ”¯æŒï¼Œå°±åƒä½ åœ¨<code>web.xml</code>ä¸­æ‰€é…ç½®çš„ä¸€æ ·ã€‚ä½ å¯ä»¥è€ƒè™‘ç›´æ¥ç»§æ‰¿<code>AbstractDispatcherServletInitializer</code>æˆ–<code>AbstractAnnotationConfigDispatcherServletInitializer</code>æ¥ç®€åŒ–é…ç½®ï¼Œå®ƒä»¬éƒ½è‡ªåŠ¨åœ°ä¸ºä½ è®¾ç½®äº†è¿™äº›é…ç½®é¡¹ï¼Œå¹¶ä½¿å¾—æ³¨å†Œ<code>Filter</code>è¿‡æ»¤å™¨å®ä¾‹å˜å¾—éå¸¸ç®€å•ã€‚</p>
<h3 id="spring-mvc-">Spring MVCé…ç½®</h3>
<p>MVC Javaç¼–ç¨‹é…ç½®å’ŒMVCå‘½åç©ºé—´é…ç½®æ–¹å¼éƒ½æä¾›äº†é…ç½®å¼‚æ­¥è¯·æ±‚å¤„ç†æ”¯æŒçš„é€‰æ‹©ã€‚<code>WebMvcConfigurer</code>æä¾›äº†<code>configureAsyncSupport</code>æ–¹æ³•ï¼Œè€Œ<code>&lt;mvc:annotation-driven&gt;</code>æœ‰ä¸€ä¸ªå­å…ƒç´ <code>&lt;async-support&gt;</code>ï¼Œå®ƒä»¬éƒ½ç”¨ä»¥ä¸ºæ­¤æä¾›æ”¯æŒã€‚</p>
<p>è¿™äº›é…ç½®å…è®¸ä½ è¦†å†™å¼‚æ­¥è¯·æ±‚é»˜è®¤çš„è¶…æ—¶æ—¶é—´ï¼Œåœ¨æœªæ˜¾å¼è®¾ç½®æ—¶ï¼Œå®ƒä»¬çš„å€¼ä¸æ‰€ä¾èµ–çš„Servletå®¹å™¨æ˜¯ç›¸å…³çš„ï¼ˆæ¯”å¦‚ï¼ŒTomcatè®¾ç½®çš„è¶…æ—¶æ—¶é—´æ˜¯10ç§’ï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥é…ç½®ç”¨äºæ‰§è¡Œæ§åˆ¶å™¨è¿”å›å€¼<code>Callable</code>çš„æ‰§è¡Œå™¨<code>AsyncTaskExecutor</code>ã€‚Springå¼ºçƒˆæ¨èä½ é…ç½®è¿™ä¸ªé€‰é¡¹ï¼Œå› ä¸ºSpring MVCé»˜è®¤ä½¿ç”¨çš„æ˜¯æ™®é€šçš„æ‰§è¡Œå™¨<code>SimpleAsyncTaskExecutor</code>ã€‚MVC Javaç¼–ç¨‹é…ç½®åŠMVCå‘½åç©ºé—´é…ç½®çš„æ–¹å¼éƒ½å…è®¸ä½ æ³¨å†Œè‡ªå·±çš„<code>CallableProcessingInterceptor</code>å’Œ<code>DeferredResultProcessingInterceptor</code>æ‹¦æˆªå™¨å®ä¾‹ã€‚</p>
<p>è‹¥ä½ éœ€è¦ä¸ºç‰¹å®šçš„<code>DeferredResult</code>è¦†å†™é»˜è®¤çš„è¶…æ—¶æ—¶é—´ï¼Œä½ å¯ä»¥é€‰ç”¨åˆé€‚çš„æ„é€ æ–¹æ³•æ¥å®ç°ã€‚ç±»ä¼¼ï¼Œå¯¹äº<code>Callable</code>è¿”å›ï¼Œä½ å¯ä»¥æŠŠå®ƒåŒ…è£…åœ¨ä¸€ä¸ª<code>WebAsyncTask</code>å¯¹è±¡ä¸­ï¼Œå¹¶ä½¿ç”¨åˆé€‚çš„æ„é€ æ–¹æ³•å®šä¹‰è¶…æ—¶æ—¶é—´ã€‚<code>WebAsyncTask</code>ç±»çš„æ„é€ æ–¹æ³•åŒæ—¶ä¹Ÿèƒ½æ¥å—ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå™¨<code>AsyncTaskExecutor</code>ç±»å‹çš„å‚æ•°ã€‚</p>
</section<section><h1 id="21-3-5-">21.3.5 å¯¹æ§åˆ¶å™¨æµ‹è¯•</h1>
<p><code>spring-test</code>æ¨¡å—å¯¹æµ‹è¯•æ§åˆ¶å™¨<code>@Controller</code>æä¾›äº†æœ€åŸç”Ÿçš„æ”¯æŒã€‚è¯¦è§<a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/integration-testing.html#spring-mvc-test-framework" title="14.6 Spring MVC Test Framework">14.6 &quot;Spring MVCæµ‹è¯•æ¡†æ¶&quot;</a>ä¸€èŠ‚ã€‚</p>
</section<section><h1 id="21-4-handler-mappings-">21.4 å¤„ç†å™¨æ˜ å°„ï¼ˆHandler Mappingsï¼‰</h1>
<p>åœ¨Springçš„ä¸Šä¸ªç‰ˆæœ¬ä¸­ï¼Œç”¨æˆ·éœ€è¦åœ¨webåº”ç”¨çš„ä¸Šä¸‹æ–‡ä¸­å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªçš„<code>HandlerMapping</code>beanï¼Œç”¨ä»¥å°†è¿›å…¥å®¹å™¨çš„webè¯·æ±‚æ˜ å°„åˆ°åˆé€‚çš„å¤„ç†å™¨æ–¹æ³•ä¸Šã€‚å…è®¸åœ¨æ§åˆ¶å™¨ä¸Šæ·»åŠ æ³¨è§£åï¼Œé€šå¸¸ä½ å°±ä¸å¿…è¿™ä¹ˆåšäº†ï¼Œå› ä¸º<code>RequestMappingHandlerMapping</code>ç±»ä¼šè‡ªåŠ¨æŸ¥æ‰¾æ‰€æœ‰æ³¨è§£äº†<code>@RequestMapping</code>çš„<code>@Controller</code>æ§åˆ¶å™¨beanã€‚åŒæ—¶ä¹Ÿè¯·çŸ¥é“ï¼Œæ‰€æœ‰ç»§æ‰¿è‡ª<code>AbstractHandlerMapping</code>çš„å¤„ç†å™¨æ–¹æ³•æ˜ å°„<code>HandlerMapping</code>ç±»éƒ½æ‹¥æœ‰ä¸‹åˆ—çš„å±æ€§ï¼Œä½ å¯ä»¥å¯¹å®ƒä»¬è¿›è¡Œå®šåˆ¶ï¼š</p>
<ul>
<li>ä¸€ä¸ª<code>interceptors</code>åˆ—è¡¨ï¼ŒæŒ‡ç¤ºäº†åº”ç”¨å…¶ä¸Šçš„ä¸€ä¸ªæ‹¦æˆªå™¨åˆ—è¡¨ã€‚å¤„ç†å™¨æ–¹æ³•æ‹¦æˆªå™¨ä¼šåœ¨ <a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-handlermapping-interceptor" title="21.4.1 Intercepting requests with a HandlerInterceptor">21.4.1å°èŠ‚ ä½¿ç”¨HandlerInterceptoræ‹¦æˆªè¯·æ±‚</a>ä¸­è®¨è®ºã€‚</li>
<li><code>defaultHandler</code>ï¼Œç”Ÿæ•ˆçš„é»˜è®¤å¤„ç†å™¨ï¼Œwhen this handler mapping does not result in a matching handler.</li>
<li><code>order</code>ï¼Œæ ¹æ®orderï¼ˆè§<code>org.springframework.core.Ordered</code>æ¥å£ï¼‰å±æ€§çš„å€¼ï¼ŒSpringä¼šå¯¹ä¸Šä¸‹æ–‡å¯ç”¨çš„æ‰€æœ‰å¤„ç†å™¨æ˜ å°„è¿›è¡Œæ’åºï¼Œå¹¶åº”ç”¨ç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸçš„å¤„ç†å™¨</li>
<li><code>alwaysUseFullPath</code>ï¼ˆæ€»æ˜¯ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼‰ã€‚è‹¥è®¾ç½®ä¸º<code>true</code>ï¼ŒSpringå°†åœ¨å½“å‰Servletä¸Šä¸‹æ–‡ä¸­æ€»æ˜¯ä½¿ç”¨å®Œæ•´è·¯å¾„æ¥æŸ¥æ‰¾åˆé€‚çš„å¤„ç†å™¨ã€‚è‹¥è®¾ç½®ä¸º<code>false</code>ï¼ˆé»˜è®¤å°±ä¸º<code>false</code>ï¼‰ï¼Œåˆ™ä½¿ç”¨å½“å‰Servletçš„mappingè·¯å¾„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè‹¥ä¸€ä¸ªServletçš„mappingè·¯å¾„æ˜¯<code>/testing/*</code>ï¼Œå¹¶ä¸”<code>alwaysUseFullPath</code>å±æ€§è¢«è®¾ç½®ä¸º<code>true</code>ï¼Œæ­¤æ—¶ç”¨äºæŸ¥æ‰¾å¤„ç†å™¨çš„è·¯å¾„å°†æ˜¯<code>/testing/viewPage.html</code>ï¼›è€Œè‹¥<code>alwaysUseFullPath</code>å±æ€§çš„å€¼ä¸º<code>false</code>ï¼Œåˆ™æ­¤æ—¶æŸ¥æ‰¾è·¯å¾„æ˜¯<code>/viewPage.html</code></li>
<li><code>urlDecode</code>ï¼Œé»˜è®¤è®¾ç½®ä¸º<code>true</code>ï¼ˆä¹Ÿæ˜¯Spring 2.5çš„é»˜è®¤è®¾ç½®ï¼‰ã€‚è‹¥ä½ éœ€è¦æ¯”è¾ƒåŠ å¯†è¿‡çš„è·¯å¾„ï¼Œåˆ™æŠŠæ­¤æ ‡å¿—è®¾ä¸º<code>false</code>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>HttpServletRequest</code>æ°¸è¿œä»¥æœªåŠ å¯†çš„æ–¹å¼å­˜å‚¨Servletè·¯å¾„ã€‚æ­¤æ—¶ï¼Œè¯¥è·¯å¾„å°†æ— æ³•åŒ¹é…åˆ°åŠ å¯†è¿‡çš„è·¯å¾„</li>
</ul>
<p>ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†é…ç½®ä¸€ä¸ªæ‹¦æˆªå™¨çš„æ–¹æ³•ï¼š</p>
<pre><code class="lang-xml">&lt;beans&gt;
    &lt;bean id=&quot;handlerMapping&quot; class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;&gt;
        &lt;property name=&quot;interceptors&quot;&gt;
            &lt;bean class=&quot;example.MyInterceptor&quot;/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;beans&gt;
</code></pre>
</section<section><h1 id="21-4-1-handlerinterceptor-">21.4.1 ä½¿ç”¨HandlerInterceptoræ‹¦æˆªè¯·æ±‚</h1>
<p>Springçš„å¤„ç†å™¨æ˜ å°„æœºåˆ¶åŒ…å«äº†å¤„ç†å™¨æ‹¦æˆªå™¨ã€‚æ‹¦æˆªå™¨åœ¨ä½ éœ€è¦ä¸ºç‰¹å®šç±»å‹çš„è¯·æ±‚åº”ç”¨ä¸€äº›åŠŸèƒ½æ—¶å¯èƒ½å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ï¼Œæ£€æŸ¥ç”¨æˆ·èº«ä»½ç­‰ã€‚</p>
<p>å¤„ç†å™¨æ˜ å°„å¤„ç†è¿‡ç¨‹é…ç½®çš„æ‹¦æˆªå™¨ï¼Œå¿…é¡»å®ç° <code>org.springframework.web.servlet</code>åŒ…ä¸‹çš„ <code>HandlerInterceptor</code>æ¥å£ã€‚è¿™ä¸ªæ¥å£å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š <code>preHandle(..)</code>ï¼Œå®ƒåœ¨å¤„ç†å™¨å®é™…æ‰§è¡Œ <em>ä¹‹å‰</em> ä¼šè¢«æ‰§è¡Œï¼› <code>postHandle(..)</code>ï¼Œå®ƒåœ¨å¤„ç†å™¨æ‰§è¡Œ <em>å®Œæ¯•</em> ä»¥åè¢«æ‰§è¡Œï¼› <code>afterCompletion(..)</code>ï¼Œå®ƒåœ¨ <em>æ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæˆ</em> ä¹‹åè¢«æ‰§è¡Œã€‚è¿™ä¸‰ä¸ªæ–¹æ³•ä¸ºå„ç§ç±»å‹çš„å‰å¤„ç†å’Œåå¤„ç†éœ€æ±‚æä¾›äº†è¶³å¤Ÿçš„çµæ´»æ€§ã€‚</p>
<p><code>preHandle(..)</code>æ–¹æ³•è¿”å›ä¸€ä¸ªbooleanå€¼ã€‚ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥å†³å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œå¤„ç†é“¾ä¸­çš„éƒ¨ä»¶ã€‚å½“æ–¹æ³•è¿”å› <code>true</code>æ—¶ï¼Œå¤„ç†å™¨é“¾ä¼šç»§ç»­æ‰§è¡Œï¼›è‹¥æ–¹æ³•è¿”å› <code>false</code>ï¼Œ <code>DispatcherServlet</code>å³è®¤ä¸ºæ‹¦æˆªå™¨è‡ªèº«å·²ç»å®Œæˆäº†å¯¹è¯·æ±‚çš„å¤„ç†ï¼ˆæ¯”å¦‚è¯´ï¼Œå·²ç»æ¸²æŸ“äº†ä¸€ä¸ªåˆé€‚çš„è§†å›¾ï¼‰ï¼Œé‚£ä¹ˆå…¶ä½™çš„æ‹¦æˆªå™¨ä»¥åŠæ‰§è¡Œé“¾ä¸­çš„å…¶ä»–å¤„ç†å™¨å°±ä¸ä¼šå†è¢«æ‰§è¡Œäº†ã€‚</p>
<p>æ‹¦æˆªå™¨å¯ä»¥é€šè¿‡<code>interceptors</code>å±æ€§æ¥é…ç½®ï¼Œè¯¥é€‰é¡¹åœ¨æ‰€æœ‰ç»§æ‰¿äº†<code>AbstractHandlerMapping</code>çš„å¤„ç†å™¨æ˜ å°„ç±»<code>HandlerMapping</code>éƒ½æä¾›äº†é…ç½®çš„æ¥å£ã€‚å¦‚ä¸‹é¢ä»£ç æ ·ä¾‹æ‰€ç¤ºï¼š</p>
<pre><code class="lang-xml">&lt;beans&gt;
    &lt;bean id=&quot;handlerMapping&quot; class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;&gt;
        &lt;property name=&quot;interceptors&quot;&gt;
            &lt;list&gt;
                &lt;ref bean=&quot;officeHoursInterceptor&quot;/&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;officeHoursInterceptor&quot; class=&quot;samples.TimeBasedAccessInterceptor&quot;&gt;
        &lt;property name=&quot;openingTime&quot; value=&quot;9&quot;/&gt;
        &lt;property name=&quot;closingTime&quot; value=&quot;18&quot;/&gt;
    &lt;/bean&gt;
&lt;beans&gt;
</code></pre>
<pre><code class="lang-java">package samples;

public class TimeBasedAccessInterceptor extends HandlerInterceptorAdapter {

    private int openingTime;
    private int closingTime;

    public void setOpeningTime(int openingTime) {
        this.openingTime = openingTime;
    }

    public void setClosingTime(int closingTime) {
        this.closingTime = closingTime;
    }

    public boolean preHandle(HttpServletRequest request, HttpServletResponse response,
            Object handler) throws Exception {
        Calendar cal = Calendar.getInstance();
        int hour = cal.get(HOUR_OF_DAY);
        if (openingTime &lt;= hour &amp;&amp; hour &lt; closingTime) {
            return true;
        }
        response.sendRedirect(&quot;http://host.com/outsideOfficeHours.html&quot;);
        return false;
    }
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ‰€æœ‰è¢«æ­¤å¤„ç†å™¨å¤„ç†çš„è¯·æ±‚éƒ½ä¼šè¢«<code>TimeBasedAccessInterceptor</code>æ‹¦æˆªå™¨æ‹¦æˆªã€‚å¦‚æœå½“å‰æ—¶é—´åœ¨å·¥ä½œæ—¶é—´ä»¥å¤–ï¼Œé‚£ä¹ˆç”¨æˆ·å°±ä¼šè¢«é‡å®šå‘åˆ°ä¸€ä¸ªHTMLæ–‡ä»¶æç¤ºç”¨æˆ·ï¼Œæ¯”å¦‚æ˜¾ç¤ºâ€œä½ åªæœ‰åœ¨å·¥ä½œæ—¶é—´æ‰å¯ä»¥è®¿é—®æœ¬ç½‘ç«™â€ä¹‹ç±»çš„ä¿¡æ¯ã€‚</p>
<blockquote>
<p>ä½¿ç”¨<code>RequestMappingHandlerMapping</code>æ—¶ï¼Œå®é™…çš„å¤„ç†å™¨æ˜¯ä¸€ä¸ªå¤„ç†å™¨æ–¹æ³•<code>HandlerMethod</code>çš„å®ä¾‹ï¼Œå®ƒæ ‡è¯†äº†ä¸€ä¸ªå°†è¢«ç”¨äºå¤„ç†è¯¥è¯·æ±‚çš„æ§åˆ¶å™¨æ–¹æ³•ã€‚</p>
</blockquote>
<p>å¦‚ä½ æ‰€è§ï¼ŒSpringçš„æ‹¦æˆªå™¨é€‚é…å™¨<code>HandlerInterceptorAdapter</code>è®©ç»§æ‰¿<code>HandlerInterceptor</code>æ¥å£å˜å¾—æ›´ç®€å•äº†ã€‚</p>
<blockquote>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ‰€æœ‰æ§åˆ¶å™¨æ–¹æ³•å¤„ç†çš„è¯·æ±‚éƒ½ä¼šè¢«é…ç½®çš„æ‹¦æˆªå™¨å…ˆæ‹¦æˆªåˆ°ã€‚å¦‚æœä½ æƒ³è¿›ä¸€æ­¥ç¼©å°æ‹¦æˆªçš„URLèŒƒå›´ï¼Œä½ å¯ä»¥é€šè¿‡MVCå‘½åç©ºé—´æˆ–MVC Javaç¼–ç¨‹çš„æ–¹å¼æ¥é…ç½®ï¼Œæˆ–è€…ï¼Œå£°æ˜ä¸€ä¸ª<code>MappedInterceptor</code>ç±»å‹çš„beanå®ä¾‹æ¥å¤„ç†ã€‚å…·ä½“è¯·è§ <a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/mvc.html#mvc-config-enable">21.16.1 å¯ç”¨MVC Javaç¼–ç¨‹é…ç½®æˆ–MVCå‘½åç©ºé—´é…ç½®</a>ä¸€å°èŠ‚ã€‚</p>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>HandlerInterceptor</code>çš„åæ‹¦æˆª<code>postHandle</code>æ–¹æ³•ä¸ä¸€å®šæ€»æ˜¯é€‚ç”¨äºæ³¨è§£äº†<code>@ResponseBody</code>æˆ–<code>ResponseEntity</code>çš„æ–¹æ³•ã€‚è¿™äº›åœºæ™¯ä¸­ï¼Œ<code>HttpMessageConverter</code>ä¼šåœ¨æ‹¦æˆªå™¨çš„<code>postHandle</code>æ–¹æ³•è¢«è°ƒä¹‹å‰å°±æŠŠä¿¡æ¯å†™å›å“åº”ä¸­ã€‚è¿™æ ·æ‹¦æˆªå™¨å°±æ— æ³•å†æ”¹å˜å“åº”äº†ï¼Œæ¯”å¦‚è¦å¢åŠ ä¸€ä¸ªå“åº”å¤´ä¹‹ç±»çš„ã€‚å¦‚æœæœ‰è¿™ç§éœ€æ±‚ï¼Œè¯·è®©ä½ çš„åº”ç”¨å®ç°<code>ResponseBodyAdvice</code>æ¥å£ï¼Œå¹¶å°†å…¶å®šä¹‰ä¸ºä¸€ä¸ª<code>@ControllerAdvice</code>beanæˆ–ç›´æ¥åœ¨<code>RequestMappingHandlerMapping</code>ä¸­é…ç½®ã€‚</p>
</section<section><h1 id="21-5-">21.5 è§†å›¾è§£æ</h1>
<p>æ‰€æœ‰webåº”ç”¨çš„MVCæ¡†æ¶éƒ½æä¾›äº†è§†å›¾ç›¸å…³çš„æ”¯æŒã€‚Springæä¾›äº†ä¸€äº›è§†å›¾è§£æå™¨ï¼Œå®ƒä»¬è®©ä½ èƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­æ¸²æŸ“æ¨¡å‹ï¼Œå¹¶æ”¯æŒä½ è‡ªç”±é€‰ç”¨é€‚åˆçš„è§†å›¾æŠ€æœ¯è€Œä¸å¿…ä¸æ¡†æ¶ç»‘å®šåˆ°ä¸€èµ·ã€‚SpringåŸç”Ÿæ”¯æŒJSPè§†å›¾æŠ€æœ¯ã€Velocityæ¨¡æ¿æŠ€æœ¯å’ŒXSLTè§†å›¾ç­‰ã€‚ä½ å¯ä»¥é˜…è¯»æ–‡æ¡£çš„<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/view.html" title="22. View technologies">ç¬¬22ç«  <em>è§†å›¾æŠ€æœ¯</em></a>ä¸€ç« ï¼Œé‡Œé¢è®¨è®ºäº†å¦‚ä½•é›†æˆå¹¶ä½¿ç”¨è®¸å¤šç‹¬ç«‹çš„è§†å›¾æŠ€æœ¯ã€‚</p>
<p>æœ‰ä¸¤ä¸ªæ¥å£åœ¨Springå¤„ç†è§†å›¾ç›¸å…³äº‹å®œæ—¶è‡³å…³é‡è¦ï¼Œåˆ†åˆ«æ˜¯è§†å›¾è§£æå™¨æ¥å£<code>ViewResolver</code>å’Œè§†å›¾æ¥å£æœ¬èº«<code>View</code>ã€‚è§†å›¾è§£æå™¨<code>ViewResolver</code>è´Ÿè´£å¤„ç†è§†å›¾åä¸å®é™…è§†å›¾ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚è§†å›¾æ¥å£<code>View</code>è´Ÿè´£å‡†å¤‡è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚çš„æ¸²æŸ“äº¤ç»™æŸç§å…·ä½“çš„è§†å›¾æŠ€æœ¯å®ç°ã€‚</p>
</section<section><h1 id="21-5-1-viewresolver-">21.5.1 ä½¿ç”¨ViewResolveræ¥å£è§£æè§†å›¾</h1>
<p>æ­£å¦‚åœ¨<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-controller" title="21.3 Implementing Controllers">21.3 æ§åˆ¶å™¨çš„å®ç°</a>ä¸€èŠ‚ä¸­æ‰€è®¨è®ºçš„ï¼ŒSpring MVCä¸­æ‰€æœ‰æ§åˆ¶å™¨çš„å¤„ç†å™¨æ–¹æ³•éƒ½å¿…é¡»è¿”å›ä¸€ä¸ªé€»è¾‘è§†å›¾çš„åå­—ï¼Œæ— è®ºæ˜¯æ˜¾å¼è¿”å›ï¼ˆæ¯”å¦‚è¿”å›ä¸€ä¸ª<code>String</code>ã€<code>View</code>æˆ–è€…<code>ModelAndView</code>ï¼‰è¿˜æ˜¯éšå¼è¿”å›ï¼ˆæ¯”å¦‚åŸºäºçº¦å®šçš„è¿”å›ï¼‰ã€‚Springä¸­çš„è§†å›¾ç”±ä¸€ä¸ªè§†å›¾åæ ‡è¯†ï¼Œå¹¶ç”±è§†å›¾è§£æå™¨æ¥æ¸²æŸ“ã€‚Springæœ‰éå¸¸å¤šå†…ç½®çš„è§†å›¾è§£æå™¨ã€‚ä¸‹è¡¨åˆ—å‡ºäº†å¤§éƒ¨åˆ†ï¼Œè¡¨åä¹Ÿç»™å‡ºäº†ä¸€äº›ä¾‹å­ã€‚</p>
<p><strong>è¡¨21.3 è§†å›¾è§£æå™¨</strong></p>
<table>
<thead>
<tr>
<th>è§†å›¾è§£æå™¨</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AbstractCachingViewResolver</code></td>
<td>ä¸€ä¸ªæŠ½è±¡çš„è§†å›¾è§£æå™¨ç±»ï¼Œæä¾›äº†ç¼“å­˜è§†å›¾çš„åŠŸèƒ½ã€‚é€šå¸¸è§†å›¾åœ¨èƒ½å¤Ÿè¢«ä½¿ç”¨ä¹‹å‰éœ€è¦ç»è¿‡å‡†å¤‡ã€‚ç»§æ‰¿è¿™ä¸ªåŸºç±»çš„è§†å›¾è§£æå™¨å³å¯ä»¥è·å¾—ç¼“å­˜è§†å›¾çš„èƒ½åŠ›ã€‚</td>
</tr>
<tr>
<td><code>XmlViewResolver</code></td>
<td>è§†å›¾è§£æå™¨æ¥å£<code>ViewResolver</code>çš„ä¸€ä¸ªå®ç°ï¼Œè¯¥ç±»æ¥å—ä¸€ä¸ªXMLæ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚è¯¥XMLæ–‡ä»¶å¿…é¡»ä¸Spring XMLçš„beanå·¥å‚æœ‰ç›¸åŒçš„DTDã€‚é»˜è®¤çš„é…ç½®æ–‡ä»¶åæ˜¯<code>/WEB-INF/views.xml</code>ã€‚</td>
</tr>
<tr>
<td><code>ResourceBundleViewResolver</code></td>
<td>è§†å›¾è§£æå™¨æ¥å£<code>ViewResolver</code>çš„ä¸€ä¸ªå®ç°ï¼Œé‡‡ç”¨bundleæ ¹è·¯å¾„æ‰€æŒ‡å®šçš„<code>ResourceBundle</code>ä¸­çš„beanå®šä¹‰ä½œä¸ºé…ç½®ã€‚ä¸€èˆ¬bundleéƒ½å®šä¹‰åœ¨classpathè·¯å¾„ä¸‹çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ã€‚é»˜è®¤çš„é…ç½®æ–‡ä»¶åä¸º<code>views.properties</code>ã€‚</td>
</tr>
<tr>
<td><code>UrlBasedViewResolver</code></td>
<td><code>ViewResolver</code>æ¥å£çš„ä¸€ä¸ªç®€å•å®ç°ã€‚å®ƒç›´æ¥ä½¿ç”¨URLæ¥è§£æåˆ°é€»è¾‘è§†å›¾åï¼Œé™¤æ­¤ä¹‹å¤–ä¸éœ€è¦å…¶ä»–ä»»ä½•æ˜¾å¼çš„æ˜ å°„å£°æ˜ã€‚å¦‚æœä½ çš„é€»è¾‘è§†å›¾åä¸ä½ çœŸæ­£çš„è§†å›¾èµ„æºåæ˜¯ç›´æ¥å¯¹åº”çš„ï¼Œé‚£ä¹ˆè¿™ç§ç›´æ¥è§£æçš„æ–¹å¼å°±å¾ˆæ–¹ä¾¿ï¼Œä¸éœ€è¦ä½ å†æŒ‡å®šé¢å¤–çš„æ˜ å°„ã€‚</td>
</tr>
<tr>
<td><code>InternalResourceViewResolver</code></td>
<td><code>UrlBasedViewResolver</code>çš„ä¸€ä¸ªå¥½ç”¨çš„å­ç±»ã€‚å®ƒæ”¯æŒå†…éƒ¨èµ„æºè§†å›¾ï¼ˆå…·ä½“æ¥è¯´ï¼ŒServletå’ŒJSPï¼‰ã€ä»¥åŠè¯¸å¦‚<code>JstlView</code>å’Œ<code>TilesView</code>ç­‰ç±»çš„å­ç±»ã€‚You can specify the view class for all views generated by this resolver by using <code>setViewClass(..)</code>ã€‚æ›´å¤šçš„ç»†èŠ‚ï¼Œè¯·è§<code>UrlBasedViewResolver</code>ç±»çš„javaæ–‡æ¡£ã€‚</td>
</tr>
<tr>
<td><code>VelocityViewResolver</code> / <code>FreeMarkerViewResolver</code></td>
<td><code>UrlBasedViewResolver</code>ä¸‹çš„å®ç”¨å­ç±»ï¼Œæ”¯æŒVelocityè§†å›¾<code>VelocityView</code>ï¼ˆVelocityæ¨¡æ¿ï¼‰å’ŒFreeMarkerè§†å›¾<code>FreeMarkerView</code>ä»¥åŠå®ƒä»¬å¯¹åº”å­ç±»ã€‚</td>
</tr>
<tr>
<td><code>ContentNegotiatingViewResolver</code></td>
<td>è§†å›¾è§£æå™¨æ¥å£<code>ViewResolver</code>çš„ä¸€ä¸ªå®ç°ï¼Œå®ƒä¼šæ ¹æ®æ‰€è¯·æ±‚çš„æ–‡ä»¶åæˆ–è¯·æ±‚çš„<code>Accept</code>å¤´æ¥è§£æä¸€ä¸ªè§†å›¾ã€‚æ›´å¤šç»†èŠ‚è¯·è§<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-multiple-representations" title="21.5.4 ContentNegotiatingViewResolver">21.5.4 å†…å®¹åå•†è§†å›¾è§£æå™¨&quot;ContentNegotiatingViewResolver&quot;</a>ä¸€å°èŠ‚ã€‚</td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬å¯ä»¥ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾è¿™é‡Œä½¿ç”¨çš„æ˜¯JSPè§†å›¾æŠ€æœ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåŸºäºURLçš„è§†å›¾è§£æå™¨<code>UrlBasedViewResolver</code>ã€‚è¿™ä¸ªè§†å›¾è§£æå™¨ä¼šå°†URLè§£ææˆä¸€ä¸ªè§†å›¾åï¼Œå¹¶å°†è¯·æ±‚è½¬äº¤ç»™è¯·æ±‚åˆ†å‘å™¨æ¥è¿›è¡Œè§†å›¾æ¸²æŸ“ã€‚</p>
<pre><code class="lang-xml">&lt;bean id=&quot;viewResolver&quot; class=&quot;org.springframework.web.servlet.view.UrlBasedViewResolver&quot;&gt;
    &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.JstlView&quot;/&gt;
    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;
    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
&lt;/bean&gt;
</code></pre>
<p>è‹¥è¿”å›ä¸€ä¸ª<code>test</code>é€»è¾‘è§†å›¾åï¼Œé‚£ä¹ˆè¯¥è§†å›¾è§£æå™¨ä¼šå°†è¯·æ±‚è½¬å‘åˆ°<code>RequestDispatcher</code>ï¼Œåè€…ä¼šå°†è¯·æ±‚äº¤ç»™<code>/WEB-INF/jsp/test.jsp</code>è§†å›¾å»æ¸²æŸ“ã€‚</p>
<p>å¦‚æœéœ€è¦åœ¨åº”ç”¨ä¸­ä½¿ç”¨å¤šç§ä¸åŒçš„è§†å›¾æŠ€æœ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>ResourceBundleViewResolver</code>ï¼š</p>
<pre><code class="lang-xml">&lt;bean id=&quot;viewResolver&quot;
        class=&quot;org.springframework.web.servlet.view.ResourceBundleViewResolver&quot;&gt;
    &lt;property name=&quot;basename&quot; value=&quot;views&quot;/&gt;
    &lt;property name=&quot;defaultParentView&quot; value=&quot;parentView&quot;/&gt;
&lt;/bean&gt;
</code></pre>
<p><code>ResourceBundleViewResolver</code>ä¼šæ£€ç´¢ç”±bundleæ ¹è·¯å¾„ä¸‹æ‰€é…ç½®çš„<code>ResourceBundle</code>ï¼Œå¯¹äºæ¯ä¸ªè§†å›¾è€Œè¨€ï¼Œå…¶è§†å›¾ç±»ç”±<code>[viewname].(class)</code>å±æ€§çš„å€¼æŒ‡å®šï¼Œå…¶è§†å›¾urlç”±<code>[viewname].url</code>å±æ€§çš„å€¼æŒ‡å®šã€‚ä¸‹ä¸€èŠ‚å°†è¯¦ç»†è®²è§£è§†å›¾æŠ€æœ¯ï¼Œä½ å¯ä»¥åœ¨é‚£é‡Œæ‰¾åˆ°æ›´å¤šä¾‹å­ã€‚ä½ è¿˜å¯ä»¥çœ‹åˆ°ï¼Œè§†å›¾è¿˜å…è®¸æœ‰åŸºè§†å›¾ï¼Œå³propertiesæ–‡ä»¶ä¸­æ‰€æœ‰è§†å›¾éƒ½â€œç»§æ‰¿â€çš„ä¸€ä¸ªæ–‡ä»¶ã€‚é€šè¿‡ç»§æ‰¿æŠ€æœ¯ï¼Œä½ å¯ä»¥ä¸ºä¼—å¤šè§†å›¾æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„è§†å›¾åŸºç±»ã€‚</p>
<blockquote>
<p><code>AbstractCachingViewResolver</code>çš„å­ç±»èƒ½å¤Ÿç¼“å­˜å·²ç»è§£æè¿‡çš„è§†å›¾å®ä¾‹ã€‚å…³é—­ç¼“å­˜ç‰¹æ€§ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªéœ€è¦å°†<code>cache</code>å±æ€§è®¾ç½®ä¸º<code>false</code>å³å¯ã€‚å¦å¤–ï¼Œå¦‚æœå®åœ¨éœ€è¦åœ¨è¿è¡Œæ—¶åˆ·æ–°æŸä¸ªè§†å›¾ï¼ˆæ¯”å¦‚ä¿®æ”¹äº†Velocityæ¨¡æ¿æ—¶ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>removeFromCache(String viewName, Locale loc)</code>æ–¹æ³•ã€‚`</p>
</blockquote>
</section<section><h1 id="21-5-2-">21.5.2 è§†å›¾é“¾</h1>
<p>Springæ”¯æŒåŒæ—¶ä½¿ç”¨å¤šä¸ªè§†å›¾è§£æå™¨ã€‚å› æ­¤ï¼Œä½ å¯ä»¥é…ç½®ä¸€ä¸ªè§£æå™¨é“¾ï¼Œå¹¶åšæ›´å¤šçš„äº‹æ¯”å¦‚ï¼Œåœ¨ç‰¹å®šæ¡ä»¶ä¸‹è¦†å†™ä¸€ä¸ªè§†å›¾ç­‰ã€‚ä½ å¯ä»¥é€šè¿‡æŠŠå¤šä¸ªè§†å›¾è§£æå™¨è®¾ç½®åˆ°åº”ç”¨ä¸Šä¸‹æ–‡(application context)ä¸­çš„æ–¹å¼æ¥ä¸²è”å®ƒä»¬ã€‚å¦‚æœéœ€è¦æŒ‡å®šå®ƒä»¬çš„æ¬¡åºï¼Œé‚£ä¹ˆè®¾ç½®<code>order</code>å±æ€§å³å¯ã€‚è¯·è®°ä½ï¼Œorderå±æ€§çš„å€¼è¶Šå¤§ï¼Œè¯¥è§†å›¾è§£æå™¨åœ¨é“¾ä¸­çš„ä½ç½®å°±è¶Šé åã€‚</p>
<p>åœ¨ä¸‹é¢çš„ä»£ç ä¾‹å­ä¸­ï¼Œè§†å›¾è§£æå™¨é“¾ä¸­åŒ…å«äº†ä¸¤ä¸ªè§£æå™¨ï¼šä¸€ä¸ªæ˜¯<code>InternalResourceViewResolver</code>ï¼Œå®ƒæ€»æ˜¯è‡ªåŠ¨è¢«æ”¾ç½®åœ¨è§£æå™¨é“¾çš„æœ€åï¼›å¦ä¸€ä¸ªæ˜¯<code>XmlViewResolver</code>ï¼Œå®ƒç”¨æ¥æŒ‡å®šExcelè§†å›¾ã€‚<code>InternalResourceViewResolver</code>ä¸æ”¯æŒExcelè§†å›¾ã€‚</p>
<pre><code class="lang-xml">&lt;bean id=&quot;jspViewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
    &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.JstlView&quot;/&gt;
    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;
    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
&lt;/bean&gt;

&lt;bean id=&quot;excelViewResolver&quot; class=&quot;org.springframework.web.servlet.view.XmlViewResolver&quot;&gt;
    &lt;property name=&quot;order&quot; value=&quot;1&quot;/&gt;
    &lt;property name=&quot;location&quot; value=&quot;/WEB-INF/views.xml&quot;/&gt;
&lt;/bean&gt;

&lt;!-- in views.xml --&gt;

&lt;beans&gt;
    &lt;bean name=&quot;report&quot; class=&quot;org.springframework.example.ReportExcelView&quot;/&gt;
&lt;/beans&gt;
</code></pre>
<p>å¦‚æœä¸€ä¸ªè§†å›¾è§£æå™¨ä¸èƒ½è¿”å›ä¸€ä¸ªè§†å›¾ï¼Œé‚£ä¹ˆSpringä¼šç»§ç»­æ£€æŸ¥ä¸Šä¸‹æ–‡ä¸­å…¶ä»–çš„è§†å›¾è§£æå™¨ã€‚æ­¤æ—¶å¦‚æœå­˜åœ¨å…¶ä»–çš„è§£æå™¨ï¼ŒSpringä¼šç»§ç»­è°ƒç”¨å®ƒä»¬ï¼Œç›´åˆ°äº§ç”Ÿä¸€ä¸ªè§†å›¾è¿”å›ä¸ºæ­¢ã€‚å¦‚æœæœ€åæ‰€æœ‰è§†å›¾è§£æå™¨éƒ½ä¸èƒ½è¿”å›ä¸€ä¸ªè§†å›¾ï¼ŒSpringå°±æŠ›å‡ºä¸€ä¸ª<code>ServletException</code>ã€‚</p>
<p>è§†å›¾è§£æå™¨çš„æ¥å£æ¸…æ¥šå£°æ˜äº†ï¼Œä¸€ä¸ªè§†å›¾è§£æå™¨æ˜¯<em>å¯ä»¥</em>è¿”å›nullå€¼çš„ï¼Œè¿™è¡¨ç¤ºä¸èƒ½æ‰¾åˆ°ä»»ä½•åˆé€‚çš„è§†å›¾ã€‚å¹¶éæ‰€æœ‰çš„è§†å›¾è§£æå™¨éƒ½è¿™ä¹ˆåšï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸å¾—ä¸å¦‚æ­¤çš„åœºæ™¯ï¼Œå³è§£æå™¨ç¡®å®æ— æ³•æ£€æµ‹å¯¹åº”çš„è§†å›¾æ˜¯å¦å­˜åœ¨ã€‚æ¯”å¦‚ï¼Œ<code>InternalResourceViewResolver</code>åœ¨å†…éƒ¨ä½¿ç”¨äº†<code>RequestDispatcher</code>ï¼Œå¹¶ä¸”è¿›å…¥åˆ†æ´¾è¿‡ç¨‹æ˜¯æ£€æµ‹ä¸€ä¸ªJSPè§†å›¾æ˜¯å¦å­˜åœ¨çš„å”¯ä¸€æ–¹æ³•ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹ä»…å¯èƒ½å‘ç”Ÿå”¯ä¸€ä¸€æ¬¡ã€‚åŒæ ·çš„<code>VelocityViewResolver</code>å’Œéƒ¨åˆ†å…¶ä»–çš„è§†å›¾è§£æå™¨ä¹Ÿå­˜åœ¨è¿™æ ·çš„æƒ…å†µã€‚å…·ä½“çš„è¯·æŸ¥é˜…æŸä¸ªç‰¹å®šçš„è§†å›¾è§£æå™¨çš„Javaæ–‡æ¡£ï¼Œçœ‹å®ƒæ˜¯å¦ä¼šreportä¸å­˜åœ¨çš„è§†å›¾ã€‚å› æ­¤ï¼Œå¦‚æœä¸æŠŠ<code>InternalResourceViewResolver</code>æ”¾ç½®åœ¨è§£æå™¨é“¾çš„æœ€åï¼Œå°†å¯èƒ½å¯¼è‡´è§£æå™¨é“¾æ— æ³•å®Œå…¨æ‰§è¡Œï¼Œå› ä¸º<code>InternalResourceViewResolver</code><em>æ°¸è¿œéƒ½ä¼š</em> è¿”å›ä¸€ä¸ªè§†å›¾ã€‚</p>
</section<section><h1 id="21-5-3-">21.5.3 è§†å›¾é‡å®šå‘</h1>
<p>å¦‚å‰æ‰€è¿°ï¼Œæ§åˆ¶å™¨é€šå¸¸éƒ½ä¼šè¿”å›ä¸€ä¸ªé€»è¾‘è§†å›¾åï¼Œç„¶åè§†å›¾è§£æå™¨ä¼šæŠŠå®ƒè§£æåˆ°ä¸€ä¸ªå…·ä½“çš„è§†å›¾æŠ€æœ¯ä¸Šå»æ¸²æŸ“ã€‚å¯¹äºä¸€äº›å¯ä»¥ç”±Servletæˆ–JSPå¼•æ“æ¥å¤„ç†çš„è§†å›¾æŠ€æœ¯ï¼Œæ¯”å¦‚JSPç­‰ï¼Œè¿™ä¸ªè§£æè¿‡ç¨‹é€šå¸¸æ˜¯ç”±<code>InternalResourceViewResolver</code>å’Œ<code>InternalResourceView</code>åä½œæ¥å®Œæˆçš„ï¼Œè€Œè¿™é€šå¸¸ä¼šè°ƒç”¨Servletçš„API<code>RequestDispatcher.forward(..)</code>æ–¹æ³•æˆ–<code>RequestDispatcher.include(..)</code>æ–¹æ³•ï¼Œå¹¶å‘ç”Ÿä¸€æ¬¡å†…éƒ¨çš„è½¬å‘ï¼ˆforwardï¼‰æˆ–å¼•ç”¨ï¼ˆincludeï¼‰ã€‚è€Œå¯¹äºå…¶ä»–çš„è§†å›¾æŠ€æœ¯ï¼Œæ¯”å¦‚Velocityã€XSLTç­‰ï¼Œè§†å›¾æœ¬èº«çš„å†…å®¹æ˜¯ç›´æ¥è¢«å†™å›å“åº”æµä¸­çš„ã€‚</p>
<p>æœ‰æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨è§†å›¾æ¸²æŸ“ä¹‹å‰ï¼Œå…ˆæŠŠä¸€ä¸ªHTTPé‡å®šå‘è¯·æ±‚å‘é€å›å®¢æˆ·ç«¯ã€‚æ¯”å¦‚ï¼Œå½“ä¸€ä¸ªæ§åˆ¶å™¨æˆåŠŸåœ°æ¥å—åˆ°äº†<code>POST</code>è¿‡æ¥çš„æ•°æ®ï¼Œè€Œå“åº”ä»…ä»…æ˜¯å§”æ‰˜å¦ä¸€ä¸ªæ§åˆ¶å™¨æ¥å¤„ç†ï¼ˆæ¯”å¦‚ä¸€æ¬¡æˆåŠŸçš„è¡¨å•æäº¤ï¼‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å‘ç”Ÿä¸€æ¬¡é‡å®šå‘ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå¦‚æœåªæ˜¯ç®€å•åœ°ä½¿ç”¨å†…éƒ¨è½¬å‘ï¼Œé‚£ä¹ˆæ„å‘³ç€ä¸‹ä¸€ä¸ªæ§åˆ¶å™¨ä¹Ÿèƒ½çœ‹åˆ°è¿™æ¬¡<code>POST</code>è¯·æ±‚æºå¸¦çš„æ•°æ®ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸€äº›æ½œåœ¨çš„é—®é¢˜ï¼Œæ¯”å¦‚å¯èƒ½ä¼šä¸å…¶ä»–æœŸæœ›çš„æ•°æ®æ··æ·†ï¼Œç­‰ã€‚æ­¤å¤–ï¼Œå¦ä¸€ç§åœ¨æ¸²æŸ“è§†å›¾å‰å¯¹è¯·æ±‚è¿›è¡Œé‡å®šå‘çš„éœ€æ±‚æ˜¯ï¼Œé˜²æ­¢ç”¨æˆ·å¤šæ¬¡æäº¤è¡¨å•çš„æ•°æ®ã€‚æ­¤æ—¶è‹¥ä½¿ç”¨é‡å®šå‘ï¼Œåˆ™æµè§ˆå™¨ä¼šå…ˆå‘é€ç¬¬ä¸€ä¸ª<code>POST</code>è¯·æ±‚ï¼›è¯·æ±‚è¢«å¤„ç†åæµè§ˆå™¨ä¼šæ”¶åˆ°ä¸€ä¸ªé‡å®šå‘å“åº”ï¼Œç„¶åæµè§ˆå™¨ç›´æ¥è¢«é‡å®šå‘åˆ°ä¸€ä¸ªä¸åŒçš„URLï¼Œæœ€åæµè§ˆå™¨ä¼šä½¿ç”¨é‡å®šå‘å“åº”ä¸­æºå¸¦çš„URLå‘èµ·ä¸€æ¬¡<code>GET</code>è¯·æ±‚ã€‚å› æ­¤ï¼Œä»æµè§ˆå™¨çš„è§’åº¦çœ‹ï¼Œå½“å‰æ‰€è§çš„é¡µé¢å¹¶ä¸æ˜¯<code>POST</code>è¯·æ±‚çš„ç»“æœï¼Œè€Œæ˜¯ä¸€æ¬¡<code>GET</code>è¯·æ±‚çš„ç»“æœã€‚è¿™å°±é˜²æ­¢äº†ç”¨æˆ·å› åˆ·æ–°ç­‰åŸå› æ„å¤–åœ°æäº¤äº†å¤šæ¬¡åŒæ ·çš„æ•°æ®ã€‚æ­¤æ—¶åˆ·æ–°ä¼šé‡æ–°<code>GET</code>ä¸€æ¬¡ç»“æœé¡µï¼Œè€Œä¸æ˜¯æŠŠåŒæ ·çš„<code>POST</code>æ•°æ®å†å‘é€ä¸€éã€‚</p>
<h2 id="-redirectview">é‡å®šå‘è§†å›¾ RedirectView</h2>
<p>å¼ºåˆ¶é‡å®šå‘çš„ä¸€ç§æ–¹æ³•æ˜¯ï¼Œåœ¨æ§åˆ¶å™¨ä¸­åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªSpringé‡å®šå‘è§†å›¾<code>RedirectView</code>çš„å®ä¾‹ã€‚å®ƒä¼šä½¿å¾—<code>DispatcherServlet</code>æ”¾å¼ƒä½¿ç”¨ä¸€èˆ¬çš„è§†å›¾è§£ææœºåˆ¶ï¼Œå› ä¸ºä½ å·²ç»è¿”å›ä¸€ä¸ªï¼ˆé‡å®šå‘ï¼‰è§†å›¾ç»™<code>DispatcherServlet</code>äº†ï¼Œæ‰€ä»¥å®ƒä¼šæ„é€ ä¸€ä¸ªè§†å›¾æ¥æ»¡è¶³æ¸²æŸ“çš„éœ€æ±‚ã€‚ç´§æ¥ç€<code>RedirectView</code>ä¼šè°ƒç”¨<code>HttpServletResponse.sendRedirect()</code>æ–¹æ³•ï¼Œå‘é€ä¸€ä¸ªHTTPé‡å®šå‘å“åº”ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚</p>
<p>å¦‚æœä½ å†³å®šè¿”å›<code>RedirectView</code>ï¼Œå¹¶ä¸”è¿™ä¸ªè§†å›¾å®ä¾‹æ˜¯ç”±æ§åˆ¶å™¨å†…éƒ¨åˆ›å»ºå‡ºæ¥çš„ï¼Œé‚£æˆ‘ä»¬æ›´æ¨èåœ¨å¤–éƒ¨é…ç½®é‡å®šå‘URLç„¶åæ³¨å…¥åˆ°æ§åˆ¶å™¨ä¸­æ¥ï¼Œè€Œä¸æ˜¯å†™åœ¨æ§åˆ¶å™¨é‡Œé¢ã€‚è¿™æ ·å®ƒå°±å¯ä»¥ä¸è§†å›¾åä¸€èµ·åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ã€‚å…³äºå¦‚ä½•å®ç°è¿™ä¸ªè§£è€¦ï¼Œè¯·å‚è€ƒ <a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-redirecting-redirect-prefix" title="The redirect: prefix">é‡å®šå‘å‰ç¼€â€”â€”redirect:</a>ä¸€å°èŠ‚ã€‚</p>
<h2 id="-">å‘é‡å®šå‘ç›®æ ‡ä¼ é€’æ•°æ®</h2>
<p>æ¨¡å‹ä¸­çš„æ‰€æœ‰å±æ€§é»˜è®¤éƒ½ä¼šè€ƒè™‘ä½œä¸ºURIæ¨¡æ¿å˜é‡è¢«æ·»åŠ åˆ°é‡å®šå‘URLä¸­ã€‚å‰©ä¸‹çš„å…¶ä»–å±æ€§ï¼Œå¦‚æœæ˜¯åŸºæœ¬ç±»å‹æˆ–è€…åŸºæœ¬ç±»å‹çš„é›†åˆæˆ–æ•°ç»„ï¼Œé‚£å®ƒä»¬å°†è¢«è‡ªåŠ¨æ·»åŠ åˆ°URLçš„æŸ¥è¯¢å‚æ•°ä¸­å»ã€‚å¦‚æœmodelæ˜¯ä¸“é—¨ä¸ºè¯¥é‡å®šå‘æ‰€å‡†å¤‡çš„ï¼Œé‚£ä¹ˆæŠŠæ‰€æœ‰åŸºæœ¬ç±»å‹çš„å±æ€§æ·»åŠ åˆ°æŸ¥è¯¢å‚æ•°ä¸­å¯èƒ½æ˜¯æˆ‘ä»¬æœŸæœ›é‚£ä¸ªçš„ç»“æœã€‚ä½†æ˜¯ï¼Œåœ¨åŒ…å«æ³¨è§£çš„æ§åˆ¶å™¨ä¸­ï¼Œmodelå¯èƒ½åŒ…å«äº†ä¸“é—¨ä½œä¸ºæ¸²æŸ“ç”¨é€”çš„å±æ€§ï¼ˆæ¯”å¦‚ä¸€ä¸ªä¸‹æ‹‰åˆ—è¡¨çš„å­—æ®µå€¼ç­‰ï¼‰ã€‚ä¸ºäº†é¿å…æŠŠè¿™æ ·çš„å±æ€§ä¹Ÿæš´éœ²åœ¨URLä¸­ï¼Œ<code>@RequestMapping</code>æ–¹æ³•å¯ä»¥å£°æ˜ä¸€ä¸ª<code>RedirectAttributes</code>ç±»å‹çš„æ–¹æ³•å‚æ•°ï¼Œç”¨å®ƒæ¥æŒ‡å®šä¸“é—¨ä¾›é‡å®šå‘è§†å›¾<code>RedirectView</code>å–ç”¨çš„å±æ€§ã€‚å¦‚æœé‡å®šå‘æˆåŠŸå‘ç”Ÿï¼Œé‚£ä¹ˆ<code>RedirectAttributes</code>å¯¹è±¡ä¸­çš„å†…å®¹å°±ä¼šè¢«ä½¿ç”¨ï¼›å¦åˆ™åˆ™ä½¿ç”¨æ¨¡å‹modelä¸­çš„æ•°æ®ã€‚</p>
<p><code>RequestMappingHandlerAdapter</code>æä¾›äº†ä¸€ä¸ª<code>&quot;ignoreDefaultModelOnRedirect&quot;</code>æ ‡å¿—ã€‚å®ƒè¢«ç”¨æ¥æ ‡è®°é»˜è®¤<code>Model</code>ä¸­çš„å±æ€§æ°¸è¿œä¸åº”è¯¥è¢«ç”¨äºæ§åˆ¶å™¨æ–¹æ³•çš„é‡å®šå‘ä¸­ã€‚æ§åˆ¶å™¨æ–¹æ³•åº”è¯¥å£°æ˜ä¸€ä¸ª<code>RedirectAttributes</code>ç±»çš„å‚æ•°ã€‚å¦‚æœä¸å£°æ˜ï¼Œé‚£å°±æ²¡æœ‰å‚æ•°è¢«ä¼ é€’åˆ°é‡å®šå‘çš„è§†å›¾<code>RedirectView</code>ä¸­ã€‚åœ¨MVCå‘½åç©ºé—´æˆ–MVC Javaç¼–ç¨‹é…ç½®æ–¹å¼ä¸­ï¼Œä¸ºäº†ç»´æŒå‘åçš„å…¼å®¹æ€§ï¼Œè¿™ä¸ªæ ‡å¿—éƒ½ä»è¢«ä¿æŒä¸º<code>false</code>ã€‚ä½†å¦‚æœä½ çš„åº”ç”¨æ˜¯ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¨èæŠŠå®ƒçš„å€¼è®¾ç½®æˆ<code>true</code>ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œå½“å‰è¯·æ±‚URIä¸­çš„æ¨¡æ¿å˜é‡ä¼šåœ¨å¡«å……é‡å®šå‘URLçš„æ—¶å€™è‡ªåŠ¨å¯¹åº”ç”¨å¯è§ï¼Œè€Œä¸éœ€è¦æ˜¾å¼åœ°åœ¨<code>Model</code>æˆ–<code>RedirectAttributes</code>ä¸­å†æ·»åŠ å±æ€§ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<pre><code class="lang-java">@RequestMapping(path = &quot;/files/{path}&quot;, method = RequestMethod.POST)
public String upload(...) {
    // ...
    return &quot;redirect:files/{path}&quot;;
}
</code></pre>
<p>å¦å¤–ä¸€ç§å‘é‡å®šå‘ç›®æ ‡ä¼ é€’æ•°æ®çš„æ–¹æ³•æ˜¯é€šè¿‡ <em>é—ªå­˜å±æ€§ï¼ˆFlash Attributesï¼‰</em>ã€‚ä¸å…¶ä»–é‡å®šå‘å±æ€§ä¸åŒï¼Œflashå±æ€§æ˜¯å­˜å‚¨åœ¨HTTP sessionä¸­çš„ï¼ˆå› æ­¤ä¸ä¼šå‡ºç°åœ¨URLä¸­ï¼‰ã€‚æ›´å¤šå†…å®¹ï¼Œè¯·å‚è€ƒ <a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-flash-attributes" title="21.6 Using flash attributes">21.6 ä½¿ç”¨é—ªå­˜å±æ€§</a>ä¸€èŠ‚ã€‚</p>
<h2 id="-redirect-">é‡å®šå‘å‰ç¼€â€”â€”redirect:</h2>
<p>å°½ç®¡ä½¿ç”¨<code>RedirectView</code>æ¥åšé‡å®šå‘èƒ½å·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†å¦‚æœæ§åˆ¶å™¨è‡ªèº«è¿˜æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ª<code>RedirectView</code>ï¼Œé‚£æ— ç–‘æ§åˆ¶å™¨è¿˜æ˜¯äº†è§£é‡å®šå‘è¿™ä¹ˆä¸€ä»¶äº‹æƒ…çš„å‘ç”Ÿã€‚è¿™è¿˜æ˜¯æœ‰ç‚¹ä¸å°½å®Œç¾ï¼Œä¸åŒèŒƒç•´çš„è€¦åˆè¿˜æ˜¯å¤ªå¼ºã€‚æ§åˆ¶å™¨å…¶å®ä¸åº”è¯¥å»å…³å¿ƒå“åº”ä¼šå¦‚ä½•è¢«æ¸²æŸ“ã€‚In general it should operate only in terms of view names that have been injected into it.</p>
<p>ä¸€ä¸ªç‰¹åˆ«çš„è§†å›¾åå‰ç¼€èƒ½å®Œæˆè¿™ä¸ªè§£è€¦ï¼š<code>redirect:</code>ã€‚å¦‚æœè¿”å›çš„è§†å›¾åä¸­å«æœ‰<code>redirect:</code>å‰ç¼€ï¼Œé‚£ä¹ˆ<code>UrlBasedViewResolver</code>ï¼ˆåŠå®ƒçš„æ‰€æœ‰å­ç±»ï¼‰å°±ä¼šæ¥å—åˆ°è¿™ä¸ªä¿¡å·ï¼Œæ„è¯†åˆ°è¿™é‡Œéœ€è¦å‘ç”Ÿé‡å®šå‘ã€‚ç„¶åè§†å›¾åå‰©ä¸‹çš„éƒ¨åˆ†ä¼šè¢«è§£ææˆé‡å®šå‘URLã€‚</p>
<p>è¿™ç§æ–¹å¼ä¸é€šè¿‡æ§åˆ¶å™¨è¿”å›ä¸€ä¸ªé‡å®šå‘è§†å›¾<code>RedirectView</code>æ‰€è¾¾åˆ°çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡è¿™æ ·ä¸€æ¥æ§åˆ¶å™¨å°±å¯ä»¥åªä¸“æ³¨äºå¤„ç†å¹¶è¿”å›é€»è¾‘è§†å›¾åäº†ã€‚å¦‚æœé€»è¾‘è§†å›¾åæ˜¯è¿™æ ·çš„å½¢å¼ï¼š<code>redirect:/myapp/some/resource</code>ï¼Œä»–ä»¬é‡å®šå‘è·¯å¾„å°†ä»¥Servletä¸Šä¸‹æ–‡ä½œä¸ºç›¸å¯¹è·¯å¾„è¿›è¡ŒæŸ¥æ‰¾ï¼Œè€Œé€»è¾‘è§†å›¾åå¦‚æœæ˜¯è¿™æ ·çš„å½¢å¼ï¼š<code>redirect:http://myhost.com/some/arbitrary/path</code>ï¼Œé‚£ä¹ˆé‡å®šå‘URLä½¿ç”¨çš„å°±æ˜¯ç»å¯¹è·¯å¾„ã€‚</p>
<p>æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ§åˆ¶å™¨æ–¹æ³•æ³¨è§£äº†<code>@ResponseStatus</code>ï¼Œé‚£ä¹ˆæ³¨è§£è®¾ç½®çš„çŠ¶æ€ç å€¼ä¼šè¦†ç›–<code>RedirectView</code>è®¾ç½®çš„å“åº”çŠ¶æ€ç å€¼ã€‚</p>
<h2 id="-forward-">é‡å®šå‘å‰ç¼€â€”â€”forward:</h2>
<p>å¯¹äºæœ€ç»ˆä¼šè¢«<code>UrlBasedViewResolver</code>æˆ–å…¶å­ç±»è§£æçš„è§†å›¾åï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‰ç¼€ï¼š<code>forward:</code>ã€‚è¿™ä¼šå¯¼è‡´ä¸€ä¸ª<code>InternalResourceView</code>è§†å›¾å¯¹è±¡çš„åˆ›å»ºï¼ˆå®ƒæœ€ç»ˆä¼šè°ƒç”¨<code>RequestDispatcher.forward()</code>æ–¹æ³•ï¼‰ï¼Œåè€…ä¼šè®¤ä¸ºè§†å›¾åå‰©ä¸‹çš„éƒ¨åˆ†æ˜¯ä¸€ä¸ªURLã€‚å› æ­¤ï¼Œè¿™ä¸ªå‰ç¼€åœ¨ä½¿ç”¨<code>InternalResourceViewResolver</code>å’Œ<code>InternalResourceView</code>æ—¶å¹¶æ²¡æœ‰ç‰¹åˆ«çš„ä½œç”¨ï¼ˆæ¯”å¦‚å¯¹äºJSPæ¥è¯´ï¼‰ã€‚ä½†å½“ä½ ä¸»è¦ä½¿ç”¨çš„æ˜¯å…¶ä»–çš„è§†å›¾æŠ€æœ¯ï¼Œè€Œåˆæƒ³è¦å¼ºåˆ¶æŠŠä¸€ä¸ªèµ„æºè½¬å‘ç»™Servlet/JSPå¼•æ“è¿›è¡Œå¤„ç†æ—¶ï¼Œè¿™ä¸ªå‰ç¼€å¯èƒ½å°±å¾ˆæœ‰ç”¨ï¼ˆæˆ–è€…ï¼Œä½ ä¹Ÿå¯èƒ½åŒæ—¶ä¸²è”å¤šä¸ªè§†å›¾è§£æå™¨ï¼‰ã€‚</p>
<p>ä¸<code>redirect:</code>å‰ç¼€ä¸€æ ·ï¼Œå¦‚æœæ§åˆ¶å™¨ä¸­çš„è§†å›¾åä½¿ç”¨äº†<code>forward:</code>å‰ç¼€ï¼Œæ§åˆ¶å™¨æœ¬èº«å¹¶ä¸ä¼šå‘è§‰ä»»ä½•å¼‚å¸¸ï¼Œå®ƒå…³æ³¨çš„ä»ç„¶åªæ˜¯å¦‚ä½•å¤„ç†å“åº”çš„é—®é¢˜ã€‚</p>
</section<section><h1 id="21-5-4-contentnegotiatingviewresolver">21.5.4 å†…å®¹åå•†è§£æå™¨ContentNegotiatingViewResolver</h1>
<p><code>ContentNegotiatingViewResolver</code>è‡ªå·±å¹¶ä¸ä¼šè§£æè§†å›¾ï¼Œè€Œæ˜¯å§”æ‰˜ç»™å…¶ä»–çš„è§†å›¾è§£æå™¨å»å¤„ç†ã€‚</p>
<p>The <code>ContentNegotiatingViewResolver</code> does not resolve views itself but rather
delegates to other view resolvers, selecting the view that resembles the
representation requested by the client. Two strategies exist for a client to
request a representation from the server:</p>
<ul>
<li>Use a distinct URI for each resource, typically by using a different file extension in the URI. For example, the URI <code>&lt;http://www.example.com/users/fred.pdf&gt;</code> requests a PDF representation of the user fred, and <code>&lt;http://www.example.com/users/fred.xml&gt;</code> requests an XML representation.</li>
<li>Use the same URI for the client to locate the resource, but set the <code>Accept</code> HTTP request header to list the <a href="http://en.wikipedia.org/wiki/Internet_media_type">media types</a> that it understands. For example, an HTTP request for <code>&lt;http://www.example.com/users/fred&gt;</code> with an <code>Accept</code> header set to <code>application/pdf</code> requests a PDF representation of the user fred, while <code>&lt;http://www.example.com/users/fred&gt;</code> with an <code>Accept</code> header set to <code>text/xml</code> requests an XML representation. This strategy is known as <a href="http://en.wikipedia.org/wiki/Content_negotiation">content negotiation</a>.</li>
</ul>
<table>
<thead>
<tr>
<th><img src="images/note.png" alt="\[Note\]"></th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>One issue with the <code>Accept</code> header is that it is impossible to set it in a web
browser within HTML. For example, in Firefox, it is fixed to:</p>
<pre><code>    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
</code></pre><p>For this reason it is common to see the use of a distinct URI for each
representation when developing browser based web applications.</p>
<p>To support multiple representations of a resource, Spring provides the
<code>ContentNegotiatingViewResolver</code> to resolve a view based on the file extension
or <code>Accept</code> header of the HTTP request. <code>ContentNegotiatingViewResolver</code> does
not perform the view resolution itself but instead delegates to a list of view
resolvers that you specify through the bean property <code>ViewResolvers</code>.</p>
<p>The <code>ContentNegotiatingViewResolver</code> selects an appropriate <code>View</code> to handle
the request by comparing the request media type(s) with the media type (also
known as <code>Content-Type</code>) supported by the <code>View</code> associated with each of its
<code>ViewResolvers</code>. The first <code>View</code> in the list that has a compatible <code>Content-
Type</code> returns the representation to the client. If a compatible view cannot be
supplied by the <code>ViewResolver</code> chain, then the list of views specified through
the <code>DefaultViews</code> property will be consulted. This latter option is
appropriate for singleton <code>Views</code> that can render an appropriate
representation of the current resource regardless of the logical view name.
The <code>Accept</code> header may include wild cards, for example <code>text/*</code>, in which
case a <code>View</code> whose Content-Type was <code>text/xml</code> is a compatible match.</p>
<p>To support custom resolution of a view based on a file extension, use a
<code>ContentNegotiationManager</code>: see <a href="mvc.html#mvc-config-content-negotiation" title="21.16.6 Content
Negotiation">Section 21.16.6, &quot;Content
Negotiation&quot;</a>.</p>
<p>Here is an example configuration of a <code>ContentNegotiatingViewResolver</code>:</p>
<pre><code class="lang-xml">&lt;bean class=&quot;org.springframework.web.servlet.view.ContentNegotiatingViewResolver&quot;&gt;
    &lt;property name=&quot;viewResolvers&quot;&gt;
        &lt;list&gt;
            &lt;bean class=&quot;org.springframework.web.servlet.view.BeanNameViewResolver&quot;/&gt;
            &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
                &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;
                &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
            &lt;/bean&gt;
        &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name=&quot;defaultViews&quot;&gt;
        &lt;list&gt;
            &lt;bean class=&quot;org.springframework.web.servlet.view.json.MappingJackson2JsonView&quot;/&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id=&quot;content&quot; class=&quot;com.foo.samples.rest.SampleContentAtomView&quot;/&gt;
</code></pre>
<p>The <code>InternalResourceViewResolver</code> handles the translation of view names and
JSP pages, while the <code>BeanNameViewResolver</code> returns a view based on the name
of a bean. (See &quot;[Resolving views with the ViewResolver interface](mvc.html</p>
<p>#mvc-viewresolver-resolver &quot;21.5.1 Resolving views with the ViewResolver
interface&quot; )&quot; for more details on how Spring looks up and instantiates a
view.) In this example, the <code>content</code> bean is a class that inherits from
<code>AbstractAtomFeedView</code>, which returns an Atom RSS feed. For more information
on creating an Atom Feed representation, see the section Atom Views.</p>
<p>In the above configuration, if a request is made with an <code>.html</code> extension,
the view resolver looks for a view that matches the <code>text/html</code> media type.
The <code>InternalResourceViewResolver</code> provides the matching view for <code>text/html</code>.
If the request is made with the file extension <code>.atom</code>, the view resolver
looks for a view that matches the <code>application/atom+xml</code> media type. This view
is provided by the <code>BeanNameViewResolver</code> that maps to the
<code>SampleContentAtomView</code> if the view name returned is <code>content</code>. If the request
is made with the file extension <code>.json</code>, the <code>MappingJackson2JsonView</code>
instance from the <code>DefaultViews</code> list will be selected regardless of the view
name. Alternatively, client requests can be made without a file extension but
with the <code>Accept</code> header set to the preferred media-type, and the same
resolution of request to views would occur.</p>
<table>
<thead>
<tr>
<th><img src="images/note.png" alt="\[Note\]"></th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>If `ContentNegotiatingViewResolver&#39;s list of ViewResolvers is not configured
explicitly, it automatically uses any ViewResolvers defined in the application
context.</p>
<p>The corresponding controller code that returns an Atom RSS feed for a URI of
the form <code>&lt;http://localhost/content.atom&gt;</code> or <code>&lt;http://localhost/content&gt;</code>
with an <code>Accept</code> header of application/atom+xml is shown below.</p>
<pre><code class="lang-java">@Controller
public class ContentController {

    private List&lt;SampleContent&gt; contentList = new ArrayList&lt;SampleContent&gt;();

    @RequestMapping(path=&quot;/content&quot;, method=RequestMethod.GET)
    public ModelAndView getContent() {
        ModelAndView mav = new ModelAndView();
        mav.setViewName(&quot;content&quot;);
        mav.addObject(&quot;sampleContentList&quot;, contentList);
        return mav;
    }

}
</code></pre>
</section<section><h1 id="21-6-flashattributes">21.6 ä½¿ç”¨é—ªå­˜å±æ€§FlashAttributes</h1>
<p>Flashå±æ€§ï¼ˆflash attributesï¼‰æä¾›äº†ä¸€ä¸ªè¯·æ±‚ä¸ºå¦ä¸€ä¸ªè¯·æ±‚å­˜å‚¨æœ‰ç”¨å±æ€§çš„æ–¹æ³•ã€‚è¿™åœ¨é‡å®šå‘çš„æ—¶å€™æœ€å¸¸ä½¿ç”¨ï¼Œæ¯”å¦‚å¸¸è§çš„ <em>POST/REDIRECT/GET</em> æ¨¡å¼ã€‚Flashå±æ€§ä¼šåœ¨é‡å®šå‘å‰è¢«æš‚æ—¶åœ°ä¿å­˜èµ·æ¥ï¼ˆé€šå¸¸æ˜¯ä¿å­˜åœ¨sessionä¸­ï¼‰ï¼Œé‡å®šå‘åä¼šé‡æ–°è¢«ä¸‹ä¸€ä¸ªè¯·æ±‚å–ç”¨å¹¶ç«‹å³ä»åŸä¿å­˜åœ°ç§»é™¤ã€‚</p>
<p>ä¸ºæ”¯æŒflashå±æ€§ï¼ŒSpring MVCæä¾›äº†ä¸¤ä¸ªæŠ½è±¡ã€‚<code>FlashMap</code>è¢«ç”¨æ¥å­˜å‚¨flashå±æ€§ï¼Œè€Œç”¨<code>FlashMapManager</code>æ¥å­˜å‚¨ã€å–å›ã€ç®¡ç†<code>FlashMap</code>çš„å®ä¾‹ã€‚</p>
<p>å¯¹flashå±æ€§çš„æ”¯æŒé»˜è®¤æ˜¯å¯ç”¨çš„ï¼Œå¹¶ä¸éœ€è¦æ˜¾å¼å£°æ˜ï¼Œä¸è¿‡æ²¡ç”¨åˆ°å®ƒæ—¶å®ƒç»ä¸ä¼šä¸»åŠ¨åœ°å»åˆ›å»ºHTTPä¼šè¯ï¼ˆsessionï¼‰ã€‚å¯¹äºæ¯ä¸ªè¯·æ±‚ï¼Œæ¡†æ¶éƒ½ä¼šâ€œä¼ è¿›â€ä¸€ä¸ª<code>FlashMap</code>ï¼Œé‡Œé¢å­˜å‚¨äº†ä»ä¸Šä¸ªè¯·æ±‚ï¼ˆå¦‚æœæœ‰ï¼‰ä¿å­˜ä¸‹æ¥çš„å±æ€§ï¼›åŒæ—¶ï¼Œæ¯ä¸ªè¯·æ±‚ä¹Ÿä¼šâ€œè¾“å‡ºâ€ä¸€ä¸ª<code>FlashMap</code>ï¼Œé‡Œé¢ä¿å­˜äº†è¦ç»™ä¸‹ä¸ªè¯·æ±‚ä½¿ç”¨çš„å±æ€§ã€‚ä¸¤ä¸ª<code>FlashMap</code>å®ä¾‹åœ¨Spring MVCåº”ç”¨ä¸­çš„ä»»ä½•åœ°ç‚¹éƒ½å¯ä»¥é€šè¿‡<code>RequestContextUtils</code>å·¥å…·ç±»çš„é™æ€æ–¹æ³•å–å¾—ã€‚</p>
<p>æ§åˆ¶å™¨é€šå¸¸ä¸éœ€è¦ç›´æ¥æ¥è§¦<code>FlashMap</code>ã€‚ä¸€èˆ¬æ˜¯é€šè¿‡<code>@RequestMapping</code>æ–¹æ³•å»æ¥å—ä¸€ä¸ª<code>RedirectAttributes</code>ç±»å‹çš„å‚æ•°ï¼Œç„¶åç›´æ¥åœ°å¾€å…¶ä¸­æ·»åŠ flashå±æ€§ã€‚é€šè¿‡<code>RedirectAttributes</code>å¯¹è±¡æ·»åŠ è¿›å»çš„flashå±æ€§ä¼šè‡ªåŠ¨è¢«å¡«å……åˆ°è¯·æ±‚çš„â€œè¾“å‡ºâ€<code>FlashMap</code>å¯¹è±¡ä¸­å»ã€‚ç±»ä¼¼åœ°ï¼Œé‡å®šå‘åâ€œä¼ è¿›â€çš„<code>FlashMap</code>å±æ€§ä¹Ÿä¼šè‡ªåŠ¨è¢«æ·»åŠ åˆ°æœåŠ¡é‡å®šå‘URLçš„æ§åˆ¶å™¨å‚æ•°<code>Model</code>ä¸­å»ã€‚</p>
<p><strong>åŒ¹é…è¯·æ±‚æ‰€ä½¿ç”¨çš„flashå±æ€§</strong></p>
<p>flashå±æ€§çš„æ¦‚å¿µåœ¨å…¶ä»–è®¸å¤šçš„Webæ¡†æ¶ä¸­ä¹Ÿå­˜åœ¨ï¼Œå¹¶ä¸”å®è·µè¯æ˜æœ‰æ—¶å¯èƒ½ä¼šå¯¼è‡´å¹¶å‘ä¸Šçš„é—®é¢˜ã€‚è¿™æ˜¯å› ä¸ºä»å®šä¹‰ä¸Šè®²ï¼Œflashå±æ€§ä¿å­˜çš„æ—¶é—´æ˜¯åˆ°ä¸‹ä¸ªè¯·æ±‚æ¥æ”¶åˆ°ä¹‹å‰ã€‚é—®é¢˜åœ¨äºï¼Œâ€œä¸‹ä¸€ä¸ªâ€è¯·æ±‚ä¸ä¸€å®šåˆšå¥½å°±æ˜¯ä½ è¦é‡å®šå‘åˆ°çš„é‚£ä¸ªè¯·æ±‚ï¼Œå®ƒæœ‰å¯èƒ½æ˜¯å…¶ä»–çš„å¼‚æ­¥è¯·æ±‚ï¼ˆæ¯”å¦‚pollingè¯·æ±‚æˆ–è€…èµ„æºè¯·æ±‚ç­‰ï¼‰ã€‚è¿™ä¼šå¯¼è‡´flashå±æ€§åœ¨åˆ°è¾¾çœŸæ­£çš„ç›®æ ‡è¯·æ±‚å‰å°±è¢«ç§»é™¤äº†ã€‚</p>
<p>ä¸ºäº†å‡å°‘è¿™ä¸ªé—®é¢˜å‘ç”Ÿçš„å¯èƒ½æ€§ï¼Œé‡å®šå‘è§†å›¾<code>RedirectView</code>ä¼šè‡ªåŠ¨ä¸ºä¸€ä¸ª<code>FlashMap</code>å®ä¾‹è®°å½•å…¶ç›®æ ‡é‡å®šå‘URLçš„è·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°ã€‚ç„¶åï¼Œé»˜è®¤çš„<code>FlashMapManager</code>ä¼šåœ¨ä¸ºè¯·æ±‚æŸ¥æ‰¾å…¶è¯¥â€œä¼ è¿›â€çš„<code>FlashMap</code>æ—¶ï¼ŒåŒ¹é…è¿™äº›ä¿¡æ¯ã€‚</p>
<p>è¿™å¹¶ä¸èƒ½å®Œå…¨è§£å†³é‡å®šå‘çš„å¹¶å‘é—®é¢˜ï¼Œä½†æå¤§ç¨‹åº¦åœ°å‡å°‘äº†è¿™ç§å¯èƒ½æ€§ï¼Œå› ä¸ºå®ƒå¯ä»¥ä»é‡å®šå‘URLå·²æœ‰çš„ä¿¡æ¯ä¸­æ¥åšåŒ¹é…ã€‚å› æ­¤ï¼Œä¸€èˆ¬åªæœ‰åœ¨é‡å®šå‘çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æ‰æ¨èä½¿ç”¨flashå±æ€§ã€‚</p>
</section<section><h1 id="21-7-uri-">21.7 URIæ„é€ </h1>
<p>åœ¨Spring MVCä¸­ï¼Œä½¿ç”¨äº†<code>UriComponentsBuilder</code>å’Œ<code>UriComponents</code>ä¸¤ä¸ªç±»æ¥æä¾›ä¸€ç§æ„é€ å’ŒåŠ å¯†URIçš„æœºåˆ¶ã€‚</p>
<p>æ¯”å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªURIæ¨¡æ¿å­—ç¬¦ä¸²æ¥å¡«å……å¹¶åŠ å¯†ä¸€ä¸ªURIï¼š</p>
<pre><code class="lang-java">UriComponents uriComponents = UriComponentsBuilder.fromUriString(
        &quot;http://example.com/hotels/{hotel}/bookings/{booking}&quot;).build();

URI uri = uriComponents.expand(&quot;42&quot;, &quot;21&quot;).encode().toUri();
</code></pre>
<p>è¯·æ³¨æ„<code>UriComponents</code>æ˜¯ä¸å¯å˜å¯¹è±¡ã€‚å› æ­¤<code>expand()</code>ä¸<code>encode()</code>æ“ä½œåœ¨å¿…è¦çš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªURIç»„ä»¶å®ä¾‹å¯¹è±¡æ¥å®ç°URIçš„å¡«å……ä¸åŠ å¯†ï¼š</p>
<pre><code class="lang-java">UriComponents uriComponents = UriComponentsBuilder.newInstance()
        .scheme(&quot;http&quot;).host(&quot;example.com&quot;).path(&quot;/hotels/{hotel}/bookings/{booking}&quot;).build()
        .expand(&quot;42&quot;, &quot;21&quot;)
        .encode();
</code></pre>
<p>åœ¨Servletç¯å¢ƒä¸‹ï¼Œ<code>ServletUriComponentsBuilder</code>ç±»æä¾›äº†ä¸€ä¸ªé™æ€çš„å·¥å‚æ–¹æ³•ï¼Œå¯ä»¥ç”¨äºä»Servletè¯·æ±‚ä¸­è·å–URLä¿¡æ¯ï¼š</p>
<pre><code class="lang-java">HttpServletRequest request = ...

// ä¸»æœºåã€schema, ç«¯å£å·ã€è¯·æ±‚è·¯å¾„å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²éƒ½é‡ç”¨è¯·æ±‚é‡Œå·²æœ‰çš„å€¼
// æ›¿æ¢äº†å…¶ä¸­çš„&quot;accountId&quot;æŸ¥è¯¢å‚æ•°

ServletUriComponentsBuilder ucb = ServletUriComponentsBuilder.fromRequest(request)
        .replaceQueryParam(&quot;accountId&quot;, &quot;{id}&quot;).build()
        .expand(&quot;123&quot;)
        .encode();
</code></pre>
<p>æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©åªå¤ç”¨è¯·æ±‚ä¸­ä¸€éƒ¨åˆ†çš„ä¿¡æ¯ï¼š</p>
<pre><code class="lang-java">    // é‡ç”¨ä¸»æœºåã€ç«¯å£å·å’Œcontext path
    // åœ¨è·¯å¾„åæ·»åŠ &quot;/accounts&quot;

    ServletUriComponentsBuilder ucb = ServletUriComponentsBuilder.fromContextPath(request)
            .path(&quot;/accounts&quot;).build()
</code></pre>
<p>æˆ–è€…ï¼Œå¦‚æœä½ çš„<code>DispatcherServlet</code>æ˜¯é€šè¿‡åå­—ï¼ˆæ¯”å¦‚ï¼Œ<code>/main/*</code>ï¼‰æ˜ å°„è¯·æ±‚çš„ï¼Œyou can also have the literal part of the servlet mapping included:</p>
<pre><code class="lang-java">    // Re-use host, port, context path
    // Append the literal part of the servlet mapping to the path
    // Append &quot;/accounts&quot; to the path

    ServletUriComponentsBuilder ucb = ServletUriComponentsBuilder.fromServletMapping(request)
            .path(&quot;/accounts&quot;).build()
</code></pre>
</section<section><h1 id="21-7-1-uri">21.7.1 ä¸ºæ§åˆ¶å™¨å’Œæ–¹æ³•æŒ‡å®šURI</h1>
<p>Spring MVCä¹Ÿæä¾›äº†æ„é€ æŒ‡å®šæ§åˆ¶å™¨æ–¹æ³•é“¾æ¥çš„æœºåˆ¶ã€‚ä»¥ä¸‹é¢ä»£ç ä¸ºä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªæ§åˆ¶å™¨ï¼š</p>
<pre><code class="lang-java">@Controller
@RequestMapping(&quot;/hotels/{hotel}&quot;)
public class BookingController {

    @RequestMapping(&quot;/bookings/{booking}&quot;)
    public String getBooking(@PathVariable Long booking) {

    // ...

    }
}
</code></pre>
<p>ä½ å¯ä»¥é€šè¿‡å¼•ç”¨æ–¹æ³•åå­—çš„åŠæ³•æ¥å‡†å¤‡ä¸€ä¸ªé“¾æ¥ï¼š</p>
<pre><code class="lang-java">UriComponents uriComponents = MvcUriComponentsBuilder
    .fromMethodName(BookingController.class, &quot;getBooking&quot;, 21).buildAndExpand(42);

URI uri = uriComponents.encode().toUri();
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ–¹æ³•å‚æ•°å‡†å¤‡äº†å¡«å……å€¼ï¼šä¸€ä¸ªlongå‹çš„å˜é‡å€¼21ï¼Œä»¥ç”¨äºå¡«å……è·¯å¾„å˜é‡å¹¶æ’å…¥åˆ°URLä¸­ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†ä¸€ä¸ªå€¼42ï¼Œä»¥ç”¨äºå¡«å……å…¶ä»–å‰©ä½™çš„URIå˜é‡ï¼Œæ¯”å¦‚ä»ç±»å±‚çº§çš„è¯·æ±‚æ˜ å°„ä¸­ç»§æ‰¿æ¥çš„<code>hotel</code>å˜é‡ã€‚å¦‚æœæ–¹æ³•è¿˜æœ‰æ›´å¤šçš„å‚æ•°ï¼Œä½ å¯ä»¥ä¸ºé‚£äº›ä¸éœ€è¦å‚ä¸URLæ„é€ çš„å˜é‡èµ‹äºˆnullå€¼ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œåªæœ‰<code>@PathVariable</code>å’Œ<code>@RequestParam</code>æ³¨è§£çš„å‚æ•°æ‰ä¸URLçš„æ„é€ ç›¸å…³ã€‚</p>
<p>è¿˜æœ‰å…¶ä»–ä½¿ç”¨<code>MvcUriComponentsBuilder</code>çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡ç±»ä¼¼mockæ‰æµ‹è¯•å¯¹è±¡çš„æ–¹æ³•ï¼Œç”¨ä»£ç†æ¥é¿å…ç›´æ¥é€šè¿‡åå­—å¼•ç”¨ä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•ï¼ˆä»¥ä¸‹æ–¹æ³•å‡è®¾<code>MvcUriComponentsBuilder.on</code>æ–¹æ³•å·²ç»è¢«é™æ€å¯¼å…¥ï¼‰ï¼š</p>
<pre><code class="lang-java">UriComponents uriComponents = MvcUriComponentsBuilder
    .fromMethodCall(on(BookingController.class).getBooking(21)).buildAndExpand(42);

URI uri = uriComponents.encode().toUri();
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ä¾‹å­ä¸­ä½¿ç”¨äº†<code>MvcUriComponentsBuilder</code>ç±»çš„é™æ€æ–¹æ³•ã€‚å†…éƒ¨å®ç°ä¸­ï¼Œå®ƒä¾èµ–äº<code>ServletUriComponentsBuilder</code>æ¥ä»å½“å‰è¯·æ±‚ä¸­æŠ½å–schemaã€ä¸»æœºåã€ç«¯å£å·ã€contextè·¯å¾„å’Œservletè·¯å¾„ï¼Œå¹¶å‡†å¤‡ä¸€ä¸ªåŸºæœ¬URLã€‚å¤§å¤šæ•°æƒ…å†µä¸‹å®ƒèƒ½è‰¯å¥½å·¥ä½œï¼Œä½†æœ‰æ—¶è¿˜ä¸è¡Œã€‚æ¯”å¦‚ï¼Œåœ¨å‡†å¤‡é“¾æ¥æ—¶ï¼Œä½ å¯èƒ½åœ¨å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ä¹‹å¤–ï¼ˆæ¯”å¦‚ï¼Œæ‰§è¡Œä¸€ä¸ªå‡†å¤‡é“¾æ¥linksçš„æ‰¹å¤„ç†ï¼‰ï¼Œæˆ–ä½ å¯èƒ½éœ€è¦ä¸ºè·¯å¾„æ’å…¥ä¸€ä¸ªå‰ç¼€ï¼ˆæ¯”å¦‚ä¸€ä¸ªåœ°åŒºæ€§å‰ç¼€ï¼Œå®ƒä»è¯·æ±‚ä¸­è¢«ç§»é™¤ï¼Œç„¶ååˆé‡æ–°è¢«æ’å…¥åˆ°é“¾æ¥ä¸­å»ï¼‰ã€‚</p>
<p>å¯¹äºä¸Šé¢æ‰€æçš„åœºæ™¯ï¼Œä½ å¯ä»¥ä½¿ç”¨é‡è½½è¿‡çš„é™æ€æ–¹æ³•<code>fromXxx</code>ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª<code>UriComponentsBuilder</code>å‚æ•°ï¼Œç„¶åä»ä¸­è·å–åŸºæœ¬URLä»¥ä¾¿ä½¿ç”¨ã€‚æˆ–ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªåŸºæœ¬URLåˆ›å»ºä¸€ä¸ª<code>MvcUriComponentsBuilder</code>å¯¹è±¡ï¼Œç„¶åä½¿ç”¨å®ä¾‹å¯¹è±¡çš„<code>fromXxx</code>æ–¹æ³•ã€‚å¦‚ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p>
<pre><code class="lang-java">UriComponentsBuilder base = ServletUriComponentsBuilder.fromCurrentContextPath().path(&quot;/en&quot;);
MvcUriComponentsBuilder builder = MvcUriComponentsBuilder.relativeTo(base);
builder.withMethodCall(on(BookingController.class).getBooking(21)).buildAndExpand(42);

URI uri = uriComponents.encode().toUri();
</code></pre>
</section<section><h1 id="-uri">åœ¨è§†å›¾ä¸­ä¸ºæ§åˆ¶å™¨å’Œæ–¹æ³•æŒ‡å®šURI</h1>
</section<section><h1 id="21-8-locales-">21.8 åœ°åŒºä¿¡æ¯ï¼ˆLocalesï¼‰</h1>
<p>Springçš„æ¶æ„ä¸­çš„å¾ˆå¤šå±‚é¢éƒ½æä¾›äº†å¯¹å›½é™…åŒ–çš„æ”¯æŒï¼ŒåŒæ ·æ”¯æŒSpring MVCæ¡†æ¶ä¹Ÿèƒ½æä¾›ã€‚<code>DispatcherServlet</code>ä¸ºä½ æä¾›äº†è‡ªåŠ¨ä½¿ç”¨ç”¨æˆ·çš„åœ°åŒºä¿¡æ¯æ¥è§£ææ¶ˆæ¯çš„èƒ½åŠ›ã€‚è€Œè¿™ï¼Œæ˜¯é€šè¿‡<code>LocaleResolver</code>å¯¹è±¡æ¥å®Œæˆçš„ã€‚</p>
<p>ä¸€ä¸ªè¯·æ±‚è¿›å…¥å¤„ç†æ—¶ï¼Œ<code>DispatcherServlet</code>ä¼šæŸ¥æ‰¾ä¸€ä¸ªåœ°åŒºè§£æå™¨ã€‚å¦‚æœæ‰¾åˆ°ï¼Œå°±å°è¯•ä½¿ç”¨å®ƒæ¥è®¾ç½®åœ°åŒºç›¸å…³çš„ä¿¡æ¯ã€‚é€šè¿‡è°ƒç”¨<code>RequestContext.getLocale()</code>éƒ½èƒ½å–åˆ°åœ°åŒºè§£æå™¨æ‰€è§£æåˆ°çš„åœ°åŒºä¿¡æ¯ã€‚</p>
<p>æ­¤å¤–ï¼Œå¦‚æœä½ éœ€è¦è‡ªåŠ¨è§£æåœ°åŒºä¿¡æ¯ï¼Œä½ å¯ä»¥åœ¨å¤„ç†å™¨æ˜ å°„å‰åŠ ä¸€ä¸ªæ‹¦æˆªå™¨ï¼ˆå…³äºæ›´å¤šå¤„ç†å™¨æ˜ å°„æ‹¦æˆªå™¨çš„çŸ¥è¯†ï¼Œè¯·å‚è§<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-handlermapping-interceptor">21.4.1 ä½¿ç”¨HandlerInterceptoræ‹¦æˆªè¯·æ±‚</a>ä¸€å°èŠ‚ï¼‰ï¼Œå¹¶ç”¨å®ƒæ¥æ ¹æ®æ¡ä»¶æˆ–ç¯å¢ƒä¸åŒï¼Œæ¯”å¦‚ï¼Œæ ¹æ®è¯·æ±‚ä¸­æŸä¸ªå‚æ•°å€¼ï¼Œæ¥æ›´æ”¹åœ°åŒºä¿¡æ¯ã€‚</p>
</section<section><h1 id="21-8-1-">21.8.1 è·å–æ—¶åŒºä¿¡æ¯</h1>
<p>é™¤äº†è·å–å®¢æˆ·ç«¯çš„åœ°åŒºä¿¡æ¯å¤–ï¼Œæœ‰æ—¶ä»–ä»¬æ‰€åœ¨çš„æ—¶åŒºä¿¡æ¯ä¹Ÿéå¸¸æœ‰ç”¨ã€‚<code>LocaleContextResolver</code>æ¥å£ä¸º<code>LocaleResolver</code>æä¾›äº†æ‹“å±•ç‚¹ï¼Œå…è®¸è§£æå™¨åœ¨<code>LocaleContext</code>ä¸­æä¾›æ›´å¤šçš„ä¿¡æ¯ï¼Œè¿™é‡Œé¢å°±å¯ä»¥åŒ…å«æ—¶åŒºä¿¡æ¯ã€‚</p>
<p>å¦‚æœç”¨æˆ·çš„æ—¶åŒºä¿¡æ¯èƒ½è¢«è§£æåˆ°ï¼Œé‚£ä¹ˆä½ æ€»å¯ä»¥é€šè¿‡<code>RequestContext.getTimeZone()</code>æ–¹æ³•è·å¾—ã€‚æ—¶åŒºä¿¡æ¯ä¼šè‡ªåŠ¨è¢«Spring<code>ConversionService</code>ä¸‹æ³¨å†Œçš„æ—¥æœŸ/æ—¶é—´è½¬æ¢å™¨<code>Converter</code>åŠæ ¼å¼åŒ–å¯¹è±¡<code>Formatter</code>æ‰€ä½¿ç”¨ã€‚</p>
</section<section><h1 id="21-8-2-accept-acceptheaderlocaleresolver">21.8.2 Acceptè¯·æ±‚å¤´è§£æå™¨AcceptHeaderLocaleResolver</h1>
<p><code>AcceptHeaderLocaleResolver</code>è§£æå™¨ä¼šæ£€æŸ¥å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ï¼Œæµè§ˆå™¨ï¼Œç­‰ï¼‰æ‰€å‘é€çš„è¯·æ±‚ä¸­æ˜¯å¦æºå¸¦<code>accept-language</code>è¯·æ±‚å¤´ã€‚é€šå¸¸ï¼Œè¯¥è¯·æ±‚å¤´å­—æ®µä¸­åŒ…å«äº†å®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿçš„åœ°åŒºä¿¡æ¯ã€‚<em>ä¸è¿‡è¯·æ³¨æ„ï¼Œè¯¥è§£æå™¨ä¸æ”¯æŒæ—¶åŒºä¿¡æ¯çš„è§£æã€‚</em></p>
</section<section><h1 id="21-8-3-cookie-cookielocaleresolver">21.8.3 Cookieè§£æå™¨CookieLocaleResolver</h1>
<p><code>CookieLocaleResolver</code>è§£æä¼šæ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦æœ‰<code>Cookie</code>ï¼Œé‡Œé¢å¯èƒ½å­˜æ”¾äº†åœ°åŒº<code>Locale</code>æˆ–æ—¶åŒº<code>TimeZone</code>ä¿¡æ¯ã€‚å¦‚æœæ£€æŸ¥åˆ°ç›¸åº”çš„å€¼ï¼Œè§£æå™¨å°±ä½¿ç”¨å®ƒä»¬ã€‚é€šè¿‡è¯¥è§£æå™¨çš„å±æ€§ï¼Œä½ å¯ä»¥æŒ‡å®šcookieçš„åç§°å’Œå…¶æœ€å¤§çš„å­˜æ´»æ—¶é—´ã€‚è¯·è§ä¸‹é¢çš„ä¾‹å­ï¼Œå®ƒå±•ç¤ºäº†å¦‚ä½•å®šä¹‰ä¸€ä¸ª<code>CookieLocaleResolver</code>ï¼š</p>
<pre><code class="lang-xml">&lt;bean id=&quot;localeResolver&quot; class=&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;&gt;

    &lt;property name=&quot;cookieName&quot; value=&quot;clientlanguage&quot;/&gt;

    &lt;!-- å•ä½ä¸ºç§’ã€‚è‹¥è®¾ç½®ä¸º-1ï¼Œåˆ™cookieä¸ä¼šè¢«æŒä¹…åŒ–ï¼ˆå®¢æˆ·ç«¯å…³é—­æµè§ˆå™¨åå³è¢«åˆ é™¤ï¼‰ --&gt;
    &lt;property name=&quot;cookieMaxAge&quot; value=&quot;100000&quot;&gt;

&lt;/bean&gt;
</code></pre>
<p><strong>è¡¨21.4. CookieLocaleResolveræ”¯æŒçš„å±æ€§</strong></p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>é»˜è®¤å€¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>cookieName</td>
<td>classname + LOCALE</td>
<td>cookieå</td>
</tr>
<tr>
<td>cookieMaxAge</td>
<td>Integer.MAX_INT</td>
<td>cookieè¢«ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„æœ€é•¿æ—¶é—´ã€‚å¦‚æœè¯¥å€¼ä¸º-1ï¼Œé‚£ä¹ˆcookieå°†ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œåœ¨å®¢æˆ·ç«¯æµè§ˆå™¨å…³é—­ä¹‹åå°±å¤±æ•ˆäº†</td>
</tr>
<tr>
<td>cookiePath</td>
<td>/</td>
<td>é™åˆ¶äº†cookieä»…å¯¹ç«™ç‚¹ä¸‹çš„æŸäº›ç‰¹å®šè·¯å¾„å¯è§ã€‚å¦‚æœæŒ‡å®šäº†cookiePathï¼Œé‚£ä¹ˆcookieå°†ä»…å¯¹è¯¥è·¯å¾„åŠå…¶å­è·¯å¾„ä¸‹çš„æ‰€æœ‰ç«™ç‚¹å¯è§</td>
</tr>
</tbody>
</table>
</section<section><h1 id="21-8-4-session-sessionlocaleresolver">21.8.4 Sessionè§£æå™¨SessionLocaleResolver</h1>
<p><code>SessionLocaleResolver</code>å…è®¸ä½ ä»sessionä¸­å–å¾—å¯èƒ½ä¸ç”¨æˆ·è¯·æ±‚ç›¸å…³è”çš„åœ°åŒº<code>Locale</code>å’Œæ—¶åŒº<code>TimeZone</code>ä¿¡æ¯ã€‚ä¸<code>CookieLocaleResolver</code>ä¸åŒï¼Œè¿™ç§å­˜å–ç­–ç•¥ä»…å°†Servletå®¹å™¨çš„<code>HttpSession</code>ä¸­ç›¸å…³çš„åœ°åŒºä¿¡æ¯å­˜å–åˆ°æœ¬åœ°ã€‚å› æ­¤ï¼Œè¿™äº›è®¾ç½®ä»…ä¼šä¸ºè¯¥ä¼šè¯ï¼ˆsessionï¼‰ä¸´æ—¶ä¿å­˜ï¼Œsessionç»“æŸåï¼Œè¿™äº›è®¾ç½®å°±ä¼šå¤±æ•ˆã€‚</p>
<p>ä¸è¿‡è¯·æ³¨æ„ï¼Œè¯¥è§£æå™¨ä¸å…¶ä»–å¤–éƒ¨sessionç®¡ç†æœºåˆ¶ï¼Œæ¯”å¦‚Springçš„Sessioné¡¹ç›®ç­‰ï¼Œå¹¶æ²¡æœ‰ç›´æ¥è”ç³»ã€‚è¯¥<code>SessionLocaleResolver</code>ä»…ä¼šç®€å•åœ°ä»ä¸å½“å‰è¯·æ±‚<code>HttpServletRequest</code>ç›¸å…³çš„<code>HttpSession</code>å¯¹è±¡ä¸­ï¼Œå–å‡ºå¯¹åº”çš„å±æ€§ï¼Œå¹¶ä¿®æ”¹å…¶å€¼ï¼Œä»…æ­¤è€Œå·²ã€‚</p>
</section<section><h1 id="21-8-5-localechangeinterceptor">21.8.5 åœ°åŒºæ›´æ”¹æ‹¦æˆªå™¨LocaleChangeInterceptor</h1>
<p>You can enable changing of locales by adding the <code>LocaleChangeInterceptor</code> to
one of the handler mappings (see [Section 21.4, &quot;Handler mappings&quot;](mvc.html</p>
<p>#mvc-handlermapping &quot;21.4 Handler mappings&quot; )). It will detect a parameter in
the request and change the locale. It calls <code>setLocale()</code> on the
<code>LocaleResolver</code> that also exists in the context. The following example shows
that calls to all <code>*.view</code> resources containing a parameter named
<code>siteLanguage</code> will now change the locale. So, for example, a request for the
following URL, <code>&lt;http://www.sf.net/home.view?siteLanguage=nl&gt;</code> will change the
site language to Dutch.</p>
<p>ä½ å¯ä»¥åœ¨å¤„ç†å™¨æ˜ å°„ï¼ˆè¯¦è§<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-handlermapping" title="21.4 Handler mappings">21.4 å¤„ç†å™¨æ˜ å°„ï¼ˆHandler mappingsï¼‰</a>å°èŠ‚ï¼‰å‰æ·»åŠ ä¸€ä¸ª<code>LocaleChangeInterceptor</code>æ‹¦æˆªå™¨æ¥æ›´æ”¹åœ°åŒºä¿¡æ¯ã€‚å®ƒèƒ½æ£€æµ‹è¯·æ±‚ä¸­çš„å‚æ•°ï¼Œå¹¶æ ¹æ®å…¶å€¼ç›¸åº”åœ°æ›´æ–°åœ°åŒºä¿¡æ¯ã€‚å®ƒé€šè¿‡è°ƒç”¨<code>LocaleResolver</code>çš„<code>setLocale()</code>æ–¹æ³•æ¥æ›´æ”¹åœ°åŒºã€‚ä¸‹é¢çš„ä»£ç é…ç½®å±•ç¤ºäº†å¦‚ä½•ä¸ºæ‰€æœ‰è¯·æ±‚<code>*.view</code>è·¯å¾„å¹¶ä¸”æºå¸¦äº†<code>siteLanguage</code>å‚æ•°çš„èµ„æºè¯·æ±‚æ›´æ”¹åœ°åŒºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªURLä¸º<code>&lt;http://www.sf.net/home.view?siteLanguage=nl&gt;</code>çš„è¯·æ±‚å°†ä¼šå°†ç«™ç‚¹è¯­è¨€æ›´æ”¹ä¸ºè·å…°è¯­ã€‚</p>
<pre><code class="lang-xml">&lt;bean id=&quot;localeChangeInterceptor&quot; class=&quot;org.springframework.web.servlet.i18n.LocaleChangeInterceptor&quot;&gt;
    &lt;property name=&quot;paramName&quot; value=&quot;siteLanguage&quot;/&gt;
&lt;/bean&gt;

&lt;bean id=&quot;localeResolver&quot; class=&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;/&gt;

&lt;bean id=&quot;urlMapping&quot; class=&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;&gt;
    &lt;property name=&quot;interceptors&quot;&gt;
        &lt;list&gt;
            &lt;ref bean=&quot;localeChangeInterceptor&quot;/&gt;
        &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name=&quot;mappings&quot;&gt;
        &lt;value&gt;/**/*.view=someController&lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
</section<section><h1 id="21-9-themes">21.9 ä¸»é¢˜ themes</h1>
<ul>
<li><a href="1-overview-of-themes.md">21.9.1 å…³äºä¸»é¢˜ï¼šæ¦‚è§ˆ</a></li>
<li><a href="2-defining-themes.md">21.9.2 å®šä¹‰ä¸»é¢˜</a></li>
<li><a href="3-theme-resolvers.md">21.9.3 ä¸»é¢˜è§£æå™¨</a></li>
</ul>
</section<section><h1 id="21-9-1-">21.9.1 å…³äºä¸»é¢˜ï¼šæ¦‚è§ˆ</h1>
<p>You can apply Spring Web MVC framework themes to set the overall look-and-feel
of your application, thereby enhancing user experience. A theme is a
collection of static resources, typically style sheets and images, that affect
the visual style of the application.</p>
<p>ä½ å¯ä»¥ä½¿ç”¨Spring Web MVCæ¡†æ¶æä¾›çš„ä¸»é¢˜æ¥ä¸ºæ•´ç«™çš„åº”ç”¨è®¾ç½®çš®è‚¤/ä¸»é¢˜ï¼ˆlook-and-feelï¼‰ï¼Œè¿™å¯ä»¥æé«˜ç”¨æˆ·ä½“éªŒã€‚<strong>ä¸»é¢˜</strong> æ˜¯æŒ‡ä¸€ç³»åˆ—é™æ€èµ„æºçš„é›†åˆï¼Œå¹¶ä¸”ä¸»è¦æ˜¯æ ·å¼è¡¨å’Œå›¾ç‰‡ï¼Œå®ƒä»¬å†³å®šäº†ä½ çš„åº”ç”¨çš„è§†è§‰é£æ ¼ã€‚</p>
</section<section><h1 id="21-9-2-">21.9.2 å®šä¹‰ä¸»é¢˜</h1>
<p>è¦åœ¨ä½ çš„åº”ç”¨ä¸­ä½¿ç”¨ä¸»é¢˜ï¼Œä½ å¿…é¡»å®ç°ä¸€ä¸ª<code>org.springframework.ui.context.ThemeSource</code>æ¥å£ã€‚<code>WebApplicationContext</code>æ¥å£ç»§æ‰¿äº†<code>ThemeSource</code>æ¥å£ï¼Œä½†ä¸»è¦çš„å·¥ä½œå®ƒè¿˜æ˜¯å§”æ‰˜ç»™æ¥å£å…·ä½“çš„å®ç°æ¥å®Œæˆã€‚é»˜è®¤çš„å®ç°æ˜¯<code>org.springframework.ui.context.support.ResourceBundleThemeSource</code>ï¼Œå®ƒä¼šä»classpathçš„æ ¹è·¯å¾„ä¸‹å»åŠ è½½é…ç½®æ–‡ä»¶ã€‚å¦‚æœéœ€è¦å®šåˆ¶<code>ThemeSource</code>çš„å®ç°ï¼Œæˆ–è¦é…ç½®<code>ResourceBundleThemeSource</code>çš„åŸºæœ¬å‰ç¼€åï¼ˆbase name prefixï¼‰ï¼Œä½ å¯ä»¥åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆapplication contextï¼‰ä¸‹æ³¨å†Œä¸€ä¸ªåå­—ä¸ºä¿ç•™å<code>themeSource</code>çš„beanï¼Œwebåº”ç”¨çš„ä¸Šä¸‹æ–‡ä¼šè‡ªåŠ¨æ£€æµ‹åå­—ä¸º<code>themeSource</code>çš„beanå¹¶ä½¿ç”¨å®ƒã€‚</p>
<p>ä½¿ç”¨çš„æ˜¯<code>ResourceBundleThemeSource</code>æ—¶ï¼Œä¸€ä¸ªä¸»é¢˜å¯ä»¥å®šä¹‰åœ¨ä¸€ä¸ªç®€å•çš„é…ç½®æ–‡ä»¶ä¸­ã€‚è¯¥é…ç½®æ–‡ä»¶ä¼šåˆ—å‡ºæ‰€æœ‰ç»„æˆäº†è¯¥ä¸»é¢˜çš„èµ„æºã€‚ä¸‹é¢æ˜¯ä¸ªä¾‹å­ï¼š</p>
<pre><code>    styleSheet=/themes/cool/style.css
    background=/themes/cool/img/coolBg.jpg
</code></pre><p>å±æ€§çš„é”®ï¼ˆkeyï¼‰æ˜¯ä¸»é¢˜å…ƒç´ åœ¨è§†å›¾ä»£ç ä¸­è¢«å¼•ç”¨çš„åå­—ã€‚å¯¹äºJSPè§†å›¾æ¥è¯´ï¼Œä¸€èˆ¬é€šè¿‡<code>spring:theme</code>è¿™ä¸ªå®šåˆ¶åŒ–çš„æ ‡ç­¾ï¼ˆtagï¼‰æ¥åšï¼Œå®ƒä¸<code>spring:message</code>æ ‡ç­¾å¾ˆç›¸ä¼¼ã€‚ä»¥ä¸‹çš„JSPä»£ç å³ä½¿ç”¨äº†ä¸Šæ®µä»£ç ç‰‡æ®µä¸­å®šä¹‰çš„ä¸»é¢˜ï¼Œç”¨ä»¥å®šåˆ¶æ•´ä½“çš„çš®è‚¤ï¼š</p>
<pre><code class="lang-html">&lt;%@ taglib prefix=&quot;spring&quot; uri=&quot;http://www.springframework.org/tags&quot;%&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;&lt;spring:theme code=&#39;&#39;styleSheet&#39;&#39;/&gt;&quot; type=&quot;text/css&quot;/&gt;
    &lt;/head&gt;
    &lt;body style=&quot;background=&lt;spring:theme code=&#39;&#39;background&#39;&#39;/&gt;&quot;&gt;
        ...
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹<code>ResourceBundleThemeSource</code>ä½¿ç”¨çš„åŸºæœ¬åå‰ç¼€ï¼ˆbase name prefixï¼‰æ˜¯ç©ºå€¼ã€‚ä¹Ÿå³æ˜¯è¯´ï¼Œé…ç½®æ–‡ä»¶æ˜¯ä»æ ¹classpathè·¯å¾„ä¸‹åŠ è½½çš„ã€‚å› æ­¤ï¼Œä½ éœ€è¦æŠŠä¸»é¢˜çš„å®šä¹‰æ–‡ä»¶<code>cool.properties</code>æ”¾åœ¨classpathçš„æ ¹è·¯å¾„ç›®å½•ä¸‹ï¼Œæ¯”å¦‚ï¼Œ<code>/WEB-INF/classes</code>ã€‚<code>ResourceBundleThemeSource</code>é‡‡ç”¨äº†Javaçš„æ ‡å‡†èµ„æºbundleåŠ è½½æœºåˆ¶ï¼Œå®Œå…¨æ”¯æŒå›½é™…åŒ–ä¸»é¢˜ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>/WEB-INF/classes/cool_nl.properties</code>é…ç½®æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­å¼•ç”¨ä¸€å‰¯æœ‰è·å…°æ–‡çš„èƒŒæ™¯å›¾ç‰‡ã€‚</p>
</section<section><h1 id="21-9-3-">21.9.3 ä¸»é¢˜è§£æå™¨</h1>
<p>ä¸Šä¸€å°èŠ‚ï¼Œæˆ‘ä»¬è®²äº†å¦‚ä½•å®šä¹‰ä¸»é¢˜ï¼Œå®šä¹‰ä¹‹åï¼Œä½ è¦å†³å®šä½¿ç”¨å“ªä¸ªä¸»é¢˜ã€‚<code>DispatcherServlet</code>ä¼šæŸ¥æ‰¾ä¸€ä¸ªåç§°ä¸º<code>themeResolver</code>çš„beanä»¥ç¡®å®šä½¿ç”¨å“ªä¸ª<code>ThemeResolver</code>çš„å®ç°ã€‚ä¸»é¢˜è§£æå™¨çš„å·¥ä½œåŸç†ä¸åœ°åŒºè§£æå™¨<code>LocaleResolver</code>çš„å·¥ä½œåŸç†å¤§åŒå°å¼‚ã€‚å®ƒä¼šæ£€æµ‹ï¼Œå¯¹äºä¸€ä¸ªè¯·æ±‚æ¥è¯´ï¼Œåº”è¯¥ä½¿ç”¨å“ªä¸ªä¸»é¢˜ï¼ŒåŒæ—¶å®ƒä¹Ÿå¯ä»¥ä¿®æ”¹ä¸€ä¸ªè¯·æ±‚æ‰€åº”åº”ç”¨çš„ä¸»é¢˜ã€‚Springæä¾›äº†ä¸‹åˆ—çš„è¿™äº›ä¸»é¢˜è§£æå™¨ï¼š</p>
<p><strong>è¡¨21.5. ThemeResolveræ¥å£çš„å®ç°</strong></p>
<table>
<thead>
<tr>
<th>ç±»å</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FixedThemeResolver</code></td>
<td>é€‰æ‹©ä¸€ä¸ªå›ºå®šçš„ä¸»é¢˜ï¼Œè¿™æ˜¯é€šè¿‡è®¾ç½®<code>defaultThemeName</code>è¿™ä¸ªå±æ€§å€¼å®ç°çš„</td>
</tr>
<tr>
<td><code>SessionThemeResolver</code></td>
<td>è¯·æ±‚ç›¸å…³çš„ä¸»é¢˜ä¿å­˜åœ¨ç”¨æˆ·çš„HTTPä¼šè¯ï¼ˆsessionï¼‰ä¸­ã€‚å¯¹äºæ¯ä¸ªä¼šè¯æ¥è¯´ï¼Œå®ƒåªéœ€è¦è¢«è®¾ç½®ä¸€æ¬¡ï¼Œä½†å®ƒä¸èƒ½åœ¨ä¼šè¯ä¹‹é—´ä¿å­˜</td>
</tr>
<tr>
<td><code>CookieThemeResolver</code></td>
<td>é€‰ä¸­çš„ä¸»é¢˜è¢«ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„cookieä¸­</td>
</tr>
</tbody>
</table>
<p>Springä¹Ÿæä¾›äº†ä¸€ä¸ªä¸»é¢˜æ›´æ”¹æ‹¦æˆªå™¨<code>ThemeChangeInterceptor</code>ï¼Œä»¥æ”¯æŒä¸»é¢˜çš„æ›´æ¢ã€‚è¿™å¾ˆå®¹æ˜“åšåˆ°ï¼Œåªéœ€è¦åœ¨è¯·æ±‚ä¸­æºå¸¦ä¸€ä¸ªç®€å•çš„è¯·æ±‚å‚æ•°å³å¯ã€‚</p>
</section<section><h1 id="21-10-spring-multipart-">21.10 Springçš„multipartï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰æ”¯æŒ</h1>
<ul>
<li><a href="1-introduction.md">æ¦‚è¿°</a></li>
<li><a href="2-using-a-multipart-resolver-with-commons-fileupload.md">ä½¿ç”¨MultipartResolverä¸Commons FileUploadä¼ è¾“æ–‡ä»¶</a></li>
<li><a href="3-using-a-multipart-resolver-with-servlet-3.md">Servlet 3.0ä¸‹çš„MultipartResolver</a></li>
<li><a href="4-handling-a-file-upload-in-a-form.md">å¤„ç†è¡¨å•ä¸­çš„æ–‡ä»¶ä¸Šä¼ </a></li>
<li><a href="5-handling-a-file-upload-request-from-programmatic-clients.md">å¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„æ–‡ä»¶ä¸Šä¼ è¯·æ±‚</a></li>
</ul>
</section<section><h1 id="21-10-1-">21.10.1 æ¦‚è¿°</h1>
<p>Springå†…ç½®å¯¹å¤šè·¯ä¸Šä¼ çš„æ”¯æŒï¼Œä¸“é—¨ç”¨äºå¤„ç†webåº”ç”¨ä¸­çš„æ–‡ä»¶ä¸Šä¼ ã€‚ä½ å¯ä»¥é€šè¿‡æ³¨å†Œä¸€ä¸ªå¯æ’æ‹”çš„<code>MultipartResolver</code>å¯¹è±¡æ¥å¯ç”¨å¯¹æ–‡ä»¶å¤šè·¯ä¸Šä¼ çš„æ”¯æŒã€‚è¯¥æ¥å£åœ¨å®šä¹‰äº<code>org.springframework.web.multipart</code>åŒ…ä¸‹ã€‚Springä¸º<a href="http://jakarta.apache.org/commons/fileupload"><em>ä¸€èˆ¬çš„æ–‡ä»¶ä¸Šä¼ </em></a>æä¾›äº†<code>MultipartResolver</code>æ¥å£çš„ä¸€ä¸ªå®ç°ï¼Œä¸ºServlet 3.0å¤šè·¯è¯·æ±‚çš„è½¬æ¢æä¾›äº†å¦ä¸€ä¸ªå®ç°ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringçš„å¤šè·¯ä¸Šä¼ æ”¯æŒæ˜¯ä¸å¼€å¯çš„ï¼Œå› ä¸ºæœ‰äº›å¼€å‘è€…å¸Œæœ›ç”±è‡ªå·±æ¥å¤„ç†å¤šè·¯è¯·æ±‚ã€‚å¦‚æœæƒ³å¯ç”¨Springçš„å¤šè·¯ä¸Šä¼ æ”¯æŒï¼Œä½ éœ€è¦åœ¨webåº”ç”¨çš„ä¸Šä¸‹æ–‡ä¸­æ·»åŠ ä¸€ä¸ªå¤šè·¯ä¼ è¾“è§£æå™¨ã€‚æ¯ä¸ªè¿›æ¥çš„è¯·æ±‚ï¼Œè§£æå™¨éƒ½ä¼šæ£€æŸ¥æ˜¯ä¸æ˜¯ä¸€ä¸ªå¤šéƒ¨åˆ†è¯·æ±‚ã€‚è‹¥å‘ç°è¯·æ±‚æ˜¯å®Œæ•´çš„ï¼Œåˆ™è¯·æ±‚æŒ‰æ­£å¸¸æµç¨‹è¢«å¤„ç†ï¼›å¦‚æœå‘ç°è¯·æ±‚æ˜¯ä¸€ä¸ªå¤šè·¯è¯·æ±‚ï¼Œåˆ™ä½ åœ¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œçš„<code>MultipartResolver</code>è§£æå™¨ä¼šè¢«ç”¨æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚ä¹‹åï¼Œè¯·æ±‚ä¸­çš„å¤šè·¯ä¸Šä¼ å±æ€§å°±ä¸å…¶ä»–å±æ€§ä¸€æ ·è¢«æ­£å¸¸å¯¹å¾…äº†ã€‚ã€æœ€åä¸€å¥ç¿»çš„ä¸å¥½ï¼Œmultipartç¿»è¯‘æˆå¤šè·¯è¿˜æ˜¯å¤šéƒ¨åˆ†è¿˜åœ¨æ–Ÿé…Œä¸­ã€‚æœ›é˜…è¯»è€…æ³¨æ„æ­¤å¤„ã€‚ã€‘</p>
</section<section><h1 id="21-10-2-multipartresolver-commons-fileupload-">21.10.2 ä½¿ç”¨MultipartResolverä¸Commons FileUploadä¼ è¾“æ–‡ä»¶</h1>
<p>ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªé€šç”¨çš„å¤šè·¯ä¸Šä¼ è§£æå™¨<code>CommonsMultipartResolver</code>ï¼š</p>
<pre><code class="lang-xml">&lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;

    &lt;!-- æ”¯æŒçš„å…¶ä¸­ä¸€ä¸ªå±æ€§ï¼Œæ”¯æŒçš„æœ€å¤§æ–‡ä»¶å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ --&gt;
    &lt;property name=&quot;maxUploadSize&quot; value=&quot;100000&quot;/&gt;

&lt;/bean&gt;
</code></pre>
<p>å½“ç„¶ï¼Œè¦è®©å¤šè·¯è§£æå™¨æ­£å¸¸å·¥ä½œï¼Œä½ éœ€è¦åœ¨classpathè·¯å¾„ä¸‹å‡†å¤‡å¿…é¡»çš„jaråŒ…ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯é€šç”¨çš„å¤šè·¯ä¸Šä¼ è§£æå™¨<code>CommonsMultipartResolver</code>ï¼Œä½ æ‰€éœ€è¦çš„jaråŒ…æ˜¯<code>commons-fileupload.jar</code>ã€‚</p>
<p>å½“Springçš„<code>DispatcherServlet</code>æ£€æµ‹åˆ°ä¸€ä¸ªå¤šéƒ¨åˆ†è¯·æ±‚æ—¶ï¼Œå®ƒä¼šæ¿€æ´»ä½ åœ¨ä¸Šä¸‹æ–‡ä¸­å£°æ˜çš„å¤šè·¯è§£æå™¨å¹¶æŠŠè¯·æ±‚äº¤ç»™å®ƒã€‚è§£æå™¨ä¼šæŠŠå½“å‰çš„<code>HttpServletRequest</code>è¯·æ±‚å¯¹è±¡åŒ…è£…æˆä¸€ä¸ªæ”¯æŒå¤šè·¯æ–‡ä»¶ä¸Šä¼ çš„è¯·æ±‚å¯¹è±¡<code>MultipartHttpServletRequest</code>ã€‚æœ‰äº†<code>MultipartHttpServletRequest</code>å¯¹è±¡ï¼Œä½ ä¸ä»…å¯ä»¥è·å–è¯¥å¤šè·¯è¯·æ±‚ä¸­çš„ä¿¡æ¯ï¼Œè¿˜å¯ä»¥åœ¨ä½ çš„æ§åˆ¶å™¨ä¸­è·å¾—è¯¥å¤šè·¯è¯·æ±‚çš„å†…å®¹æœ¬èº«ã€‚</p>
</section<section><h1 id="21-10-3-servlet-3-0-multipartresolver">21.10.3 Servlet 3.0ä¸‹çš„MultipartResolver</h1>
<p>è¦ä½¿ç”¨åŸºäºServlet 3.0çš„å¤šè·¯ä¼ è¾“è½¬æ¢åŠŸèƒ½ï¼Œä½ å¿…é¡»åœ¨<code>web.xml</code>ä¸­ä¸º<code>DispatcherServlet</code>æ·»åŠ ä¸€ä¸ª<code>multipart-config</code>å…ƒç´ ï¼Œæˆ–è€…é€šè¿‡Servletç¼–ç¨‹çš„æ–¹æ³•ä½¿ç”¨<code>javax.servlet.MultipartConfigElement</code>è¿›è¡Œæ³¨å†Œï¼Œæˆ–ä½ è‡ªå·±å®šåˆ¶äº†è‡ªå·±çš„Servletç±»ï¼Œé‚£ä½ å¿…é¡»ä½¿ç”¨<code>javax.servlet.annotation.MultipartConfig</code>å¯¹å…¶è¿›è¡Œæ³¨è§£ã€‚å…¶ä»–è¯¸å¦‚æœ€å¤§æ–‡ä»¶å¤§å°æˆ–å­˜å‚¨ä½ç½®ç­‰é…ç½®é€‰é¡¹éƒ½å¿…é¡»åœ¨è¿™ä¸ªServletçº§åˆ«è¿›è¡Œæ³¨å†Œï¼Œå› ä¸ºServlet 3.0ä¸å…è®¸åœ¨è§£æå™¨MultipartResolverçš„å±‚çº§é…ç½®è¿™äº›ä¿¡æ¯ã€‚</p>
<p>å½“ä½ é€šè¿‡ä»¥ä¸Šä»»ä¸€ç§æ–¹å¼å¯ç”¨äº†Servlet 3.0å¤šè·¯ä¼ è¾“è½¬æ¢åŠŸèƒ½ï¼Œä½ å°±å¯ä»¥æŠŠä¸€ä¸ª<code>StandardServletMultipartResolver</code>è§£æå™¨æ·»åŠ åˆ°ä½ çš„Springé…ç½®ä¸­å»äº†ï¼š</p>
<pre><code class="lang-xml">&lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.support.StandardServletMultipartResolver&quot;&gt;
&lt;/bean&gt;
</code></pre>
</section<section><h1 id="21-10-4-">21.10.4 å¤„ç†è¡¨å•ä¸­çš„æ–‡ä»¶ä¸Šä¼ </h1>
<p>å½“è§£æå™¨<code>MultipartResolver</code>å®Œæˆå¤„ç†æ—¶ï¼Œè¯·æ±‚ä¾¿ä¼šåƒå…¶ä»–è¯·æ±‚ä¸€æ ·è¢«æ­£å¸¸æµç¨‹å¤„ç†ã€‚é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ¥å—æ–‡ä»¶ä¸Šä¼ çš„è¡¨å•å°†å…è®¸ç”¨äºç›´æ¥ä¸Šä¼ æ•´ä¸ªè¡¨å•ã€‚ç¼–ç å±æ€§ï¼ˆ<code>enctype=&quot;multipart/form-data&quot;</code>ï¼‰èƒ½è®©æµè§ˆå™¨çŸ¥é“å¦‚ä½•å¯¹å¤šè·¯ä¸Šä¼ è¯·æ±‚çš„è¡¨å•è¿›è¡Œç¼–ç ï¼ˆencodeï¼‰ã€‚</p>
<pre><code class="lang-html">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Upload a file please&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Please upload a file&lt;/h1&gt;
        &lt;form method=&quot;post&quot; action=&quot;/form&quot; enctype=&quot;multipart/form-data&quot;&gt;
            &lt;input type=&quot;text&quot; name=&quot;name&quot;/&gt;
            &lt;input type=&quot;file&quot; name=&quot;file&quot;/&gt;
            &lt;input type=&quot;submit&quot;/&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªèƒ½å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„æ§åˆ¶å™¨ã€‚è¿™é‡Œéœ€è¦çš„æ§åˆ¶å™¨ä¸<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-ann-controller" title="21.3.1 Defining a controller with @Controller">ä¸€èˆ¬æ³¨è§£äº†<code>@Controller</code>çš„æ§åˆ¶å™¨</a>åŸºæœ¬ä¸€æ ·ï¼Œé™¤äº†å®ƒæ¥å—çš„æ–¹æ³•å‚æ•°ç±»å‹æ˜¯<code>MultipartHttpServletRequest</code>ï¼Œæˆ–<code>MultipartFile</code>ã€‚</p>
<pre><code class="lang-java">@Controller
public class FileUploadController {

    @RequestMapping(path = &quot;/form&quot;, method = RequestMethod.POST)
    public String handleFormUpload(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;file&quot;) MultipartFile file) {

        if (!file.isEmpty()) {
            byte[] bytes = file.getBytes();
            // store the bytes somewhere
            return &quot;redirect:uploadSuccess&quot;;
        }

        return &quot;redirect:uploadFailure&quot;;
    }

}
</code></pre>
<p>è¯·ç•™æ„<code>@RequestParam</code>æ³¨è§£æ˜¯å¦‚ä½•å°†æ–¹æ³•å‚æ•°å¯¹åº”åˆ°è¡¨å•ä¸­çš„å®šä¹‰çš„è¾“å…¥å­—æ®µçš„ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ‹¿åˆ°äº†<code>byte[]</code>æ–‡ä»¶æ•°æ®ï¼Œåªæ˜¯æ²¡å¯¹å®ƒåšä»»ä½•äº‹ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šå°†å®ƒä¿å­˜åˆ°æ•°æ®åº“ã€å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œæˆ–åšå…¶ä»–çš„å¤„ç†ã€‚</p>
<p>å½“ä½¿ç”¨Servlet 3.0çš„å¤šè·¯ä¼ è¾“è½¬æ¢æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨<code>javax.servlet.http.Part</code>ä½œä¸ºæ–¹æ³•å‚æ•°ï¼š</p>
<pre><code class="lang-java">@Controller
public class FileUploadController {

    @RequestMapping(path = &quot;/form&quot;, method = RequestMethod.POST)
    public String handleFormUpload(@RequestParam(&quot;name&quot;) String name, @RequestParam(&quot;file&quot;) Part file) {

        InputStream inputStream = file.getInputStream();
        // store bytes from uploaded file somewhere

        return &quot;redirect:uploadSuccess&quot;;
    }

}
</code></pre>
</section<section><h1 id="21-10-5-">21.10.5 å¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„æ–‡ä»¶ä¸Šä¼ è¯·æ±‚</h1>
<p>åœ¨ä½¿ç”¨äº†RESTfulæœåŠ¡çš„åœºæ™¯ä¸‹ï¼Œéæµè§ˆå™¨çš„å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ç›´æ¥æäº¤å¤šè·¯æ–‡ä»¶è¯·æ±‚ã€‚ä¸Šä¸€èŠ‚è®²è¿°çš„æ‰€æœ‰ä¾‹å­ä¸é…ç½®åœ¨è¿™é‡Œä¹Ÿéƒ½åŒæ ·é€‚ç”¨ã€‚ä½†ä¸æµè§ˆå™¨ä¸åŒçš„æ˜¯ï¼Œæäº¤çš„æ–‡ä»¶å’Œç®€å•çš„è¡¨å•å­—æ®µï¼Œå®¢æˆ·ç«¯å‘é€çš„æ•°æ®å¯ä»¥æ›´åŠ å¤æ‚ï¼Œæ•°æ®å¯ä»¥æŒ‡å®šä¸ºæŸç§ç‰¹å®šçš„å†…å®¹ç±»å‹ï¼ˆcontent typeï¼‰â€”â€”æ¯”å¦‚ï¼Œä¸€ä¸ªå¤šè·¯ä¸Šä¼ è¯·æ±‚å¯èƒ½ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¸ªæ–‡ä»¶ï¼Œè€Œç¬¬äºŒéƒ¨åˆ†æ˜¯ä¸ªJSONæ ¼å¼çš„æ•°æ®ï¼š</p>
<pre><code>    POST /someUrl
    Content-Type: multipart/mixed

    --edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
    Content-Disposition: form-data; name=&quot;meta-data&quot;
    Content-Type: application/json; charset=UTF-8
    Content-Transfer-Encoding: 8bit

    {
        &quot;name&quot;: &quot;value&quot;
    }
    --edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
    Content-Disposition: form-data; name=&quot;file-data&quot;; filename=&quot;file.properties&quot;
    Content-Type: text/xml
    Content-Transfer-Encoding: 8bit
    ... File Data ...
</code></pre><p>å¯¹äºåç§°ä¸º<code>meta-data</code>çš„éƒ¨åˆ†ï¼Œä½ å¯ä»¥é€šè¿‡æ§åˆ¶å™¨æ–¹æ³•ä¸Šçš„<code>@RequestParam(&quot;meta-data&quot;) String metadata</code>å‚æ•°æ¥è·å¾—ã€‚ä½†å¯¹äºé‚£éƒ¨åˆ†è¯·æ±‚ä½“ä¸­ä¸ºJSONæ ¼å¼æ•°æ®çš„è¯·æ±‚ï¼Œä½ å¯èƒ½æ›´æƒ³é€šè¿‡æ¥å—ä¸€ä¸ªå¯¹åº”çš„å¼ºç±»å‹å¯¹è±¡ï¼Œå°±åƒ<code>@RequestBody</code>é€šè¿‡<code>HttpMessageConverter</code>å°†ä¸€èˆ¬è¯·æ±‚çš„è¯·æ±‚ä½“è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡ä¸€æ ·ã€‚</p>
<p>è¿™æ˜¯å¯èƒ½çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>@RequestPart</code>æ³¨è§£æ¥å®ç°ï¼Œè€Œé<code>@RequestParam</code>ã€‚è¯¥æ³¨è§£å°†ä½¿å¾—ç‰¹å®šå¤šè·¯è¯·æ±‚çš„è¯·æ±‚ä½“è¢«ä¼ ç»™<code>HttpMessageConverter</code>ï¼Œå¹¶ä¸”åœ¨è½¬æ¢æ—¶è€ƒè™‘å¤šè·¯è¯·æ±‚ä¸­ä¸åŒçš„å†…å®¹ç±»å‹å‚æ•°<code>&#39;Content-Type&#39;</code>ï¼š</p>
<pre><code class="lang-java">@RequestMapping(path = &quot;/someUrl&quot;, method = RequestMethod.POST)
public String onSubmit(@RequestPart(&quot;meta-data&quot;) MetaData metadata, @RequestPart(&quot;file-data&quot;) MultipartFile file) {

    // ...

}
</code></pre>
<p>è¯·æ³¨æ„<code>MultipartFile</code>æ–¹æ³•å‚æ•°æ˜¯å¦‚ä½•èƒ½å¤Ÿåœ¨<code>@RequestParam</code>æˆ–<code>@RequestPart</code>æ³¨è§£ä¸‹äº’ç”¨çš„ï¼Œä¸¤ç§æ–¹æ³•éƒ½èƒ½æ‹¿åˆ°æ•°æ®ã€‚ä½†ï¼Œè¿™é‡Œçš„æ–¹æ³•å‚æ•°<code>@RequestPart(&quot;meta-data&quot;) MetaData</code>åˆ™ä¼šå› ä¸ºè¯·æ±‚ä¸­çš„å†…å®¹ç±»å‹è¯·æ±‚å¤´<code>&#39;Content-Type&#39;</code>è¢«è¯»å…¥æˆä¸ºJSONæ•°æ®ï¼Œç„¶åå†é€šè¿‡<code>MappingJackson2HttpMessageConverter</code>è¢«è½¬æ¢æˆç‰¹å®šçš„å¯¹è±¡ã€‚</p>
</section<section><h1 id="21-11-">21.11 å¼‚å¸¸å¤„ç†</h1>
<ul>
<li><a href="1-handler-exception-handler.md">å¤„ç†å™¨å¼‚å¸¸è§£æå™¨HandlerExceptionHandler</a></li>
<li><a href="2-@exception-handler.md">@ExceptionHandleræ³¨è§£</a></li>
<li><a href="3-handling-standard-spring-mvc-exceptions.md">å¤„ç†ä¸€èˆ¬çš„Spring MVCå¼‚å¸¸</a></li>
<li><a href="4-annotating-business-exceptions-with-@response-status.md">ä½¿ç”¨@ResponseStatusæ³¨è§£ä¸šåŠ¡å¼‚å¸¸</a></li>
<li><a href="5-customizing-the-default-servlet-container-error-page.md">Servleté»˜è®¤å®¹å™¨é”™è¯¯é¡µé¢çš„å®šåˆ¶åŒ–</a></li>
</ul>
</section<section><h1 id="21-11-1-handlerexceptionhandler">21.11.1 å¤„ç†å™¨å¼‚å¸¸è§£æå™¨HandlerExceptionHandler</h1>
<p>Springçš„å¤„ç†å™¨å¼‚å¸¸è§£æå™¨<code>HandlerExceptionResolver</code>æ¥å£çš„å®ç°è´Ÿè´£å¤„ç†å„ç±»æ§åˆ¶å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ã€‚æŸç§ç¨‹åº¦ä¸Šè®²ï¼Œ<code>HandlerExceptionResolver</code>ä¸ä½ åœ¨webåº”ç”¨æè¿°ç¬¦<code>web.xml</code>æ–‡ä»¶ä¸­èƒ½å®šä¹‰çš„å¼‚å¸¸æ˜ å°„ï¼ˆexception mappingï¼‰å¾ˆç›¸åƒï¼Œä¸è¿‡å®ƒæ¯”åè€…æä¾›äº†æ›´çµæ´»çš„æ–¹å¼ã€‚æ¯”å¦‚å®ƒèƒ½æä¾›å¼‚å¸¸è¢«æŠ›å‡ºæ—¶æ­£åœ¨æ‰§è¡Œçš„æ˜¯å“ªä¸ªå¤„ç†å™¨è¿™æ ·çš„ä¿¡æ¯ã€‚å¹¶ä¸”ï¼Œä¸€ä¸ªæ›´çµæ´»ï¼ˆprogrammaticï¼‰çš„å¼‚å¸¸å¤„ç†æ–¹å¼å¯ä»¥ä¸ºä½ æä¾›æ›´å¤šé€‰æ‹©ï¼Œä½¿ä½ åœ¨è¯·æ±‚è¢«ç›´æ¥è½¬å‘åˆ°å¦ä¸€ä¸ªURLä¹‹å‰ï¼ˆä¸ä½ ä½¿ç”¨Servletè§„èŒƒçš„å¼‚å¸¸æ˜ å°„æ˜¯ä¸€æ ·çš„ï¼‰æœ‰æ›´å¤šçš„æ–¹å¼æ¥å¤„ç†å¼‚å¸¸ã€‚</p>
<p>å®ç°<code>HandlerExceptionResolver</code>æ¥å£å¹¶éå®ç°å¼‚å¸¸å¤„ç†çš„å”¯ä¸€æ–¹å¼ï¼Œå®ƒåªæ˜¯æä¾›äº†<code>resolveException(Exception, Hanlder)</code>æ–¹æ³•çš„ä¸€ä¸ªå®ç°è€Œå·²ï¼Œæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>ModelAndView</code>ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥æ¡†æ¶æä¾›çš„<code>SimpleMappingExceptionResolver</code>æˆ–åœ¨å¼‚å¸¸å¤„ç†æ–¹æ³•ä¸Šæ³¨è§£<code>@ExceptionHandler</code>ã€‚<code>SimpleMappingExceptionResolver</code>å…è®¸ä½ è·å–å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»çš„åå­—ï¼Œå¹¶æŠŠå®ƒæ˜ å°„åˆ°ä¸€ä¸ªè§†å›¾åä¸Šå»ã€‚è¿™ä¸Servlet APIæä¾›çš„å¼‚å¸¸æ˜ å°„ç‰¹æ€§æ˜¯åŠŸèƒ½ç­‰ä»·çš„ï¼Œä½†ä½ ä¹Ÿå¯ä»¥åŸºäºæ­¤å®ç°ç²’åº¦æ›´ç²¾ç»†çš„å¼‚å¸¸æ˜ å°„ã€‚è€Œ<code>@ExceptionHandler</code>æ³¨è§£çš„æ–¹æ³•åˆ™ä¼šåœ¨å¼‚å¸¸æŠ›å‡ºæ—¶è¢«è°ƒç”¨ä»¥å¤„ç†è¯¥å¼‚å¸¸ã€‚è¿™æ ·çš„æ–¹æ³•å¯ä»¥å®šä¹‰åœ¨<code>@Controller</code>æ³¨è§£çš„æ§åˆ¶å™¨ç±»é‡Œï¼Œä¹Ÿå¯ä»¥å®šä¹‰åœ¨<code>@ControllerAdvice</code>ç±»ä¸­ï¼Œåè€…å¯ä»¥ä½¿è¯¥å¼‚å¸¸å¤„ç†æ–¹æ³•è¢«åº”ç”¨åˆ°æ›´å¤šçš„<code>@Controller</code>æ§åˆ¶å™¨ä¸­ã€‚ä¸‹ä¸€å°èŠ‚å°†æä¾›æ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯ã€‚</p>
</section<section><h1 id="21-11-2-exceptionhandler-">21.11.2 @ExceptionHandleræ³¨è§£</h1>
<p><code>HandlerExceptionResolver</code>æ¥å£ä»¥åŠ<code>SimpleMappingExceptionResolver</code>è§£æå™¨ç±»çš„å®ç°ä½¿å¾—ä½ èƒ½å£°æ˜å¼åœ°å°†å¼‚å¸¸æ˜ å°„åˆ°ç‰¹å®šçš„è§†å›¾ä¸Šï¼Œè¿˜å¯ä»¥åœ¨å¼‚å¸¸è¢«è½¬å‘ï¼ˆforwardï¼‰åˆ°å¯¹åº”çš„è§†å›¾å‰ä½¿ç”¨Javaä»£ç åšäº›åˆ¤æ–­å’Œé€»è¾‘ã€‚ä¸è¿‡åœ¨ä¸€äº›åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯ä¾é <code>@ResponseBody</code>è¿”å›å“åº”è€Œéä¾èµ–è§†å›¾è§£ææœºåˆ¶çš„åœºæ™¯ä¸‹ï¼Œç›´æ¥è®¾ç½®å“åº”çš„çŠ¶æ€ç å¹¶å°†å®¢æˆ·ç«¯éœ€è¦çš„é”™è¯¯ä¿¡æ¯ç›´æ¥å†™å›å“åº”ä½“ä¸­ï¼Œå¯èƒ½æ˜¯æ›´æ–¹ä¾¿çš„æ–¹æ³•ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨<code>@ExceptionHandler</code>æ–¹æ³•æ¥åšåˆ°è¿™ç‚¹ã€‚å¦‚æœ<code>@ExceptionHandler</code>æ–¹æ³•æ˜¯åœ¨æ§åˆ¶å™¨å†…éƒ¨å®šä¹‰çš„ï¼Œé‚£ä¹ˆå®ƒä¼šæ¥æ”¶å¹¶å¤„ç†ç”±æ§åˆ¶å™¨ï¼ˆæˆ–å…¶ä»»ä½•å­ç±»ï¼‰ä¸­çš„<code>@RequestMapping</code>æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ã€‚å¦‚æœä½ å°†<code>@ExceptionHandler</code>æ–¹æ³•å®šä¹‰åœ¨<code>@ControllerAdvice</code>ç±»ä¸­ï¼Œé‚£ä¹ˆå®ƒä¼šå¤„ç†ç›¸å…³æ§åˆ¶å™¨ä¸­æŠ›å‡ºçš„å¼‚å¸¸ã€‚ä¸‹é¢çš„ä»£ç å°±å±•ç¤ºäº†ä¸€ä¸ªå®šä¹‰åœ¨æ§åˆ¶å™¨å†…éƒ¨çš„<code>@ExceptionHandler</code>æ–¹æ³•ï¼š</p>
<pre><code class="lang-java">@Controller
public class SimpleController {

    // @RequestMapping methods omitted ...

    @ExceptionHandler(IOException.class)
    public ResponseEntity&lt;String&gt; handleIOException(IOException ex) {
        // prepare responseEntity
        return responseEntity;
    }

}
</code></pre>
<p>æ­¤å¤–ï¼Œ<code>@ExceptionHandler</code>æ³¨è§£è¿˜å¯ä»¥æ¥å—ä¸€ä¸ªå¼‚å¸¸ç±»å‹çš„æ•°ç»„ä½œä¸ºå‚æ•°å€¼ã€‚è‹¥æŠ›å‡ºäº†å·²åœ¨åˆ—è¡¨ä¸­å£°æ˜çš„å¼‚å¸¸ï¼Œé‚£ä¹ˆç›¸åº”çš„<code>@ExceptionHandler</code>æ–¹æ³•å°†ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰ç»™æ³¨è§£ä»»ä½•å‚æ•°å€¼ï¼Œé‚£ä¹ˆé»˜è®¤å¤„ç†çš„å¼‚å¸¸ç±»å‹å°†æ˜¯æ–¹æ³•å‚æ•°æ‰€å£°æ˜çš„é‚£äº›å¼‚å¸¸ã€‚</p>
<p>ä¸æ ‡å‡†çš„æ§åˆ¶å™¨<code>@RequestMapping</code>æ³¨è§£å¤„ç†æ–¹æ³•ä¸€æ ·ï¼Œ<code>@ExceptionHandler</code>æ–¹æ³•çš„æ–¹æ³•å‚æ•°å’Œè¿”å›å€¼ä¹Ÿå¯ä»¥å¾ˆçµæ´»ã€‚æ¯”å¦‚ï¼Œåœ¨Servletç¯å¢ƒä¸‹æ–¹æ³•å¯ä»¥æ¥æ”¶<code>HttpServletRequest</code>å‚æ•°ï¼Œè€ŒPortletç¯å¢ƒä¸‹æ–¹æ³•å¯ä»¥æ¥æ”¶<code>PortletRequest</code>å‚æ•°ã€‚è¿”å›å€¼å¯ä»¥æ˜¯<code>String</code>ç±»å‹â€”â€”è¿™ç§æƒ…å†µä¸‹ä¼šè¢«è§£æä¸ºè§†å›¾åâ€”â€”å¯ä»¥æ˜¯<code>ModelAndView</code>ç±»å‹çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯<code>ResponseEntity</code>ã€‚æˆ–è€…ä½ è¿˜å¯ä»¥åœ¨æ–¹æ³•ä¸Šæ·»åŠ <code>@ResponseBody</code>æ³¨è§£ä»¥ä½¿ç”¨æ¶ˆæ¯è½¬æ¢å™¨ä¼šè½¬æ¢ä¿¡æ¯ä¸ºç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œç„¶åæŠŠå®ƒä»¬å†™å›åˆ°å“åº”æµä¸­ã€‚</p>
</section<section><h1 id="21-11-3-spring-mvc-">21.11.3 å¤„ç†ä¸€èˆ¬çš„Spring MVCå¼‚å¸¸</h1>
<p>å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼ŒSpring MVCå¯èƒ½ä¼šæŠ›å‡ºä¸€äº›çš„å¼‚å¸¸ã€‚<code>SimpleMappingExceptionResolver</code>å¯ä»¥æ ¹æ®éœ€è¦å¾ˆæ–¹ä¾¿åœ°å°†ä»»ä½•å¼‚å¸¸æ˜ å°„åˆ°ä¸€ä¸ªé»˜è®¤çš„é”™è¯¯è§†å›¾ã€‚ä½†ï¼Œå¦‚æœå®¢æˆ·ç«¯æ˜¯é€šè¿‡è‡ªåŠ¨æ£€æµ‹å“åº”çš„æ–¹å¼æ¥åˆ†å‘å¤„ç†å¼‚å¸¸çš„ï¼Œé‚£ä¹ˆåç«¯å°±éœ€è¦ä¸ºå“åº”è®¾ç½®å¯¹åº”çš„çŠ¶æ€ç ã€‚æ ¹æ®æŠ›å‡ºå¼‚å¸¸çš„ç±»å‹ä¸åŒï¼Œå¯èƒ½éœ€è¦è®¾ç½®ä¸åŒçš„çŠ¶æ€ç æ¥æ ‡è¯†æ˜¯å®¢æˆ·ç«¯é”™è¯¯ï¼ˆ4xxï¼‰è¿˜æ˜¯æœåŠ¡å™¨ç«¯é”™è¯¯ï¼ˆ5xxï¼‰ã€‚</p>
<p>é»˜è®¤å¤„ç†å™¨å¼‚å¸¸è§£æå™¨<code>DefaultHandlerExceptionResolver</code>ä¼šå°†Spring MVCæŠ›å‡ºçš„å¼‚å¸¸è½¬æ¢æˆå¯¹åº”çš„é”™è¯¯çŠ¶æ€ç ã€‚è¯¥è§£æå™¨åœ¨MVCå‘½åç©ºé—´é…ç½®æˆ–MVC Javaé…ç½®çš„æ–¹å¼ä¸‹é»˜è®¤å·²ç»è¢«æ³¨å†Œäº†ï¼Œå¦å¤–ï¼Œé€šè¿‡<code>DispatcherServlet</code>æ³¨å†Œä¹Ÿæ˜¯å¯è¡Œçš„ï¼ˆå³ä¸ä½¿ç”¨MVCå‘½åç©ºé—´æˆ–Javaç¼–ç¨‹æ–¹å¼è¿›è¡Œé…ç½®çš„æ—¶å€™ï¼‰ã€‚ä¸‹è¡¨åˆ—å‡ºäº†è¯¥è§£æå™¨èƒ½å¤„ç†çš„ä¸€äº›å¼‚å¸¸ï¼ŒåŠä»–ä»¬å¯¹åº”çš„çŠ¶æ€ç ã€‚</p>
<table>
<thead>
<tr>
<th>å¼‚å¸¸</th>
<th>HTTPçŠ¶æ€ç </th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BindException</code></td>
<td>400 (æ— æ•ˆè¯·æ±‚)</td>
</tr>
<tr>
<td><code>ConversionNotSupportedException</code></td>
<td>500 (æœåŠ¡å™¨å†…éƒ¨é”™è¯¯)</td>
</tr>
<tr>
<td><code>HttpMediaTypeNotAcceptableException</code></td>
<td>406 (ä¸æ¥å—)</td>
</tr>
<tr>
<td><code>HttpMediaTypeNotSupportedException</code></td>
<td>415 (ä¸æ”¯æŒçš„åª’ä½“ç±»å‹)</td>
</tr>
<tr>
<td><code>HttpMessageNotReadableException</code></td>
<td>400 (æ— æ•ˆè¯·æ±‚)</td>
</tr>
<tr>
<td><code>HttpMessageNotWritableException</code></td>
<td>500 (æœåŠ¡å™¨å†…éƒ¨é”™è¯¯)</td>
</tr>
<tr>
<td><code>HttpRequestMethodNotSupportedException</code></td>
<td>405 (ä¸æ”¯æŒçš„æ–¹æ³•)</td>
</tr>
<tr>
<td><code>MethodArgumentNotValidException</code></td>
<td>400 (æ— æ•ˆè¯·æ±‚)</td>
</tr>
<tr>
<td><code>MissingServletRequestParameterException</code></td>
<td>400 (æ— æ•ˆè¯·æ±‚)</td>
</tr>
<tr>
<td><code>MissingServletRequestPartException</code></td>
<td>400 (æ— æ•ˆè¯·æ±‚)</td>
</tr>
<tr>
<td><code>NoHandlerFoundException</code></td>
<td>404 (è¯·æ±‚æœªæ‰¾åˆ°)</td>
</tr>
<tr>
<td><code>NoSuchRequestHandlingMethodException</code></td>
<td>404 (è¯·æ±‚æœªæ‰¾åˆ°)</td>
</tr>
<tr>
<td><code>TypeMismatchException</code></td>
<td>400 (æ— æ•ˆè¯·æ±‚)</td>
</tr>
<tr>
<td><code>MissingPathVariableException</code></td>
<td>500 (æœåŠ¡å™¨å†…éƒ¨é”™è¯¯)</td>
</tr>
<tr>
<td><code>NoHandlerFoundException</code></td>
<td>404 (è¯·æ±‚æœªæ‰¾åˆ°)</td>
</tr>
</tbody>
</table>
<p>ä»¥ä¸‹å¾…ç¿»è¯‘ã€‚</p>
<p>The <code>DefaultHandlerExceptionResolver</code> works transparently by setting the
status of the response. However, it stops short of writing any error content
to the body of the response while your application may need to add developer-
friendly content to every error response for example when providing a REST
API. You can prepare a <code>ModelAndView</code> and render error content through view
resolutionâ€‰--â€‰i.e. by configuring a <code>ContentNegotiatingViewResolver</code>,
<code>MappingJackson2JsonView</code>, and so on. However, you may prefer to use
<code>@ExceptionHandler</code> methods instead.</p>
<p>If you prefer to write error content via <code>@ExceptionHandler</code> methods you can
extend <code>ResponseEntityExceptionHandler</code> instead. This is a convenient base for
<code>@ControllerAdvice</code> classes providing an <code>@ExceptionHandler</code> method to handle
standard Spring MVC exceptions and return <code>ResponseEntity</code>. That allows you to
customize the response and write error content with message converters. See
the <code>ResponseEntityExceptionHandler</code> javadocs for more details.</p>
</section<section><h1 id="21-11-4-responsestatus-">21.11.4 ä½¿ç”¨@ResponseStatusæ³¨è§£ä¸šåŠ¡å¼‚å¸¸</h1>
<p>ä¸šåŠ¡å¼‚å¸¸å¯ä»¥ä½¿ç”¨<code>@ResponseStatus</code>æ¥æ³¨è§£ã€‚å½“å¼‚å¸¸è¢«æŠ›å‡ºæ—¶ï¼Œ<code>ResponseStatusExceptionResolver</code>ä¼šè®¾ç½®ç›¸åº”çš„å“åº”çŠ¶æ€ç ã€‚<code>DispatcherServlet</code>ä¼šé»˜è®¤æ³¨å†Œä¸€ä¸ª<code>ResponseStatusExceptionResolver</code>ä»¥ä¾›ä½¿ç”¨ã€‚</p>
</section<section><h1 id="21-11-5-servlet-">21.11.5 Servleté»˜è®¤å®¹å™¨é”™è¯¯é¡µé¢çš„å®šåˆ¶åŒ–</h1>
<p>å½“å“åº”çš„çŠ¶æ€ç è¢«è®¾ç½®ä¸ºé”™è¯¯çŠ¶æ€ç ï¼Œå¹¶ä¸”å“åº”ä½“ä¸­æ²¡æœ‰å†…å®¹æ—¶ï¼ŒServletå®¹å™¨é€šå¸¸ä¼šæ¸²æŸ“ä¸€ä¸ªHTMLé”™è¯¯é¡µã€‚è‹¥éœ€è¦å®šåˆ¶å®¹å™¨é»˜è®¤æä¾›çš„é”™è¯¯é¡µï¼Œä½ å¯ä»¥åœ¨<code>web.xml</code>ä¸­å®šä¹‰ä¸€ä¸ªé”™è¯¯é¡µé¢<code>&lt;error-page&gt;</code>å…ƒç´ ã€‚åœ¨Servlet 3è§„èŒƒå‡ºæ¥ä¹‹å‰ï¼Œè¯¥é”™è¯¯é¡µå…ƒç´ å¿…é¡»è¢«æ˜¾å¼æŒ‡å®šæ˜ å°„åˆ°ä¸€ä¸ªå…·ä½“çš„é”™è¯¯ç æˆ–ä¸€ä¸ªå¼‚å¸¸ç±»å‹ã€‚ä»Servlet 3å¼€å§‹ï¼Œé”™è¯¯é¡µä¸å†éœ€è¦æ˜ å°„åˆ°å…¶ä»–ä¿¡æ¯äº†ï¼Œè¿™æ„å‘³ç€ï¼Œä½ æŒ‡å®šçš„ä½ç½®å°±æ˜¯å¯¹Servletå®¹å™¨é»˜è®¤é”™è¯¯é¡µçš„è‡ªå®šåˆ¶äº†ã€‚</p>
<pre><code class="lang-xml">&lt;error-page&gt;
    &lt;location&gt;/error&lt;/location&gt;
&lt;/error-page&gt;
</code></pre>
<p>è¿™é‡Œé”™è¯¯é¡µçš„ä½ç½®æ‰€åœ¨å¯ä»¥æ˜¯ä¸€ä¸ªJSPé¡µé¢ï¼Œæˆ–è€…å…¶ä»–çš„ä¸€äº›URLï¼Œåªè¦å®ƒæŒ‡å®šå®¹å™¨é‡Œä»»æ„ä¸€ä¸ª<code>@Controller</code>æ§åˆ¶å™¨ä¸‹çš„å¤„ç†å™¨æ–¹æ³•ï¼š</p>
<p>å†™å›<code>HttpServletResponse</code>çš„é”™è¯¯ä¿¡æ¯å’Œé”™è¯¯çŠ¶æ€ç å¯ä»¥åœ¨æ§åˆ¶å™¨ä¸­é€šè¿‡è¯·æ±‚å±æ€§æ¥è·å–ï¼š</p>
<pre><code class="lang-java">@Controller
public class ErrorController {

    @RequestMapping(path = &quot;/error&quot;, produces = MediaType.APPLICATION_JSON_UTF8_VALUE)
    @ResponseBody
    public Map&lt;String, Object&gt; handle(HttpServletRequest request) {

        Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();
        map.put(&quot;status&quot;, request.getAttribute(&quot;javax.servlet.error.status_code&quot;));
        map.put(&quot;reason&quot;, request.getAttribute(&quot;javax.servlet.error.message&quot;));

        return map;
    }

}
</code></pre>
<p>æˆ–è€…åœ¨JSPä¸­è¿™ä¹ˆä½¿ç”¨:</p>
<pre><code class="lang-JSP">&lt;%@ page contentType=&quot;application/json&quot; pageEncoding=&quot;UTF-8&quot;%&gt;
{
    status:&lt;%=request.getAttribute(&quot;javax.servlet.error.status_code&quot;) %&gt;,
    reason:&lt;%=request.getAttribute(&quot;javax.servlet.error.message&quot;) %&gt;
}
</code></pre>
</section<section><h1 id="21-12-web-">21.12 Webå®‰å…¨</h1>
<p><a href="http://projects.spring.io/spring-security/">Spring Security</a>é¡¹ç›®ä¸ºä¿æŠ¤webåº”ç”¨å…å—æ¶æ„æ”»å‡»æä¾›äº†ä¸€äº›ç‰¹æ€§ã€‚ä½ å¯ä»¥å»çœ‹çœ‹å‚è€ƒæ–‡æ¡£çš„è¿™å‡ å°èŠ‚ï¼š<a href="http://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#csrf">&quot;CSRFä¿æŠ¤&quot;</a>ã€<a href="http://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#headers">&quot;å®‰å…¨å“åº”å¤´&quot;</a>ä»¥åŠ<a href="http://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#mvc">&quot;Spring
MVCé›†æˆ&quot;</a>ã€‚ä¸è¿‡å¹¶éåº”ç”¨çš„æ‰€æœ‰ç‰¹æ€§éƒ½éœ€è¦å¼•å…¥Spring Securityã€‚æ¯”å¦‚ï¼Œéœ€è¦CSRFä¿æŠ¤çš„è¯ï¼Œä½ ä»…éœ€è¦ç®€å•åœ°åœ¨é…ç½®ä¸­æ·»åŠ ä¸€ä¸ªè¿‡æ»¤å™¨<code>CsrfFilter</code>å’Œå¤„ç†å™¨<code>CsrfRequestDataValueProcessor</code>ã€‚ä½ å¯ä»¥å‚è€ƒ<a href="https://github.com/spring-projects/spring-mvc-showcase/commit/361adc124c05a8187b84f25e8a57550bb7d9f8e4">Spring MVC Showcase</a>ä¸€èŠ‚ï¼Œè§‚çœ‹ä¸€ä¸ªå®Œæ•´çš„å±•ç¤ºã€‚</p>
<p>å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ä½¿ç”¨å…¶ä»–ä¸“æ³¨äºWebå®‰å…¨çš„æ¡†æ¶ã€‚<a href="http://hdiv.org/">HDIV</a>å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ¡†æ¶ï¼Œå¹¶ä¸”å®ƒèƒ½ä¸Spring MVCè‰¯å¥½é›†æˆã€‚</p>
</section<section><h1 id="21-13-">21.13 &quot;çº¦å®šä¼˜äºé…ç½®&quot;çš„æ”¯æŒ</h1>
<p>å¯¹äºè®¸å¤šé¡¹ç›®æ¥è¯´ï¼Œä¸æ‰“ç ´å·²æœ‰çš„çº¦å®šï¼Œå¯¹äºé…ç½®ç­‰æœ‰å¯é¢„æµ‹çš„é»˜è®¤å€¼æ˜¯éå¸¸é€‚åˆçš„ã€‚ç°åœ¨ï¼ŒSpring MVCå¯¹ <em>çº¦å®šä¼˜äºé…ç½®</em> è¿™ä¸ªå®è·µå·²ç»æœ‰äº†æ˜¾å¼çš„æ”¯æŒã€‚è¿™æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿæ„å‘³ç€å¦‚æœä½ ä¸ºé¡¹ç›®é€‰æ‹©äº†ä¸€ç»„å‘½åä¸Šçš„çº¦å®š/è§„èŒƒï¼Œä½ å°†èƒ½å‡å°‘ <em>å¤§é‡</em> çš„é…ç½®é¡¹ï¼Œæ¯”å¦‚ä¸€äº›å¿…è¦çš„å¤„ç†å™¨æ˜ å°„ã€è§†å›¾è§£æå™¨ã€<code>ModelAndView</code>å®ä¾‹çš„é…ç½®ç­‰ã€‚è¿™èƒ½å¸®ä½ å¿«é€Ÿåœ°å»ºç«‹èµ·é¡¹ç›®åŸå‹ï¼Œæ­¤å¤–åœ¨æŸç§ç¨‹åº¦ä¸Šï¼ˆé€šå¸¸æ˜¯å¥½çš„æ–¹é¢ï¼‰ç»´æŠ¤äº†æ•´ä¸ªä»£ç åº“çš„ä¸€è‡´æ€§should you choose to move forward with it into production.</p>
<p>å…·ä½“æ¥è¯´ï¼Œæ”¯æŒâ€œçº¦å®šä¼˜äºé…ç½®â€æ¶‰åŠåˆ°MVCçš„ä¸‰ä¸ªæ ¸å¿ƒæ–¹é¢ï¼šæ¨¡å‹ã€è§†å›¾ï¼Œå’Œæ§åˆ¶å™¨ã€‚</p>
</section<section><h1 id="21-13-1-controllerclassnamehandlermapping">21.13.1 æ§åˆ¶å™¨ç±»å-å¤„ç†å™¨æ˜ å°„ControllerClassNameHandlerMapping</h1>
<p><code>ControllerClassNameHandlerMapping</code>ç±»æ˜¯<code>HandlerMapping</code>æ¥å£çš„ä¸€ä¸ªå®ç°ï¼Œå®ƒæ˜¯é€šè¿‡ä¸€ä¸ªçº¦å®šæ¥è§£æè¯·æ±‚URLåŠå¤„ç†è¯¥è¯·æ±‚çš„<code>@Controller</code>æ§åˆ¶å™¨å®ä¾‹ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p>
<p>è¯·çœ‹ä¸‹é¢ä¸€ä¸ªç®€å•çš„æ§åˆ¶å™¨å®ç°ã€‚è¯·æ³¨æ„ç•™æ„è¯¥ç±»çš„ <em>åç§°</em>ï¼š</p>
<pre><code class="lang-java">public class **ViewShoppingCartController** implements Controller {

    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        // è¿™ä¸ªä¾‹å­ä¸­æ–¹æ³•çš„å…·ä½“å®ç°å¹¶ä¸é‡è¦ï¼Œæ•…å¿½ç•¥ã€‚
    }

}
</code></pre>
<p>å¯¹åº”çš„Spring Web MVCé…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="lang-xml">&lt;bean class=&quot;org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping&quot;/&gt;

&lt;bean id=&quot;**viewShoppingCart**&quot; class=&quot;x.y.z.ViewShoppingCartController&quot;&gt;
    &lt;!-- æ³¨å…¥éœ€è¦çš„ä¾èµ– --&gt;
&lt;/bean&gt;
</code></pre>
<p><code>ControllerClassNameHandlerMapping</code>ä¼šæŸ¥æ‰¾å½“å‰åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œçš„æ‰€æœ‰å¤„ç†å™¨ï¼ˆä¹Ÿå³æ§åˆ¶å™¨ï¼‰beanï¼Œå¹¶å»é™¤ç±»åçš„<code>Controller</code>åç¼€ä½œä¸ºå†³å®šå¤„ç†å™¨æ˜ å°„çš„ä¾æ®ã€‚å› æ­¤ï¼Œç±»å<code>ViewShoppingCartController</code>ä¼šè¢«æ˜ å°„åˆ°åŒ¹é…<code>/viewshoppingcart*</code>çš„è¯·æ±‚URLä¸Šã€‚</p>
<p>è®©æˆ‘ä»¬å¤šçœ‹å‡ ä¸ªä¾‹å­ï¼Œè¿™æ ·ä½ å¯¹äºæ ¸å¿ƒçš„æ€æƒ³ä¼šé©¬ä¸Šç†Ÿæ‚‰èµ·æ¥ï¼ˆæ³¨æ„URLä¸­è·¯å¾„æ˜¯å…¨å°å†™ï¼Œè€Œ<code>Controller</code>æ§åˆ¶å™¨ç±»åç¬¦åˆé©¼å³°å‘½åæ³•ï¼‰ï¼š</p>
<ul>
<li><code>WelcomeController</code>å°†æ˜ å°„åˆ°<code>/welcome*</code>è¯·æ±‚URL</li>
<li><code>HomeController</code> å°†æ˜ å°„åˆ°<code>/home*</code>è¯·æ±‚URL</li>
<li><code>IndexController</code> å°†æ˜ å°„åˆ°<code>/index*</code>è¯·æ±‚URL</li>
<li><code>RegisterController</code> å°†æ˜ å°„åˆ°<code>/register*</code>è¯·æ±‚URL</li>
</ul>
<p>å¯¹äº<code>MultiActionController</code>å¤„ç†å™¨ç±»ï¼Œæ˜ å°„è§„åˆ™è¦ç¨å¾®å¤æ‚ä¸€äº›ã€‚è¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼Œå‡è®¾è¿™é‡Œçš„æ§åˆ¶å™¨éƒ½æ˜¯<code>MultiActionController</code>çš„å®ç°ï¼š</p>
<ul>
<li><code>AdminController</code>å°†æ˜ å°„åˆ°<code>/admin/*</code>è¯·æ±‚URL</li>
<li><code>CatalogController</code>å°†æ˜ å°„åˆ°<code>/catalog/*</code>è¯·æ±‚URL</li>
</ul>
<p>åªè¦æ‰€æœ‰æ§åˆ¶å™¨<code>Controller</code>å®ç°éƒ½éµå¾ª<code>xxxController</code>è¿™æ ·çš„å‘½åè§„èŒƒï¼Œé‚£ä¹ˆ<code>ControllerClassNameHandlerMapping</code>èƒ½æŠŠä½ ä»å®šä¹‰ç»´æŠ¤ä¸€ä¸ª <em>é•¿é•¿é•¿</em> <code>SimpleUrlHandlerMapping</code>æ˜ å°„è¡¨çš„é‡å¤å·¥ä½œä¸­æ‹¯æ•‘å‡ºæ¥ã€‚</p>
<p><code>ControllerClassNameHandlerMapping</code>ç±»ç»§æ‰¿è‡ª <code>AbstractHandlerMapping</code>åŸºç±»ã€‚å› æ­¤ï¼Œä½ å¯ä»¥è§†å®ƒä¸å…¶ä»–<code>HandlerMapping</code>å®ç°ä¸€æ ·ï¼Œå®šä¹‰ä½ æ‰€éœ€è¦çš„æ‹¦æˆªå™¨<code>HandlerInterceptor</code>å®ä¾‹åŠå…¶ä»–æ‰€æœ‰ä¸œè¥¿ã€‚</p>
</section<section><h1 id="21-13-2-modelmap-modelandview-">21.13.2 æ¨¡å‹ModelMap(ModelAndView)</h1>
<p><code>ModelMap</code>ç±»å…¶å®å°±æ˜¯ä¸€ä¸ªè±ªåç‰ˆçš„ <code>Map</code>ï¼Œå®ƒä½¿å¾—ä½ ä¸ºè§†å›¾å±•ç¤ºéœ€è¦æ‰€æ·»åŠ çš„å¯¹è±¡éƒ½éµå¾ªä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„çº¦å®šè¢«å‘½åã€‚è¯·çœ‹ä¸‹é¢è¿™ä¸ª <code>Controller</code>å®ç°ï¼Œå¹¶è¯·æ³¨æ„ï¼Œæ·»åŠ åˆ°<code>ModelAndView</code>ä¸­å»çš„å¯¹è±¡éƒ½æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šé”®åã€‚</p>
<pre><code class="lang-java">public class DisplayShoppingCartController implements Controller {

    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {

        List cartItems = // æ‹¿åˆ°ä¸€ä¸ªCartItemå¯¹è±¡çš„åˆ—è¡¨
        User user = // æ‹¿åˆ°å½“å‰è´­ç‰©çš„ç”¨æˆ·User

        ModelAndView mav = new ModelAndView(&quot;displayShoppingCart&quot;); &lt;-- é€»è¾‘è§†å›¾å

        mav.addObject(cartItems); &lt;-- å•Šå“ˆï¼Œç›´æ¥æ·»åŠ çš„å¯¹è±¡ï¼Œæ²¡æœ‰æŒ‡å®šåç§°
        mav.addObject(user); &lt;-- å•Šå“ˆå†æ¥ä¸€æ¬¡

        return mav;
    }
}
</code></pre>
<p><code>ModelAndView</code>å†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ª<code>ModelMap</code>ç±»ï¼Œå®ƒæ˜¯<code>Map</code>çš„ä¸€ä¸ªå®ç°ï¼Œä¼šè‡ªåŠ¨ä¸ºæ·»åŠ è¿›æ¥çš„å¯¹è±¡ç”Ÿæˆä¸€ä¸ªé”®åã€‚ä¸ºæ·»åŠ å¯¹è±¡ç”Ÿæˆåç§°çš„ç­–ç•¥æ˜¯ï¼Œè‹¥æ·»åŠ å¯¹è±¡æ˜¯ä¸€ä¸ªçº¯Java beanï¼ˆa scalar objectï¼‰ï¼Œæ¯”å¦‚<code>User</code>ï¼Œé‚£ä¹ˆä½¿ç”¨å¯¹è±¡ç±»çš„çŸ­ç±»åï¼ˆshort class nameï¼‰æ¥ä½œä¸ºè¯¥å¯¹è±¡çš„åç§°ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼Œå±•ç¤ºäº†ä¸ºæ·»åŠ åˆ°<code>ModelMap</code>å®ä¾‹ä¸­çš„çº¯Javaå¯¹è±¡æ‰€ç”Ÿæˆçš„åç§°ï¼š</p>
<ul>
<li>æ·»åŠ ä¸€ä¸ª<code>x.y.User</code>å®ä¾‹ï¼Œä¸ºå…¶ç”Ÿæˆçš„åç§°ä¸º<code>user</code></li>
<li>æ·»åŠ ä¸€ä¸ª<code>x.y.Registration</code>å®ä¾‹ï¼Œä¸ºå…¶ç”Ÿæˆçš„åç§°ä¸º<code>registration</code></li>
<li>æ·»åŠ ä¸€ä¸ª<code>x.y.Foo</code>å®ä¾‹ï¼Œä¸ºå…¶ç”Ÿæˆçš„åç§°ä¸º<code>foo</code></li>
<li>æ·»åŠ ä¸€ä¸ª<code>java.util.HashMap</code>å®ä¾‹ï¼Œä¸ºå…¶ç”Ÿæˆçš„åç§°ä¸º<code>hashMap</code>ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¾å¼åœ°å£°æ˜ä¸€ä¸ªé”®åå¯èƒ½æ›´å¥½ï¼Œå› ä¸º<code>hashMap</code>çš„çº¦å®šå¹¶éé‚£ä¹ˆç¬¦åˆç›´è§‰</li>
<li>æ·»åŠ ä¸€ä¸ª<code>null</code>å€¼å°†å¯¼è‡´ç¨‹åºæŠ›å‡ºä¸€ä¸ª<code>IllegalArgumentException</code>å‚æ•°éæ³•å¼‚å¸¸ã€‚è‹¥ä½ æ‰€æ·»åŠ çš„ï¼ˆå¤šä¸ªï¼‰å¯¹è±¡æœ‰å¯èƒ½ä¸º<code>null</code>å€¼ï¼Œé‚£ä½ ä¹Ÿéœ€è¦æ˜¾å¼åœ°æŒ‡å®šå®ƒï¼ˆä»¬ï¼‰çš„åå­—</li>
</ul>
<p><strong>å•¥ï¼Ÿé”®åä¸èƒ½è‡ªåŠ¨å˜å¤æ•°å½¢å¼ä¹ˆï¼Ÿ</strong></p>
<p>Spring Web MVCçš„çº¦å®šä¼˜äºé…ç½®æ”¯æŒå°šä¸èƒ½æ”¯æŒè‡ªåŠ¨å¤æ•°è½¬æ¢ã€‚è¿™æ„æ€æ˜¯ï¼Œä½ ä¸èƒ½æœŸæœ›å¾€<code>ModelAndView</code>ä¸­æ·»åŠ ä¸€ä¸ª<code>Person</code>å¯¹è±¡çš„<code>List</code>åˆ—è¡¨æ—¶ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨ä¸ºå…¶ç”Ÿæˆä¸€ä¸ªåç§°<code>people</code>ã€‚</p>
<p>è¿™ä¸ªå†³å®šæ˜¯ç»è¿‡è®¸å¤šäº‰è®ºåçš„ç»“æœï¼Œæœ€ç»ˆâ€œæœ€å°æƒŠå–œåŸåˆ™â€èƒœå‡ºå¹¶ä¸ºå¤§å®¶æ‰€æ¥å—ã€‚</p>
<p>ä¸ºé›†åˆ<code>Set</code>æˆ–åˆ—è¡¨<code>List</code>ç”Ÿæˆé”®åæ‰€é‡‡å–çš„ç­–ç•¥ï¼Œæ˜¯å…ˆæ£€æŸ¥é›†åˆçš„å…ƒç´ ç±»å‹ã€æ‹¿åˆ°ç¬¬ä¸€ä¸ªå¯¹è±¡çš„çŸ­ç±»åï¼Œç„¶ååœ¨å…¶åé¢æ·»åŠ <code>List</code>ä½œä¸ºåç§°ã€‚æ·»åŠ æ•°ç»„å¯¹è±¡ä¹Ÿæ˜¯åŒç†ï¼Œå°½ç®¡å¯¹äºæ•°ç»„æˆ‘ä»¬å°±ä¸éœ€å†æ£€æŸ¥æ•°ç»„å†…å®¹äº†ã€‚ä¸‹é¢ç»™å‡ºçš„å‡ ä¸ªä¾‹å­å¯ä»¥é˜é‡Šä¸€äº›ä¸œè¥¿ï¼Œè®©é›†åˆçš„åç§°ç”Ÿæˆè¯­ä¹‰å˜å¾—æ›´åŠ æ¸…æ™°ï¼š</p>
<ul>
<li>æ·»åŠ ä¸€ä¸ªå¸¦é›¶ä¸ªæˆ–å¤šä¸ª<code>x.y.User</code>å…ƒç´ ç±»å‹çš„æ•°ç»„<code>x.y.User[]</code>ï¼Œä¸ºå…¶ç”Ÿæˆçš„é”®åæ˜¯<code>userList</code></li>
<li>æ·»åŠ ä¸€ä¸ªå¸¦é›¶ä¸ªæˆ–å¤šä¸ª<code>x.y.User</code>å…ƒç´ ç±»å‹çš„æ•°ç»„<code>x.y.Foo[]</code>ï¼Œä¸ºå…¶ç”Ÿæˆçš„é”®åæ˜¯<code>fooList</code></li>
<li>æ·»åŠ ä¸€ä¸ªå¸¦é›¶ä¸ªæˆ–å¤šä¸ª<code>x.y.User</code>å…ƒç´ ç±»å‹çš„æ•°ç»„<code>java.util.ArrayList</code>ï¼Œä¸ºå…¶ç”Ÿæˆçš„é”®åæ˜¯<code>userList</code></li>
<li>æ·»åŠ ä¸€ä¸ªå¸¦é›¶ä¸ªæˆ–å¤šä¸ª<code>x.y.Foo</code>å…ƒç´ ç±»å‹çš„æ•°ç»„<code>java.util.HashSet</code>ï¼Œä¸ºå…¶ç”Ÿæˆçš„é”®åæ˜¯<code>fooList</code></li>
<li>ä¸€ä¸ª <em>ç©ºçš„</em> <code>java.util.ArrayList</code>åˆ™æ ¹æœ¬ä¸ä¼šè¢«æ·»åŠ </li>
</ul>
</section<section><h1 id="21-13-3-">21.13.3 è§†å›¾-è¯·æ±‚ä¸è§†å›¾åçš„æ˜ å°„</h1>
<p><code>RequestToViewNameTranslator</code>æ¥å£å¯ä»¥åœ¨é€»è¾‘è§†å›¾åæœªè¢«æ˜¾å¼æä¾›çš„æƒ…å†µä¸‹ï¼Œå†³å®šä¸€ä¸ªå¯ç”¨çš„é€»è¾‘è§†å›¾<code>View</code>åã€‚</p>
<p><code>DefaultRequestToViewNameTranslator</code>èƒ½å¤Ÿå°†è¯·æ±‚URLæ˜ å°„åˆ°é€»è¾‘è§†å›¾åä¸Šå»ï¼Œå¦‚ä¸‹é¢ä»£ç ä¾‹å­æ‰€ç¤ºï¼š</p>
<pre><code class="lang-java">public class RegistrationController implements Controller {

    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        // å¤„ç†è¯·æ±‚â€¦â€¦
        ModelAndView mav = new ModelAndView();
        // å‘Modelä¸­æ·»åŠ éœ€è¦çš„æ•°æ®
        return mav;
        // è¯·æ³¨æ„è¿™é‡Œï¼Œæ²¡æœ‰è®¾ç½®ä»»ä½•Viewå¯¹è±¡æˆ–é€»è¾‘è§†å›¾å
    }

}
</code></pre>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;

    &lt;!-- è¿™ä¸ªä¼—äººçš†çŸ¥çš„beanå°†ä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆè§†å›¾å --&gt;
    &lt;bean id=&quot;viewNameTranslator&quot; class=&quot;org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator&quot;/&gt;

    &lt;bean class=&quot;x.y.RegistrationController&quot;&gt;
        &lt;!-- å¦‚æœéœ€è¦ï¼Œæ³¨å…¥ä¾èµ– --&gt;
    &lt;/bean&gt;

    &lt;!-- è¯·è¯·æ±‚URLæ˜ å°„åˆ°æ§åˆ¶å™¨å --&gt;
    &lt;bean class=&quot;org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping&quot;/&gt;

    &lt;bean id=&quot;viewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;
        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;
</code></pre>
<p>è¯·æ³¨æ„åœ¨<code>handleRequest(...)</code>æ–¹æ³•å®ç°ä¸­ï¼Œè¿”å›çš„<code>ModelAndView</code>å¯¹è±¡ä¸Šè‡ªå§‹è‡³ç»ˆæœªè®¾ç½®ä»»ä½•<code>View</code>å¯¹è±¡æˆ–é€»è¾‘è§†å›¾åã€‚è¿™æ˜¯ç”±<code>DefaultRequestToViewNameTranslator</code>å®Œæˆçš„ï¼Œå®ƒçš„ä»»åŠ¡å°±æ˜¯ä»è¯·æ±‚çš„URLä¸­ç”Ÿæˆä¸€ä¸ª<em>é€»è¾‘è§†å›¾å</em>ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>RegistrationController</code>ä¸é…ç½®çš„<code>ControllerClassNameHandlerMapping</code>ä¸€èµ·ä½¿ç”¨çš„ç»“æœæ˜¯ï¼Œä¸€ä¸ªURLä¸º<code>&lt;http://localhost/registration.html&gt;</code>çš„è¯·æ±‚ï¼Œä¼šç»ç”±<code>DefaultRequestToViewNameTranslator</code>ç”Ÿæˆå¹¶å¯¹åº”åˆ°ä¸€ä¸ªé€»è¾‘è§†å›¾å<code>registration</code>ä¸Šã€‚è¯¥é€»è¾‘è§†å›¾ååˆä¼šç”±<code>InternalResourceViewResolver</code>beanè§£æåˆ°<code>/WEB-INF/jsp/registration.jsp</code>è§†å›¾ä¸Šã€‚</p>
<blockquote>
<p>ä½ æ— éœ€æ˜¾å¼åœ°å®šä¹‰ä¸€ä¸ª<code>DefaultRequestToViewNameTranslator</code>beanã€‚å¦‚æœé»˜è®¤çš„<code>DefaultRequestToViewNameTranslator</code>é…ç½®å·²èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œé‚£ä¹ˆä½ æ— éœ€é…ç½®ï¼ŒSpring Web MVCçš„<code>DispatcherServlet</code>ä¼šä¸ºä½ å®ä¾‹åŒ–è¿™æ ·ä¸€ä¸ªé»˜è®¤çš„å¯¹è±¡ã€‚</p>
</blockquote>
<p>å½“ç„¶ï¼Œå¦‚æœä½ éœ€è¦æ›´æ”¹é»˜è®¤çš„è®¾ç½®ï¼Œé‚£ä½ å°±éœ€è¦æ‰‹åŠ¨åœ°é…ç½®è‡ªå·±çš„<code>DefaultRequestToViewNameTranslator</code>beanã€‚å…³äºå¯é…ç½®å±æ€§çš„ä¸€äº›è¯¦ç»†ä¿¡æ¯ï¼Œä½ å¯ä»¥å»å’¨è¯¢<code>DefaultRequestToViewNameTranslator</code>ç±»è¯¦ç»†çš„javaæ–‡æ¡£ã€‚</p>
</section<section><h1 id="21-14-http-">21.14 HTTPç¼“å­˜æ”¯æŒ</h1>
<p>ä¸€ä¸ªå¥½çš„HTTPç¼“å­˜ç­–ç•¥å¯ä»¥æå¤§åœ°æé«˜ä¸€ä¸ªwebåº”ç”¨çš„æ€§èƒ½åŠå®¢æˆ·ç«¯çš„ä½“éªŒã€‚è°ˆåˆ°HTTPç¼“å­˜ï¼Œå®ƒä¸»è¦æ˜¯ä¸HTTPçš„å“åº”å¤´<code>&#39;Cache-Control&#39;</code>ç›¸å…³ï¼Œå…¶æ¬¡å¦å¤–çš„ä¸€äº›å“åº”å¤´æ¯”å¦‚<code>&#39;Last-Modified&#39;</code>å’Œ<code>&#39;ETag&#39;</code>ç­‰ä¹Ÿä¼šèµ·ä¸€å®šçš„ä½œç”¨ã€‚</p>
<p>HTTPçš„å“åº”å¤´<code>&#39;Cache-Control&#39;</code>ä¸»è¦å¸®åŠ©ç§æœ‰ç¼“å­˜ï¼ˆæ¯”å¦‚æµè§ˆå™¨ç«¯ç¼“å­˜ï¼‰å’Œå…¬å…±ç¼“å­˜ï¼ˆæ¯”å¦‚ä»£ç†ç«¯ç¼“å­˜ï¼‰äº†è§£å®ƒä»¬åº”è¯¥å¦‚æœç¼“å­˜HTTPå“åº”ï¼Œä»¥ä¾¿åç”¨ã€‚</p>
<p><a href="http://en.wikipedia.org/wiki/HTTP_ETag">ETag</a>ï¼ˆå®ä½“æ ‡ç­¾ï¼‰æ˜¯ä¸€ä¸ªHTTPå“åº”å¤´ï¼Œå¯ç”±æ”¯æŒHTTP/1.1çš„webåº”ç”¨æœåŠ¡å™¨è®¾ç½®è¿”å›ï¼Œä¸»è¦ç”¨äºæ ‡è¯†ç»™å®šçš„URLä¸‹çš„å†…å®¹æœ‰æ— å˜åŒ–ã€‚å¯ä»¥è®¤ä¸ºå®ƒæ˜¯<code>Last-Modified</code>å¤´çš„ä¸€ä¸ªæ›´ç²¾ç»†çš„åç»­ç‰ˆæœ¬ã€‚å½“æœåŠ¡å™¨ç«¯è¿”å›äº†ä¸€ä¸ªETagå¤´çš„èµ„æºè¡¨ç¤ºæ—¶ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥åœ¨åç»­çš„GETè¯·æ±‚ä¸­ä½¿ç”¨è¿™ä¸ªè¡¨ç¤ºï¼Œä¸€èˆ¬æ˜¯å°†å®ƒæ”¾åœ¨<code>If-None-Match</code>è¯·æ±‚å¤´ä¸­ã€‚æ­¤æ—¶è‹¥å†…å®¹æ²¡æœ‰å˜åŒ–ï¼ŒæœåŠ¡å™¨ç«¯ä¼šç›´æ¥è¿”å›<code>304: å†…å®¹æœªæ›´æ”¹</code>ã€‚</p>
<p>è¿™ä¸€èŠ‚å°†è®²è§£å…¶ä»–ä¸€äº›åœ¨Spring Web MVCåº”ç”¨ä¸­é…ç½®HTTPç¼“å­˜çš„æ–¹æ³•ã€‚</p>
</section<section><h1 id="21-14-1-http-cache-control">21.14.1 HTTPè¯·æ±‚å¤´Cache-Control</h1>
<p>Spring MVCæä¾›äº†è®¸å¤šæ–¹å¼æ¥é…ç½®&quot;Cache-Control&quot;è¯·æ±‚å¤´ï¼Œæ”¯æŒåœ¨è®¸å¤šåœºæ™¯ä¸‹ä½¿ç”¨å®ƒã€‚å…³äºè¯¥è¯·æ±‚å¤´å®Œæ•´è¯¦å°½çš„æ‰€æœ‰ç”¨æ³•ï¼Œä½ å¯ä»¥å‚è€ƒ<a href="https://tools.ietf.org/html/rfc7234#section-5.2.2">RFC 7234çš„ç¬¬5.2.2å°èŠ‚</a>ï¼Œè¿™é‡Œæˆ‘ä»¬åªè®²è§£æœ€å¸¸ç”¨çš„å‡ ç§ç”¨æ³•ã€‚</p>
<p>Spring MVCçš„è®¸å¤šAPIä¸­éƒ½ä½¿ç”¨äº†è¿™æ ·çš„æƒ¯ä¾‹é…ç½®ï¼š<code>setCachePeriod(int seconds)</code>ï¼Œè‹¥è¿”å›å€¼ä¸ºï¼š</p>
<ul>
<li><code>-1</code>ï¼Œåˆ™æ¡†æ¶ä¸ä¼šç”Ÿæˆä¸€ä¸ª<code>&#39;Cache-Control&#39;</code>ç¼“å­˜æ§åˆ¶æŒ‡ä»¤å“åº”å¤´</li>
<li><code>0</code>ï¼Œåˆ™æŒ‡ç¤ºç¦æ­¢ä½¿ç”¨ç¼“å­˜ï¼ŒæœåŠ¡å™¨ç«¯è¿”å›ç¼“å­˜æ§åˆ¶æŒ‡ä»¤<code>&#39;Cache-Control: no-store&#39;</code></li>
<li>ä»»ä½•<code>n &gt; 0</code>çš„å€¼ï¼Œåˆ™å“åº”ä¼šè¢«ç¼“å­˜<code>n</code>ç§’ï¼Œå¹¶è¿”å›ç¼“å­˜æ§åˆ¶æŒ‡ä»¤<code>&#39;Cache-Control: max-age=n&#39;</code></li>
</ul>
<p><a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/javadoc-api/org/springframework/http/CacheControl.html"><code>CacheControl</code></a>æ„é€ å™¨ç±»è¢«ç®€å•çš„ç”¨æ¥æè¿°&quot;Cache-Control&quot;ç¼“å­˜æ§åˆ¶æŒ‡ä»¤ï¼Œä½¿ä½ èƒ½æ›´å®¹æ˜“åœ°åˆ›å»ºè‡ªå·±çš„HTTPç¼“å­˜ç­–ç•¥ã€‚åˆ›å»ºå®Œäº†ä»¥åï¼Œ<code>CacheControl</code>ç±»çš„å®ä¾‹å°±å¯ä»¥åœ¨Spring MVCçš„è®¸å¤šAPIä¸­è¢«ä¼ å…¥ä¸ºæ–¹æ³•å‚æ•°äº†ã€‚</p>
<pre><code class="lang-java">// ç¼“å­˜ä¸€å°æ—¶ - &quot;Cache-Control: max-age=3600&quot;
CacheControl ccCacheOneHour = CacheControl.maxAge(1, TimeUnit.HOURS);

// ç¦æ­¢ç¼“å­˜ - &quot;Cache-Control: no-store&quot;
CacheControl ccNoStore = CacheControl.noStore();

// ç¼“å­˜åå¤©ï¼Œå¯¹æ‰€æœ‰å…¬å…±ç¼“å­˜å’Œç§æœ‰ç¼“å­˜ç”Ÿæ•ˆ
// å“åº”ä¸èƒ½è¢«å…¬å…±ç¼“å­˜æ”¹å˜
// &quot;Cache-Control: max-age=864000, public, no-transform&quot;
CacheControl ccCustom = CacheControl.maxAge(10, TimeUnit.DAYS)
                                    .noTransform().cachePublic();
</code></pre>
</section<section><h1 id="21-14-2-http-">21.14.2 å¯¹é™æ€èµ„æºçš„HTTPç¼“å­˜æ”¯æŒ</h1>
<p>ä¸ºä¼˜åŒ–ç«™ç‚¹æ€§èƒ½ï¼Œé™æ€èµ„æºåº”è¯¥å¸¦æœ‰æ°å½“çš„<code>&#39;Cache-Control&#39;</code>å€¼ä¸å…¶ä»–å¿…è¦çš„å¤´ã€‚<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-config-static-resources" title="21.16.9
Serving of Resources">é…ç½®ä¸€ä¸ª<code>ResourceHttpRequestHandler</code>å¤„ç†å™¨</a>æœåŠ¡é™æ€èµ„æºè¯·æ±‚ä¸ä»…ä¼šè¯»å–æ–‡ä»¶çš„å…ƒæ•°æ®å¹¶å¡«å……<code>&#39;Last-Modified&#39;</code>å¤´çš„å€¼ï¼Œæ­£ç¡®é…ç½®æ—¶<code>&#39;Cache-Control&#39;</code>å¤´ä¹Ÿä¼šè¢«å¡«å……ã€‚ã€è¿™æ®µç¿»å¾—è¿˜ä¸æ˜¯å¾ˆæ¸…æ™°ã€‘</p>
<p>ä½ å¯ä»¥è®¾ç½®<code>ResourceHttpRequestHandler</code>ä¸Šçš„<code>cachePeriod</code>å±æ€§å€¼ï¼Œæˆ–ä½¿ç”¨ä¸€ä¸ª<code>CacheControl</code>å®ä¾‹æ¥æ”¯æŒæ›´ç»†è‡´çš„æŒ‡ä»¤ï¼š</p>
<pre><code class="lang-java">@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(&quot;/resources/**&quot;)
                .addResourceLocations(&quot;/public-resources/&quot;)
                .setCacheControl(CacheControl.maxAge(1, TimeUnit.HOURS).cachePublic());
    }

}
</code></pre>
<p>XMLä¸­å†™æ³•åˆ™å¦‚ä¸‹ï¼š</p>
<pre><code class="lang-xml">&lt;mvc:resources mapping=&quot;/resources/**&quot; location=&quot;/public-resources/&quot;&gt;
    &lt;mvc:cache-control max-age=&quot;3600&quot; cache-public=&quot;true&quot;/&gt;
&lt;/mvc:resources&gt;
</code></pre>
</section<section><h1 id="21-14-3-cache-control-etag-last-modified-">21.14.3 åœ¨æ§åˆ¶å™¨ä¸­è®¾ç½®Cache-Controlã€ETagå’ŒLast-Modifiedå“åº”å¤´</h1>
<p>æ§åˆ¶å™¨èƒ½å¤„ç†å¸¦æœ‰<code>&#39;Cache-Control&#39;</code>ã€<code>&#39;ETag&#39;</code>åŠ/æˆ–<code>&#39;If-Modified-Since&#39;</code>å¤´çš„è¯·æ±‚ï¼Œå¦‚æœæœåŠ¡ç«¯åœ¨å“åº”ä¸­è®¾ç½®äº†<code>&#39;Cache-Control&#39;</code>å“åº”å¤´ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¨èåœ¨æ§åˆ¶å™¨å†…å¯¹è¿™äº›è¯·æ±‚å¤´è¿›è¡Œå¤„ç†ã€‚è¿™æ¶‰åŠä¸€äº›å·¥ä½œï¼šè®¡ç®—æœ€åæ›´æ”¹æ—¶é—´<code>long</code>å’Œ/æˆ–è¯·æ±‚çš„ETagå€¼ã€ä¸è¯·æ±‚å¤´çš„<code>&#39;If-Modified-Since&#39;</code>å€¼åšæ¯”è¾ƒï¼Œå¹¶ä¸”åœ¨èµ„æºæœªæ›´æ”¹çš„æƒ…å†µä¸‹åœ¨å“åº”ä¸­è¿”å›ä¸€ä¸ª304ï¼ˆèµ„æºæœªæ›´æ”¹ï¼‰çŠ¶æ€ç ã€‚</p>
<p>æ­£å¦‚åœ¨<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-ann-httpentity" title="Using HttpEntity">&quot;ä½¿ç”¨HttpEntity&quot;ä¸€èŠ‚</a>ä¸­æ‰€è®²ï¼Œæ§åˆ¶å™¨å¯ä»¥é€šè¿‡<code>HttpEntity</code>ç±»ä¸è¯·æ±‚/å“åº”äº¤äº’ã€‚è¿”å›<code>ResponseEntity</code>çš„æ§åˆ¶å™¨å¯ä»¥åœ¨å“åº”ä¸­åŒ…å«HTTPç¼“å­˜çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<pre><code class="lang-java">@RequestMapping(&quot;/book/{id}&quot;)
public ResponseEntity&lt;Book&gt; showBook(@PathVariable Long id) {

    Book book = findBook(id);
    String version = book.getVersion();

    return ResponseEntity
                .ok()
                .cacheControl(CacheControl.maxAge(30, TimeUnit.DAYS))
                .eTag(version) // è¿™é‡Œä¹Ÿèƒ½æ“ä½œæœ€åä¿®æ”¹æ—¶é—´lastModifiedï¼Œåªä¸è¿‡æ²¡æœ‰ä¸€ä¸€å±•ç¤º
                .body(book);
}
</code></pre>
<p>è¿™æ ·åšä¸ä»…ä¼šåœ¨å“åº”å¤´ä¸­è®¾ç½®<code>&#39;ETag&#39;</code>åŠ<code>&#39;Cache-Control&#39;</code>ç›¸å…³çš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿä¼š <strong>å°è¯•å°†å“åº”çŠ¶æ€ç è®¾ç½®ä¸º<code>HTTP 304 Not Modified</code>ï¼ˆèµ„æºæœªä¿®æ”¹ï¼‰åŠå°†å“åº”ä½“ç½®ç©º</strong>â€”â€”å¦‚æœå®¢æˆ·ç«¯æºå¸¦çš„è¯·æ±‚å¤´ä¿¡æ¯ä¸æ§åˆ¶å™¨è®¾ç½®çš„ç¼“å­˜ä¿¡æ¯èƒ½å¤ŸåŒ¹é…çš„è¯ã€‚</p>
<p>å¦‚æœå¸Œæœ›åœ¨<code>@RequestMapping</code>æ–¹æ³•ä¸Šä¹Ÿèƒ½å®ŒæˆåŒæ ·çš„äº‹ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™æ ·åšï¼š</p>
<pre><code class="lang-java">@RequestMapping
public String myHandleMethod(WebRequest webRequest, Model model) {

    long lastModified = // 1. åº”ç”¨ç›¸å…³çš„æ–¹å¼è®¡ç®—å¾—åˆ°(application-specific calculation)

    if (request.checkNotModified(lastModified)) {
        // 2. å¿«é€Ÿé€€å‡º â€” ä¸éœ€è¦æ›´å¤šå¤„ç†äº†
        return null;
    }

    // 3. è‹¥èµ„æºæ›´æ”¹äº†ï¼Œé‚£ä¹ˆå†è¿›è¡Œè¯·æ±‚å¤„ç†é˜¶æ®µï¼Œä¸€èˆ¬è€Œè¨€æ˜¯å‡†å¤‡å“åº”å†…å®¹
    model.addAttribute(...);
    return &quot;myViewName&quot;;
}
</code></pre>
<p>è¿™é‡Œæœ€é‡è¦çš„ä¸¤ä¸ªåœ°æ–¹æ˜¯ï¼šè°ƒç”¨<code>request.checkNotModified(lastModified)</code>æ–¹æ³•ï¼Œä»¥åŠè¿”å›<code>null</code>ã€‚å‰è€…ï¼ˆæ–¹æ³•è°ƒç”¨ï¼‰åœ¨è¿”å›<code>true</code>ä¹‹å‰ä¼šå°†å“åº”çŠ¶æ€ç è®¾ä¸º304ï¼›è€Œåè€…ï¼Œåœ¨æ£€æŸ¥æ˜¯å¦æ›´æ”¹çš„æ–¹æ³•è°ƒç”¨è¿”å›<code>true</code>çš„åŸºç¡€ä¸Šç›´æ¥å°†æ–¹æ³•è¿”å›ï¼Œè¿™ä¼šé€šçŸ¥Spring MVCä¸å†å¯¹è¯·æ±‚åšä»»ä½•å¤„ç†ã€‚</p>
<p>å¦å¤–è¦æ³¨æ„çš„æ˜¯ï¼Œæ£€æŸ¥èµ„æºæ˜¯å¦å‘ç”Ÿäº†æ›´æ”¹æœ‰3ç§æ–¹å¼ï¼š</p>
<ul>
<li><code>request.checkNotModified(lastModified)</code>æ–¹æ³•ä¼šå°†ä¼ å…¥çš„å‚æ•°å€¼ï¼ˆæœ€åä¿®æ”¹æ—¶é—´ï¼‰ä¸è¯·æ±‚å¤´<code>&#39;If-Modified-Since&#39;</code>çš„å€¼è¿›è¡Œæ¯”è¾ƒ</li>
<li><code>request.checkNotModified(eTag)</code>æ–¹æ³•ä¼šå°†ä¼ å…¥çš„å‚æ•°å€¼ä¸è¯·æ±‚å¤´<code>&#39;ETag&#39;</code>çš„å€¼è¿›è¡Œæ¯”è¾ƒ</li>
<li><code>request.checkNotModified(eTag, lastModified)</code>æ–¹æ³•ä¼šåŒæ—¶è¿›è¡Œä»¥ä¸Šä¸¤ç§æ¯”è¾ƒã€‚ä¹Ÿå³æ˜¯è¯´ï¼Œåªæœ‰åœ¨ä¸¤ä¸ªæ¯”è¾ƒéƒ½è¢«åˆ¤å®šä¸ºæœªä¿®æ”¹æ—¶ï¼ŒæœåŠ¡å™¨æ‰ä¼šè¿”å›ä¸€ä¸ª304å“åº”çŠ¶æ€ç <code>HTTP 304 Not Modified</code>ï¼ˆèµ„æºæœªä¿®æ”¹ï¼‰</li>
</ul>
</section<section><h1 id="21-14-4-etag-shallow-etag-">21.14.4 å¼±ETagï¼ˆShallow ETag)</h1>
<p>å¯¹ETagçš„æ”¯æŒæ˜¯ç”±Servletçš„è¿‡æ»¤å™¨<code>ShallowEtagHeaderFilter</code>æä¾›çš„ã€‚å®ƒæ˜¯çº¯ServletæŠ€æœ¯å®ç°çš„è¿‡æ»¤å™¨ï¼Œå› æ­¤ï¼Œå®ƒå¯ä»¥ä¸ä»»ä½•webæ¡†æ¶æ— ç¼é›†æˆã€‚<code>ShallowEtagHeaderFilter</code>è¿‡æ»¤å™¨ä¼šåˆ›å»ºä¸€ä¸ªæˆ‘ä»¬ç§°ä¸ºå¼±ETagï¼ˆä¸å¼ºETagç›¸å¯¹ï¼Œåé¢ä¼šè¯¦è¿°ï¼‰çš„å¯¹è±¡ã€‚è¿‡æ»¤å™¨ä¼šå°†æ¸²æŸ“çš„JSPé¡µé¢çš„å†…å®¹ï¼ˆåŒ…æ‹¬å…¶ä»–ç±»å‹çš„å†…å®¹ï¼‰ç¼“å­˜èµ·æ¥ï¼Œç„¶åä»¥æ­¤ç”Ÿæˆä¸€ä¸ªMD5å“ˆå¸Œå€¼ï¼Œå¹¶æŠŠè¿™ä¸ªå€¼ä½œä¸ºETagå¤´çš„å€¼å†™å›å“åº”ä¸­ã€‚ä¸‹ä¸€æ¬¡å®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚è¿™ä¸ªåŒæ ·çš„èµ„æºæ—¶ï¼Œå®ƒä¼šå°†è¿™ä¸ªETagçš„å€¼å†™åˆ°<code>If-None-Match</code>å¤´ä¸­ã€‚è¿‡æ»¤å™¨ä¼šæ£€æµ‹åˆ°è¿™ä¸ªè¯·æ±‚å¤´ï¼Œç„¶åå†æ¬¡æŠŠè§†å›¾æ¸²æŸ“å‡ºæ¥å¹¶æ¯”è¾ƒä¸¤ä¸ªå“ˆå¸Œå€¼ã€‚å¦‚æœæ¯”è¾ƒçš„ç»“æœæ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ª<code>304</code>ã€‚æ­£å¦‚ä½ æ‰€è§ï¼Œè§†å›¾ä»ç„¶ä¼šè¢«æ¸²æŸ“ï¼Œå› æ­¤æœ¬è´¨ä¸Šè¿™ä¸ªè¿‡æ»¤å™¨å¹¶éèŠ‚çœä»»ä½•è®¡ç®—èµ„æºã€‚å”¯ä¸€èŠ‚çœçš„ä¸œè¥¿ï¼Œæ˜¯å¸¦å®½ï¼Œå› ä¸ºè¢«æ¸²æŸ“çš„å“åº”ä¸ä¼šè¢«æ•´ä¸ªå‘é€å›å®¢æˆ·ç«¯ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªç­–ç•¥èŠ‚çœçš„æ˜¯ç½‘ç»œå¸¦å®½ï¼Œè€ŒéCPUã€‚å› ä¸ºå¯¹äºæ¯ä¸ªè¯·æ±‚ï¼Œå®Œæ•´çš„å“åº”ä»ç„¶éœ€è¦è¢«æ•´ä¸ªè®¡ç®—å‡ºæ¥ã€‚è€Œå…¶ä»–åœ¨æ§åˆ¶å™¨å±‚çº§å®ç°çš„ç­–ç•¥ï¼ˆä¸Šå‡ èŠ‚æ‰€è¿°çš„ï¼‰å¯ä»¥åŒæ—¶èŠ‚çœç½‘ç»œå¸¦å®½åŠé¿å…å¤šä½™è®¡ç®—ã€‚</p>
<p>ä½ å¯ä»¥åœ¨<code>web.xml</code>ä¸­é…ç½®<code>ShallowEtagHeaderFilter</code>ï¼š</p>
<pre><code class="lang-xml">&lt;filter&gt;
    &lt;filter-name&gt;etagFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.ShallowEtagHeaderFilter&lt;/filter-class&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;etagFilter&lt;/filter-name&gt;
    &lt;servlet-name&gt;petclinic&lt;/servlet-name&gt;
&lt;/filter-mapping&gt;
</code></pre>
<p>å¦‚æœæ˜¯åœ¨Servlet 3.0ä»¥ä¸Šçš„ç¯å¢ƒä¸‹ï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š</p>
<pre><code class="lang-java">public class MyWebAppInitializer extends AbstractDispatcherServletInitializer {

    // ...

    @Override
    protected Filter[] getServletFilters() {
        return new Filter[] { new ShallowEtagHeaderFilter() };
    }

}
</code></pre>
<p>æ›´å¤šé…ç½®ç»†èŠ‚ï¼Œè¯·å‚è€ƒç¬¬<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-container-config" title="21.15 Code-based Servlet container initialization">21.15 åŸºäºä»£ç çš„Servletå®¹å™¨åˆå§‹åŒ–</a>ä¸€å°èŠ‚ã€‚</p>
</section<section><h1 id="21-15-servlet-">21.15 åŸºäºä»£ç çš„Servletå®¹å™¨åˆå§‹åŒ–</h1>
<p>åœ¨Servlet 3.0ä»¥ä¸Šçš„ç¯å¢ƒä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼æ¥é…ç½®Servletå®¹å™¨äº†ã€‚ä½ å¯ä»¥å®Œå…¨æ”¾å¼ƒ<code>web.xml</code>ï¼Œä¹Ÿå¯ä»¥ä¸¤ç§é…ç½®æ–¹å¼åŒæ—¶ä½¿ç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ³¨å†Œ<code>DispatcherServlet</code>çš„ä¾‹å­ï¼š</p>
<pre><code class="lang-java">import org.springframework.web.WebApplicationInitializer;

public class MyWebApplicationInitializer implements WebApplicationInitializer {

    @Override
    public void onStartup(ServletContext container) {
        XmlWebApplicationContext appContext = new XmlWebApplicationContext();
        appContext.setConfigLocation(&quot;/WEB-INF/spring/dispatcher-config.xml&quot;);

        ServletRegistration.Dynamic registration = container.addServlet(&quot;dispatcher&quot;, new DispatcherServlet(appContext));
        registration.setLoadOnStartup(1);
        registration.addMapping(&quot;/&quot;);
    }

}
</code></pre>
<p>Spring MVCæä¾›äº†ä¸€ä¸ª<code>WebApplicationInitializer</code>æ¥å£ï¼Œå®ç°è¿™ä¸ªæ¥å£èƒ½ä¿è¯ä½ çš„é…ç½®èƒ½è‡ªåŠ¨è¢«æ£€æµ‹åˆ°å¹¶åº”ç”¨äºServlet 3å®¹å™¨çš„åˆå§‹åŒ–ä¸­ã€‚<code>WebApplicationInitializer</code>æœ‰ä¸€ä¸ªå®ç°ï¼Œæ˜¯ä¸€ä¸ªæŠ½è±¡çš„åŸºç±»ï¼Œåå­—å«<code>AbstractDispatcherServletInitializer</code>ã€‚æœ‰äº†å®ƒï¼Œè¦é…ç½®<code>DispatcherServlet</code>å°†å˜å¾—æ›´ç®€å•ï¼Œä½ åªéœ€è¦è¦†å†™ç›¸åº”çš„æ–¹æ³•ï¼Œåœ¨å…¶ä¸­æä¾›servletæ˜ å°„ã€<code>DispatcherServlet</code>æ‰€éœ€é…ç½®çš„ä½ç½®å³å¯ï¼š</p>
<pre><code class="lang-java">public class MyWebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

    @Override
    protected Class&lt;?&gt;[] getRootConfigClasses() {
        return null;
    }

    @Override
    protected Class&lt;?&gt;[] getServletConfigClasses() {
        return new Class[] { MyWebConfig.class };
    }

    @Override
    protected String[] getServletMappings() {
        return new String[] { &quot;/&quot; };
    }

}
</code></pre>
<p>ä»¥ä¸Šçš„ä¾‹å­é€‚ç”¨äºä½¿ç”¨åŸºäºJavaé…ç½®çš„Springåº”ç”¨ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯åŸºäºXMLçš„Springé…ç½®æ–¹å¼ï¼Œé‚£ä¹ˆè¯·ç›´æ¥ç»§æ‰¿<code>AbstractDispatcherServletInitializer</code>è¿™ä¸ªç±»ï¼š</p>
<pre><code class="lang-java">public class MyWebAppInitializer extends AbstractDispatcherServletInitializer {

    @Override
    protected WebApplicationContext createRootApplicationContext() {
        return null;
    }

    @Override
    protected WebApplicationContext createServletApplicationContext() {
        XmlWebApplicationContext cxt = new XmlWebApplicationContext();
        cxt.setConfigLocation(&quot;/WEB-INF/spring/dispatcher-config.xml&quot;);
        return cxt;
    }

    @Override
    protected String[] getServletMappings() {
        return new String[] { &quot;/&quot; };
    }

}
</code></pre>
<p><code>AbstractDispatcherServletInitializer</code>åŒæ ·ä¹Ÿæä¾›äº†ä¾¿æ·çš„æ–¹å¼æ¥æ·»åŠ è¿‡æ»¤å™¨<code>Filter</code>å®ä¾‹å¹¶ä½¿ä»–ä»¬è‡ªåŠ¨è¢«æ˜ å°„åˆ°<code>DispatcherServlet</code>ä¸‹ï¼š</p>
<pre><code class="lang-java">public class MyWebAppInitializer extends AbstractDispatcherServletInitializer {

    // ...

    @Override
    protected Filter[] getServletFilters() {
        return new Filter[] { new HiddenHttpMethodFilter(), new CharacterEncodingFilter() };
    }

}
</code></pre>
<p>æ¯ä¸ªè¿‡æ»¤å™¨è¢«æ·»åŠ æ—¶ï¼Œé»˜è®¤çš„åç§°éƒ½åŸºäºå…¶ç±»ç±»å‹å†³å®šï¼Œå¹¶ä¸”å®ƒä»¬ä¼šè¢«è‡ªåŠ¨åœ°æ˜ å°„åˆ°<code>DispatcherServlet</code>ä¸‹ã€‚</p>
<p>å…³äºå¼‚æ­¥æ”¯æŒï¼Œ<code>AbstractDispatcherServletInitializer</code>çš„ä¿æŠ¤æ–¹æ³•<code>isAsyncSupported</code>æä¾›äº†ä¸€ä¸ªé›†ä¸­çš„åœ°æ–¹æ¥å¼€å…³<code>DispatcherServlet</code>ä¸Šçš„è¿™ä¸ªé…ç½®ï¼Œå®ƒä¼šå¯¹æ‰€æœ‰æ˜ å°„åˆ°è¿™ä¸ªåˆ†å‘å™¨ä¸Šçš„è¿‡æ»¤å™¨ç”Ÿæ•ˆã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ ‡å¿—è¢«è®¾ä¸º<code>true</code>ã€‚</p>
<p>æœ€åï¼Œå¦‚æœä½ éœ€è¦å¯¹<code>DispatcherServlet</code>åšè¿›ä¸€æ­¥çš„å®šåˆ¶ï¼Œä½ å¯ä»¥è¦†å†™<code>createDispatcherServlet</code>è¿™ä¸ªæ–¹æ³•ã€‚</p>
</section<section><h1 id="21-16-spring-mvc">21.16 é…ç½®Spring MVC</h1>
<p><a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html@mvc-servlet-special-bean-types" title="21.2.1 Special Bean Types In the WebApplicationContext">21.2.1 WebApplicationContextä¸­ç‰¹æ®Šçš„beanç±»å‹</a>å°èŠ‚å’Œ<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-servlet-config" title="21.2.2 Default DispatcherServlet Configuration">21.2.2 é»˜è®¤çš„DispatcherServleté…ç½®</a>å°èŠ‚è§£é‡Šäº†ä½•è°“Spring MVCçš„ç‰¹æ®Šbeanï¼Œä»¥åŠ<code>DispatcherServlet</code>æ‰€ä½¿ç”¨çš„é»˜è®¤å®ç°ã€‚åœ¨è¿™å°èŠ‚ä¸­ï¼Œä½ å°†äº†è§£é…ç½®Spring MVCçš„å…¶ä»–ä¸¤ç§æ–¹å¼ï¼šMVC Javaç¼–ç¨‹é…ç½®ï¼Œä»¥åŠMVC XMLå‘½åç©ºé—´ã€‚</p>
<p>MVC Javaç¼–ç¨‹é…ç½®å’ŒMVCå‘½åç©ºé—´éƒ½æä¾›äº†ç›¸ä¼¼çš„é»˜è®¤é…ç½®ï¼Œä»¥è¦†å†™<code>DispatcherServlet</code>çš„é»˜è®¤å€¼ã€‚ç›®æ ‡åœ¨äºä¸ºå¤§å¤šæ•°åº”ç”¨è½¯ä»¶å…å»åˆ›å»ºç›¸åŒé…ç½®çš„éº»çƒ¦ï¼ŒåŒæ—¶ä¹Ÿæƒ³ä¸ºé…ç½®Spring MVCæä¾›ä¸€ä¸ªæ›´æ˜“ç†è§£çš„æŒ‡å—ã€ä¸€ä¸ªç®€å•çš„å¼€å§‹ç‚¹ï¼Œå®ƒåªéœ€è¦å¾ˆå°‘æˆ–ä¸éœ€ä»»ä½•å…³äºåº•å±‚é…ç½®çš„çŸ¥è¯†ã€‚</p>
<p>ä½ å¯ä»¥é€‰ç”¨MVC Javaç¼–ç¨‹é…ç½®æˆ–MVCå‘½åç©ºé—´çš„æ–¹å¼ï¼Œè¿™å®Œå…¨å–å†³äºä½ çš„å–œå¥½ã€‚è‹¥ä½ èƒ½è¯»å®Œåé¢çš„å°èŠ‚ï¼Œä½ ä¼šå‘ç°ä½¿ç”¨MVC Javaç¼–ç¨‹é…ç½®çš„æ–¹å¼èƒ½æ›´å®¹æ˜“çœ‹åˆ°åº•å±‚å…·ä½“çš„é…ç½®é¡¹ï¼Œå¹¶ä¸”èƒ½å¯¹åˆ›å»ºçš„Spring MVC beanæœ‰æ›´ç»†ç²’åº¦çš„å®šåˆ¶ç©ºé—´ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»å¤´æ¥çœ‹èµ·å§ã€‚</p>
</section<section><h1 id="21-16-1-mvc-java-mvc-">21.16.1 å¯ç”¨MVC Javaç¼–ç¨‹é…ç½®æˆ–MVCå‘½åç©ºé—´</h1>
<p>è¦å¯ç”¨MVC Javaç¼–ç¨‹é…ç½®ï¼Œä½ éœ€è¦åœ¨å…¶ä¸­ä¸€ä¸ªæ³¨è§£äº†<code>@Configuration</code>çš„ç±»ä¸Šæ·»åŠ <code>@EnableWebMvc</code>æ³¨è§£ï¼š</p>
<pre><code class="lang-java">@Configuration
@EnableWebMvc
public class WebConfig {

}
</code></pre>
<p>è¦å¯ç”¨XMLå‘½åç©ºé—´ï¼Œè¯·åœ¨ä½ çš„DispatcherServletä¸Šä¸‹æ–‡ä¸­ï¼ˆå¦‚æœæ²¡æœ‰å®šä¹‰ä»»ä½•DispatcherServletä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆå°±åœ¨æ ¹ä¸Šä¸‹æ–‡ä¸­ï¼‰æ·»åŠ ä¸€ä¸ª<code>mvc:annotation-driven</code>å…ƒç´ ï¼š</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;

    &lt;mvc:annotation-driven/&gt;

&lt;/beans&gt;
</code></pre>
<p>ä¸Šé¢çš„ç®€å•çš„å£°æ˜ä»£ç ï¼Œå°±å·²ç»é»˜è®¤æ³¨å†Œäº†ä¸€ä¸ª<code>RequestMappingHandlerMapping</code>ã€ä¸€ä¸ª<code>RequestMappingHandlerAdapter</code>ï¼Œä»¥åŠä¸€ä¸ª<code>ExceptionHandlerExceptionResolver</code>ï¼Œä»¥æ”¯æŒå¯¹ä½¿ç”¨äº†<code>@RequestMapping</code>ã€<code>@ExceptionHandler</code>åŠå…¶ä»–æ³¨è§£çš„æ§åˆ¶å™¨æ–¹æ³•çš„è¯·æ±‚å¤„ç†ã€‚</p>
<p>åŒæ—¶ï¼Œä¸Šé¢çš„ä»£ç è¿˜å¯ç”¨äº†ä»¥ä¸‹çš„ç‰¹æ€§ï¼š</p>
<ol>
<li>Spring 3é£æ ¼çš„ç±»å‹è½¬æ¢æ”¯æŒã€‚è¿™æ˜¯ä½¿ç”¨ä¸€ä¸ªé…ç½®çš„è½¬æ¢æœåŠ¡<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/validation.html#core-convert" title="8.5 Spring Type Conversion">ConversionService</a>å®ä¾‹ï¼Œä»¥åŠthe JavaBeans PropertyEditors used for Data Binding.</li>
<li>ä½¿ç”¨<code>@NumberFormat</code>å¯¹æ•°å­—å­—æ®µè¿›è¡Œ<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/validation.html#format" title="8.6 Spring Field Formatting">æ ¼å¼åŒ–</a>ï¼Œç±»å‹è½¬æ¢ç”±<code>ConversionService</code>å®ç°</li>
<li>ä½¿ç”¨<code>@DateTimeFormat</code>æ³¨è§£å¯¹<code>Date</code>ã€<code>Calendar</code>ã€<code>Long</code>åŠJoda Timeç±»å‹çš„å­—æ®µè¿›è¡Œ<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/validation.html#format" title="8.6 Spring Field Formatting">æ ¼å¼åŒ–</a></li>
<li>ä½¿ç”¨<code>@Valid</code>æ³¨è§£å¯¹<code>@Controller</code>è¾“å…¥è¿›è¡Œ<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-config-validation" title="21.16.4 Validation">éªŒè¯</a>â€”â€”å‰ææ˜¯classpathè·¯å¾„ä¸‹æ¯”å¦‚æä¾›ç¬¦åˆJSR-303è§„èŒƒçš„éªŒè¯å™¨</li>
<li>HTTPæ¶ˆæ¯è½¬æ¢<code>HttpMessageConverter</code>çš„æ”¯æŒï¼Œå¯¹æ³¨è§£äº†<code>@RequestMapping</code>æˆ–<code>@ExceptionHandler</code>æ–¹æ³•çš„<code>@RequestBody</code>æ–¹æ³•å‚æ•°æˆ–<code>@ResponseBody</code>è¿”å›å€¼ç”Ÿæ•ˆ</li>
</ol>
<p>ä¸‹é¢ç»™å‡ºäº†ä¸€ä»½ç”±<code>mvc:annotation-driven</code>æ³¨å†Œå¯ç”¨çš„HTTPæ¶ˆæ¯è½¬æ¢å™¨çš„å®Œæ•´åˆ—è¡¨ï¼š</p>
<ol>
<li>è½¬æ¢å­—èŠ‚æ•°ç»„çš„<code>ByteArrayHttpMessageConverter</code></li>
<li>è½¬æ¢å­—ç¬¦ä¸²çš„<code>StringHttpMessageConverter</code></li>
<li><code>ResourceHttpMessageConverter</code>ï¼š<code>org.springframework.core.io.Resource</code>ä¸æ‰€æœ‰åª’ä½“ç±»å‹ä¹‹é—´çš„äº’ç›¸è½¬æ¢</li>
<li><code>SourceHttpMessageConverter</code>ï¼šä»ï¼ˆåˆ°ï¼‰<code>javax.xml.transform.Source</code>çš„è½¬æ¢</li>
<li><code>FormHttpMessageConverter</code>ï¼šæ•°æ®ä¸<code>MultiValueMap&lt;String, String&gt;</code>ä¹‹é—´çš„äº’ç›¸è½¬æ¢</li>
<li><code>Jaxb2RootElementHttpMessageConverter</code>ï¼šJavaå¯¹è±¡ä¸XMLä¹‹é—´çš„äº’ç›¸è½¬æ¢â€”â€”è¯¥è½¬æ¢å™¨åœ¨classpathè·¯å¾„ä¸‹æœ‰JAXB2ä¾èµ–å¹¶ä¸”æ²¡æœ‰Jackson 2 XMLæ‰©å±•æ—¶è¢«æ³¨å†Œ</li>
<li><code>MappingJackson2HttpMessageConverter</code>ï¼šä»ï¼ˆåˆ°ï¼‰JSONçš„è½¬æ¢â€”â€”è¯¥è½¬æ¢å™¨åœ¨classpathä¸‹æœ‰Jackson 2ä¾èµ–æ—¶è¢«æ³¨å†Œ</li>
<li><code>MappingJackson2XmlHttpMessageConverter</code>ï¼šä»ï¼ˆåˆ°ï¼‰XMLçš„è½¬æ¢â€”â€”è¯¥è½¬æ¢å™¨åœ¨classpathä¸‹æœ‰<a href="https://github.com/FasterXML/jackson-dataformat-xml">Jackson 2 XMLæ‰©å±•</a>æ—¶è¢«æ³¨å†Œ</li>
<li><code>AtomFeedHttpMessageConverter</code>ï¼šAtomæºçš„è½¬æ¢â€”â€”è¯¥è½¬æ¢å™¨åœ¨classpathè·¯å¾„ä¸‹æœ‰Romeæ—¶è¢«æ³¨å†Œ</li>
<li><code>RssChannelHttpMessageConverter</code>ï¼šRSSæºçš„è½¬æ¢â€”â€”è¯¥è½¬æ¢å™¨åœ¨classpathè·¯å¾„ä¸‹æœ‰Romeæ—¶è¢«æ³¨å†Œ</li>
</ol>
<p>ä½ å¯ä»¥å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-config-message-converters" title="21.16.12 Message Converters">21.16.12 æ¶ˆæ¯è½¬æ¢å™¨</a>ä¸€å°èŠ‚ï¼Œäº†è§£å¦‚ä½•è¿›ä¸€æ­¥å®šåˆ¶è¿™äº›é»˜è®¤çš„è½¬æ¢å™¨ã€‚</p>
<blockquote>
<p>Jackson JSONå’ŒXMLè½¬æ¢å™¨æ˜¯é€šè¿‡<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/javadoc-api/org/springframework/http/converter/json/Jackson2ObjectMapperBuilder.html"><code>Jackson2ObjectMapperBuilder</code></a>åˆ›å»ºçš„<code>ObjectMapper</code>å®ä¾‹åˆ›å»ºçš„ï¼Œç›®çš„åœ¨äºæä¾›æ›´å¥½çš„é»˜è®¤é…ç½®</p>
<p>è¯¥builderä¼šä½¿ç”¨ä»¥ä¸‹çš„é»˜è®¤å±æ€§å¯¹Jacksonè¿›è¡Œé…ç½®ï¼š</p>
<ol>
<li><p>ç¦ç”¨<a href="http://fasterxml.github.io/jackson-databind/javadoc/2.6/com/fasterxml/jackson/databind/DeserializationFeature.html#FAIL_ON_UNKNOWN_PROPERTIES"><code>DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES</code></a></p>
</li>
<li><p>ç¦ç”¨<a href="http://fasterxml.github.io/jackson-databind/javadoc/2.6/com/fasterxml/jackson/databind/MapperFeature.html#DEFAULT_VIEW_INCLUSION"><code>MapperFeature.DEFAULT_VIEW_INCLUSION</code></a></p>
</li>
</ol>
<p>åŒæ—¶ï¼Œå¦‚æœæ£€æµ‹åˆ°åœ¨classpathè·¯å¾„ä¸‹å­˜åœ¨è¿™äº›æ¨¡å—ï¼Œè¯¥builderä¹Ÿä¼šè‡ªåŠ¨åœ°æ³¨å†Œå®ƒä»¬ï¼š</p>
<ol>
<li><p><a href="https://github.com/FasterXML/jackson-datatype-jdk7">jackson-datatype-jdk7</a>: æ”¯æŒJava 7çš„ä¸€äº›ç±»å‹ï¼Œä¾‹å¦‚<code>java.nio.file.Path</code></p>
</li>
<li><p><a href="https://github.com/FasterXML/jackson-datatype-joda">jackson-datatype-joda</a>: æ”¯æŒJoda-Timeç±»å‹</p>
</li>
<li><p><a href="https://github.com/FasterXML/jackson-datatype-jsr310">jackson-datatype-jsr310</a>: æ”¯æŒJava 8çš„Date &amp; Time APIç±»å‹</p>
</li>
<li><p><a href="https://github.com/FasterXML/jackson-datatype-jdk8">jackson-datatype-jdk8</a>: æ”¯æŒJava 8å…¶ä»–çš„ä¸€äº›ç±»å‹ï¼Œæ¯”å¦‚<code>Optional</code>ç­‰</p>
</li>
</ol>
</blockquote>
</section<section><h1 id="21-16-2-">21.16.2 é»˜è®¤é…ç½®çš„å®šåˆ¶åŒ–</h1>
<p>åœ¨MVC Javaç¼–ç¨‹é…ç½®æ–¹å¼ä¸‹ï¼Œå¦‚æœä½ æƒ³å¯¹é»˜è®¤é…ç½®è¿›è¡Œå®šåˆ¶ï¼Œä½ å¯ä»¥è‡ªå·±å®ç°<code>WebMvcConfigurer</code>æ¥å£ï¼Œè¦ä¹ˆç»§æ‰¿<code>WebMvcConfigurerAdapter</code>ç±»å¹¶è¦†å†™ä½ éœ€è¦å®šåˆ¶çš„æ–¹æ³•ï¼š</p>
<pre><code class="lang-java">@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

    // Override configuration methods...

}
</code></pre>
<p>åœ¨MVC XMLå‘½åç©ºé—´ä¸‹ï¼Œå¦‚æœä½ æƒ³å¯¹é»˜è®¤é…ç½®è¿›è¡Œå®šåˆ¶ï¼Œè¯·æŸ¥çœ‹<code>&lt;mvc:annotation-driven/&gt;</code>å…ƒç´ æ”¯æŒçš„å±æ€§å’Œå­å…ƒç´ ã€‚ä½ å¯ä»¥æŸ¥çœ‹<a href="http://schema.spring.io/mvc/spring-mvc.xsd">Spring MVC XML schema</a>ï¼Œæˆ–ä½¿ç”¨IDEçš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½æ¥æŸ¥çœ‹æœ‰å“ªäº›å±æ€§å’Œå­å…ƒç´ æ˜¯å¯ä»¥é…ç½®çš„ã€‚</p>
</section<section><h1 id="21-16-3-">21.16.3 è½¬æ¢ä¸æ ¼å¼åŒ–</h1>
<p>æ•°å­—çš„<code>Number</code>ç±»å‹å’Œæ—¥æœŸ<code>Date</code>ç±»å‹çš„æ ¼å¼åŒ–æ˜¯é»˜è®¤å®‰è£…äº†çš„ï¼ŒåŒ…æ‹¬<code>@NumberFormat</code>æ³¨è§£å’Œ<code>@DateTimeFormat</code>æ³¨è§£ã€‚å¦‚æœclasspathè·¯å¾„ä¸‹å­˜åœ¨Joda Timeä¾èµ–ï¼Œé‚£ä¹ˆå®Œç¾æ”¯æŒJoda Timeçš„æ—¶é—´æ ¼å¼åŒ–åº“ä¹Ÿä¼šè¢«å®‰è£…å¥½ã€‚å¦‚æœè¦æ³¨å†Œå®šåˆ¶çš„æ ¼å¼åŒ–å™¨æˆ–è½¬æ¢å™¨ï¼Œè¯·è¦†å†™<code>addFormatters</code>æ–¹æ³•ï¼š</p>
<pre><code class="lang-java">@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

    @Override
    public void addFormatters(FormatterRegistry registry) {
        // Add formatters and/or converters
    }

}
</code></pre>
<p>ä½¿ç”¨MVCå‘½åç©ºé—´æ—¶ï¼Œ<code>&lt;mvc:annotation-driven&gt;</code>ä¹Ÿä¼šè¿›è¡ŒåŒæ ·çš„é»˜è®¤é…ç½®ã€‚è¦æ³¨å†Œå®šåˆ¶çš„æ ¼å¼åŒ–å™¨å’Œè½¬æ¢å™¨ï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªè½¬æ¢æœåŠ¡<code>ConversionService</code>ï¼š</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;

    &lt;mvc:annotation-driven conversion-service=&quot;conversionService&quot;/&gt;

    &lt;bean id=&quot;conversionService&quot;
            class=&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;&gt;
        &lt;property name=&quot;converters&quot;&gt;
            &lt;set&gt;
                &lt;bean class=&quot;org.example.MyConverter&quot;/&gt;
            &lt;/set&gt;
        &lt;/property&gt;
        &lt;property name=&quot;formatters&quot;&gt;
            &lt;set&gt;
                &lt;bean class=&quot;org.example.MyFormatter&quot;/&gt;
                &lt;bean class=&quot;org.example.MyAnnotationFormatterFactory&quot;/&gt;
            &lt;/set&gt;
        &lt;/property&gt;
        &lt;property name=&quot;formatterRegistrars&quot;&gt;
            &lt;set&gt;
                &lt;bean class=&quot;org.example.MyFormatterRegistrar&quot;/&gt;
            &lt;/set&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

&lt;/beans&gt;
</code></pre>
<blockquote>
<p>å…³äºå¦‚ä½•ä½¿ç”¨æ ¼å¼åŒ–ç®¡ç†å™¨FormatterRegistrarï¼Œè¯·å‚è€ƒ <a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/validation.html#format-FormatterRegistrar-SPI">8.6.4 FormatterRegistrar SPI</a>ä¸€èŠ‚ï¼Œä»¥åŠ<code>FormattingConversionServiceFactoryBean</code>çš„æ–‡æ¡£ã€‚</p>
</blockquote>
</section<section><h1 id="21-16-4-">21.16.4 éªŒè¯</h1>
<p>Springæä¾›äº†ä¸€ä¸ª<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/validation.html#validator" title="8.2 Validation using Spring&#39;s Validator interface">éªŒè¯å™¨Validatoræ¥å£</a>ï¼Œåº”ç”¨çš„ä»»ä½•ä¸€å±‚éƒ½å¯ä»¥ä½¿ç”¨å®ƒæ¥åšéªŒè¯ã€‚åœ¨Spring MVCä¸­ï¼Œä½ å¯ä»¥é…ç½®ä¸€ä¸ªå…¨å±€çš„<code>Validator</code>å®ä¾‹ï¼Œç”¨ä»¥å¤„ç†æ‰€æœ‰æ³¨è§£äº†<code>@Valid</code>çš„å…ƒç´ æˆ–æ³¨è§£äº†<code>@Validated</code>çš„æ§åˆ¶å™¨æ–¹æ³•å‚æ•°ã€ä»¥åŠ/æˆ–åœ¨æ§åˆ¶å™¨å†…çš„<code>@InitBinder</code>æ–¹æ³•ä¸­ç”¨ä½œå±€éƒ¨çš„<code>Validator</code>ã€‚å…¨å±€éªŒè¯å™¨ä¸å±€éƒ¨éªŒè¯å™¨å®ä¾‹å¯ä»¥ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œæä¾›ç»„åˆéªŒè¯ã€‚</p>
<p>Springè¿˜<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/validation.html#validation-beanvalidation-overview" title="8.8.1 Overview of the JSR-303 Bean Validation API">æ”¯æŒJSR-303/JSR-349</a>çš„BeanéªŒè¯ã€‚è¿™æ˜¯é€šè¿‡<code>LocalValidatorFactoryBean</code>ç±»å®ç°çš„ï¼Œå®ƒä¸ºSpringçš„éªŒè¯å™¨æ¥å£<code>org.springframework.validation.Validator</code>åˆ°BeanéªŒè¯çš„<code>javax.validation.Validator</code>æ¥å£åšäº†é€‚é…ã€‚è¿™ä¸ªç±»å¯ä»¥æ’å…¥åˆ°Spring MVCçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä½œä¸ºä¸€ä¸ªå…¨å±€çš„éªŒè¯å™¨ï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚</p>
<p>å¦‚æœåœ¨classpathä¸‹å­˜åœ¨BeanéªŒè¯å™¨ï¼Œè¯¸å¦‚Hibernate Validatorç­‰ï¼Œé‚£ä¹ˆ<code>@EnableWebMvc</code>æˆ–<code>&lt;mvc:annotation-driven&gt;</code>é»˜è®¤ä¼šè‡ªåŠ¨ä½¿ç”¨<code>LocalValidatorFactoryBean</code>ä¸ºSpring MVCåº”ç”¨æä¾›BeanéªŒè¯çš„æ”¯æŒã€‚</p>
<blockquote>
<p>æœ‰æ—¶ï¼Œèƒ½å°†<code>LocalValidatorFactoryBean</code>ç›´æ¥æ³¨å…¥åˆ°æ§åˆ¶å™¨æˆ–å¦å¤–ä¸€ä¸ªç±»ä¸­ä¼šæ›´æ–¹ä¾¿ã€‚</p>
<p>Sometimes it&#39;s convenient to have a <code>LocalValidatorFactoryBean</code> injected into
a controller or another class. The easiest way to do that is to declare your
own <code>@Bean</code> and also mark it with <code>@Primary</code> in order to avoid a conflict with
the one provided with the MVC Java config.</p>
<p>If you prefer to use the one from the MVC Java config, you&#39;ll need to override
the <code>mvcValidator</code> method from <code>WebMvcConfigurationSupport</code> and declare the
method to explicitly return <code>LocalValidatorFactory</code> rather than <code>Validator</code>.
See <a href="mvc.html#mvc-config-advanced-java" title="21.16.13 Advanced Customizations
with MVC Java Config">Section 21.16.13, &quot;Advanced Customizations with MVC Java
Config&quot;</a> for information on how to switch to extend the
provided configuration.</p>
</blockquote>
<p>æ­¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥é…ç½®ä½ è‡ªå·±çš„å…¨å±€<code>Validator</code>éªŒè¯å™¨å®ä¾‹ï¼š</p>
<pre><code class="lang-java">@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

    @Override
    public Validator getValidator(); {
        // return &quot;global&quot; validator
    }

}
</code></pre>
<p>XMLä¸­åšæ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;

    &lt;mvc:annotation-driven validator=&quot;globalValidator&quot;/&gt;

&lt;/beans&gt;
</code></pre>
<p>è‹¥è¦åŒæ—¶ä½¿ç”¨å…¨å±€éªŒè¯å’Œå±€éƒ¨éªŒè¯ï¼Œåªéœ€æ·»åŠ ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰å±€éƒ¨éªŒè¯å™¨å³å¯ï¼š</p>
<pre><code class="lang-java">@Controller
public class MyController {

    @InitBinder
    protected void initBinder(WebDataBinder binder) {
        binder.addValidators(new FooValidator());
    }

}
</code></pre>
<p>åšå®Œè¿™ä¸ªæœ€å°‘çš„é…ç½®ä¹‹åï¼Œä»»ä½•æ—¶å€™åªè¦æ–¹æ³•ä¸­æœ‰å‚æ•°æ³¨è§£äº†<code>@Valid</code>æˆ–<code>@Validated</code>ï¼Œé…ç½®çš„éªŒè¯å™¨å°±ä¼šè‡ªåŠ¨å¯¹å®ƒä»¬åšéªŒè¯ã€‚ä»»ä½•æ— æ³•é€šè¿‡çš„éªŒè¯éƒ½ä¼šè¢«è‡ªåŠ¨æŠ¥å‘Šä¸ºé”™è¯¯å¹¶æ·»åŠ åˆ°<code>BindingResult</code>å¯¹è±¡ä¸­å»ï¼Œä½ å¯ä»¥åœ¨æ–¹æ³•å‚æ•°ä¸­å£°æ˜å®ƒå¹¶è·å–è¿™äº›é”™è¯¯ï¼ŒåŒæ—¶è¿™äº›é”™è¯¯ä¹Ÿèƒ½åœ¨Spring MVCçš„HTMLè§†å›¾ä¸­è¢«æ¸²æŸ“ã€‚</p>
</section<section><h1 id="21-16-5-">21.16.5 æ‹¦æˆªå™¨</h1>
<p>ä½ å¯ä»¥é…ç½®å¤„ç†å™¨æ‹¦æˆªå™¨<code>HandlerInterceptors</code>æˆ–webè¯·æ±‚æ‹¦æˆªå™¨<code>WebRequestInterceptors</code>ç­‰æ‹¦æˆªå™¨ï¼Œå¹¶é…ç½®å®ƒä»¬æ‹¦æˆªæ‰€æœ‰è¿›å…¥å®¹å™¨çš„è¯·æ±‚ï¼Œæˆ–é™å®šåˆ°ç¬¦åˆç‰¹å®šæ¨¡å¼çš„URLè·¯å¾„ã€‚</p>
<p>åœ¨MVC Javaç¼–ç¨‹é…ç½®ä¸‹æ³¨å†Œæ‹¦æˆªå™¨çš„æ–¹æ³•ï¼š</p>
<pre><code class="lang-java">@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LocaleInterceptor());
        registry.addInterceptor(new ThemeInterceptor()).addPathPatterns(&quot;/**&quot;).excludePathPatterns(&quot;/admin/**&quot;);
        registry.addInterceptor(new SecurityInterceptor()).addPathPatterns(&quot;/secure/*&quot;);
    }

}
</code></pre>
<p>åœ¨MVC XMLå‘½åç©ºé—´ä¸‹ï¼Œåˆ™ä½¿ç”¨<code>&lt;mvc:interceptors&gt;</code>å…ƒç´ ï¼š</p>
<pre><code class="lang-xml">&lt;mvc:interceptors&gt;
    &lt;bean class=&quot;org.springframework.web.servlet.i18n.LocaleChangeInterceptor&quot;/&gt;
    &lt;mvc:interceptor&gt;
        &lt;mvc:mapping path=&quot;/**&quot;/&gt;
        &lt;mvc:exclude-mapping path=&quot;/admin/**&quot;/&gt;
        &lt;bean class=&quot;org.springframework.web.servlet.theme.ThemeChangeInterceptor&quot;/&gt;
    &lt;/mvc:interceptor&gt;
    &lt;mvc:interceptor&gt;
        &lt;mvc:mapping path=&quot;/secure/*&quot;/&gt;
        &lt;bean class=&quot;org.example.SecurityInterceptor&quot;/&gt;
    &lt;/mvc:interceptor&gt;
&lt;/mvc:interceptors&gt;
</code></pre>
</section<section><h1 id="21-16-6-">21.16.6 å†…å®¹åå•†</h1>
<p>You can configure how Spring MVC determines the requested media types from the
request. The available options are to check the URL path for a file extension,
check the &quot;Accept&quot; header, a specific query parameter, or to fall back on a
default content type when nothing is requested. By default the path extension
in the request URI is checked first and the &quot;Accept&quot; header is checked second.</p>
<p>The MVC Java config and the MVC namespace register <code>json</code>, <code>xml</code>, <code>rss</code>,
<code>atom</code> by default if corresponding dependencies are on the classpath.
Additional path extension-to-media type mappings may also be registered
explicitly and that also has the effect of whitelisting them as safe
extensions for the purpose of RFD attack detection (see <a href="mvc.html#mvc-ann-requestmapping-rfd" title="Suffix
Pattern Matching and RFD">the section called
&quot;Suffix Pattern Matching and RFD&quot;</a> for more detail).</p>
<p>Below is an example of customizing content negotiation options through the MVC
Java config:</p>
<pre><code>_@Configuration_
_@EnableWebMvc_
public class WebConfig extends WebMvcConfigurerAdapter {

    _@Override_
    public void configureContentNegotiation(ContentNegotiationConfigurer configurer) {
        configurer.mediaType(&quot;json&quot;, MediaType.APPLICATION_JSON);
    }
}
</code></pre><p>In the MVC namespace, the <code>&lt;mvc:annotation-driven&gt;</code> element has a <code>content-
negotiation-manager</code> attribute, which expects a <code>ContentNegotiationManager</code>
that in turn can be created with a <code>ContentNegotiationManagerFactoryBean</code>:</p>
<pre><code>&lt;mvc:annotation-driven content-negotiation-manager=&quot;contentNegotiationManager&quot;/&gt;

&lt;bean id=&quot;contentNegotiationManager&quot; class=&quot;org.springframework.web.accept.ContentNegotiationManagerFactoryBean&quot;&gt;
    &lt;property name=&quot;mediaTypes&quot;&gt;
        &lt;value&gt;
            json=application/json
            xml=application/xml
        &lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre><p>If not using the MVC Java config or the MVC namespace, you&#39;ll need to create
an instance of <code>ContentNegotiationManager</code> and use it to configure
<code>RequestMappingHandlerMapping</code> for request mapping purposes, and
<code>RequestMappingHandlerAdapter</code> and <code>ExceptionHandlerExceptionResolver</code> for
content negotiation purposes.</p>
<p>Note that <code>ContentNegotiatingViewResolver</code> now can also be configured with a
<code>ContentNegotiationManager</code>, so you can use one shared instance throughout
Spring MVC.</p>
<p>In more advanced cases, it may be useful to configure multiple
<code>ContentNegotiationManager</code> instances that in turn may contain custom
<code>ContentNegotiationStrategy</code> implementations. For example you could configure
<code>ExceptionHandlerExceptionResolver</code> with a <code>ContentNegotiationManager</code> that
always resolves the requested media type to <code>&quot;application/json&quot;</code>. Or you may
want to plug a custom strategy that has some logic to select a default content
type (e.g. either XML or JSON) if no content types were requested.</p>
</section<section><h1 id="21-16-7-">21.16.7 è§†å›¾æ§åˆ¶å™¨</h1>
<p>ä»¥ä¸‹çš„ä¸€æ®µä»£ç ç›¸å½“äºå®šä¹‰ä¸€ä¸ª<code>ParameterizableViewController</code>è§†å›¾æ§åˆ¶å™¨çš„å¿«æ·æ–¹å¼ï¼Œè¯¥æ§åˆ¶å™¨ä¼šç«‹å³å°†ä¸€ä¸ªè¯·æ±‚è½¬å‘ï¼ˆforwardsï¼‰ç»™ä¸€ä¸ªè§†å›¾ã€‚è¯·ç¡®ä¿ä»…åœ¨ä»¥ä¸‹æƒ…æ™¯ä¸‹æ‰ä½¿ç”¨è¿™ä¸ªç±»ï¼šå½“æ§åˆ¶å™¨é™¤äº†å°†è§†å›¾æ¸²æŸ“åˆ°å“åº”ä¸­å¤–ä¸éœ€è¦æ‰§è¡Œä»»ä½•é€»è¾‘æ—¶ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨MVC Javaç¼–ç¨‹é…ç½®æ–¹å¼ä¸‹å°†æ‰€æœ‰<code>&quot;/&quot;</code>è¯·æ±‚ç›´æ¥è½¬å‘ç»™åå­—ä¸º<code>&quot;home&quot;</code>çš„è§†å›¾ï¼š</p>
<pre><code class="lang-java">@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController(&quot;/&quot;).setViewName(&quot;home&quot;);
    }

}
</code></pre>
<p>åœ¨MVC XMLå‘½åç©ºé—´ä¸‹å®ŒæˆåŒæ ·çš„é…ç½®ï¼Œåˆ™ä½¿ç”¨<code>&lt;mvc:view-controller&gt;</code>å…ƒç´ ï¼š</p>
<pre><code class="lang-xml">&lt;mvc:view-controller path=&quot;/&quot; view-name=&quot;home&quot;/&gt;
</code></pre>
</section<section><h1 id="21-16-8-">21.16.8 è§†å›¾è§£æå™¨</h1>
<p>MVCæä¾›çš„é…ç½®ç®€åŒ–äº†è§†å›¾è§£æå™¨çš„æ³¨å†Œå·¥ä½œã€‚</p>
<p>ä»¥ä¸‹çš„ä»£ç å±•ç¤ºäº†åœ¨MVC Javaç¼–ç¨‹é…ç½®ä¸‹ï¼Œå¦‚ä½•ä¸ºå†…å®¹åå•†é…ç½®FreeMarker HTMLæ¨¡æ¿å’ŒJacksonä½œä¸ºJSONæ•°æ®çš„é»˜è®¤è§†å›¾è§£æï¼š</p>
<pre><code class="lang-java">@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.enableContentNegotiation(new MappingJackson2JsonView());
        registry.jsp();
    }

}
</code></pre>
<p>åœ¨MVC XMLå‘½åç©ºé—´ä¸‹å®ç°ç›¸åŒé…ç½®ï¼š</p>
<pre><code class="lang-xml">&lt;mvc:view-resolvers&gt;
    &lt;mvc:content-negotiation&gt;
        &lt;mvc:default-views&gt;
            &lt;bean class=&quot;org.springframework.web.servlet.view.json.MappingJackson2JsonView&quot;/&gt;
        &lt;/mvc:default-views&gt;
    &lt;/mvc:content-negotiation&gt;
    &lt;mvc:jsp/&gt;
&lt;/mvc:view-resolvers&gt;
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨FreeMarker, Velocity, Tiles, Groovy MarkupåŠscriptæ¨¡æ¿ä½œä¸ºè§†å›¾æŠ€æœ¯æ—¶ï¼Œä»éœ€è¦é…ç½®ä¸€äº›å…¶ä»–é€‰é¡¹ã€‚</p>
<p>MVCå‘½åç©ºé—´ä¸ºæ¯ç§è§†å›¾éƒ½æä¾›äº†ç›¸åº”çš„å…ƒç´ ã€‚æ¯”å¦‚ä¸‹é¢ä»£ç æ˜¯FreeMarkeréœ€è¦çš„é…ç½®ï¼š</p>
<pre><code class="lang-xml">&lt;mvc:view-resolvers&gt;
    &lt;mvc:content-negotiation&gt;
        &lt;mvc:default-views&gt;
            &lt;bean class=&quot;org.springframework.web.servlet.view.json.MappingJackson2JsonView&quot;/&gt;
        &lt;/mvc:default-views&gt;
    &lt;/mvc:content-negotiation&gt;
    &lt;mvc:freemarker cache=&quot;false&quot;/&gt;
&lt;/mvc:view-resolvers&gt;

&lt;mvc:freemarker-configurer&gt;
    &lt;mvc:template-loader-path location=&quot;/freemarker&quot;/&gt;
&lt;/mvc:freemarker-configurer&gt;
</code></pre>
<p>åœ¨MVC Javaç¼–ç¨‹é…ç½®æ–¹å¼ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ªè§†å›¾å¯¹åº”çš„â€œé…ç½®å™¨â€beanå³å¯ï¼š</p>
<pre><code class="lang-java">@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.enableContentNegotiation(new MappingJackson2JsonView());
        registry.freeMarker().cache(false);
    }

    @Bean
    public FreeMarkerConfigurer freeMarkerConfigurer() {
        FreeMarkerConfigurer configurer = new FreeMarkerConfigurer();
        configurer.setTemplateLoaderPath(&quot;/WEB-INF/&quot;);
        return configurer;
    }

}
</code></pre>
</section<section><h1 id="-">èµ„æºçš„æœåŠ¡</h1>
</section<section><h1 id="21-16-10-servlet-">21.16.10 å›åˆ°é»˜è®¤çš„Servletæ¥è¿›è¡Œèµ„æºæœåŠ¡</h1>
<p>è¿™äº›é…ç½®å…è®¸ä½ å°†<code>DispatcherServlet</code>æ˜ å°„åˆ°&quot;/&quot;è·¯å¾„ï¼ˆä¹Ÿå³è¦†ç›–äº†å®¹å™¨é»˜è®¤Servletçš„æ˜ å°„ï¼‰ï¼Œä½†ä¾ç„¶ä¿ç•™å®¹å™¨é»˜è®¤çš„Servletä»¥å¤„ç†é™æ€èµ„æºçš„è¯·æ±‚ã€‚è¿™å¯ä»¥é€šè¿‡é…ç½®ä¸€ä¸ªURLæ˜ å°„åˆ°&quot;/**&quot;çš„å¤„ç†å™¨<code>DefaultServletHttpRequestHandler</code>æ¥å®ç°ï¼Œå¹¶ä¸”è¯¥å¤„ç†å™¨åœ¨å…¶ä»–æ‰€æœ‰URLæ˜ å°„å…³ç³»ä¸­ä¼˜å…ˆçº§åº”è¯¥æ˜¯æœ€ä½çš„ã€‚</p>
<p>è¯¥å¤„ç†å™¨ä¼šå°†æ‰€æœ‰è¯·æ±‚è½¬å‘ï¼ˆforwardï¼‰åˆ°é»˜è®¤çš„Servletï¼Œå› æ­¤éœ€è¦ä¿è¯å®ƒåœ¨æ‰€æœ‰URLå¤„ç†å™¨æ˜ å°„<code>HandlerMappings</code>çš„æœ€åã€‚å¦‚æœä½ æ˜¯é€šè¿‡<code>&lt;mvc:annotation-driven&gt;</code>çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œæˆ–è‡ªå·±å®šåˆ¶äº†<code>HandlerMapping</code>å®ä¾‹ï¼Œé‚£ä¹ˆä½ éœ€è¦ç¡®ä¿è¯¥å¤„ç†å™¨<code>order</code>å±æ€§çš„å€¼æ¯”<code>DefaultServletHttpRequestHandler</code>çš„æ¬¡åºå€¼<code>Integer.MAXVALUE</code>å°ã€‚</p>
<p>ä½¿ç”¨é»˜è®¤çš„é…ç½®å¯ç”¨è¯¥ç‰¹æ€§ï¼Œä½ å¯ä»¥ï¼š</p>
<pre><code class="lang-java">@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter {

    @Override
    public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
        configurer.enable();
    }

}
</code></pre>
<p>XMLå‘½åç©ºé—´åªéœ€ä¸€è¡Œï¼š</p>
<pre><code class="lang-xml">    &lt;mvc:default-servlet-handler/&gt;
</code></pre>
<p>ä¸è¿‡éœ€è¦æ³¨æ„ï¼Œè¦†å†™äº†&quot;/&quot;çš„Servletæ˜ å°„åï¼Œé»˜è®¤Servletçš„<code>RequestDispatcher</code>å°±å¿…é¡»é€šè¿‡åå­—è€Œéè·¯å¾„æ¥å–å¾—äº†ã€‚<code>DefaultServletHttpRequestHandler</code>ä¼šå°è¯•åœ¨å®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™è‡ªåŠ¨æ£€æµ‹é»˜è®¤Servletï¼Œè¿™é‡Œå®ƒä½¿ç”¨çš„æ˜¯ä¸€ä»½ä¸»æµServletå®¹å™¨ï¼ˆåŒ…æ‹¬Tomcatã€Jettyã€GlassFishã€JBossã€Resinã€WebLogicï¼Œå’ŒWWebSphereï¼‰å·²çŸ¥çš„åç§°åˆ—è¡¨ã€‚å¦‚æœé»˜è®¤Servletè¢«é…ç½®äº†ä¸€ä¸ªå…¶ä»–çš„åå­—ï¼Œæˆ–è€…ä½¿ç”¨äº†ä¸€ä¸ªåˆ—è¡¨é‡Œæœªæä¾›é»˜è®¤Servletåç§°çš„å®¹å™¨ï¼Œé‚£ä¹ˆé»˜è®¤Servletçš„åç§°å¿…é¡»è¢«æ˜¾å¼æŒ‡å®šã€‚æ­£å¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š</p>
<pre><code class="lang-java">    @Configuration
    @EnableWebMvc
    public class WebConfig extends WebMvcConfigurerAdapter {

        @Override
        public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
            configurer.enable(&quot;myCustomDefaultServlet&quot;);
        }

    }
</code></pre>
<p>XMLå‘½åç©ºé—´çš„é…ç½®æ–¹å¼ï¼š</p>
<pre><code class="lang-xml">    &lt;mvc:default-servlet-handler default-servlet-name=&quot;myCustomDefaultServlet&quot;/&gt;
</code></pre>
</section<section><h1 id="21-16-11-">21.16.11 è·¯å¾„åŒ¹é…</h1>
<p>è¿™äº›é…ç½®å…è®¸ä½ å¯¹è®¸å¤šä¸URLæ˜ å°„å’Œè·¯å¾„åŒ¹é…æœ‰å…³çš„è®¾ç½®è¿›è¡Œå®šåˆ¶ã€‚å…³äºæ‰€æœ‰å¯ç”¨çš„é…ç½®é€‰é¡¹ï¼Œè¯·å‚è€ƒ<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/PathMatchConfigurer.html">PathMatchConfigurer</a>ç±»çš„APIæ–‡æ¡£ã€‚</p>
<p>ä¸‹é¢æ˜¯é‡‡ç”¨MVC Javaç¼–ç¨‹é…ç½®çš„ä¸€æ®µä»£ç ï¼š</p>
<pre><code class="lang-java">    @Configuration
    @EnableWebMvc
    public class WebConfig extends WebMvcConfigurerAdapter {

        @Override
        public void configurePathMatch(PathMatchConfigurer configurer) {
            configurer
                .setUseSuffixPatternMatch(true)
                .setUseTrailingSlashMatch(false)
                .setUseRegisteredSuffixPatternMatch(true)
                .setPathMatcher(antPathMatcher())
                .setUrlPathHelper(urlPathHelper());
        }

        @Bean
        public UrlPathHelper urlPathHelper() {
            //...
        }

        @Bean
        public PathMatcher antPathMatcher() {
            //...
        }

    }
</code></pre>
<p>åœ¨XMLå‘½åç©ºé—´ä¸‹å®ç°åŒæ ·çš„åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨<code>&lt;mvc:path-matching&gt;</code>å…ƒç´ ï¼š</p>
<pre><code class="lang-xml">    &lt;mvc:annotation-driven&gt;
        &lt;mvc:path-matching
            suffix-pattern=&quot;true&quot;
            trailing-slash=&quot;false&quot;
            registered-suffixes-only=&quot;true&quot;
            path-helper=&quot;pathHelper&quot;
            path-matcher=&quot;pathMatcher&quot;/&gt;
    &lt;/mvc:annotation-driven&gt;

    &lt;bean id=&quot;pathHelper&quot; class=&quot;org.example.app.MyPathHelper&quot;/&gt;
    &lt;bean id=&quot;pathMatcher&quot; class=&quot;org.example.app.MyPathMatcher&quot;/&gt;
</code></pre>
</section<section><h1 id="21-16-12-">21.16.12 æ¶ˆæ¯è½¬æ¢å™¨</h1>
<p>ä½¿ç”¨MVC Javaç¼–ç¨‹é…ç½®æ–¹å¼æ—¶ï¼Œå¦‚æœä½ æƒ³æ›¿æ¢Spring MVCæä¾›çš„é»˜è®¤è½¬æ¢å™¨ï¼Œå®Œå…¨å®šåˆ¶è‡ªå·±çš„<code>HttpMessageConverter</code>ï¼Œè¿™å¯ä»¥é€šè¿‡è¦†å†™<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurerAdapter.html#configureMessageConverters-java.util.List-"><code>configureMessageConverters()</code></a>æ–¹æ³•æ¥å®ç°ã€‚å¦‚æœä½ åªæ˜¯æƒ³å®šåˆ¶ä¸€ä¸‹ï¼Œæˆ–è€…æƒ³åœ¨é»˜è®¤è½¬æ¢å™¨ä¹‹å¤–å†æ·»åŠ å…¶ä»–çš„è½¬æ¢å™¨ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è¦†å†™<a href="http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurerAdapter.html#extendMessageConverters-java.util.List-"><code>extendMessageConverters()</code></a>æ–¹æ³•æ¥å®ç°ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€æ®µä¾‹å­ï¼Œå®ƒä½¿ç”¨å®šåˆ¶çš„<code>ObjectMapper</code>æ„é€ äº†æ–°çš„Jacksonçš„JSONå’ŒXMLè½¬æ¢å™¨ï¼Œå¹¶ç”¨å®ƒä»¬æ›¿æ¢äº†é»˜è®¤æä¾›çš„è½¬æ¢å™¨ï¼š</p>
<pre><code class="lang-java">    @Configuration
    @EnableWebMvc
    public class WebConfiguration extends WebMvcConfigurerAdapter {

        @Override
        public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
            Jackson2ObjectMapperBuilder builder = new Jackson2ObjectMapperBuilder()
                    .indentOutput(true)
                    .dateFormat(new SimpleDateFormat(&quot;yyyy-MM-dd&quot;))
                    .modulesToInstall(new ParameterNamesModule());
            converters.add(new MappingJackson2HttpMessageConverter(builder.build()));
            converters.add(new MappingJackson2XmlHttpMessageConverter(builder.xml().build()));
        }

    }
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>Jackson2ObjectMapperBuilder</code>ç”¨äºä¸º<code>MappingJackson2HttpMessageConverter</code>å’Œ<code>MappingJackson2XmlHttpMessageConverter</code>è½¬æ¢å™¨åˆ›å»ºå…¬å…±çš„é…ç½®ï¼Œæ¯”å¦‚å¯ç”¨tabç¼©è¿›ã€å®šåˆ¶çš„æ—¥æœŸæ ¼å¼ï¼Œå¹¶æ³¨å†Œäº†ä¸€ä¸ªæ¨¡å—<a href="https://github.com/FasterXML/jackson-module-parameter-names">jackson-module-parameter-names</a>ç”¨äºè·å–å‚æ•°åï¼ˆJava 8æ–°å¢çš„ç‰¹æ€§ï¼‰</p>
<blockquote>
<p>é™¤äº†<a href="http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22jackson-
dataformat-xml%22"><code>jackson-
dataformat-xml</code></a>ï¼Œè¦å¯ç”¨Jackson XMLçš„tabç¼©è¿›æ”¯æŒï¼Œè¿˜éœ€è¦ä¸€ä¸ª<a href="h
ttp://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22org.codehaus.woodstox%22%20A
ND%20a%3A%22woodstox-core-asl%22"><code>woodstox-core-asl</code></a>ä¾èµ–ã€‚</p>
</blockquote>
<p>è¿˜æœ‰å…¶ä»–æœ‰ç”¨çš„Jacksonæ¨¡å—å¯ä»¥ä½¿ç”¨ï¼š</p>
<ol>
<li><a href="https://github.com/zalando/jackson-datatype-money">jackson-datatype-money</a>ï¼šæä¾›äº†å¯¹<code>javax.money</code>ç±»å‹çš„æ”¯æŒï¼ˆéå®˜æ–¹æ¨¡å—ï¼‰</li>
<li><a href="https://github.com/FasterXML/jackson-datatype-hibernate">jackson-datatype-hibernate</a>ï¼šæä¾›äº†Hibernateç›¸å…³çš„ç±»å‹å’Œå±æ€§æ”¯æŒï¼ˆåŒ…å«æ‡’åŠ è½½aspectsï¼‰</li>
</ol>
<p>åœ¨XMLåšåŒæ ·çš„äº‹ä¹Ÿæ˜¯å¯èƒ½çš„ï¼š</p>
<pre><code class="lang-xml">&lt;mvc:annotation-driven&gt;
    &lt;mvc:message-converters&gt;
        &lt;bean class=&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;&gt;
            &lt;property name=&quot;objectMapper&quot; ref=&quot;objectMapper&quot;/&gt;
        &lt;/bean&gt;
        &lt;bean class=&quot;org.springframework.http.converter.xml.MappingJackson2XmlHttpMessageConverter&quot;&gt;
            &lt;property name=&quot;objectMapper&quot; ref=&quot;xmlMapper&quot;/&gt;
        &lt;/bean&gt;
    &lt;/mvc:message-converters&gt;
&lt;/mvc:annotation-driven&gt;

&lt;bean id=&quot;objectMapper&quot; class=&quot;org.springframework.http.converter.json.Jackson2ObjectMapperFactoryBean&quot;
      p:indentOutput=&quot;true&quot;
      p:simpleDateFormat=&quot;yyyy-MM-dd&quot;
      p:modulesToInstall=&quot;com.fasterxml.jackson.module.paramnames.ParameterNamesModule&quot;/&gt;

&lt;bean id=&quot;xmlMapper&quot; parent=&quot;objectMapper&quot; p:createXmlMapper=&quot;true&quot;/&gt;
</code></pre>
</section<section><h1 id="21-16-13-mvc-java-">21.16.13 ä½¿ç”¨MVC Javaç¼–ç¨‹è¿›è¡Œé«˜çº§å®šåˆ¶</h1>
<p>ä»ä¸Šé¢è®¸å¤šä¾‹å­ä½ å¯ä»¥çœ‹åˆ°ï¼ŒMVC Javaç¼–ç¨‹é…ç½®å’ŒMVCå‘½åç©ºé—´çš„æ–¹å¼éƒ½æä¾›äº†æ›´é«˜æŠ½è±¡å±‚çº§çš„åº”ç”¨é…ç½®ï¼Œå®ƒä¸éœ€è¦ä½ å¯¹åº•ä¸‹åˆ›å»ºçš„beanæœ‰éå¸¸æ·±å…¥çš„äº†è§£ï¼Œç›¸åï¼Œè¿™ä½¿å¾—ä½ èƒ½ä»…ä¸“æ³¨äºåº”ç”¨éœ€è¦çš„é…ç½®ã€‚ä¸è¿‡ï¼Œæœ‰æ—¶ä½ å¯èƒ½å¸Œæœ›å¯¹åº”ç”¨çš„æ›´ç²¾ç»†æ§åˆ¶ï¼Œæˆ–ä½ å°±æ˜¯å•çº¯å¸Œæœ›ç†è§£åº•ä¸‹çš„é…ç½®å’Œæœºåˆ¶ã€‚</p>
<p>è¦åšåˆ°æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œä½ è¦åšçš„ç¬¬ä¸€æ­¥å°±æ˜¯çœ‹çœ‹åº•å±‚éƒ½ä¸ºä½ åˆ›å»ºäº†å“ªäº›beanã€‚è‹¥ä½ ä½¿ç”¨MVC Javaç¼–ç¨‹çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œä½ å¯ä»¥çœ‹çœ‹javaæ–‡æ¡£ï¼Œä»¥åŠ<code>WebMvcConfigurationSupport</code>ç±»çš„<code>@Bean</code>æ–¹æ³•ã€‚è¿™ä¸ªç±»æœ‰çš„é…ç½®éƒ½ä¼šè‡ªåŠ¨è¢«<code>@EnableWebMvc</code>æ³¨è§£å¯¼å…¥ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä½ æ‰“å¼€<code>@EnableWebMvc</code>çš„å£°æ˜ï¼Œä½ å°±ä¼šçœ‹åˆ°åº”ç”¨äºå…¶ä¸Šçš„<code>@Import</code>æ³¨è§£ã€‚</p>
<p>ç²¾ç»†æ§åˆ¶çš„ä¸‹ä¸€æ­¥æ˜¯é€‰æ‹©ä¸€ä¸ª<code>WebMvcConfigurationSupport</code>åˆ›å»ºçš„beanï¼Œå®šåˆ¶å®ƒçš„å±æ€§ï¼Œæˆ–ä½ å¯ä»¥æä¾›è‡ªå·±çš„ä¸€ä¸ªå®ä¾‹ã€‚è¿™ç¡®ä¿åšåˆ°ä»¥ä¸‹ä¸¤æ­¥ï¼šç§»é™¤<code>@EnableWebMvc</code>æ³¨è§£ä»¥é¿å…é»˜è®¤é…ç½®è¢«è‡ªåŠ¨å¯¼å…¥ï¼Œç„¶åç»§æ‰¿<code>DelegatingWebMvcConfiguration</code>ç±»ï¼Œå®ƒæ˜¯<code>WebMvcConfigurationSupport</code>çš„ä¸€ä¸ªå­ç±»ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code class="lang-java">@Configuration
public class WebConfig extends DelegatingWebMvcConfiguration {

    @Override
    public void addInterceptors(InterceptorRegistry registry){
        // ...
    }

    @Override
    @Bean
    public RequestMappingHandlerAdapter requestMappingHandlerAdapter() {
        // è‡ªå·±åˆ›å»ºé€‚é…å™¨ï¼Œæˆ–è€…è°ƒç”¨superè®©åŸºç±»å¤„ç†
        // ç„¶ååœ¨è¿™é‡Œå®šåˆ¶beançš„ä¸€äº›å±æ€§
    }

}
</code></pre>
<blockquote>
<p>åº”ç”¨åº”è¯¥åªæœ‰ä¸€ä¸ªç»§æ‰¿<code>DelegatingWebMvcConfiguration</code>çš„é…ç½®ç±»ï¼Œæˆ–åªæœ‰ä¸€ä¸ª<code>@EnableWebMvc</code>æ³¨è§£çš„ç±»ï¼Œå› ä¸ºå®ƒä»¬èƒŒåæ³¨å†Œçš„beanéƒ½æ˜¯ç›¸åŒçš„ã€‚</p>
<p>ä½¿ç”¨è¿™ä¸ªæ–¹å¼ä¿®æ”¹beançš„å±æ€§ï¼Œä¸è¿™èŠ‚å‰é¢å±•ç¤ºçš„ä»»ä½•é«˜æŠ½è±¡å±‚çº§çš„é…ç½®æ–¹å¼å¹¶ä¸å†²çªã€‚<code>WebMvcConfigurerAdapter</code>çš„å­ç±»å’Œ<code>WebMvcConfigurer</code>çš„å®ç°éƒ½è¿˜æ˜¯ä¼šè¢«ä½¿ç”¨ã€‚</p>
</blockquote>
</section<section><h1 id="21-16-14-mvc-">21.16.14 ä½¿ç”¨MVCå‘½åç©ºé—´è¿›è¡Œé«˜çº§çš„å®šåˆ¶åŒ–</h1>
<p>å¦‚æœä½¿ç”¨MVCå‘½åç©ºé—´ï¼Œè¦åœ¨é»˜è®¤é…ç½®çš„åŸºç¡€ä¸Šå®ç°ç²’åº¦æ›´ç»†çš„æ§åˆ¶ï¼Œåˆ™è¦æ¯”ä½¿ç”¨MVC Javaç¼–ç¨‹é…ç½®çš„æ–¹å¼éš¾ä¸€äº›ã€‚</p>
<p>å¦‚æœä½ ç¡®å®éœ€è¦è¿™ä¹ˆåšï¼Œé‚£ä¹Ÿå°½é‡ä¸è¦å¤åˆ¶é»˜è®¤æä¾›çš„é…ç½®ï¼Œè¯·å°è¯•é…ç½®ä¸€ä¸ª<code>BeanPostProcessor</code>åç½®å¤„ç†å™¨ï¼Œç”¨å®ƒæ¥æ£€æµ‹ä½ è¦å®šåˆ¶çš„beanã€‚å¯ä»¥é€šè¿‡beançš„ç±»å‹æ¥æ‰¾ï¼Œæ‰¾åˆ°ä»¥åå†ä¿®æ”¹éœ€è¦å®šåˆ¶çš„å±æ€§å€¼ã€‚æ¯”å¦‚è¿™æ ·ï¼š</p>
<pre><code class="lang-java">@Component
public class MyPostProcessor implements BeanPostProcessor {

    public Object postProcessBeforeInitialization(Object bean, String name) throws BeansException {
        if (bean instanceof RequestMappingHandlerAdapter) {
            // ä¿®æ”¹é€‚é…å™¨çš„å±æ€§
        }
    }

}
</code></pre>
<p>æ³¨æ„ï¼Œ<code>MyPostProcessor</code>éœ€è¦è¢«åŒ…å«åœ¨<code>&lt;component scan/&gt;</code>çš„è·¯å¾„ä¸‹ï¼Œè¿™æ ·å®ƒæ‰èƒ½è¢«è‡ªåŠ¨æ£€æµ‹åˆ°ï¼›æˆ–è€…ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ˜¾å¼åœ°ç”¨ä¸€ä¸ªXMLçš„beanå®šä¹‰æ¥å£°æ˜å®ƒã€‚</p>
</section<!-- interpolation -->
        </div>
    </body>
</html>
